(function(){var e={5358:function(e,t,o){var a={"./af":2190,"./af.js":2190,"./ar":7218,"./ar-dz":5785,"./ar-dz.js":5785,"./ar-kw":9417,"./ar-kw.js":9417,"./ar-ly":6904,"./ar-ly.js":6904,"./ar-ma":8617,"./ar-ma.js":8617,"./ar-ps":1318,"./ar-ps.js":1318,"./ar-sa":2699,"./ar-sa.js":2699,"./ar-tn":6789,"./ar-tn.js":6789,"./ar.js":7218,"./az":3050,"./az.js":3050,"./be":8316,"./be.js":8316,"./bg":310,"./bg.js":310,"./bm":8884,"./bm.js":8884,"./bn":3469,"./bn-bd":6672,"./bn-bd.js":6672,"./bn.js":3469,"./bo":9118,"./bo.js":9118,"./br":3113,"./br.js":3113,"./bs":3626,"./bs.js":3626,"./ca":921,"./ca.js":921,"./cs":7799,"./cs.js":7799,"./cv":2828,"./cv.js":2828,"./cy":3521,"./cy.js":3521,"./da":6962,"./da.js":6962,"./de":3294,"./de-at":6158,"./de-at.js":6158,"./de-ch":5960,"./de-ch.js":5960,"./de.js":3294,"./dv":7963,"./dv.js":7963,"./el":3432,"./el.js":3432,"./en-au":998,"./en-au.js":998,"./en-ca":5931,"./en-ca.js":5931,"./en-gb":5930,"./en-gb.js":5930,"./en-ie":8081,"./en-ie.js":8081,"./en-il":1594,"./en-il.js":1594,"./en-in":3904,"./en-in.js":3904,"./en-nz":1507,"./en-nz.js":1507,"./en-sg":9409,"./en-sg.js":9409,"./eo":2177,"./eo.js":2177,"./es":4805,"./es-do":9155,"./es-do.js":9155,"./es-mx":9791,"./es-mx.js":9791,"./es-us":6098,"./es-us.js":6098,"./es.js":4805,"./et":6240,"./et.js":6240,"./eu":391,"./eu.js":391,"./fa":612,"./fa.js":612,"./fi":4220,"./fi.js":4220,"./fil":5570,"./fil.js":5570,"./fo":5466,"./fo.js":5466,"./fr":4461,"./fr-ca":6306,"./fr-ca.js":6306,"./fr-ch":7081,"./fr-ch.js":7081,"./fr.js":4461,"./fy":3484,"./fy.js":3484,"./ga":6957,"./ga.js":6957,"./gd":2978,"./gd.js":2978,"./gl":9866,"./gl.js":9866,"./gom-deva":5011,"./gom-deva.js":5011,"./gom-latn":4724,"./gom-latn.js":4724,"./gu":1601,"./gu.js":1601,"./he":9802,"./he.js":9802,"./hi":9358,"./hi.js":9358,"./hr":3907,"./hr.js":3907,"./hu":218,"./hu.js":218,"./hy-am":533,"./hy-am.js":533,"./id":2844,"./id.js":2844,"./is":7353,"./is.js":7353,"./it":6364,"./it-ch":774,"./it-ch.js":774,"./it.js":6364,"./ja":6008,"./ja.js":6008,"./jv":8221,"./jv.js":8221,"./ka":2417,"./ka.js":2417,"./kk":2071,"./kk.js":2071,"./km":6149,"./km.js":6149,"./kn":4572,"./kn.js":4572,"./ko":659,"./ko.js":659,"./ku":6285,"./ku-kmr":9398,"./ku-kmr.js":9398,"./ku.js":6285,"./ky":1609,"./ky.js":1609,"./lb":119,"./lb.js":119,"./lo":1748,"./lo.js":1748,"./lt":1973,"./lt.js":1973,"./lv":1347,"./lv.js":1347,"./me":3023,"./me.js":3023,"./mi":5747,"./mi.js":5747,"./mk":4341,"./mk.js":4341,"./ml":3840,"./ml.js":3840,"./mn":2058,"./mn.js":2058,"./mr":9182,"./mr.js":9182,"./ms":5197,"./ms-my":9136,"./ms-my.js":9136,"./ms.js":5197,"./mt":6408,"./mt.js":6408,"./my":1683,"./my.js":1683,"./nb":3141,"./nb.js":3141,"./ne":9344,"./ne.js":9344,"./nl":4703,"./nl-be":4641,"./nl-be.js":4641,"./nl.js":4703,"./nn":9873,"./nn.js":9873,"./oc-lnc":1217,"./oc-lnc.js":1217,"./pa-in":4612,"./pa-in.js":4612,"./pl":4457,"./pl.js":4457,"./pt":1089,"./pt-br":9146,"./pt-br.js":9146,"./pt.js":1089,"./ro":5950,"./ro.js":5950,"./ru":7292,"./ru.js":7292,"./sd":6774,"./sd.js":6774,"./se":7493,"./se.js":7493,"./si":3761,"./si.js":3761,"./sk":9711,"./sk.js":9711,"./sl":8558,"./sl.js":8558,"./sq":8633,"./sq.js":8633,"./sr":688,"./sr-cyrl":7903,"./sr-cyrl.js":7903,"./sr.js":688,"./ss":1991,"./ss.js":1991,"./sv":7020,"./sv.js":7020,"./sw":5891,"./sw.js":5891,"./ta":5714,"./ta.js":5714,"./te":206,"./te.js":206,"./tet":4768,"./tet.js":4768,"./tg":8276,"./tg.js":8276,"./th":7977,"./th.js":7977,"./tk":6928,"./tk.js":6928,"./tl-ph":8046,"./tl-ph.js":8046,"./tlh":1361,"./tlh.js":1361,"./tr":4367,"./tr.js":4367,"./tzl":627,"./tzl.js":627,"./tzm":2636,"./tzm-latn":8148,"./tzm-latn.js":8148,"./tzm.js":2636,"./ug-cn":8823,"./ug-cn.js":8823,"./uk":461,"./uk.js":461,"./ur":1366,"./ur.js":1366,"./uz":3454,"./uz-latn":8374,"./uz-latn.js":8374,"./uz.js":3454,"./vi":8572,"./vi.js":8572,"./x-pseudo":464,"./x-pseudo.js":464,"./yo":3709,"./yo.js":3709,"./zh-cn":5873,"./zh-cn.js":5873,"./zh-hk":7549,"./zh-hk.js":7549,"./zh-mo":2240,"./zh-mo.js":2240,"./zh-tw":405,"./zh-tw.js":405};function l(e){var t=n(e);return o(t)}function n(e){if(!o.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}l.keys=function(){return Object.keys(a)},l.resolve=n,e.exports=l,l.id=5358},7933:function(e,t,o){"use strict";var a=o(5130),l=o(6768),n=o(4232);const i={key:3,class:"main-content"},s={class:"content-wrapper"};function r(e,t,o,a,r,d){const c=(0,l.g2)("SideBar"),u=(0,l.g2)("TopBar"),p=(0,l.g2)("router-view");return(0,l.uX)(),(0,l.CE)("div",{id:"app",class:(0,n.C4)({"sidebar-open":r.isMobileSidebarOpen||!r.isSidebarCollapsed&&!1!==e.$route.meta.requiresSidebar,"topbar-open":!1!==e.$route.meta.requiresTopbar,"login-page":"/login"===e.$route.path,"sidebar-collapsed":r.isSidebarCollapsed,"calendar-page":"/calendar"===e.$route.path})},[!1!==e.$route.meta.requiresSidebar?((0,l.uX)(),(0,l.Wv)(c,{key:0,"is-collapsed":r.isSidebarCollapsed,"is-mobile-sidebar-open":r.isMobileSidebarOpen,onCloseMobileSidebar:t[0]||(t[0]=e=>r.isMobileSidebarOpen=!1)},null,8,["is-collapsed","is-mobile-sidebar-open"])):(0,l.Q3)("",!0),!1!==e.$route.meta.requiresTopbar?((0,l.uX)(),(0,l.Wv)(u,{key:1,"is-collapsed":r.isSidebarCollapsed,onToggleSidebar:d.toggleSidebar,onToggleMobileSidebar:d.toggleMobileSidebar},null,8,["is-collapsed","onToggleSidebar","onToggleMobileSidebar"])):(0,l.Q3)("",!0),"/login"===e.$route.path?((0,l.uX)(),(0,l.Wv)(p,{key:2})):((0,l.uX)(),(0,l.CE)("div",i,[(0,l.Lk)("div",s,[(0,l.bF)(p)])]))],2)}const d={class:"logo-container"},c={key:0,src:"https://app.gixflow.cloud/flow_logo-removebg.png",alt:"GIX Flow Logo",class:"logo"},u={key:1,class:"logo-text"},p={key:0},h={key:0},m={key:0},g={key:0},k={key:0},f={key:0},L={key:0},v={key:0,class:"sidebar-quote-wrapper"},b={class:"sidebar-info"},y={class:"user-greeting"},_={class:"info-meta"},C={class:"info-item"},w={class:"info-item"},A={class:"quote-box fade-in"};function E(e,t,o,a,i,s){const r=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.Lk)("div",{class:(0,n.C4)(["sidebar",{collapsed:o.isCollapsed},{"mobile-open":o.isMobileSidebarOpen}])},[(0,l.Lk)("div",d,[o.isCollapsed?((0,l.uX)(),(0,l.CE)("div",u,"GF")):((0,l.uX)(),(0,l.CE)("img",c))]),t[35]||(t[35]=(0,l.Lk)("span",{class:"sidebar-element"},"MENU",-1)),(0,l.Lk)("ul",null,[(0,l.Lk)("li",null,[(0,l.bF)(r,{to:"/"},{default:(0,l.k6)((()=>[t[6]||(t[6]=(0,l.Lk)("i",{class:"fas fa-home"},null,-1)),o.isCollapsed?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("span",p,"Dashboard"))])),_:1})]),(0,l.Lk)("li",{onClick:t[0]||(t[0]=e=>s.toggleSubMenu("appointments")),class:"has-submenu"},[(0,l.Lk)("div",{class:(0,n.C4)(["submenu-title",{open:i.subMenus.appointments}])},[t[7]||(t[7]=(0,l.Lk)("i",{class:"fas fa-calendar-check"},null,-1)),o.isCollapsed?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("span",h,"Appuntamenti")),o.isCollapsed?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("i",{key:1,class:(0,n.C4)([i.subMenus.appointments?"fas fa-chevron-down":"fas fa-chevron-right","submenu-icon"])},null,2))],2),(0,l.Lk)("ul",{class:(0,n.C4)(["submenu",{open:i.subMenus.appointments}])},[(0,l.Lk)("li",null,[(0,l.bF)(r,{to:"/calendar"},{default:(0,l.k6)((()=>t[8]||(t[8]=[(0,l.Lk)("i",{class:"fas fa-angle-right"},null,-1),(0,l.eW)("Calendario")]))),_:1})]),(0,l.Lk)("li",null,[(0,l.bF)(r,{to:"/appointments"},{default:(0,l.k6)((()=>t[9]||(t[9]=[(0,l.Lk)("i",{class:"fas fa-angle-right"},null,-1),(0,l.eW)("Elenco Appuntamenti")]))),_:1})]),(0,l.Lk)("li",null,[(0,l.bF)(r,{to:"/agenda-schedules"},{default:(0,l.k6)((()=>t[10]||(t[10]=[(0,l.Lk)("i",{class:"fas fa-angle-right"},null,-1),(0,l.eW)("Schedulazioni")]))),_:1})])],2)]),(0,l.Lk)("li",null,[(0,l.bF)(r,{to:"/clients"},{default:(0,l.k6)((()=>[t[11]||(t[11]=(0,l.Lk)("i",{class:"fas fa-users"},null,-1)),o.isCollapsed?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("span",m,"Clienti"))])),_:1})]),(0,l.Lk)("li",{onClick:t[1]||(t[1]=e=>s.toggleSubMenu("reports")),class:"has-submenu"},[(0,l.Lk)("div",{class:(0,n.C4)(["submenu-title",{open:i.subMenus.reports}])},[t[12]||(t[12]=(0,l.Lk)("i",{class:"fas fa-file-contract"},null,-1)),o.isCollapsed?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("span",g,"Reports")),o.isCollapsed?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("i",{key:1,class:(0,n.C4)([i.subMenus.reports?"fas fa-chevron-down":"fas fa-chevron-right","submenu-icon"])},null,2))],2),(0,l.Lk)("ul",{class:(0,n.C4)(["submenu",{open:i.subMenus.reports}])},[(0,l.Lk)("li",null,[(0,l.bF)(r,{to:"/reports/appointments-report"},{default:(0,l.k6)((()=>t[13]||(t[13]=[(0,l.Lk)("i",{class:"fas fa-angle-right"},null,-1),(0,l.eW)("Appuntamenti")]))),_:1})]),(0,l.Lk)("li",null,[(0,l.bF)(r,{to:"/reports/contracts-by-agent-report"},{default:(0,l.k6)((()=>t[14]||(t[14]=[(0,l.Lk)("i",{class:"fas fa-angle-right"},null,-1),(0,l.eW)("Contratti per agente")]))),_:1})]),(0,l.Lk)("li",null,[(0,l.bF)(r,{to:"/reports/location-efficiency-report"},{default:(0,l.k6)((()=>t[15]||(t[15]=[(0,l.Lk)("i",{class:"fas fa-angle-right"},null,-1),(0,l.eW)("Efficienza per sede")]))),_:1})]),(0,l.Lk)("li",null,[(0,l.bF)(r,{to:"/reports/operator-performance-report"},{default:(0,l.k6)((()=>t[16]||(t[16]=[(0,l.Lk)("i",{class:"fas fa-angle-right"},null,-1),(0,l.eW)("Performance operatori")]))),_:1})])],2)]),(0,l.Lk)("li",{onClick:t[2]||(t[2]=e=>s.toggleSubMenu("contracts")),class:"has-submenu"},[(0,l.Lk)("div",{class:(0,n.C4)(["submenu-title",{open:i.subMenus.contracts}])},[t[17]||(t[17]=(0,l.Lk)("i",{class:"fas fa-file-signature"},null,-1)),o.isCollapsed?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("span",k,"Contratti")),o.isCollapsed?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("i",{key:1,class:(0,n.C4)([i.subMenus.contracts?"fas fa-chevron-down":"fas fa-chevron-right","submenu-icon"])},null,2))],2),(0,l.Lk)("ul",{class:(0,n.C4)(["submenu",{open:i.subMenus.contracts}])},[(0,l.Lk)("li",null,[(0,l.bF)(r,{to:"/contracts"},{default:(0,l.k6)((()=>t[18]||(t[18]=[(0,l.Lk)("i",{class:"fas fa-angle-right"},null,-1),(0,l.eW)("Elenco Contratti")]))),_:1})]),(0,l.Lk)("li",null,[(0,l.bF)(r,{to:"/contracts/new"},{default:(0,l.k6)((()=>t[19]||(t[19]=[(0,l.Lk)("i",{class:"fas fa-angle-right"},null,-1),(0,l.eW)("Nuovo Contratto")]))),_:1})])],2)]),(0,l.Lk)("li",{onClick:t[3]||(t[3]=e=>s.toggleSubMenu("commissioning")),class:"has-submenu"},[(0,l.Lk)("div",{class:(0,n.C4)(["submenu-title",{open:i.subMenus.commissioning}])},[t[20]||(t[20]=(0,l.Lk)("i",{class:"fas fa-credit-card"},null,-1)),o.isCollapsed?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("span",f,"Commissioning")),o.isCollapsed?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("i",{key:1,class:(0,n.C4)([i.subMenus.commissioning?"fas fa-chevron-down":"fas fa-chevron-right","submenu-icon"])},null,2))],2),(0,l.Lk)("ul",{class:(0,n.C4)(["submenu",{open:i.subMenus.commissioning}])},[(0,l.Lk)("li",null,[(0,l.bF)(r,{to:"/commissioning/agents"},{default:(0,l.k6)((()=>t[21]||(t[21]=[(0,l.Lk)("i",{class:"fas fa-angle-right"},null,-1),(0,l.eW)("Agenti")]))),_:1})]),(0,l.Lk)("li",null,[(0,l.bF)(r,{to:"/commissioning/operators"},{default:(0,l.k6)((()=>t[22]||(t[22]=[(0,l.Lk)("i",{class:"fas fa-angle-right"},null,-1),(0,l.eW)("Operatori")]))),_:1})])],2)]),(0,l.Lk)("li",{onClick:t[4]||(t[4]=e=>s.toggleSubMenu("settings")),class:"has-submenu"},[(0,l.Lk)("div",{class:(0,n.C4)(["submenu-title",{open:i.subMenus.settings}])},[t[23]||(t[23]=(0,l.Lk)("i",{class:"fas fa-wrench"},null,-1)),o.isCollapsed?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("span",L,"Impostazioni")),o.isCollapsed?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("i",{key:1,class:(0,n.C4)([i.subMenus.settings?"fas fa-chevron-down":"fas fa-chevron-right","submenu-icon"])},null,2))],2),(0,l.Lk)("ul",{class:(0,n.C4)(["submenu",{open:i.subMenus.settings}])},[(0,l.Lk)("li",null,[(0,l.bF)(r,{to:"/user/profile"},{default:(0,l.k6)((()=>t[24]||(t[24]=[(0,l.Lk)("i",{class:"fas fa-angle-right"},null,-1),(0,l.eW)("Area Personale")]))),_:1})]),(0,l.Lk)("li",null,[(0,l.bF)(r,{to:"/settings/email"},{default:(0,l.k6)((()=>t[25]||(t[25]=[(0,l.Lk)("i",{class:"fas fa-angle-right"},null,-1),(0,l.eW)("Configura E-Mail")]))),_:1})]),(0,l.Lk)("li",null,[(0,l.bF)(r,{to:"/settings/generate-api-key"},{default:(0,l.k6)((()=>t[26]||(t[26]=[(0,l.Lk)("i",{class:"fas fa-angle-right"},null,-1),(0,l.eW)("API")]))),_:1})]),(0,l.Lk)("li",null,[(0,l.bF)(r,{to:"/settings/logs"},{default:(0,l.k6)((()=>t[27]||(t[27]=[(0,l.Lk)("i",{class:"fas fa-angle-right"},null,-1),(0,l.eW)("Logs")]))),_:1})]),(0,l.Lk)("li",null,[(0,l.bF)(r,{to:"/settings/tables"},{default:(0,l.k6)((()=>t[28]||(t[28]=[(0,l.Lk)("i",{class:"fas fa-angle-right"},null,-1),(0,l.eW)("Tabelle")]))),_:1})]),(0,l.Lk)("li",null,[(0,l.bF)(r,{to:"/users"},{default:(0,l.k6)((()=>t[29]||(t[29]=[(0,l.Lk)("i",{class:"fas fa-angle-right"},null,-1),(0,l.eW)("Utenti")]))),_:1})])],2)])]),o.isCollapsed?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",v,[(0,l.Lk)("div",b,[(0,l.Lk)("div",y,[t[31]||(t[31]=(0,l.Lk)("i",{class:"fas fa-hand-sparkles waving-icon"},null,-1)),(0,l.Lk)("span",null,[t[30]||(t[30]=(0,l.eW)("Ciao ")),(0,l.Lk)("strong",null,(0,n.v_)(i.user.nome),1)])]),(0,l.Lk)("div",_,[(0,l.Lk)("div",C,[t[32]||(t[32]=(0,l.Lk)("i",{class:"fas fa-calendar-day"},null,-1)),(0,l.Lk)("span",null,(0,n.v_)(i.currentDate),1)]),(0,l.Lk)("div",w,[t[33]||(t[33]=(0,l.Lk)("i",{class:"fas fa-clock"},null,-1)),(0,l.Lk)("span",null,(0,n.v_)(i.currentTime),1)])])]),(0,l.Lk)("div",A,[t[34]||(t[34]=(0,l.Lk)("i",{class:"fas fa-quote-left"},null,-1)),(0,l.Lk)("span",null,(0,n.v_)(i.motivationalQuote),1)])]))],2),o.isMobileSidebarOpen?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"mobile-sidebar-overlay",onClick:t[5]||(t[5]=t=>e.$emit("close-mobile-sidebar"))})):(0,l.Q3)("",!0)],64)}o(4114);var P=o(4373),D=o(5068),S={name:"SideBar",props:{isCollapsed:{type:Boolean,default:!1},isMobileSidebarOpen:{type:Boolean,default:!1}},emits:["closeMobileSidebar"],data(){return{user:{nome:"",cognome:"",role:""},currentTime:"",currentDate:"",motivationalQuote:"",quotes:["Sii il cambiamento che vuoi vedere nel mondo.","Ogni giorno è una nuova opportunità.","Dai il massimo, sempre.","Il successo è una somma di piccoli sforzi.","Non fermarti finché non sei fiero."],subMenus:{appointments:!1,settings:!1,commissioning:!1,contracts:!1,reports:!1},routeGroups:{"/calendar":"appointments","/appointments":"appointments","/agenda-schedules":"appointments","/reports/appointments-report":"reports","/reports/contracts-by-agent-report":"reports","/reports/location-efficiency-report":"reports","/reports/operator-performance-report":"reports","/contracts":"contracts","/contracts/new":"contracts","/commissioning/agents":"commissioning","/commissioning/operators":"commissioning","/user/profile":"settings","/settings/email":"settings","/settings/generate-api-key":"settings","/settings/logs":"settings","/settings/tables":"settings","/users":"settings"}}},watch:{"$route.path"(){this.setActiveSubMenuFromRoute()},isCollapsed(e){if(e)for(const t in this.subMenus)this.subMenus[t]=!1}},methods:{setActiveSubMenuFromRoute(){const e=this.$route.path,t=this.routeGroups[e];for(const o in this.subMenus)this.subMenus[o]=o===t},toggleSubMenu(e){if(!this.isCollapsed)for(const t in this.subMenus)this.subMenus[t]=t===e&&!this.subMenus[t]},loadUserData(){const e=localStorage.getItem("token");if(e)try{const t=(0,D.s)(e);this.user.nome=t.nome||"Sconosciuto",this.user.cognome=t.cognome||"",this.user.role=t.role||"Nessun ruolo"}catch(t){console.error("[DEBUG] Errore decodifica token:",t)}},logout(){const e=localStorage.getItem("token");e?P.A.post("https://app.gixflow.cloud/api/auth/logout",{},{headers:{Authorization:`Bearer ${e}`}}).then((()=>{localStorage.removeItem("token"),delete P.A.defaults.headers.common["Authorization"],this.$router.push("/login")})).catch((e=>{console.warn("Errore logout (fallback):",e),localStorage.removeItem("token"),delete P.A.defaults.headers.common["Authorization"],this.$router.push("/login")})):this.$router.push("/login")},updateDateTime(){const e=new Date;this.currentTime=e.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),this.currentDate=e.toLocaleDateString("it-IT",{weekday:"long",day:"numeric",month:"numeric",year:"numeric"})},updateQuote(){const e=Math.floor(Math.random()*this.quotes.length);this.motivationalQuote=this.quotes[e]}},mounted(){this.loadUserData(),this.updateDateTime(),this.updateQuote(),this.setActiveSubMenuFromRoute(),setInterval(this.updateDateTime,1e3),setInterval(this.updateQuote,1e4)}},x=o(1241);const F=(0,x.A)(S,[["render",E]]);var M=F;const V={class:"topbar"},U={class:"left-section"},I={class:"left-section"},O={class:"right-section"},X={class:"user-menu"},T={class:"user-info-tb"},$={class:"user-details-inline"},z={class:"user-initial-icon"};function R(e,t,o,a,i,s){const r=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)("header",V,[(0,l.Lk)("div",U,[(0,l.Lk)("div",I,[(0,l.Lk)("button",{class:"toggle-btn",onClick:t[0]||(t[0]=t=>e.$emit("toggle-sidebar"))},[(0,l.Lk)("i",{class:(0,n.C4)((o.isCollapsed,"fas fa-bars"))},null,2)]),t[3]||(t[3]=(0,l.Lk)("div",{class:"mobile-logo"},[(0,l.Lk)("h4",null,"flow.")],-1))])]),(0,l.Lk)("div",O,[(0,l.Lk)("div",X,[(0,l.Lk)("div",T,[(0,l.Lk)("div",$,[(0,l.bF)(r,{to:"/user/profile",class:"user-info-link"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",z,(0,n.v_)(i.user.nome.charAt(0).toUpperCase()),1)])),_:1})]),(0,l.Lk)("i",{class:"fas fa-sign-out-alt logout-icon",onClick:t[1]||(t[1]=(...e)=>s.logout&&s.logout(...e)),title:"Logout"})])]),(0,l.Lk)("button",{class:"mobile-toggle-btn",onClick:t[2]||(t[2]=t=>e.$emit("toggle-mobile-sidebar"))},t[4]||(t[4]=[(0,l.Lk)("i",{class:"fas fa-bars"},null,-1)]))])])}var W={name:"TopBar",data(){return{user:{nome:"Utente",cognome:"",role:"Nessun ruolo"}}},props:{isCollapsed:{type:Boolean,default:!1}},methods:{logout(){const e=localStorage.getItem("token");if(!e)return console.warn("Nessun token trovato, esco comunque."),void this.$router.push("/login");P.A.post("https://app.gixflow.cloud/api/auth/logout",{},{headers:{Authorization:`Bearer ${e}`}}).then((()=>{console.log("Logout registrato nel backend"),localStorage.removeItem("token"),delete P.A.defaults.headers.common["Authorization"],this.$router.push("/login")})).catch((e=>{console.error("Errore nel logout:",e.response?.data||e.message),localStorage.removeItem("token"),delete P.A.defaults.headers.common["Authorization"],this.$router.push("/login")}))},loadUserData(){const e=localStorage.getItem("token");if(e)try{const t=(0,D.s)(e);console.log("[DEBUG] Dati utente decodificati:",t),this.user.nome=t.nome||"Sconosciuto",this.user.cognome=t.cognome||"",this.user.role="number"!==typeof t.role&&isNaN(parseInt(t.role))?t.role||"Nessun ruolo":this.getRoleName(t.role),console.log("[DEBUG] Ruolo utente raw:",t.role)}catch(t){console.error("[DEBUG] Errore nella decodifica del token:",t)}},getRoleName(e){const t={1:"Admin",2:"Manager",3:"Operatore",4:"Commerciale",5:"Super Admin"},o=parseInt(e);return t[o]||"Nessun ruolo"}},mounted(){this.loadUserData()}};const N=(0,x.A)(W,[["render",R],["__scopeId","data-v-571d6a9a"]]);var j=N,B={name:"App",components:{SideBar:M,TopBar:j},data(){return{isSidebarCollapsed:!1,isMobileSidebarOpen:!1}},methods:{toggleSidebar(){window.innerWidth<=768?this.toggleMobileSidebar():this.isSidebarCollapsed=!this.isSidebarCollapsed},toggleMobileSidebar(){window.innerWidth<=768&&(this.isMobileSidebarOpen=!this.isMobileSidebarOpen)}},mounted(){this.isMobileSidebarOpen=!1}};const q=(0,x.A)(B,[["render",r],["__scopeId","data-v-6591749a"]]);var K=q,Y=o(7721),J=(o(4979),o(1387));const Q={class:"header"},G={class:"actions"},H={class:"filter-bar"},Z={class:"dashboard"},ee={class:"sparkline-grid"},te={class:"charts-container"},oe={class:"chart wide-3"},ae={class:"chart"},le={class:"chart wide-3"},ne={class:"chart"},ie={class:"chart"},se={class:"chart"},re={class:"chart wide-2"};function de(e,t,o,a,i,s){const r=(0,l.g2)("MonthYearPicker"),d=(0,l.g2)("SparkBox"),c=(0,l.g2)("apexchart");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.Lk)("div",Q,[(0,l.Lk)("div",G,[(0,l.Lk)("div",H,[t[1]||(t[1]=(0,l.Lk)("label",null,"Periodo:",-1)),(0,l.bF)(r,{modelValue:e.selectedMonth,"onUpdate:modelValue":t[0]||(t[0]=t=>e.selectedMonth=t)},null,8,["modelValue"])])])]),(0,l.Lk)("div",Z,[t[2]||(t[2]=(0,l.Lk)("h3",null,"Rese orarie per sede",-1)),(0,l.Lk)("div",ee,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.hourlyYieldStats,((t,o)=>((0,l.uX)(),(0,l.Wv)(d,{key:o,title:`${parseFloat(t.yield).toFixed(2)} app/h`,subtitle:t.location,data:[t.hours,t.appointments,t.yield],color:e.getColorByIndex(o),class:(0,n.C4)(`spark-${o}`)},null,8,["title","subtitle","data","color","class"])))),128))]),(0,l.Lk)("div",te,[(0,l.Lk)("div",oe,[(0,l.bF)(c,{type:"bar",height:"250",options:e.loginHeatmapOptions,series:e.loginHeatmapSeries},null,8,["options","series"])]),(0,l.Lk)("div",ae,[(0,l.bF)(c,{type:"bar",height:"250",options:e.usersStackedBarOptions,series:e.usersStackedBarSeries},null,8,["options","series"])]),(0,l.Lk)("div",le,[(0,l.bF)(c,{type:"area",height:"250",options:e.appointmentsHeatmapOptions,series:e.appointmentsHeatmapSeries},null,8,["options","series"])]),(0,l.Lk)("div",ne,[(0,l.bF)(c,{type:"bar",height:"320",options:e.conversionChartOptions,series:e.conversionChartSeries},null,8,["options","series"])]),(0,l.Lk)("div",ie,[(0,l.bF)(c,{type:"treemap",height:"300",options:e.contractsVendorTreemapOptions,series:e.contractsVendorTreemapSeries},null,8,["options","series"])]),(0,l.Lk)("div",se,[(0,l.bF)(c,{type:"donut",height:"250",options:e.conversionsDonutOptions,series:e.conversionsDonutSeries},null,8,["options","series"])]),(0,l.Lk)("div",re,[(0,l.bF)(c,{type:"line",height:"250",options:e.contractsLineOptions,series:e.contractsLineSeries},null,8,["options","series"])])])])],64)}o(8111),o(2489),o(7588),o(1701),o(7642),o(8004),o(3853),o(5876),o(2475),o(5024),o(1698);var ce=o(1576),ue=o.n(ce),pe=(o(6697),o(1805));const he={class:"spark-box"},me={class:"subtitle"};function ge(e,t,o,a,i,s){const r=(0,l.g2)("apexchart");return(0,l.uX)(),(0,l.CE)("div",he,[(0,l.Lk)("h2",null,(0,n.v_)(o.title),1),(0,l.Lk)("p",me,(0,n.v_)(o.subtitle),1),(0,l.bF)(r,{type:o.type,height:"100",options:s.options,series:s.series},null,8,["type","options","series"])])}var ke={name:"SparkBox",components:{apexchart:pe.A},props:{title:String,subtitle:String,type:{type:String,default:"area"},color:{type:String,default:"#007bff"},data:{type:Array,required:!0}},computed:{series(){return[{data:this.data}]},options(){return{chart:{type:this.type,sparkline:{enabled:!0}},stroke:{curve:"straight",width:2},fill:{opacity:.3},yaxis:{min:0},colors:[this.color],tooltip:{enabled:!1}}}}};const fe=(0,x.A)(ke,[["render",ge],["__scopeId","data-v-d08aae14"]]);var Le=fe;const ve={class:"month-year-picker"},be=["value"],ye=["value"];function _e(e,t,o,i,s,r){return(0,l.uX)(),(0,l.CE)("div",ve,[(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.selectedMonth=e),onChange:t[1]||(t[1]=(...e)=>i.emitDate&&i.emitDate(...e))},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.months,((e,t)=>((0,l.uX)(),(0,l.CE)("option",{key:t,value:t+1},(0,n.v_)(e),9,be)))),128))],544),[[a.u1,i.selectedMonth]]),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>i.selectedYear=e),onChange:t[3]||(t[3]=(...e)=>i.emitDate&&i.emitDate(...e))},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.years,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,n.v_)(e),9,ye)))),128))],544),[[a.u1,i.selectedYear]])])}var Ce=o(144),we={name:"MonthYearPicker",props:{modelValue:{type:String,required:!0}},emits:["update:modelValue"],setup(e,{emit:t}){const o=["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],a=(0,Ce.KR)(1),n=(0,Ce.KR)(ue()().year()),i=(0,l.EW)((()=>{const e=ue()().year();return Array.from({length:5},((t,o)=>e-2+o))}));function s(){const e=String(a.value).padStart(2,"0");t("update:modelValue",`${n.value}-${e}`)}return(0,l.sV)((()=>{if(e.modelValue){const[t,o]=e.modelValue.split("-");n.value=parseInt(t),a.value=parseInt(o)}})),{months:o,years:i,selectedMonth:a,selectedYear:n,emitDate:s}}};const Ae=(0,x.A)(we,[["render",_e],["__scopeId","data-v-187f53e5"]]);var Ee=Ae;ue().locale("it");var Pe=(0,l.pM)({name:"DashboardPage",components:{MonthYearPicker:Ee,apexchart:pe.A,SparkBox:Le},data(){return{loginHeatmapOptions:{legend:{position:"top",horizontalAlign:"right",fontSize:"13px",fontWeight:500,markers:{width:12,height:12,radius:4},floating:!1,offsetY:-40},chart:{type:"bar",stacked:!0,toolbar:{show:!1}},title:{text:"Login per sede",style:{fontSize:"20px",fontWeight:"bold",fontFamily:"inherit"}},subtitle:{text:"Dati aggiornati al mese selezionato",align:"left",margin:10,offsetX:0,style:{fontSize:"14px",color:"#666"}},xaxis:{type:"category",labels:{style:{fontSize:"13px"},formatter:e=>ue()(e,"YYYY-MM-DD").format("DD MMM")}},yaxis:{labels:{style:{fontSize:"13px"}}},dataLabels:{enabled:!1},colors:["#c35573","#71b095","#34495e"]},usersStackedBarOptions:{chart:{stacked:!0,toolbar:{show:!1}},title:{text:"Utenti attivi",align:"left",style:{fontSize:"20px",fontWeight:"bold",fontFamily:"inherit"}},subtitle:{text:"Dati aggiornati in real time",align:"left",style:{fontSize:"14px",color:"#666"}},plotOptions:{bar:{horizontal:!0,dataLabels:{position:"center"}}},dataLabels:{enabled:!0,style:{colors:["#fff"]}},xaxis:{title:{style:{fontWeight:"bold"}},labels:{style:{fontSize:"13px"}}},yaxis:{categories:[],title:{style:{fontWeight:"bold"}},labels:{style:{fontSize:"13px"}}},legend:{position:"top",horizontalAlign:"right",fontSize:"13px",fontWeight:500,markers:{width:12,height:12,radius:4},floating:!1,offsetY:-40},colors:["#c35573","#34495e","#8e24aa"]},appointmentsHeatmapOptions:{legend:{position:"top",horizontalAlign:"right",fontSize:"13px",fontWeight:500,markers:{width:12,height:12,radius:4},floating:!1,offsetY:-40},chart:{type:"area",stacked:!0,toolbar:{show:!1}},title:{text:"Appuntamenti per sede",align:"left",style:{fontSize:"20px",fontWeight:"bold",fontFamily:"inherit"}},subtitle:{text:"Dati aggiornati al mese selezionato",align:"left",margin:10,offsetX:0,style:{fontSize:"14px",color:"#666"}},xaxis:{type:"datetime",labels:{format:"dd MMM",style:{fontSize:"12px"}}},yaxis:{},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.5,opacityTo:.2,stops:[0,90,100]}},colors:["#c35573","#71b095","#34495e"]},conversionChartOptions:{chart:{type:"bar",stacked:!1,toolbar:{show:!0}},title:{text:"% Conversione per sede",style:{fontSize:"20px",fontWeight:"bold",fontFamily:"inherit"}},subtitle:{text:"Dati aggiornati al mese selezionato",align:"left",margin:10,offsetX:0,style:{fontSize:"14px",color:"#666"}},xaxis:{categories:[],labels:{style:{fontSize:"13px"}}},yaxis:{labels:{formatter:e=>`${e.toFixed(1)}%`}},tooltip:{y:{formatter:function(e,{seriesIndex:t,dataPointIndex:o,w:a}){const l=a.globals.seriesNames[t],n=a.config.xaxis.categories[o];return`${l} @ ${n}: ${e.toFixed(1)}%`}}},plotOptions:{bar:{horizontal:!1}},legend:{position:"bottom"},fill:{opacity:1},colors:["#c35573","#71b095","#34495e","#ff8c00","#17a2b8"]},contractsVendorTreemapOptions:{chart:{type:"treemap",toolbar:{show:!1}},title:{text:"Contratti per vendor (mensile)",align:"left",style:{fontSize:"20px",fontWeight:"bold",fontFamily:"inherit"}},subtitle:{text:"Dati aggiornati al mese selezionato",align:"left",style:{fontSize:"14px",color:"#666"}},colors:["#71b095","#34495e","#c35573","#ff8c00","#20c997","#007bff","#e83e8c","#ffc107","#6f42c1"],dataLabels:{enabled:!0,style:{fontSize:"14px",colors:["#fff"]},formatter:function(e,t){return`${e}: ${t.w.globals.series[t.seriesIndex][t.dataPointIndex]}`}},plotOptions:{treemap:{distributed:!0,enableShades:!0,shadeIntensity:.4}}},conversionsDonutOptions:{labels:[],legend:{position:"top",horizontalAlign:"right",fontSize:"13px",fontWeight:500,markers:{width:12,height:12,radius:4},floating:!1,offsetY:-15},title:{text:"Conversioni per sede",align:"left",style:{fontSize:"20px",fontWeight:"bold",fontFamily:"inherit"}},subtitle:{text:"Dati aggiornati al mese selezionato",align:"left",style:{fontSize:"14px",color:"#666"}},colors:["#c35573","#71b095","#34495e"]},contractsLineOptions:{chart:{id:"contracts-line",toolbar:{show:!1}},title:{text:"Contratti attivati per agente (settimanale)",align:"left",style:{fontSize:"20px",fontWeight:"bold",fontFamily:"inherit"}},subtitle:{text:"Dati aggiornati al mese selezionato",align:"left",style:{fontSize:"14px",color:"#666"}},xaxis:{categories:[],title:{text:"Settimana",style:{fontWeight:"bold"}},labels:{style:{fontSize:"13px"}}},yaxis:{title:{text:"Numero contratti",style:{fontWeight:"bold"}},labels:{style:{fontSize:"13px"}}},stroke:{curve:"smooth"},legend:{position:"top",horizontalAlign:"right",fontSize:"13px",fontWeight:500,markers:{width:12,height:12,radius:4},floating:!1,offsetY:-40},colors:["#c35573","#71b095","#34495e"]},selectedMonth:ue()().format("YYYY-MM"),loginHeatmapSeries:[],usersStackedBarSeries:[],appointmentsHeatmapSeries:[],conversionChartSeries:[],contractsVendorTreemapSeries:[],conversionsDonutSeries:[],contractsLineSeries:[],hourlyYieldStats:[]}},mounted(){this.fetchAllData(),this.fetchActiveUsersSummary()},methods:{async fetchLoginSummary(e){try{const{data:t}=await P.A.get("https://dev.gixflow.cloud/api/db/ast/login-summary",{params:{month:e}}),o={};t.forEach((({location:e,date:t,total_hours:a})=>{o[e]||(o[e]=[]),o[e].push({x:t,y:a})})),this.loginHeatmapSeries=Object.entries(o).map((([e,t])=>({name:e,data:t})))}catch(t){console.error("Errore nel recupero login summary:",t)}},async fetchPositiveAppointmentsMonthlySummary(e){try{const{data:t}=await P.A.get("https://dev.gixflow.cloud/api/db/positive-appointments/daily-summary",{params:{month:e}});if(!t||0===t.length)return this.posAppointmentsHeatmapSeries=[],void console.warn("⚠️ Nessun dato disponibile per il mese:",e);const{startDate:o,endDate:a}=this.getStartEndDate(e),l=[];let n=ue()(o);while(n.isBefore(a)||n.isSame(a))l.push(n.format("YYYY-MM-DD")),n=n.add(1,"day");const i={};t.forEach((({date:e,location:t,total:o})=>{i[t]||(i[t]={}),i[t][e]=o})),this.posAppointmentsHeatmapSeries=Object.entries(i).map((([e,t])=>({name:e,data:l.map((e=>({x:e,y:t[e]||0})))})))}catch(t){console.error("❌ Errore nel fetch app positivi per sede:",t)}},async fetchAppointmentsMonthlySummary(e){try{const{data:t}=await P.A.get("https://dev.gixflow.cloud/api/db/appointments/daily-summary",{params:{month:e}});if(!t||0===t.length)return this.appointmentsHeatmapSeries=[],void console.warn("⚠️ Nessun dato disponibile per il mese:",e);const{startDate:o,endDate:a}=this.getStartEndDate(e),l=[];let n=ue()(o);while(n.isBefore(a)||n.isSame(a))l.push(n.format("YYYY-MM-DD")),n=n.add(1,"day");const i={};t.forEach((({date:e,location:t,total:o})=>{i[t]||(i[t]={}),i[t][e]=o})),this.appointmentsHeatmapSeries=Object.entries(i).map((([e,t])=>({name:e,data:l.map((e=>({x:e,y:t[e]||0})))})))}catch(t){console.error("❌ Errore nel fetch app per sede:",t)}},async fetchConversionsSummary(e){try{const{data:t}=await P.A.get("https://dev.gixflow.cloud/api/db/appointments/conversions-summary",{params:{month:e}});this.conversionsDonutSeries=t.map((e=>e.total)),this.conversionsDonutOptions={...this.conversionsDonutOptions,labels:t.map((e=>e.location))}}catch(t){console.error("Errore nel fetch conversion summary:",t)}},async fetchActiveUsersSummary(){try{const{data:e}=await P.A.get("https://dev.gixflow.cloud/api/db/users/active-summary"),t=new Set,o=new Set,a={};e.forEach((({location:e,role:l,total:n})=>{t.add(l),o.add(e),a[l]||(a[l]={}),a[l][e]=n}));const l=Array.from(t);this.locations=Array.from(o).filter(Boolean),this.usersStackedBarOptions={...this.usersStackedBarOptions,yaxis:{...this.usersStackedBarOptions.yaxis,categories:this.locations}},this.usersStackedBarSeries=l.map((e=>({name:e,data:this.locations.map((t=>a[e][t]||0))})))}catch(e){console.error("Errore nel fetch utenti attivi per ruolo/sede:",e)}},async fetchContractsPerAgent(e){try{const{data:t}=await P.A.get("https://dev.gixflow.cloud/api/db/contracts/weekly-agent-summary",{params:{month:e}}),o=new Set,a=new Set,l={};t.forEach((({agent:e,week:t,total:n})=>{o.add(e),a.add(t),l[e]||(l[e]={}),l[e][t]=n}));const n=Array.from(a).sort(((e,t)=>e-t));this.contractsLineOptions.xaxis.categories=n.map((e=>`W${e}`)),this.contractsLineSeries=Array.from(o).map((e=>({name:e,data:n.map((t=>l[e][t]||0))})))}catch(t){console.error("Errore nel fetch contratti per agente:",t)}},async fetchSPH(){const e=this.selectedMonth;try{const{data:t}=await P.A.get("https://dev.gixflow.cloud/api/db/contracts/sphbylocation",{params:{month:e}});this.hourlyYieldStats=t}catch(t){console.error("❌ Errore nel recupero resa oraria per sede:",t)}},async fetchVendorContractsTreemap(e){try{const{data:t}=await P.A.get("https://dev.gixflow.cloud/api/db/contracts/monthly-vendor-summary",{params:{month:e}});this.contractsVendorTreemapSeries=[{data:t.map((e=>({x:e.vendor,y:e.total})))}]}catch(t){console.error("Errore fetch contracts per vendor (treemap):",t)}},async fetchConversionRateByLocationAndVendor(e){try{const{data:t}=await P.A.get("https://dev.gixflow.cloud/api/db/appointments/conversion-rate-by-location-vendor",{params:{month:e}}),o=new Set,a=new Set,l={};t.forEach((({location:e,vendor:t,conversion:n})=>{o.add(e),a.add(t),l[t]||(l[t]={}),l[t][e]=n}));const n=Array.from(o).sort(),i=Array.from(a).sort();this.conversionChartOptions={...this.conversionChartOptions,xaxis:{...this.conversionChartOptions.xaxis,categories:n}},this.conversionChartSeries=i.map((e=>({name:e,data:n.map((t=>l[e]?.[t]||0))})))}catch(t){console.error("❌ Errore fetch conversioni per sede/vendor:",t)}},getStartEndDate(e){const[t,o]=e.split("-"),a=`${t}-${o}-01`,l=new Date(t,o,0).toISOString().split("T")[0];return{startDate:a,endDate:l}},formatDate(e){return ue()(e).format("DD-MM-YYYY")},fetchAllData(){const e=this.selectedMonth;Promise.all([this.fetchLoginSummary(e),this.fetchConversionsSummary(e),this.fetchAppointmentsMonthlySummary(e),this.fetchPositiveAppointmentsMonthlySummary(e),this.fetchContractsPerAgent(e),this.fetchVendorContractsTreemap(e),this.fetchSPH(),this.fetchConversionRateByLocationAndVendor(e)]).catch((e=>console.error("Errore fetchAllData:",e)))}},computed:{getColorByIndex(){return e=>{const t=["#c35573","#71b095","#34495e"];return t[e%t.length]}}},watch:{selectedMonth(){this.fetchAllData()}}});const De=(0,x.A)(Pe,[["render",de],["__scopeId","data-v-6de0a90a"]]);var Se=De;const xe={class:"appointments-page"},Fe={class:"header"},Me={class:"actions"},Ve={key:0,class:"modal-overlay"},Ue={class:"modal-content"},Ie={class:"form-grid"},Oe={class:"form-column"},Xe=["value"],Te={class:"form-column"},$e=["value"],ze=["value"],Re=["value"],We={class:"notes-section"},Ne={class:"modal-buttons"},je={class:"filters"},Be=["value"],qe=["value"],Ke=["value"],Ye={class:"table"},Je=["onClick"],Qe=["onClick"],Ge={key:0},He={class:"pagination"},Ze=["disabled"],et=["onClick"],tt=["disabled"],ot={key:1,class:"modal-overlay"},at={class:"modal-content"},lt={key:0},nt={class:"form-grid"},it={class:"form-column"},st={class:"readonly-fields"},rt={class:"form-column"},dt={class:"editable-fields"},ct=["value"],ut=["value"],pt=["value"],ht={class:"meta-info"},mt={class:"notes-section"},gt={class:"modal-buttons"};function kt(e,t,o,i,s,r){const d=(0,l.g2)("flat-pickr");return(0,l.uX)(),(0,l.CE)("div",xe,[(0,l.Lk)("div",Fe,[t[41]||(t[41]=(0,l.Lk)("h1",null,[(0,l.Lk)("i",{class:"fa-solid fa-calendar-check icon-green"}),(0,l.eW)("Elenco Appuntamenti ")],-1)),(0,l.Lk)("div",Me,[(0,l.Lk)("button",{class:"create-button",onClick:t[0]||(t[0]=(...e)=>r.openCreateModal&&r.openCreateModal(...e))},"+"),(0,l.Lk)("button",{class:"csv-button",onClick:t[1]||(t[1]=(...e)=>r.exportAppointments&&r.exportAppointments(...e))},"CSV")])]),s.isCreateModalOpen?((0,l.uX)(),(0,l.CE)("div",Ve,[(0,l.Lk)("div",Ue,[t[59]||(t[59]=(0,l.Lk)("h2",null,"Crea Nuovo Appuntamento",-1)),(0,l.Lk)("form",{onSubmit:t[16]||(t[16]=(0,a.D$)(((...e)=>r.createAppointment&&r.createAppointment(...e)),["prevent"]))},[(0,l.Lk)("div",Ie,[(0,l.Lk)("div",Oe,[(0,l.Lk)("fieldset",null,[t[50]||(t[50]=(0,l.Lk)("legend",null,"Informazioni Cliente",-1)),(0,l.Lk)("label",null,[t[42]||(t[42]=(0,l.eW)(" Cliente: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>s.newAppointment.client_name=e),required:""},null,512),[[a.Jo,s.newAppointment.client_name]])]),(0,l.Lk)("label",null,[t[44]||(t[44]=(0,l.eW)(" Forma Giuridica: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>s.newAppointment.forma_giuridica=e),required:""},[t[43]||(t[43]=(0,l.Lk)("option",{disabled:"",value:""},"Seleziona Forma Giuridica",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.legalForms,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.name),9,Xe)))),128))],512),[[a.u1,s.newAppointment.forma_giuridica]])]),(0,l.Lk)("label",null,[t[45]||(t[45]=(0,l.eW)(" Telefono: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>s.newAppointment.client_phone=e),required:""},null,512),[[a.Jo,s.newAppointment.client_phone]])]),(0,l.Lk)("label",null,[t[46]||(t[46]=(0,l.eW)(" Indirizzo: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=e=>s.newAppointment.client_address=e),required:""},null,512),[[a.Jo,s.newAppointment.client_address]])]),(0,l.Lk)("label",null,[t[47]||(t[47]=(0,l.eW)(" CAP: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[6]||(t[6]=e=>s.newAppointment.client_cap=e),required:""},null,512),[[a.Jo,s.newAppointment.client_cap]])]),(0,l.Lk)("label",null,[t[48]||(t[48]=(0,l.eW)(" Città: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[7]||(t[7]=e=>s.newAppointment.client_city=e),required:""},null,512),[[a.Jo,s.newAppointment.client_city]])]),(0,l.Lk)("label",null,[t[49]||(t[49]=(0,l.eW)(" Provincia: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[8]||(t[8]=e=>s.newAppointment.client_province=e),required:""},null,512),[[a.Jo,s.newAppointment.client_province]])])])]),(0,l.Lk)("div",Te,[(0,l.Lk)("fieldset",null,[t[56]||(t[56]=(0,l.Lk)("legend",null,"Dettagli Appuntamento",-1)),(0,l.Lk)("label",null,[t[51]||(t[51]=(0,l.eW)(" Operatore: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[9]||(t[9]=e=>s.newAppointment.operator_id=e),required:""},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.operators,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.cognome?`${e.cognome} ${e.nome||""}`:"Senza Nome"),9,$e)))),128))],512),[[a.u1,s.newAppointment.operator_id]])]),(0,l.Lk)("label",null,[t[52]||(t[52]=(0,l.eW)(" Agente: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[10]||(t[10]=e=>s.newAppointment.agent_id=e),required:""},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.agents,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.cognome?`${e.cognome} ${e.nome||""}`:"Senza Nome"),9,ze)))),128))],512),[[a.u1,s.newAppointment.agent_id]])]),(0,l.Lk)("label",null,[t[53]||(t[53]=(0,l.eW)(" Data Inizio: ")),(0,l.bo)((0,l.Lk)("input",{type:"datetime-local","onUpdate:modelValue":t[11]||(t[11]=e=>s.newAppointment.date_start=e),required:""},null,512),[[a.Jo,s.newAppointment.date_start]])]),(0,l.Lk)("label",null,[t[54]||(t[54]=(0,l.eW)(" Data Fine: ")),(0,l.bo)((0,l.Lk)("input",{type:"datetime-local","onUpdate:modelValue":t[12]||(t[12]=e=>s.newAppointment.date_end=e),required:""},null,512),[[a.Jo,s.newAppointment.date_end]])]),(0,l.Lk)("label",null,[t[55]||(t[55]=(0,l.eW)(" Stato: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[13]||(t[13]=e=>s.newAppointment.status_id=e),required:""},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.appointmentStatuses,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.name),9,Re)))),128))],512),[[a.u1,s.newAppointment.status_id]])])])])]),(0,l.Lk)("div",We,[(0,l.Lk)("label",null,[t[57]||(t[57]=(0,l.eW)(" Note: ")),(0,l.bo)((0,l.Lk)("textarea",{"onUpdate:modelValue":t[14]||(t[14]=e=>s.newAppointment.notes=e),rows:"4"},null,512),[[a.Jo,s.newAppointment.notes]])])]),(0,l.Lk)("div",Ne,[(0,l.Lk)("button",{type:"button",onClick:t[15]||(t[15]=(...e)=>r.closeCreateModal&&r.closeCreateModal(...e))},"Annulla"),t[58]||(t[58]=(0,l.Lk)("button",{type:"submit"},"Crea Appuntamento",-1))])],32)])])):(0,l.Q3)("",!0),(0,l.Lk)("div",je,[(0,l.Lk)("label",null,[t[61]||(t[61]=(0,l.eW)(" Agente: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[17]||(t[17]=e=>s.filters.agent=e)},[t[60]||(t[60]=(0,l.Lk)("option",{value:""},"Tutti",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.agents,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.cognome?`${e.cognome} ${e.nome||""}`:"Senza Nome"),9,Be)))),128))],512),[[a.u1,s.filters.agent]])]),(0,l.Lk)("label",null,[t[63]||(t[63]=(0,l.eW)(" Operatore: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[18]||(t[18]=e=>s.filters.operator=e)},[t[62]||(t[62]=(0,l.Lk)("option",{value:""},"Tutti",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.operators,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.cognome?`${e.cognome} ${e.nome||""}`:"Senza Nome"),9,qe)))),128))],512),[[a.u1,s.filters.operator]])]),(0,l.Lk)("label",null,[t[64]||(t[64]=(0,l.eW)(" Data Inizio: ")),(0,l.bF)(d,{modelValue:s.filters.dateStart,"onUpdate:modelValue":t[19]||(t[19]=e=>s.filters.dateStart=e),config:i.configDate,class:"custom-datepicker"},null,8,["modelValue","config"])]),(0,l.Lk)("label",null,[t[65]||(t[65]=(0,l.eW)(" Data Fine: ")),(0,l.bF)(d,{modelValue:s.filters.dateEnd,"onUpdate:modelValue":t[20]||(t[20]=e=>s.filters.dateEnd=e),config:i.configDate,class:"custom-datepicker"},null,8,["modelValue","config"])]),(0,l.Lk)("label",null,[t[67]||(t[67]=(0,l.eW)(" Stato: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[21]||(t[21]=e=>s.filters.status_id=e)},[t[66]||(t[66]=(0,l.Lk)("option",{value:""},"Tutti",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.appointmentStatuses,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.name),9,Ke)))),128))],512),[[a.u1,s.filters.status_id]])]),(0,l.Lk)("button",{onClick:t[22]||(t[22]=(...e)=>r.applyFilters&&r.applyFilters(...e))},"Applica Filtri"),(0,l.Lk)("button",{onClick:t[23]||(t[23]=(...e)=>r.resetFilters&&r.resetFilters(...e))},"Reset")]),(0,l.Lk)("table",Ye,[t[71]||(t[71]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"ID"),(0,l.Lk)("th",null,"Cliente"),(0,l.Lk)("th",null,"Telefono"),(0,l.Lk)("th",null,"Indirizzo"),(0,l.Lk)("th",null,"Città"),(0,l.Lk)("th",null,"Provincia"),(0,l.Lk)("th",null,"CAP"),(0,l.Lk)("th",null,"Operatore"),(0,l.Lk)("th",null,"Agente"),(0,l.Lk)("th",null,"Data / Ora"),(0,l.Lk)("th",null,"Stato"),(0,l.Lk)("th",null,"Azioni")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.paginatedAppointments,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id},[(0,l.Lk)("td",null,(0,n.v_)(e.id),1),(0,l.Lk)("td",null,(0,n.v_)(e.client_name||"N/A")+" - "+(0,n.v_)(e.client_forma_giuridica),1),(0,l.Lk)("td",null,(0,n.v_)(e.client_phone||"N/A"),1),(0,l.Lk)("td",null,(0,n.v_)(e.client_address||"N/A"),1),(0,l.Lk)("td",null,(0,n.v_)(e.client_city||"N/A"),1),(0,l.Lk)("td",null,(0,n.v_)(e.client_province||"N/A"),1),(0,l.Lk)("td",null,(0,n.v_)(e.client_cap||"N/A"),1),(0,l.Lk)("td",null,(0,n.v_)(e.operator_name||"N/A"),1),(0,l.Lk)("td",null,(0,n.v_)(e.agent_name||"N/A"),1),(0,l.Lk)("td",null,(0,n.v_)(r.formatDateTime(e.date_start)),1),(0,l.Lk)("td",null,(0,n.v_)(r.capitalize(e.status_name)||"N/A"),1),(0,l.Lk)("td",null,[(0,l.Lk)("button",{class:"in-grid",onClick:t=>r.openEditModal(e)},t[68]||(t[68]=[(0,l.Lk)("i",{class:"fa-duotone fa-solid fa-pen"},null,-1)]),8,Je),(0,l.Lk)("button",{class:"in-grid-red",onClick:t=>r.deleteAppointment(e.id)},t[69]||(t[69]=[(0,l.Lk)("i",{class:"fa-duotone fa-solid fa-trash"},null,-1)]),8,Qe)])])))),128)),0===s.filteredAppointments.length?((0,l.uX)(),(0,l.CE)("tr",Ge,t[70]||(t[70]=[(0,l.Lk)("td",{colspan:"13"},"Nessun appuntamento trovato.",-1)]))):(0,l.Q3)("",!0)])]),(0,l.Lk)("div",He,[(0,l.Lk)("button",{disabled:1===s.currentPage,onClick:t[24]||(t[24]=e=>r.changePage(s.currentPage-1))},t[72]||(t[72]=[(0,l.Lk)("i",{class:"fa-solid fa-backward-step"},null,-1)]),8,Ze),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.totalPages,(e=>((0,l.uX)(),(0,l.CE)("span",{key:e},[(0,l.Lk)("button",{class:(0,n.C4)({active:e===s.currentPage}),onClick:t=>r.changePage(e)},(0,n.v_)(e),11,et)])))),128)),(0,l.Lk)("button",{disabled:s.currentPage===r.totalPages,onClick:t[25]||(t[25]=e=>r.changePage(s.currentPage+1))},t[73]||(t[73]=[(0,l.Lk)("i",{class:"fa-solid fa-forward-step"},null,-1)]),8,tt)]),s.isEditModalOpen?((0,l.uX)(),(0,l.CE)("div",ot,[(0,l.Lk)("div",at,[s.selectedAppointment?((0,l.uX)(),(0,l.CE)("h2",lt," Modifica Appuntamento #"+(0,n.v_)(s.selectedAppointment.id),1)):(0,l.Q3)("",!0),(0,l.Lk)("form",{onSubmit:t[40]||(t[40]=(0,a.D$)(((...e)=>r.updateAppointment&&r.updateAppointment(...e)),["prevent"]))},[(0,l.Lk)("div",nt,[(0,l.Lk)("div",it,[(0,l.Lk)("fieldset",st,[t[81]||(t[81]=(0,l.Lk)("legend",null,"Informazioni Cliente",-1)),(0,l.Lk)("label",null,[t[74]||(t[74]=(0,l.eW)(" Cliente: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[26]||(t[26]=e=>s.selectedAppointment.client_name=e),readonly:""},null,512),[[a.Jo,s.selectedAppointment.client_name]])]),(0,l.Lk)("label",null,[(0,l.Lk)("label",null,[t[75]||(t[75]=(0,l.eW)(" Forma Giuridica: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[27]||(t[27]=e=>s.selectedAppointment.client_forma_giuridica=e),readonly:""},null,512),[[a.Jo,s.selectedAppointment.client_forma_giuridica]])]),t[76]||(t[76]=(0,l.eW)(" Telefono: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[28]||(t[28]=e=>s.selectedAppointment.client_phone=e),readonly:""},null,512),[[a.Jo,s.selectedAppointment.client_phone]])]),(0,l.Lk)("label",null,[t[77]||(t[77]=(0,l.eW)(" Indirizzo: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[29]||(t[29]=e=>s.selectedAppointment.client_address=e),readonly:""},null,512),[[a.Jo,s.selectedAppointment.client_address]])]),(0,l.Lk)("label",null,[t[78]||(t[78]=(0,l.eW)(" CAP: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[30]||(t[30]=e=>s.selectedAppointment.client_cap=e),readonly:""},null,512),[[a.Jo,s.selectedAppointment.client_cap]])]),(0,l.Lk)("label",null,[t[79]||(t[79]=(0,l.eW)(" Città: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[31]||(t[31]=e=>s.selectedAppointment.client_city=e),readonly:""},null,512),[[a.Jo,s.selectedAppointment.client_city]])]),(0,l.Lk)("label",null,[t[80]||(t[80]=(0,l.eW)(" Provincia: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[32]||(t[32]=e=>s.selectedAppointment.client_province=e),readonly:""},null,512),[[a.Jo,s.selectedAppointment.client_province]])])])]),(0,l.Lk)("div",rt,[(0,l.Lk)("fieldset",dt,[t[87]||(t[87]=(0,l.Lk)("legend",null,"Dettagli Appuntamento",-1)),(0,l.Lk)("label",null,[t[82]||(t[82]=(0,l.eW)(" Operatore: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[33]||(t[33]=e=>s.selectedAppointment.operator_id=e),required:""},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.filteredOperators,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.cognome?`${e.cognome} ${e.nome||""}`:"Senza Nome"),9,ct)))),128))],512),[[a.u1,s.selectedAppointment.operator_id]])]),(0,l.Lk)("label",null,[t[83]||(t[83]=(0,l.eW)(" Agente: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[34]||(t[34]=e=>s.selectedAppointment.agent_id=e),required:""},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.filteredAgents,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.cognome?`${e.cognome} ${e.nome||""}`:"Senza Nome"),9,ut)))),128))],512),[[a.u1,s.selectedAppointment.agent_id]])]),(0,l.Lk)("label",null,[t[84]||(t[84]=(0,l.eW)(" Data Inizio: ")),(0,l.bF)(d,{modelValue:s.selectedAppointment.date_start,"onUpdate:modelValue":t[35]||(t[35]=e=>s.selectedAppointment.date_start=e),config:i.configDateTime,class:"custom-datepicker"},null,8,["modelValue","config"])]),(0,l.Lk)("label",null,[t[85]||(t[85]=(0,l.eW)(" Data Fine: ")),(0,l.bF)(d,{modelValue:s.selectedAppointment.date_end,"onUpdate:modelValue":t[36]||(t[36]=e=>s.selectedAppointment.date_end=e),config:i.configDateTime,class:"custom-datepicker"},null,8,["modelValue","config"])]),(0,l.Lk)("label",null,[t[86]||(t[86]=(0,l.eW)(" Stato: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[37]||(t[37]=e=>s.selectedAppointment.status_id=e),required:""},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.appointmentStatuses,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.name),9,pt)))),128))],512),[[a.u1,s.selectedAppointment.status_id]])])]),(0,l.Lk)("fieldset",ht,[t[92]||(t[92]=(0,l.Lk)("legend",null,"Meta Dati",-1)),(0,l.Lk)("p",null,[t[88]||(t[88]=(0,l.Lk)("strong",null,"Creato il:",-1)),(0,l.eW)(" "+(0,n.v_)(r.formatDateTime(s.selectedAppointment.creation_date)),1)]),(0,l.Lk)("p",null,[t[89]||(t[89]=(0,l.Lk)("strong",null,"Creato da:",-1)),(0,l.eW)(" "+(0,n.v_)(s.selectedAppointment.created_by_name),1)]),(0,l.Lk)("p",null,[t[90]||(t[90]=(0,l.Lk)("strong",null,"Ultima modifica:",-1)),(0,l.eW)(" "+(0,n.v_)(r.formatDateTime(s.selectedAppointment.last_modified_date)),1)]),(0,l.Lk)("p",null,[t[91]||(t[91]=(0,l.Lk)("strong",null,"Modificato da:",-1)),(0,l.eW)(" "+(0,n.v_)(s.selectedAppointment.updated_by_name),1)])])])]),(0,l.Lk)("div",mt,[(0,l.Lk)("label",null,[t[93]||(t[93]=(0,l.eW)(" Note: ")),(0,l.bo)((0,l.Lk)("textarea",{"onUpdate:modelValue":t[38]||(t[38]=e=>s.selectedAppointment.notes=e),rows:"4",placeholder:"Aggiungi eventuali note qui..."},null,512),[[a.Jo,s.selectedAppointment.notes]])])]),(0,l.Lk)("div",gt,[(0,l.Lk)("button",{type:"button",onClick:t[39]||(t[39]=(...e)=>r.closeEditModal&&r.closeEditModal(...e))},"Annulla"),t[94]||(t[94]=(0,l.Lk)("button",{type:"submit"},"Salva Modifiche",-1))])],32)])])):(0,l.Q3)("",!0)])}o(4603),o(7566),o(8721);var ft=o(2830),Lt=o.n(ft),vt=o(4653),bt=o(1743),yt={components:{FlatPickr:vt.A},setup(){const e=(0,Ce.KR)({dateFormat:"Y-m-d",altInput:!0,altFormat:"d/m/Y",locale:bt.Italian}),t=(0,Ce.KR)({enableTime:!0,dateFormat:"Y-m-d H:i",altInput:!0,altFormat:"d/m/Y H:i",time_24hr:!0,locale:bt.Italian});return{configDate:e,configDateTime:t}},name:"AppointmentsPage",data(){return{appointments:[],filteredAppointments:[],agents:[],operators:[],appointmentStatuses:[],filters:{agent:"",operator:"",dateStart:"",dateEnd:"",status_id:""},currentPage:1,itemsPerPage:10,isCreateModalOpen:!1,legalForms:[],newAppointment:{client_name:"",client_forma_giuridica:"",client_phone:"",client_address:"",client_city:"",client_province:"",client_cap:"",operator_id:"",agent_id:"",date_start:"",date_end:"",status_id:"",notes:""},operatorSearch:"",agentSearch:"",isEditModalOpen:!1,selectedAppointment:null}},computed:{paginatedAppointments(){const e=(this.currentPage-1)*this.itemsPerPage,t=e+this.itemsPerPage;return this.filteredAppointments.slice(e,t)},totalPages(){return Math.ceil(this.filteredAppointments.length/this.itemsPerPage)},filteredOperators(){return this.operators.filter((e=>(e.name||e.username||"").toLowerCase().includes(this.operatorSearch.toLowerCase())))},filteredAgents(){return this.agents.filter((e=>(e.name||e.username||"").toLowerCase().includes(this.agentSearch.toLowerCase())))}},methods:{async fetchAppointmentStatuses(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/appointment-status");this.appointmentStatuses=Array.isArray(e.data)?e.data:[]}catch(e){console.error("Errore durante il recupero degli stati:",e),this.$toast.show("Errore durante il caricamento degli stati.",{position:"bottom-right",duration:5e3,type:"error"})}},async fetchLegalForms(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/legal-forms");this.legalForms=e.data}catch(e){console.error("Errore durante il recupero delle forme giuridiche:",e),this.$toast.show("Errore durante il caricamento delle forme giuridiche.",{position:"bottom-right",duration:5e3,type:"error"})}},async fetchAppointments(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/appointments");this.appointments=e.data.map((e=>({id:e.id,client_name:e.client_name||"N/A",client_forma_giuridica:e.client_forma_giuridica||"Non specificata",client_phone:e.client_phone||"N/A",client_address:e.client_address||"N/A",client_city:e.client_city||"N/A",client_province:e.client_province||"N/A",client_cap:e.client_cap||"N/A",operator_id:e.operator_id||null,operator_name:e.operator_name||"N/A",agent_id:e.agent_id||null,agent_name:e.agent_name||"N/A",date_start:e.date_start||"❌ ERRORE: NO DATA",date_end:e.date_end||"❌ ERRORE: NO DATA",status_id:e.status_id||"",status_name:e.status_name||"N/A",notes:e.notes||"",creation_date:e.creation_date||null,last_modified_date:e.last_modified_date||null,created_by_name:e.created_by_name||"Non specificato",updated_by_name:e.updated_by_name||"Nessuna modifica"}))),this.filteredAppointments=[...this.appointments]}catch(e){console.error("❌ Errore durante il recupero degli appuntamenti:",e)}},async fetchUsersByRole(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/users"),t=Array.isArray(e.data)?e.data.flat():[];this.operators=this.removeDuplicates(t.filter((e=>1===e.role_id))).sort(((e,t)=>{const o=`${e.cognome||""} ${e.nome||""}`.trim().toLowerCase(),a=`${t.cognome||""} ${t.nome||""}`.trim().toLowerCase();return o.localeCompare(a)})),this.agents=this.removeDuplicates(t.filter((e=>2===e.role_id))).sort(((e,t)=>{const o=`${e.cognome||""} ${e.nome||""}`.trim().toLowerCase(),a=`${t.cognome||""} ${t.nome||""}`.trim().toLowerCase();return o.localeCompare(a)}))}catch(e){this.$toast.show("Errore durante il caricamento degli utenti.",{position:"bottom-right",duration:5e3,type:"error"})}},async createAppointment(){try{if(!this.newAppointment.client_phone||""===this.newAppointment.client_phone.trim())return void this.$toast.show("Il campo Telefono è obbligatorio.",{position:"bottom-right",duration:5e3,type:"warning"});const e={client_name:this.newAppointment.client_name,forma_giuridica_id:this.newAppointment.forma_giuridica,client_phone:this.newAppointment.client_phone,client_address:this.newAppointment.client_address||null,client_city:this.newAppointment.client_city||null,client_province:this.newAppointment.client_province||null,client_cap:this.newAppointment.client_cap||null,operator_id:this.newAppointment.operator_id,agent_id:this.newAppointment.agent_id,date_start:this.formatDateForBackend(this.newAppointment.date_start),date_end:this.formatDateForBackend(this.newAppointment.date_end),status_id:this.newAppointment.status_id,notes:this.newAppointment.notes||""};await P.A.post("https://dev.gixflow.cloud/api/appointments",e),this.$toast.show("Appuntamento creato con successo.",{position:"bottom-right",duration:5e3,type:"default"}),this.closeCreateModal(),this.fetchAppointments()}catch(e){console.error("Errore durante la creazione dell'appuntamento:",e),this.$toast.show("Errore durante la creazione dell'appuntamento.",{position:"bottom-right",duration:5e3,type:"error"})}},async updateAppointment(){try{const e=this.selectedAppointment.id,t={operator_id:this.selectedAppointment.operator_id,agent_id:this.selectedAppointment.agent_id,date_start:this.formatDateForBackend(this.selectedAppointment.date_start),date_end:this.formatDateForBackend(this.selectedAppointment.date_end),status_id:this.selectedAppointment.status_id,notes:this.selectedAppointment.notes};await P.A.put(`https://dev.gixflow.cloud/api/appointments/${e}`,t),this.fetchAppointments(),this.closeEditModal(),this.$toast.show("Appuntamento aggiornato con successo.",{position:"bottom-right",duration:5e3,type:"default"})}catch(e){console.error("❌ Errore durante l'aggiornamento:",e),this.$toast.show("Errore durante l'aggiornamento dell'appuntamento.",{position:"bottom-right",duration:5e3,type:"error"})}},async deleteAppointment(e){if(confirm("Sei sicuro di voler eliminare questo appuntamento?"))try{await P.A.delete(`https://dev.gixflow.cloud/api/appointments/${e}`),this.fetchAppointments(),this.$toast.show("Appuntamento eliminato con successo.",{position:"bottom-right",duration:5e3,type:"default"})}catch(t){console.error("Errore durante l'eliminazione dell'appuntamento:",t),this.$toast.show("Errore durante l'eliminazione dell'appuntamento.",{position:"bottom-right",duration:5e3,type:"error"})}},async exportAppointments(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/appointments/export",{responseType:"blob"}),t=window.URL.createObjectURL(new Blob([e.data])),o=document.createElement("a");o.href=t,o.setAttribute("download","appuntamenti.csv"),document.body.appendChild(o),o.click(),document.body.removeChild(o)}catch(e){console.error("Errore durante l'export:",e),this.showFeedback("Errore durante l'esportazione","error")}},removeDuplicates(e){const t=new Set;return e.filter((e=>!t.has(e.id)&&(t.add(e.id),!0)))},resetNewAppointment(){this.newAppointment={client_name:"",client_forma_giuridica:"",client_phone:"",client_address:"",client_city:"",client_province:"",client_cap:"",operator_id:"",agent_id:"",date_start:"",date_end:"",status_id:"",notes:""}},applyFilters(){this.filteredAppointments=this.appointments.filter((e=>{const t=!this.filters.agent||e.agent_id===parseInt(this.filters.agent),o=!this.filters.operator||e.operator_id===parseInt(this.filters.operator),a=!this.filters.dateStart||Lt()(e.date_start).isSameOrAfter(Lt()(this.filters.dateStart),"day"),l=!this.filters.dateEnd||Lt()(e.date_end).isSameOrBefore(Lt()(this.filters.dateEnd),"day"),n=!this.filters.status_id||e.status_id===parseInt(this.filters.status_id);return t&&o&&a&&l&&n}))},resetFilters(){this.filters={agent:"",operator:"",dateStart:"",dateEnd:"",status:""},this.filteredAppointments=[...this.appointments]},formatDateForInput(e){if(!e||"string"!==typeof e)return"";try{const t=new Date(e);if(isNaN(t.getTime()))return"";const o=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0"),n=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0");return`${o}-${a}-${l}T${n}:${i}`}catch(t){return console.error("Errore formatDateForInput:",t),""}},formatDateForBackend(e){if(!e)return null;try{const t=new Date(e);if(isNaN(t.getTime()))return null;const o=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0"),n=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0");return`${o}-${a}-${l} ${n}:${i}:00`}catch(t){return console.error("Errore formatDateForBackend:",t),null}},openCreateModal(){this.resetNewAppointment(),this.isCreateModalOpen=!0},closeCreateModal(){this.isCreateModalOpen=!1},openEditModal(e){this.selectedAppointment={...e,date_start:e.date_start?this.formatDateForInput(e.date_start):"",date_end:e.date_end?this.formatDateForInput(e.date_end):""},this.isEditModalOpen=!0},closeEditModal(){this.selectedAppointment=null,this.operatorSearch="",this.agentSearch="",this.isEditModalOpen=!1},formatDate(e){if(!e)return"N/A";const t=new Date(e);return t.toLocaleString("it-IT")},changePage(e){e>0&&e<=this.totalPages&&(this.currentPage=e)},formatDateTime(e){return e?Lt().utc(e).format("DD/MM/YYYY HH:mm"):"N/A"},capitalize(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}},mounted(){this.fetchAppointments(),this.fetchUsersByRole(),this.fetchAppointmentStatuses(),this.fetchLegalForms()}};const _t=(0,x.A)(yt,[["render",kt]]);var Ct=_t;const wt={class:"notifications-container"},At={class:"header"},Et={class:"actions"},Pt={class:"in-grid-blue"},Dt={class:"fa-solid fa-question icon-tip"},St={class:"form-container"},xt=["value"],Ft={class:"form-container"},Mt=["value"],Vt={class:"table"},Ut={key:0},It=["checked","onChange"],Ot=["onClick"];function Xt(e,t,o,i,s,r){const d=(0,l.g2)("flat-pickr"),c=(0,l.gN)("tippy");return(0,l.uX)(),(0,l.CE)("div",wt,[(0,l.Lk)("div",At,[t[6]||(t[6]=(0,l.Lk)("h1",null,[(0,l.Lk)("i",{class:"fa-solid fa-calendar-check icon-green"}),(0,l.eW)("Schedulazioni & Invio Agende ")],-1)),(0,l.Lk)("div",Et,[(0,l.Lk)("button",Pt,[(0,l.bo)((0,l.Lk)("i",Dt,null,512),[[c,{content:s.tooltipText,allowHTML:!0,maxWidth:"450px"}]])])])]),(0,l.Lk)("div",St,[t[10]||(t[10]=(0,l.Lk)("h2",null,[(0,l.Lk)("i",{class:"fa-solid fa-paper-plane icon-green"}),(0,l.eW)("Invio manuale")],-1)),t[11]||(t[11]=(0,l.Lk)("pre",null,"Tramite questo strumento è possibile inviare una singola agenda ad un singolo agente, selezionando dalla lista agente e data.",-1)),(0,l.Lk)("form",{onSubmit:t[2]||(t[2]=(0,a.D$)(((...e)=>r.sendManualAgenda&&r.sendManualAgenda(...e)),["prevent"]))},[(0,l.Lk)("label",null,[t[7]||(t[7]=(0,l.eW)(" Seleziona Agente: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>s.manualAgent=e),required:""},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.agents,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.cognome)+" "+(0,n.v_)(e.nome)+" ("+(0,n.v_)(e.email)+") ",9,xt)))),128))],512),[[a.u1,s.manualAgent]])]),(0,l.Lk)("label",null,[t[8]||(t[8]=(0,l.eW)(" Seleziona Data: ")),(0,l.bF)(d,{modelValue:s.manualDate,"onUpdate:modelValue":t[1]||(t[1]=e=>s.manualDate=e),config:i.configDate,class:"custom-datepicker"},null,8,["modelValue","config"])]),t[9]||(t[9]=(0,l.Lk)("button",{class:"save-button",type:"submit"},"Invia Manualmente",-1))],32)]),(0,l.Lk)("div",Ft,[t[15]||(t[15]=(0,l.Lk)("h2",null,[(0,l.Lk)("i",{class:"fa-solid fa-list-check icon-green"}),(0,l.eW)("Schedulazioni")],-1)),t[16]||(t[16]=(0,l.Lk)("pre",null,"Tramite questo strumento è possibile schedulare l'invio giornaliero delle agende agli agenti. Gli invii vengolo schedulati ogni giorno per il giorno lavorativo successivo.",-1)),(0,l.Lk)("form",{onSubmit:t[5]||(t[5]=(0,a.D$)(((...e)=>r.scheduleNotifications&&r.scheduleNotifications(...e)),["prevent"]))},[(0,l.Lk)("label",null,[t[12]||(t[12]=(0,l.eW)(" Seleziona Agenti: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>s.selectedAgents=e),multiple:"",required:""},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.agents,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.cognome)+" "+(0,n.v_)(e.nome)+" ("+(0,n.v_)(e.email)+") ",9,Mt)))),128))],512),[[a.u1,s.selectedAgents]])]),(0,l.Lk)("label",null,[t[13]||(t[13]=(0,l.eW)(" Orario di Invio: ")),(0,l.bo)((0,l.Lk)("input",{type:"time","onUpdate:modelValue":t[4]||(t[4]=e=>s.send_time=e),required:""},null,512),[[a.Jo,s.send_time]])]),t[14]||(t[14]=(0,l.Lk)("button",{class:"save-button",type:"submit"},"Pianifica Invio",-1))],32)]),t[20]||(t[20]=(0,l.Lk)("hr",null,null,-1)),t[21]||(t[21]=(0,l.Lk)("h2",null,[(0,l.Lk)("i",{class:"fa-solid fa-calendar-days icon-green"}),(0,l.eW)("Schedulazione attive ")],-1)),(0,l.Lk)("table",Vt,[t[19]||(t[19]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Agente"),(0,l.Lk)("th",null,"Tipo"),(0,l.Lk)("th",null,"Orario"),(0,l.Lk)("th",null,"Email/Telefono"),(0,l.Lk)("th",null,"Attivo"),(0,l.Lk)("th",null,"Azioni")])],-1)),(0,l.Lk)("tbody",null,[0===s.notifications.length?((0,l.uX)(),(0,l.CE)("tr",Ut,t[17]||(t[17]=[(0,l.Lk)("td",{colspan:"6",class:"no-results"},"Nessuna schedulazione programmata",-1)]))):((0,l.uX)(!0),(0,l.CE)(l.FK,{key:1},(0,l.pI)(s.notifications,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id},[(0,l.Lk)("td",null,(0,n.v_)(e.cognome)+" "+(0,n.v_)(e.nome),1),(0,l.Lk)("td",null,(0,n.v_)(e.type),1),(0,l.Lk)("td",null,(0,n.v_)(e.send_time),1),(0,l.Lk)("td",null,(0,n.v_)(e.email),1),(0,l.Lk)("td",null,[(0,l.Lk)("input",{type:"checkbox",checked:1==e.is_enabled,onChange:t=>r.toggleNotification(e)},null,40,It)]),(0,l.Lk)("td",null,[(0,l.Lk)("button",{class:"in-grid-red",onClick:t=>r.deleteNotification(e.id)},t[18]||(t[18]=[(0,l.Lk)("i",{class:"fas fa-trash"},null,-1)]),8,Ot)])])))),128))])])])}var Tt={components:{FlatPickr:vt.A},setup(){const e=(0,Ce.KR)({dateFormat:"d/m/Y",altInput:!0,altFormat:"d/m/Y",locale:bt.Italian}),t=(0,Ce.KR)({enableTime:!0,dateFormat:"Y-m-d H:i",altInput:!0,altFormat:"d/m/Y H:i",time_24hr:!0,locale:bt.Italian});return{configDate:e,configDateTime:t}},data(){return{notifications:[],agents:[],selectedAgents:[],send_time:"",manualAgent:"",manualDate:"",tooltipText:"\n        <div style='text-align: left; font-size: 14px; line-height: 1.5; max-width: 350px;'>\n          <strong>Schedulazioni & Invio Agende</strong><br>\n          Questa pagina ti permette di <strong>inviare</strong> e <strong>schedulare</strong> le agende per gli agenti.<br><br>\n\n          <strong>Invio Manuale</strong><br>Invia un'agenda a un singolo agente selezionando un nome e una data specifica.<br>\n          - <strong>Seleziona Agente:</strong> Scegli l’agente a cui inviare l’agenda.<br>\n          - <strong>Seleziona Data:</strong> Imposta il giorno dell’agenda da inviare.<br>\n          - <strong>Invia Manualmente:</strong> Esegue subito l'invio dell'agenda.<br><br>\n\n          <strong>Schedulazioni</strong><br>Pianifica l'invio automatico delle agende giornaliere.<br>\n          - <strong>Seleziona Agenti:</strong> Scegli uno o più agenti che riceveranno le agende ogni giorno.<br>\n          - <strong>Orario di Invio:</strong> Imposta l'orario in cui il sistema invierà automaticamente le agende.<br><br>\n\n          <em>Usa questa funzionalità per ottimizzare il processo di gestione delle agende e ridurre il lavoro manuale.</em>\n        </div>\n      "}},methods:{async fetchAgents(){try{const{data:e}=await P.A.get("https://dev.gixflow.cloud/api/users");console.log("Risposta API /users:",e);const t=Array.isArray(e)?e.flat():[];this.agents=t.filter((e=>2===e.role_id&&e.id&&e.cognome)).map((e=>({id:e.id,nome:e.nome||"",cognome:e.cognome||"Senza Cognome",email:e.email||"N/A"}))),console.log("Agenti filtrati:",this.agents)}catch(e){console.error("Errore nel recupero degli agenti:",e)}},async fetchNotifications(){try{const{data:e}=await P.A.get("https://dev.gixflow.cloud/api/notifications/schedule");console.log("[DEBUG] Notifiche ricevute dal backend:",e),this.notifications=e.map((e=>({...e,is_enabled:Number(e.is_enabled)}))),console.log("[DEBUG] Notifiche salvate in Vue:",this.notifications)}catch(e){console.error("Errore nel recupero delle notifiche:",e)}},async scheduleNotifications(){if(0!==this.selectedAgents.length)try{for(let e of this.selectedAgents){const t={user_id:e,type:"email",send_time:`${this.send_time}:00`,is_enabled:1};console.log("[DEBUG] Payload inviato al backend:",t),await P.A.post("https://dev.gixflow.cloud/api/notifications/create",t)}this.$toast.show("Notifiche pianificate con successo.",{position:"bottom-right",duration:5e3,type:"success"}),this.fetchNotifications(),this.selectedAgents=[],this.send_time=""}catch(e){console.error("Errore nella schedulazione delle notifiche:",e),this.$toast.show("Errore nella schedulazione delle notifiche.",{position:"bottom-right",duration:5e3,type:"error"})}else this.$toast.show("Seleziona almeno un agente.",{position:"bottom-right",duration:5e3,type:"error"})},async toggleNotification(e){try{const t={is_enabled:1==e.is_enabled?0:1};console.log("[DEBUG] Invio aggiornamento per notifica ID:",e.id,t),await P.A.put(`https://dev.gixflow.cloud/api/notifications/update/${e.id}`,t),this.$toast.show("Stato notifica aggiornato.",{position:"bottom-right",duration:5e3,type:"success"}),this.fetchNotifications()}catch(t){console.error("Errore nell'aggiornamento della notifica:",t),this.$toast.show("Errore nell'aggiornamento della notifica.",{position:"bottom-right",duration:5e3,type:"error"})}},async deleteNotification(e){try{await P.A.delete(`https://dev.gixflow.cloud/api/notifications/schedule/${e}`),this.$toast.show("Notifica eliminata con successo.",{position:"bottom-right",duration:5e3,type:"success"}),this.fetchNotifications()}catch(t){console.error("Errore nell'eliminazione della notifica:",t),this.$toast.show("Errore nell'eliminazione della notifica.",{position:"bottom-right",duration:5e3,type:"error"})}},async sendManualAgenda(){if(!this.manualAgent||!this.manualDate)return void this.$toast.show("Seleziona un agente e una data.",{position:"bottom-right",duration:5e3,type:"default"});const e=this.manualDate.split("/").reverse().join("-");try{await P.A.post("https://dev.gixflow.cloud/api/notifications/send-agenda",{agent_id:this.manualAgent,date:e}),this.$toast.show("Agenda inviata con successo.",{position:"bottom-right",duration:5e3,type:"success"})}catch(t){console.error("Errore nell'invio manuale dell'agenda:",t),this.$toast.show("Errore nell'invio dell'agenda.",{position:"bottom-right",duration:5e3,type:"error"})}}},mounted(){this.fetchNotifications(),this.fetchAgents()}};const $t=(0,x.A)(Tt,[["render",Xt],["__scopeId","data-v-7ea0d866"]]);var zt=$t;const Rt={class:"calendar-page"},Wt={class:"calendar-container"},Nt={class:"sidebar-multiselect"},jt={class:"mini-calendar"},Bt={class:"calendar-header"},qt={class:"calendar-weekdays"},Kt={class:"calendar-grid"},Yt=["onClick"],Jt={class:"button-group"},Qt={class:"filter-section"},Gt=["value"],Ht={class:"button-group"},Zt=["onClick"],eo={key:0,class:"modal-overlay"},to={class:"modal-content"},oo={key:0},ao={class:"form-grid"},lo={class:"form-column"},no={class:"readonly-fields"},io={class:"form-column"},so={class:"editable-fields"},ro=["value"],co=["value"],uo=["value"],po={class:"meta-info"},ho={class:"notes-section"},mo={class:"modal-buttons"};function go(e,t,o,i,s,r){const d=(0,l.g2)("FullCalendar");return(0,l.uX)(),(0,l.CE)("div",Rt,[t[48]||(t[48]=(0,l.Lk)("h1",null,[(0,l.Lk)("i",{class:"fa-solid fa-calendar-days icon-green"}),(0,l.eW)("Calendario Appuntamenti ")],-1)),(0,l.Lk)("div",Wt,[(0,l.Lk)("div",Nt,[t[25]||(t[25]=(0,l.Lk)("h3",null,"Vai a data",-1)),(0,l.Lk)("div",jt,[(0,l.Lk)("div",Bt,[(0,l.Lk)("button",{onClick:t[0]||(t[0]=(...t)=>e.prevMonth&&e.prevMonth(...t))},"<"),(0,l.Lk)("span",null,(0,n.v_)(e.currentMonth),1),(0,l.Lk)("button",{onClick:t[1]||(t[1]=(...t)=>e.nextMonth&&e.nextMonth(...t))},">")]),(0,l.Lk)("div",qt,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.weekdays,(e=>((0,l.uX)(),(0,l.CE)("span",{key:e,class:"weekday"},(0,n.v_)(e),1)))),128))]),(0,l.Lk)("div",Kt,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.daysInMonth,(t=>((0,l.uX)(),(0,l.CE)("div",{key:t.date,class:(0,n.C4)(["calendar-day",{selected:e.isSelected(t.date)}]),onClick:o=>e.selectDate(t.date)},(0,n.v_)(t.day),11,Yt)))),128))])]),(0,l.Lk)("div",Jt,[(0,l.Lk)("button",{onClick:t[2]||(t[2]=(...t)=>e.refreshData&&e.refreshData(...t))},t[22]||(t[22]=[(0,l.Lk)("i",{class:"fa-solid fa-arrows-rotate"},null,-1),(0,l.eW)(" Aggiorna eventi ")]))]),(0,l.Lk)("div",Qt,[t[24]||(t[24]=(0,l.Lk)("h3",null,"Filtra per Sede",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[3]||(t[3]=t=>e.selectedLocation=t),onChange:t[4]||(t[4]=(...t)=>e.filterByLocation&&e.filterByLocation(...t))},[t[23]||(t[23]=(0,l.Lk)("option",{value:""},"Tutte le sedi",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.uniqueLocations,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,n.v_)(e),9,Gt)))),128))],544),[[a.u1,e.selectedLocation]])]),t[26]||(t[26]=(0,l.Lk)("h3",null,"Sub-calendars",-1)),(0,l.Lk)("div",Ht,[(0,l.Lk)("button",{onClick:t[5]||(t[5]=(...t)=>e.selectAllAgents&&e.selectAllAgents(...t))},"Tutti"),(0,l.Lk)("button",{onClick:t[6]||(t[6]=(...t)=>e.deselectAllAgents&&e.deselectAllAgents(...t))},"Deseleziona")]),(0,l.Lk)("ul",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.agents,(t=>((0,l.uX)(),(0,l.CE)("li",{key:t.id,class:(0,n.C4)({selected:e.selectedAgentIds.includes(t.id)}),onClick:o=>e.toggleAgentSelection(t.id)},(0,n.v_)(t.cognome||"")+" "+(0,n.v_)(t.nome||""),11,Zt)))),128))])]),(0,l.Lk)("div",null,[(0,l.bF)(d,{ref:"fullCalendar",options:e.calendarOptions,class:"custom-calendar"},null,8,["options"])])]),e.isModalOpen?((0,l.uX)(),(0,l.CE)("div",eo,[(0,l.Lk)("div",to,[e.selectedAppointment?((0,l.uX)(),(0,l.CE)("h2",oo," Modifica Appuntamento #"+(0,n.v_)(e.selectedAppointment.id),1)):(0,l.Q3)("",!0),(0,l.Lk)("form",{onSubmit:t[21]||(t[21]=(0,a.D$)(((...t)=>e.updateAppointmentClickFC&&e.updateAppointmentClickFC(...t)),["prevent"]))},[(0,l.Lk)("div",ao,[(0,l.Lk)("div",lo,[(0,l.Lk)("fieldset",no,[t[34]||(t[34]=(0,l.Lk)("legend",null,"Informazioni Cliente",-1)),(0,l.Lk)("label",null,[t[27]||(t[27]=(0,l.eW)(" Cliente: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[7]||(t[7]=t=>e.selectedAppointment.client_name=t),readonly:""},null,512),[[a.Jo,e.selectedAppointment.client_name]])]),(0,l.Lk)("label",null,[t[28]||(t[28]=(0,l.eW)(" Forma Giuridica: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[8]||(t[8]=t=>e.selectedAppointment.client_forma_giuridica=t),readonly:""},null,512),[[a.Jo,e.selectedAppointment.client_forma_giuridica]])]),(0,l.Lk)("label",null,[t[29]||(t[29]=(0,l.eW)(" Telefono: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[9]||(t[9]=t=>e.selectedAppointment.client_phone=t),readonly:""},null,512),[[a.Jo,e.selectedAppointment.client_phone]])]),(0,l.Lk)("label",null,[t[30]||(t[30]=(0,l.eW)(" Indirizzo: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[10]||(t[10]=t=>e.selectedAppointment.client_address=t),readonly:""},null,512),[[a.Jo,e.selectedAppointment.client_address]])]),(0,l.Lk)("label",null,[t[31]||(t[31]=(0,l.eW)(" CAP: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[11]||(t[11]=t=>e.selectedAppointment.client_cap=t),readonly:""},null,512),[[a.Jo,e.selectedAppointment.client_cap]])]),(0,l.Lk)("label",null,[t[32]||(t[32]=(0,l.eW)(" Città: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[12]||(t[12]=t=>e.selectedAppointment.client_city=t),readonly:""},null,512),[[a.Jo,e.selectedAppointment.client_city]])]),(0,l.Lk)("label",null,[t[33]||(t[33]=(0,l.eW)(" Provincia: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[13]||(t[13]=t=>e.selectedAppointment.client_province=t),readonly:""},null,512),[[a.Jo,e.selectedAppointment.client_province]])])])]),(0,l.Lk)("div",io,[(0,l.Lk)("fieldset",so,[t[40]||(t[40]=(0,l.Lk)("legend",null,"Dettagli Appuntamento",-1)),(0,l.Lk)("label",null,[t[35]||(t[35]=(0,l.eW)(" Operatore: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[14]||(t[14]=t=>e.selectedAppointment.operator_id=t),required:""},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.operators,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.cognome?`${e.cognome||""} ${e.nome||""} (${e.location_name||""})`:"Senza Nome"),9,ro)))),128))],512),[[a.u1,e.selectedAppointment.operator_id]])]),(0,l.Lk)("label",null,[t[36]||(t[36]=(0,l.eW)(" Agente: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[15]||(t[15]=t=>e.selectedAppointment.agent_id=t),required:""},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.agents,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.cognome?`${e.cognome} ${e.nome||""}`:"Senza Nome"),9,co)))),128))],512),[[a.u1,e.selectedAppointment.agent_id]])]),(0,l.Lk)("label",null,[t[37]||(t[37]=(0,l.eW)(" Data Inizio: ")),(0,l.bo)((0,l.Lk)("input",{type:"datetime-local","onUpdate:modelValue":t[16]||(t[16]=t=>e.selectedAppointment.date_start=t),required:""},null,512),[[a.Jo,e.selectedAppointment.date_start]])]),(0,l.Lk)("label",null,[t[38]||(t[38]=(0,l.eW)(" Data Fine: ")),(0,l.bo)((0,l.Lk)("input",{type:"datetime-local","onUpdate:modelValue":t[17]||(t[17]=t=>e.selectedAppointment.date_end=t),required:""},null,512),[[a.Jo,e.selectedAppointment.date_end]])]),(0,l.Lk)("label",null,[t[39]||(t[39]=(0,l.eW)(" Stato: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[18]||(t[18]=t=>e.selectedAppointment.status=t),required:""},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.appointmentStatuses,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.name),9,uo)))),128))],512),[[a.u1,e.selectedAppointment.status]])])]),(0,l.Lk)("fieldset",po,[t[45]||(t[45]=(0,l.Lk)("legend",null,"Informazioni di Tracciamento",-1)),(0,l.Lk)("p",null,[t[41]||(t[41]=(0,l.Lk)("strong",null,"Creato il:",-1)),(0,l.eW)(" "+(0,n.v_)(e.formatDateTime(e.selectedAppointment.creation_date)),1)]),(0,l.Lk)("p",null,[t[42]||(t[42]=(0,l.Lk)("strong",null,"Creato da:",-1)),(0,l.eW)(" "+(0,n.v_)(e.selectedAppointment.created_by_name),1)]),(0,l.Lk)("p",null,[t[43]||(t[43]=(0,l.Lk)("strong",null,"Ultima modifica:",-1)),(0,l.eW)(" "+(0,n.v_)(e.formatDateTime(e.selectedAppointment.last_modified_date)),1)]),(0,l.Lk)("p",null,[t[44]||(t[44]=(0,l.Lk)("strong",null,"Modificato da:",-1)),(0,l.eW)(" "+(0,n.v_)(e.selectedAppointment.updated_by_name),1)])])])]),(0,l.Lk)("div",ho,[(0,l.Lk)("label",null,[t[46]||(t[46]=(0,l.eW)(" Note: ")),(0,l.bo)((0,l.Lk)("textarea",{"onUpdate:modelValue":t[19]||(t[19]=t=>e.selectedAppointment.notes=t),rows:"4",placeholder:"Aggiungi eventuali note qui..."},null,512),[[a.Jo,e.selectedAppointment.notes]])])]),(0,l.Lk)("div",mo,[(0,l.Lk)("button",{type:"button",onClick:t[20]||(t[20]=(...t)=>e.closeModal&&e.closeModal(...t))},"Annulla"),t[47]||(t[47]=(0,l.Lk)("button",{type:"submit"},"Salva Modifiche",-1))])],32)])])):(0,l.Q3)("",!0)])}o(531);var ko=o(3535),fo=o(5661),Lo=o(8439);o(6364);Lt().locale("it");var vo=(0,l.pM)({name:"CalendarView",components:{FullCalendar:ko.A},data(){return{agents:[],selectedDate:new Date,currentMonth:Lt()().format("MMMM"),currentYear:Lt()().format("YYYY"),daysInMonth:[],weekdays:["L","M","M","G","V","S","D"],selectedLocation:"",selectedButton:"today",appointments:[],isModalOpen:!1,legalForms:[],selectedAppointment:{id:null,client_name:"",date_start:"",date_end:"",notes:"",agent_id:null,operator_id:null,status:null},operatorSearch:"",agentSearch:"",appointmentStatuses:[],selectedAgents:[],selectedAgentIds:[],calendarOptions:{plugins:[fo.A,Lo.Ay],initialView:"resourceTimeGridDay",slotMinTime:"09:00:00",slotMaxTime:"20:00:00",allDaySlot:!0,editable:!0,eventResizableFromStart:!1,eventDrop:this.handleEventDrop,eventResize:this.handleEventResize,eventClick:this.handleEventClick,headerToolbar:{left:"prev,next yesterday today tomorrow",center:"title",right:"customDayButton customWeekButton"},customButtons:{customDayButton:{text:"Giorno",click:null},customWeekButton:{text:"Settimana",click:null},yesterday:{text:"Ieri",click:null},today:{text:"Oggi",click:null},tomorrow:{text:"Domani",click:null},prev:{text:"Prev",click:null},next:{text:"Next",click:null}},resources:[],events:[],height:"auto",locale:"it",timeZone:"Europe/Rome",datesSet:this.handleDatesSet}}},computed:{isWeekViewEnabled(){return 1===this.selectedAgentIds.length},filteredOperators(){return this.operators.filter((e=>(e.name||e.username||"").toLowerCase().includes(this.operatorSearch.toLowerCase())))},filteredAgents(){return this.agents.filter((e=>(e.name||e.username||"").toLowerCase().includes(this.agentSearch.toLowerCase())))},uniqueLocations(){const e=this.appointments.map((e=>e.location||"Sede non specificata"));return[...new Set(e)]}},watch:{selectedAgents:{handler(){this.updateCalendarData()},deep:!0},selectedAgentIds:{handler(e){if(1!==e.length){const e=this.$refs.fullCalendar.getApi();"resourceTimeGridWeek"===e.view.type&&(e.changeView("resourceTimeGridDay"),this.$toast.show("La vista settimanale è disponibile solo con un agente selezionato.",{position:"bottom-right",duration:5e3,type:"default"}))}},deep:!0}},methods:{async fetchAgents(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/users"),t=Array.isArray(e.data)?e.data.flatMap((e=>Array.isArray(e)?e:[e])):[];this.agents=t.filter((e=>2===e.role_id)).map((e=>({...e,cognome_nome:`${e.cognome||""} ${e.nome||""}`.trim()}))).sort(((e,t)=>e.cognome_nome.localeCompare(t.cognome_nome)))}catch(e){console.error("Errore nel caricamento agenti:",e)}},async fetchLegalForms(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/legal-forms");this.legalForms=e.data}catch(e){console.error("Errore durante il recupero delle forme giuridiche:",e),this.$toast.show("Errore durante il caricamento delle forme giuridiche.",{position:"bottom-right",duration:5e3,type:"error"})}},async fetchOperators(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/users"),t=Array.isArray(e.data)?e.data.flatMap((e=>Array.isArray(e)?e:[e])):[];this.operators=t.filter((e=>1===e.role_id))}catch(e){console.error("Errore nel caricamento operatori:",e)}},async fetchAppointments(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/appointments");this.appointments=e.data.map((e=>({id:e.id,location:e.operator_location_name||"Sede non specificata",client_name:e.client_name||"N/A",client_forma_giuridica:e.client_forma_giuridica||"Non specificata",client_phone:e.client_phone||"N/A",client_address:e.client_address||"N/A",client_city:e.client_city||"N/A",client_province:e.client_province||"N/A",client_cap:e.client_cap||"N/A",operator_id:e.operator_id||null,agent_id:e.agent_id||null,date_start:e.date_start,date_end:e.date_end,status_id:e.status_id||"",notes:e.notes||"",creation_date:e.creation_date||null,last_modified_date:e.last_modified_date||null,created_by_name:e.created_by_name||"Non specificato",updated_by_name:e.updated_by_name||"Nessuna modifica"}))),this.updateCalendarData()}catch(e){console.error("❌ Errore nel fetch degli appuntamenti:",e)}},async fetchAppointmentStatuses(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/appointment-status");this.appointmentStatuses=Array.isArray(e.data)?e.data:[]}catch(e){console.error("Errore durante il recupero degli stati:",e),this.$toast.show("Errore durante il caricamento degli stati.",{position:"bottom-right",duration:5e3,type:"error"})}},async updateAppointmentClickFC(){try{const e={id:this.selectedAppointment.id,date_start:this.formatDateForBackend(this.selectedAppointment.date_start),date_end:this.formatDateForBackend(this.selectedAppointment.date_end),notes:this.selectedAppointment.notes,agent_id:this.selectedAppointment.agent_id,operator_id:this.selectedAppointment.operator_id,status_id:this.selectedAppointment.status,updated_by:this.currentUserId};await P.A.put(`https://dev.gixflow.cloud/api/appointments-clickfc/${e.id}`,e),this.$toast.show("Appuntamento aggiornato con successo.",{position:"bottom-right",duration:5e3,type:"success"}),await this.fetchAppointments(),this.updateCalendarData(),this.closeModal()}catch(e){console.error("❌ Errore aggiornamento appuntamento:",e),this.$toast.show("Errore durante l'aggiornamento.",{position:"bottom-right",duration:5e3,type:"error"})}},handleEventClick(e){const t=e.event;this.selectedAppointment={id:t.id,client_name:t.title||"",client_forma_giuridica:t.extendedProps.client_forma_giuridica||"N/A",client_address:t.extendedProps.client_address||"",client_city:t.extendedProps.client_city||"",client_cap:t.extendedProps.client_cap||"",client_phone:t.extendedProps.client_phone||"",client_province:t.extendedProps.client_province||"",date_start:this.formatDateForInput(t.start),date_end:this.formatDateForInput(t.end),notes:t.extendedProps.notes||"",agent_id:t.extendedProps.agent_id||null,operator_id:t.extendedProps.operator_id||null,status:t.extendedProps.status_id||t.extendedProps.status||null,creation_date:t.extendedProps.creation_date||null,last_modified_date:t.extendedProps.last_modified_date||null,created_by_name:t.extendedProps.created_by_name||"Non specificato",updated_by_name:t.extendedProps.updated_by_name||"Nessuna modifica"},this.isModalOpen=!0},async handleEventDrop(e){try{const t=e.event,o=t.getResources()[0]?.id,a={id:t.id,agent_id:o,date_start:this.formatDateForBackendResDrop(t.start),date_end:this.formatDateForBackendResDrop(t.end),notes:t.extendedProps.notes||"",operator_id:t.extendedProps.operator_id||null,status_id:t.extendedProps.status_id??t.extendedProps.status??null};await P.A.put(`https://dev.gixflow.cloud/api/appointments-drop/${a.id}`,a),this.$toast.show("Appuntamento aggiornato con successo.",{position:"bottom-right",duration:5e3,type:"success"}),t.setExtendedProp("agent_id",o)}catch(t){console.error("❌ Errore nel drop:",t),e.revert()}},async handleEventResize(e){try{const t=e.event,o={id:t.id,agent_id:t.getResources()[0]?.id||null,date_start:this.formatDateForBackendResDrop(t.start),date_end:this.formatDateForBackendResDrop(t.end),notes:t.extendedProps.notes||"",operator_id:t.extendedProps.operator_id||null,status_id:t.extendedProps.status_id??t.extendedProps.status??null};await P.A.put(`https://dev.gixflow.cloud/api/appointments/${o.id}`,o),this.$toast.show("Appuntamento aggiornato con successo.",{position:"bottom-right",duration:5e3,type:"success"})}catch(t){console.error("❌ Errore nel resize:",t),e.revert()}},async refreshData(){try{await Promise.all([this.fetchAgents(),this.fetchAppointments()]),this.updateCalendarData(),this.$toast.show("Dati aggiornati.",{position:"bottom-right",duration:3e3,type:"success"})}catch(e){console.error("Errore durante l'aggiornamento dei dati:",e),this.$toast.show("Errore durante l'aggiornamento dei dati.",{position:"bottom-right",duration:5e3,type:"error"})}},updateCalendarData(){const e=this.selectedAgentIds.length?this.selectedAgentIds:this.agents.map((e=>e.id));this.calendarOptions.resources=this.agents.filter((t=>e.includes(t.id))).map((e=>({id:e.id,title:`${e.cognome||""} ${e.nome||""}`.trim()}))),this.calendarOptions.events=this.appointments.filter((t=>e.includes(t.agent_id))).map((e=>({id:e.id,title:e.client_name||"Appuntamento",start:Lt().tz(e.date_start,"UTC").tz("Europe/Rome").toISOString(),end:Lt().tz(e.date_end,"UTC").tz("Europe/Rome").toISOString(),resourceId:e.agent_id,extendedProps:{...e}})))},filterByLocation(){localStorage.setItem("selectedLocation",this.selectedLocation),this.selectedLocation?this.calendarOptions.events=this.appointments.filter((e=>e.location===this.selectedLocation)).map((e=>({id:e.id,title:e.client_name||"Appuntamento",start:Lt().tz(e.date_start,"UTC").tz("Europe/Rome").toISOString(),end:Lt().tz(e.date_end,"UTC").tz("Europe/Rome").toISOString(),resourceId:e.agent_id,extendedProps:{...e}}))):this.updateCalendarData()},formatDateTime(e){return e?Lt().utc(e).tz("Europe/Rome").format("DD/MM/YYYY HH:mm"):"N/A"},formatDateForInput(e){return e?Lt().utc(e).format("YYYY-MM-DDTHH:mm"):""},formatDateForBackend(e){return e?e.replace("T",":")+":00":null},formatDateForBackendResDrop(e){return e?Lt()(e,"YYYY-MM-DDTHH:mm").tz("Europe/Rome").utc().format("YYYY-MM-DD HH:mm:ss"):null},closeModal(){this.isModalOpen=!1},toggleAgentSelection(e){this.selectedAgentIds.includes(e)?this.selectedAgentIds=this.selectedAgentIds.filter((t=>t!==e)):this.selectedAgentIds.push(e),localStorage.setItem("selectedAgentIds",JSON.stringify(this.selectedAgentIds)),this.updateCalendarData()},selectAllAgents(){this.selectedAgentIds=this.agents.map((e=>e.id)),localStorage.setItem("selectedAgentIds",JSON.stringify(this.selectedAgentIds)),this.updateCalendarData()},deselectAllAgents(){this.selectedAgentIds=[],localStorage.setItem("selectedAgentIds",JSON.stringify(this.selectedAgentIds)),this.updateCalendarData()},handleDatesSet(e){this.selectedDate=Lt()(e.start).toDate(),this.generateDaysInMonth()},generateDaysInMonth(){const e=Lt()(this.selectedDate).startOf("month").startOf("isoWeek"),t=Lt()(this.selectedDate).endOf("month").endOf("isoWeek"),o=[];for(let a=e;a.isBefore(t);a.add(1,"day"))o.push({date:a.toDate(),day:a.format("D")});this.daysInMonth=o,this.currentMonth=Lt()(this.selectedDate).format("MMM YYYY").toUpperCase()},prevMonth(){this.selectedDate=Lt()(this.selectedDate).subtract(1,"month").toDate(),this.generateDaysInMonth(),this.updateCalendarView()},nextMonth(){this.selectedDate=Lt()(this.selectedDate).add(1,"month").toDate(),this.generateDaysInMonth(),this.updateCalendarView()},selectDate(e){this.selectedDate=e,localStorage.setItem("selectedDate",Lt()(e).format("YYYY-MM-DD")),console.log("Data salvata nel localStorage:",Lt()(e).format("YYYY-MM-DD")),this.updateCalendarView()},isSelected(e){return Lt()(e).isSame(this.selectedDate,"day")},updateCalendarView(){const e=this.$refs.fullCalendar.getApi();console.log("Aggiornamento del calendario alla data:",this.selectedDate),e.gotoDate(Lt()(this.selectedDate).format("YYYY-MM-DD"))},changeToDayView(){const e=this.$refs.fullCalendar?.getApi();if(!e)return console.error("FullCalendar non inizializzato");e.changeView("resourceTimeGridDay")},changeToWeekView(){if(this.isWeekViewEnabled){const e=this.$refs.fullCalendar?.getApi();if(!e)return console.error("FullCalendar non inizializzato");e.changeView("resourceTimeGridWeek")}else this.$toast.show("Seleziona un solo agente per abilitare la vista settimanale.",{position:"bottom-right",duration:5e3,type:"default"})},changeToYesterday(){const e=this.$refs.fullCalendar?.getApi();if(!e)return console.error("FullCalendar non inizializzato");const t=Lt()().subtract(1,"day").toDate();e.gotoDate(Lt()(t).format("YYYY-MM-DD")),this.selectedDate=t,this.selectedButton="yesterday",localStorage.setItem("selectedButton","yesterday"),localStorage.setItem("selectedDate",Lt()(t).format("YYYY-MM-DD")),this.generateDaysInMonth()},changeToToday(){const e=this.$refs.fullCalendar?.getApi();if(!e)return console.error("FullCalendar non inizializzato");e.today();const t=new Date;this.selectedDate=t,this.selectedButton="today",localStorage.setItem("selectedButton","today"),localStorage.setItem("selectedDate",Lt()(t).format("YYYY-MM-DD")),this.generateDaysInMonth()},changeToTomorrow(){const e=this.$refs.fullCalendar?.getApi();if(!e)return console.error("FullCalendar non inizializzato");const t=Lt()().add(1,"day").toDate();e.gotoDate(Lt()(t).format("YYYY-MM-DD")),this.selectedDate=t,this.selectedButton="tomorrow",localStorage.setItem("selectedButton","tomorrow"),localStorage.setItem("selectedDate",Lt()(t).format("YYYY-MM-DD")),this.generateDaysInMonth()},changeToPrev(){const e=this.$refs.fullCalendar?.getApi();if(!e)return console.error("FullCalendar non inizializzato");e.prev();const t=e.getDate();this.selectedDate=t,localStorage.setItem("selectedDate",Lt()(t).format("YYYY-MM-DD")),this.generateDaysInMonth()},changeToNext(){const e=this.$refs.fullCalendar?.getApi();if(!e)return console.error("FullCalendar non inizializzato");e.next();const t=e.getDate();this.selectedDate=t,localStorage.setItem("selectedDate",Lt()(t).format("YYYY-MM-DD")),this.generateDaysInMonth()},async initApp(){await Promise.all([this.fetchAgents(),this.fetchOperators(),this.fetchAppointments(),this.fetchAppointmentStatuses(),this.fetchLegalForms()]),this.applySavedPreferences(),this.updateCalendarData(),this.filterByLocation()},applySavedPreferences(){try{const e=localStorage.getItem("selectedAgentIds"),t=localStorage.getItem("selectedLocation"),o=localStorage.getItem("selectedDate"),a=localStorage.getItem("selectedButton");e&&(this.selectedAgentIds=JSON.parse(e)),t&&(this.selectedLocation=t),o&&(this.selectedDate=Lt()(o,"YYYY-MM-DD").toDate()),a&&(this.selectedButton=a),this.generateDaysInMonth()}catch(e){console.error("Errore nel recupero dati da localStorage:",e)}}},mounted(){if(this.$refs.fullCalendar){const e=this.$refs.fullCalendar.getApi(),t=localStorage.getItem("selectedDate"),o=localStorage.getItem("selectedButton");if(t)this.selectedDate=Lt()(t,"YYYY-MM-DD").toDate(),e.gotoDate(Lt()(this.selectedDate).format("YYYY-MM-DD"));else if(o){if(this.selectedButton=o,"yesterday"===o){const t=Lt()().subtract(1,"day").toDate();e.gotoDate(Lt()(t).format("YYYY-MM-DD")),this.selectedDate=t}else if("today"===o)e.today(),this.selectedDate=new Date;else if("tomorrow"===o){const t=Lt()().add(1,"day").toDate();e.gotoDate(Lt()(t).format("YYYY-MM-DD")),this.selectedDate=t}}else this.selectedDate=new Date,e.today();this.generateDaysInMonth()}else console.error("FullCalendar non è pronto.");this.$nextTick((()=>{this.$refs.fullCalendar?.getApi||console.warn("FullCalendar ancora non pronto in mounted")}))},created(){this.calendarOptions.customButtons.customDayButton.click=this.changeToDayView,this.calendarOptions.customButtons.customWeekButton.click=this.changeToWeekView,this.calendarOptions.customButtons.yesterday.click=this.changeToYesterday,this.calendarOptions.customButtons.today.click=this.changeToToday,this.calendarOptions.customButtons.tomorrow.click=this.changeToTomorrow,this.calendarOptions.customButtons.prev.click=this.changeToPrev,this.calendarOptions.customButtons.next.click=this.changeToNext,this.initApp()}});const bo=(0,x.A)(vo,[["render",go]]);var yo=bo;const _o={class:"user-page"},Co={class:"header"},wo={class:"actions"},Ao={class:"filters"},Eo=["value"],Po={class:"table"},Do=["onClick"],So=["onClick"],xo={key:0},Fo={class:"pagination"},Mo=["disabled"],Vo=["onClick"],Uo=["disabled"],Io={key:0,class:"modal-overlay"},Oo={class:"modal-content"},Xo={class:"form-grid"},To={class:"form-column"},$o={class:"form-column"},zo={class:"form-column"},Ro=["value"],Wo=["value"],No=["value"],jo=["disabled"],Bo={class:"modal-buttons"},qo={key:1,class:"modal-overlay"},Ko={class:"modal-content"},Yo={class:"form-grid"},Jo={class:"form-column"},Qo={class:"form-column"},Go={class:"form-column"},Ho=["value"],Zo=["value"],ea=["value"],ta=["disabled"],oa={class:"modal-buttons"};function aa(e,t,o,i,s,r){return(0,l.uX)(),(0,l.CE)("div",_o,[(0,l.Lk)("div",Co,[t[49]||(t[49]=(0,l.Lk)("h1",null,"Gestione Utenti",-1)),(0,l.Lk)("div",wo,[(0,l.Lk)("button",{class:"create-button",onClick:t[0]||(t[0]=(...e)=>r.openCreateModal&&r.openCreateModal(...e))},"+"),(0,l.Lk)("button",{class:"csv-button",onClick:t[1]||(t[1]=(...e)=>r.exportToCSV&&r.exportToCSV(...e))},"CSV")])]),(0,l.Lk)("div",Ao,[(0,l.Lk)("label",null,[t[51]||(t[51]=(0,l.eW)(" Ruolo: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>s.filters.role=e)},[t[50]||(t[50]=(0,l.Lk)("option",{value:""},"Tutti",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.roles,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.name},(0,n.v_)(e.name),9,Eo)))),128))],512),[[a.u1,s.filters.role]])]),(0,l.Lk)("label",null,[t[53]||(t[53]=(0,l.eW)(" Attivo: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>s.filters.is_active=e)},t[52]||(t[52]=[(0,l.Lk)("option",{value:""},"Tutti",-1),(0,l.Lk)("option",{value:!0},"Sì",-1),(0,l.Lk)("option",{value:!1},"No",-1)]),512),[[a.u1,s.filters.is_active]])]),(0,l.Lk)("label",null,[t[54]||(t[54]=(0,l.eW)(" Nome/Cognome: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>s.filters.name=e),placeholder:"Cerca..."},null,512),[[a.Jo,s.filters.name]])]),(0,l.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>r.applyFilters&&r.applyFilters(...e))},"Applica Filtri"),(0,l.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>r.resetFilters&&r.resetFilters(...e))},"Reset")]),(0,l.Lk)("table",Po,[t[56]||(t[56]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"ID"),(0,l.Lk)("th",null,"Cognome"),(0,l.Lk)("th",null,"Nome"),(0,l.Lk)("th",null,"Username"),(0,l.Lk)("th",null,"Email"),(0,l.Lk)("th",null,"Ruolo"),(0,l.Lk)("th",null,"Codice Fiscale"),(0,l.Lk)("th",null,"Sede"),(0,l.Lk)("th",null,"Utente Asterisk"),(0,l.Lk)("th",null,"Attivo"),(0,l.Lk)("th",null,"Azioni")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.paginatedUsers,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id},[(0,l.Lk)("td",null,(0,n.v_)(e.id),1),(0,l.Lk)("td",null,(0,n.v_)(e.cognome||""),1),(0,l.Lk)("td",null,(0,n.v_)(e.nome||""),1),(0,l.Lk)("td",null,(0,n.v_)(e.username),1),(0,l.Lk)("td",null,(0,n.v_)(e.email||""),1),(0,l.Lk)("td",null,(0,n.v_)(e.role_name||""),1),(0,l.Lk)("td",null,(0,n.v_)(e.codice_fiscale||""),1),(0,l.Lk)("td",null,(0,n.v_)(e.location_name),1),(0,l.Lk)("td",null,(0,n.v_)(e.ast_user||""),1),(0,l.Lk)("td",null,(0,n.v_)(e.is_active?"Sì":"No"),1),(0,l.Lk)("td",null,[(0,l.Lk)("button",{onClick:t=>r.openEditModal(e)},"Modifica",8,Do),(0,l.Lk)("button",{onClick:t=>r.deleteUser(e.id)},"Elimina",8,So)])])))),128)),0===r.filteredUsers.length?((0,l.uX)(),(0,l.CE)("tr",xo,t[55]||(t[55]=[(0,l.Lk)("td",{colspan:"11"},"Nessun utente trovato.",-1)]))):(0,l.Q3)("",!0)])]),(0,l.Lk)("div",Fo,[(0,l.Lk)("button",{disabled:1===s.currentPage,onClick:t[7]||(t[7]=e=>r.changePage(s.currentPage-1))},t[57]||(t[57]=[(0,l.Lk)("i",{class:"fa-solid fa-backward-step"},null,-1)]),8,Mo),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.totalPages,(e=>((0,l.uX)(),(0,l.CE)("span",{key:e},[(0,l.Lk)("button",{class:(0,n.C4)({active:e===s.currentPage}),onClick:t=>r.changePage(e)},(0,n.v_)(e),11,Vo)])))),128)),(0,l.Lk)("button",{disabled:s.currentPage===r.totalPages,onClick:t[8]||(t[8]=e=>r.changePage(s.currentPage+1))},t[58]||(t[58]=[(0,l.Lk)("i",{class:"fa-solid fa-forward-step"},null,-1)]),8,Uo)]),s.isEditModalOpen?((0,l.uX)(),(0,l.CE)("div",Io,[(0,l.Lk)("div",Oo,[t[81]||(t[81]=(0,l.Lk)("h2",null,"Modifica Utente",-1)),(0,l.Lk)("form",{onSubmit:t[28]||(t[28]=(0,a.D$)(((...e)=>r.updateUser&&r.updateUser(...e)),["prevent"]))},[(0,l.Lk)("div",Xo,[(0,l.Lk)("fieldset",null,[t[65]||(t[65]=(0,l.Lk)("legend",null,"Informazioni Personali",-1)),(0,l.Lk)("div",To,[(0,l.Lk)("label",null,[t[59]||(t[59]=(0,l.eW)("Nome: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[9]||(t[9]=e=>s.selectedUser.nome=e),required:""},null,512),[[a.Jo,s.selectedUser.nome]])]),(0,l.Lk)("label",null,[t[60]||(t[60]=(0,l.eW)("Cognome: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[10]||(t[10]=e=>s.selectedUser.cognome=e),required:""},null,512),[[a.Jo,s.selectedUser.cognome]])]),(0,l.Lk)("label",null,[t[61]||(t[61]=(0,l.eW)("Email: ")),(0,l.bo)((0,l.Lk)("input",{type:"email","onUpdate:modelValue":t[11]||(t[11]=e=>s.selectedUser.email=e),required:""},null,512),[[a.Jo,s.selectedUser.email]])]),(0,l.Lk)("label",null,[t[62]||(t[62]=(0,l.eW)("Telefono: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[12]||(t[12]=e=>s.selectedUser.telefono=e),required:""},null,512),[[a.Jo,s.selectedUser.telefono]])]),(0,l.Lk)("label",null,[t[63]||(t[63]=(0,l.eW)("Codice Fiscale: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[13]||(t[13]=e=>s.selectedUser.codice_fiscale=e),required:""},null,512),[[a.Jo,s.selectedUser.codice_fiscale]])]),(0,l.Lk)("label",null,[t[64]||(t[64]=(0,l.eW)("Partita IVA: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[14]||(t[14]=e=>s.selectedUser.partita_iva=e)},null,512),[[a.Jo,s.selectedUser.partita_iva]])])])]),(0,l.Lk)("fieldset",null,[t[72]||(t[72]=(0,l.Lk)("legend",null,"Dati di Accesso",-1)),(0,l.Lk)("div",$o,[(0,l.Lk)("label",null,[t[66]||(t[66]=(0,l.eW)("Indirizzo: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[15]||(t[15]=e=>s.selectedUser.indirizzo=e),required:""},null,512),[[a.Jo,s.selectedUser.indirizzo]])]),(0,l.Lk)("label",null,[t[67]||(t[67]=(0,l.eW)("Città: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[16]||(t[16]=e=>s.selectedUser.city=e),required:""},null,512),[[a.Jo,s.selectedUser.city]])]),(0,l.Lk)("label",null,[t[68]||(t[68]=(0,l.eW)("Provincia: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[17]||(t[17]=e=>s.selectedUser.provincia=e),required:""},null,512),[[a.Jo,s.selectedUser.provincia]])]),(0,l.Lk)("label",null,[t[69]||(t[69]=(0,l.eW)("CAP: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[18]||(t[18]=e=>s.selectedUser.cap=e),required:""},null,512),[[a.Jo,s.selectedUser.cap]])]),(0,l.Lk)("label",null,[t[70]||(t[70]=(0,l.eW)("Username: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[19]||(t[19]=e=>s.selectedUser.username=e),required:""},null,512),[[a.Jo,s.selectedUser.username]])]),(0,l.Lk)("label",null,[t[71]||(t[71]=(0,l.eW)("Password: ")),(0,l.bo)((0,l.Lk)("input",{type:"password","onUpdate:modelValue":t[20]||(t[20]=e=>s.selectedUser.password=e),placeholder:"Lascia vuoto per non cambiare"},null,512),[[a.Jo,s.selectedUser.password]])])])]),(0,l.Lk)("fieldset",null,[t[79]||(t[79]=(0,l.Lk)("legend",null,"Dettagli",-1)),(0,l.Lk)("div",zo,[(0,l.Lk)("label",null,[t[73]||(t[73]=(0,l.eW)("Ruolo: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[21]||(t[21]=e=>s.selectedUser.role_id=e),onChange:t[22]||(t[22]=(...e)=>r.updateAsteriskField&&r.updateAsteriskField(...e)),required:""},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.roles,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.name),9,Ro)))),128))],544),[[a.u1,s.selectedUser.role_id]])]),(0,l.Lk)("label",null,[t[74]||(t[74]=(0,l.eW)("Location: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[23]||(t[23]=e=>s.selectedUser.location_id=e)},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.locations,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.location),9,Wo)))),128))],512),[[a.u1,s.selectedUser.location_id]])]),(0,l.Lk)("label",null,[t[75]||(t[75]=(0,l.eW)("Paga Oraria: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[24]||(t[24]=e=>s.selectedUser.hourly_payment_id=e)},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.hourlyPayments,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.description)+" - €"+(0,n.v_)(e.payment),9,No)))),128))],512),[[a.u1,s.selectedUser.hourly_payment_id]])]),(0,l.Lk)("label",null,[t[76]||(t[76]=(0,l.eW)("Utente Asterisk: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[25]||(t[25]=e=>s.selectedUser.ast_user=e),disabled:!r.isOperatorSelected},null,8,jo),[[a.Jo,s.selectedUser.ast_user]])]),(0,l.Lk)("label",null,[t[78]||(t[78]=(0,l.eW)("Attivo: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[26]||(t[26]=e=>s.selectedUser.is_active=e),required:""},t[77]||(t[77]=[(0,l.Lk)("option",{value:!0},"Sì",-1),(0,l.Lk)("option",{value:!1},"No",-1)]),512),[[a.u1,s.selectedUser.is_active]])])])])]),(0,l.Lk)("div",Bo,[(0,l.Lk)("button",{type:"button",onClick:t[27]||(t[27]=(...e)=>r.closeEditModal&&r.closeEditModal(...e))},"Annulla"),t[80]||(t[80]=(0,l.Lk)("button",{type:"submit"},"Salva Modifiche",-1))])],32)])])):(0,l.Q3)("",!0),s.isCreateModalOpen?((0,l.uX)(),(0,l.CE)("div",qo,[(0,l.Lk)("div",Ko,[t[104]||(t[104]=(0,l.Lk)("h2",null,"Aggiungi Nuovo Utente",-1)),(0,l.Lk)("form",{onSubmit:t[48]||(t[48]=(0,a.D$)(((...e)=>r.createUser&&r.createUser(...e)),["prevent"]))},[(0,l.Lk)("div",Yo,[(0,l.Lk)("fieldset",null,[t[88]||(t[88]=(0,l.Lk)("legend",null,"Informazioni Personali",-1)),(0,l.Lk)("div",Jo,[(0,l.Lk)("label",null,[t[82]||(t[82]=(0,l.eW)("Nome: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[29]||(t[29]=e=>s.newUser.nome=e),required:""},null,512),[[a.Jo,s.newUser.nome]])]),(0,l.Lk)("label",null,[t[83]||(t[83]=(0,l.eW)("Cognome: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[30]||(t[30]=e=>s.newUser.cognome=e),required:""},null,512),[[a.Jo,s.newUser.cognome]])]),(0,l.Lk)("label",null,[t[84]||(t[84]=(0,l.eW)("Email: ")),(0,l.bo)((0,l.Lk)("input",{type:"email","onUpdate:modelValue":t[31]||(t[31]=e=>s.newUser.email=e),required:""},null,512),[[a.Jo,s.newUser.email]])]),(0,l.Lk)("label",null,[t[85]||(t[85]=(0,l.eW)("Telefono: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[32]||(t[32]=e=>s.newUser.telefono=e),required:""},null,512),[[a.Jo,s.newUser.telefono]])]),(0,l.Lk)("label",null,[t[86]||(t[86]=(0,l.eW)("Codice Fiscale: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[33]||(t[33]=e=>s.newUser.codice_fiscale=e),required:""},null,512),[[a.Jo,s.newUser.codice_fiscale]])]),(0,l.Lk)("label",null,[t[87]||(t[87]=(0,l.eW)("Partita IVA: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[34]||(t[34]=e=>s.newUser.partita_iva=e)},null,512),[[a.Jo,s.newUser.partita_iva]])])])]),(0,l.Lk)("fieldset",null,[t[95]||(t[95]=(0,l.Lk)("legend",null,"Dati di Accesso",-1)),(0,l.Lk)("div",Qo,[(0,l.Lk)("label",null,[t[89]||(t[89]=(0,l.eW)("Indirizzo: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[35]||(t[35]=e=>s.newUser.indirizzo=e),required:""},null,512),[[a.Jo,s.newUser.indirizzo]])]),(0,l.Lk)("label",null,[t[90]||(t[90]=(0,l.eW)("Città: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[36]||(t[36]=e=>s.newUser.city=e),required:""},null,512),[[a.Jo,s.newUser.city]])]),(0,l.Lk)("label",null,[t[91]||(t[91]=(0,l.eW)("Provincia: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[37]||(t[37]=e=>s.newUser.provincia=e),required:""},null,512),[[a.Jo,s.newUser.provincia]])]),(0,l.Lk)("label",null,[t[92]||(t[92]=(0,l.eW)("CAP: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[38]||(t[38]=e=>s.newUser.cap=e),required:""},null,512),[[a.Jo,s.newUser.cap]])]),(0,l.Lk)("label",null,[t[93]||(t[93]=(0,l.eW)("Username: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[39]||(t[39]=e=>s.newUser.username=e),required:""},null,512),[[a.Jo,s.newUser.username]])]),(0,l.Lk)("label",null,[t[94]||(t[94]=(0,l.eW)("Password: ")),(0,l.bo)((0,l.Lk)("input",{type:"password","onUpdate:modelValue":t[40]||(t[40]=e=>s.newUser.password=e),required:""},null,512),[[a.Jo,s.newUser.password]])])])]),(0,l.Lk)("fieldset",null,[t[102]||(t[102]=(0,l.Lk)("legend",null,"Dettagli",-1)),(0,l.Lk)("div",Go,[(0,l.Lk)("label",null,[t[96]||(t[96]=(0,l.eW)("Ruolo: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[41]||(t[41]=e=>s.newUser.role_id=e),onChange:t[42]||(t[42]=(...e)=>r.updateAsteriskField&&r.updateAsteriskField(...e)),required:""},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.roles,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.name),9,Ho)))),128))],544),[[a.u1,s.newUser.role_id]])]),(0,l.Lk)("label",null,[t[97]||(t[97]=(0,l.eW)("Location: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[43]||(t[43]=e=>s.newUser.location_id=e)},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.locations,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.location),9,Zo)))),128))],512),[[a.u1,s.newUser.location_id]])]),(0,l.Lk)("label",null,[t[98]||(t[98]=(0,l.eW)("Paga Oraria: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[44]||(t[44]=e=>s.newUser.hourly_payment_id=e)},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.hourlyPayments,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.description)+" - €"+(0,n.v_)(e.payment),9,ea)))),128))],512),[[a.u1,s.newUser.hourly_payment_id]])]),(0,l.Lk)("label",null,[t[99]||(t[99]=(0,l.eW)("Utente Asterisk: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[45]||(t[45]=e=>s.newUser.ast_user=e),disabled:!r.isOperatorSelected},null,8,ta),[[a.Jo,s.newUser.ast_user]])]),(0,l.Lk)("label",null,[t[101]||(t[101]=(0,l.eW)("Attivo: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[46]||(t[46]=e=>s.newUser.is_active=e),required:""},t[100]||(t[100]=[(0,l.Lk)("option",{value:!0},"Sì",-1),(0,l.Lk)("option",{value:!1},"No",-1)]),512),[[a.u1,s.newUser.is_active]])])])])]),(0,l.Lk)("div",oa,[(0,l.Lk)("button",{type:"button",onClick:t[47]||(t[47]=(...e)=>r.closeCreateModal&&r.closeCreateModal(...e))},"Annulla"),t[103]||(t[103]=(0,l.Lk)("button",{type:"submit"},"Crea Utente",-1))])],32)])])):(0,l.Q3)("",!0)])}o(116);var la={name:"UserManagement",data(){return{users:[],isEditModalOpen:!1,isCreateModalOpen:!1,currentPage:1,itemsPerPage:10,selectedUser:null,newUser:{nome:"",cognome:"",email:"",telefono:"",role_id:"",password:"",is_active:!0,ast_user:""},roles:[],filters:{role:"",is_active:"",name:""},feedbackMessage:"",feedbackType:""}},computed:{filteredUsers(){return this.users.filter((e=>{const t=!this.filters.role||e.role_name===this.filters.role,o=""===this.filters.is_active||e.is_active===JSON.parse(this.filters.is_active),a=!this.filters.name||`${e.nome} ${e.cognome}`.toLowerCase().includes(this.filters.name.toLowerCase());return t&&o&&a}))},paginatedUsers(){const e=(this.currentPage-1)*this.itemsPerPage,t=e+this.itemsPerPage;return this.filteredUsers.slice(e,t)},totalPages(){return Math.ceil(this.filteredUsers.length/this.itemsPerPage)},isOperatorSelected(){const e=this.roles.find((e=>"operatore"===e.name.toLowerCase()));return this.selectedUser?.role_id===e?.id||this.newUser?.role_id===e?.id}},methods:{updateAsteriskField(){const e=this.roles.find((e=>"operatore"===e.name.toLowerCase()));this.selectedUser&&this.selectedUser.role_id!==e?.id&&(this.selectedUser.ast_user=""),this.newUser&&this.newUser.role_id!==e?.id&&(this.newUser.ast_user="")},changePage(e){e>0&&e<=this.totalPages&&(this.currentPage=e)},exportToCSV(){const e=["ID","Nome","Cognome","Username","Email","Ruolo","Codice Fiscale","Telefono","Indirizzo","Città","Provincia","CAP","Attivo","Utente Asterisk"],t=this.users.map((e=>[e.id,e.nome||"",e.cognome||"",e.username||"",e.email||"",e.role_name||"",e.codice_fiscale||"",e.telefono||"",e.indirizzo||"",e.city||"",e.provincia||"",e.cap||"",e.is_active?"Sì":"No",e.ast_user||""])),o=[e.join(","),...t.map((e=>e.map((e=>`"${e}"`)).join(",")))].join("\n"),a=new Blob([o],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(a),n=document.createElement("a");n.href=l,n.setAttribute("download","utenti.csv"),document.body.appendChild(n),n.click(),document.body.removeChild(n)},async fetchRoles(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/roles");Array.isArray(e.data)&&Array.isArray(e.data[0])?this.roles=e.data[0]:this.roles=e.data,console.log("Ruoli caricati:",this.roles)}catch(e){console.error("Errore durante il caricamento dei ruoli:",e)}},async fetchUsers(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/users");if(Array.isArray(e.data)){const t=[];e.data.forEach((e=>{e.forEach((e=>{e&&e.id&&e.username&&t.push({id:e.id,username:e.username,email:e.email||"",nome:e.nome||"",cognome:e.cognome||"",telefono:e.telefono||"",codice_fiscale:e.codice_fiscale||"",partita_iva:e.partita_iva||"",indirizzo:e.indirizzo||"",city:e.city||"",provincia:e.provincia||"",cap:e.cap||"",role_name:e.role_name||"",is_active:"string"===typeof e.is_active?"si"===e.is_active.trim().toLowerCase():!!e.is_active,ast_user:e.ast_user||"",location_id:e.location_id||"",location_name:e.location_name||"",hourly_payment_id:e.hourly_payment_id||""})}))})),this.users=t.filter((e=>""!==e.nome||""!==e.cognome||""!==e.email||""!==e.telefono||""!==e.indirizzo)),console.log("Utenti finali assegnati a Vue:",this.users)}else console.warn("Struttura della risposta non valida:",e.data),this.showFeedback("Errore nella struttura dei dati ricevuti.","error")}catch(e){console.error("Errore nel recupero degli utenti:",e),this.showFeedback("Errore durante il caricamento della lista utenti.","error")}},async createUser(){try{const e={username:this.newUser.username,nome:this.newUser.nome,cognome:this.newUser.cognome,email:this.newUser.email,telefono:this.newUser.telefono,codice_fiscale:this.newUser.codice_fiscale,partita_iva:this.newUser.partita_iva,indirizzo:this.newUser.indirizzo,city:this.newUser.city,provincia:this.newUser.provincia,cap:this.newUser.cap,role_id:this.newUser.role_id,password:this.newUser.password,is_active:this.newUser.is_active?"si":"no",ast_user:this.newUser.ast_user,location_id:this.newUser.location_id,hourly_payment_id:this.newUser.hourly_payment_id};console.log("Dati per la creazione:",e),await P.A.post("https://dev.gixflow.cloud/api/register",e),this.showFeedback("Utente creato con successo.","success"),await this.fetchUsers(),this.closeCreateModal()}catch(e){if(console.error("Errore durante la creazione dell'utente:",e),e.response){const t=e.response.data.error||"Errore sconosciuto.";400===e.response.status&&t.includes("Email già in uso")?this.showFeedback("Non puoi usare questa E-mail, è già registrata.","warning"):this.showFeedback(`Errore: ${t}`,"error")}else this.showFeedback("Errore nella comunicazione col server.","error")}},async updateUser(){try{const e={username:this.selectedUser.username,nome:this.selectedUser.nome,cognome:this.selectedUser.cognome,email:this.selectedUser.email,telefono:this.selectedUser.telefono,codice_fiscale:this.selectedUser.codice_fiscale,partita_iva:this.selectedUser.partita_iva,indirizzo:this.selectedUser.indirizzo,city:this.selectedUser.city,provincia:this.selectedUser.provincia,cap:this.selectedUser.cap,role_id:this.selectedUser.role_id,is_active:this.selectedUser.is_active?"si":"no",ast_user:this.selectedUser.ast_user,location_id:this.selectedUser.location_id,hourly_payment_id:this.selectedUser.hourly_payment_id};console.log("Dati inviati per l'aggiornamento:",e),await P.A.put(`https://dev.gixflow.cloud/api/users/${this.selectedUser.id}`,e),this.showFeedback("Utente aggiornato con successo!","success"),await this.fetchUsers(),this.closeEditModal()}catch(e){this.showFeedback("Errore durante l'aggiornamento dell'utente.","error"),console.error("Errore durante l'aggiornamento:",e.response?.data||e)}},async deleteUser(e){try{confirm("Sei sicuro di voler eliminare questo utente?")&&(await P.A.delete(`https://dev.gixflow.cloud/api/users/${e}`),this.users=this.users.filter((t=>t.id!==e)),this.showFeedback("Utente eliminato con successo.","success"))}catch(t){this.showFeedback("Errore durante l'eliminazione dell'utente.","error"),console.error(t)}},async fetchLocations(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/locations-table");this.locations=e.data,console.log("Locations caricate:",this.locations)}catch(e){console.error("Errore nel caricamento delle locations:",e)}},async fetchHourlyPayments(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/hourly-payments-table");this.hourlyPayments=e.data,console.log("Pagamenti orari caricati:",this.hourlyPayments)}catch(e){console.error("Errore nel caricamento delle tariffe orarie:",e)}},openCreateModal(){this.isCreateModalOpen=!0,this.newUser={nome:"",cognome:"",email:"",telefono:"",codice_fiscale:"",partita_iva:"",indirizzo:"",city:"",provincia:"",cap:"",username:"",password:"",role_id:this.roles.length>0?this.roles[0].id:null,is_active:!0,ast_user:"",location_id:"",hourly_payment_id:""}},closeCreateModal(){this.isCreateModalOpen=!1,this.newUser={nome:"",cognome:"",email:"",telefono:"",role:"",password:"",is_active:!0}},openEditModal(e){this.selectedUser={...e,role_id:this.roles.find((t=>t.name===e.role_name))?.id||null,is_active:"string"===typeof e.is_active?"si"===e.is_active.trim().toLowerCase():!!e.is_active,location_id:e.location_id||null,hourly_payment_id:e.hourly_payment_id||null},this.isEditModalOpen=!0,this.feedbackMessage=""},closeEditModal(){this.selectedUser=null,this.isEditModalOpen=!1,this.feedbackMessage=""},applyFilters(){console.log("Filtri applicati:",this.filters)},resetFilters(){this.filters={role:"",is_active:"",name:""}},showFeedback(e,t){this.feedbackMessage=e,this.feedbackType=t,setTimeout((()=>{this.feedbackMessage="",this.feedbackType=""}),3e3)}},mounted(){this.fetchRoles(),this.fetchUsers(),this.fetchLocations(),this.fetchHourlyPayments()}};const na=(0,x.A)(la,[["render",aa]]);var ia=na;const sa={class:"login-container"},ra={class:"login-box"},da={key:0},ca={key:1},ua={key:0},pa={class:"input-group"},ha={class:"input-group"},ma={key:1},ga={class:"input-group"},ka={type:"submit",class:"login-btn"},fa={key:2,class:"error-message"};function La(e,t,o,i,s,r){return(0,l.uX)(),(0,l.CE)("div",sa,[(0,l.Lk)("div",ra,[t[7]||(t[7]=(0,l.Lk)("img",{src:"https://app.gixflow.cloud/flow_logo.png",alt:"GIX Flow Logo",class:"logo"},null,-1)),t[8]||(t[8]=(0,l.Lk)("h2",null,"Benvenuto",-1)),s.twoFactorRequired?((0,l.uX)(),(0,l.CE)("p",ca,"Inserisci il codice OTP")):((0,l.uX)(),(0,l.CE)("p",da,"Accedi a GIX Flow con le tue credenziali e l'OTP da Authenticator.")),(0,l.Lk)("form",{onSubmit:t[3]||(t[3]=(0,a.D$)(((...e)=>r.handleLogin&&r.handleLogin(...e)),["prevent"]))},[s.twoFactorRequired?((0,l.uX)(),(0,l.CE)("div",ma,[(0,l.Lk)("div",ga,[t[6]||(t[6]=(0,l.Lk)("label",{for:"otp"},"Codice OTP",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>s.otpCode=e),type:"text",id:"otp",required:"",placeholder:"Inserisci codice OTP"},null,512),[[a.Jo,s.otpCode]])])])):((0,l.uX)(),(0,l.CE)("div",ua,[(0,l.Lk)("div",pa,[t[4]||(t[4]=(0,l.Lk)("label",{for:"usernameOrEmail"},"Email",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>s.usernameOrEmail=e),type:"text",id:"usernameOrEmail",required:"",placeholder:"Inserisci username o email"},null,512),[[a.Jo,s.usernameOrEmail]])]),(0,l.Lk)("div",ha,[t[5]||(t[5]=(0,l.Lk)("label",{for:"password"},"Password",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>s.password=e),type:"password",id:"password",required:"",placeholder:"Inserisci la password"},null,512),[[a.Jo,s.password]])])])),(0,l.Lk)("button",ka,(0,n.v_)(s.twoFactorRequired?"Verifica OTP":"Accedi"),1),s.errorMessage?((0,l.uX)(),(0,l.CE)("p",fa,(0,n.v_)(s.errorMessage),1)):(0,l.Q3)("",!0)],32)])])}var va={data(){return{usernameOrEmail:"",password:"",otpCode:"",errorMessage:"",twoFactorRequired:!1,tempToken:""}},methods:{async handleLogin(){try{if(this.twoFactorRequired){console.log("[DEBUG] Token inviato per verifica OTP:",this.tempToken),console.log("[DEBUG] OTP inserito:",this.otpCode);const e=await P.A.post("https://dev.gixflow.cloud/api/verify-login-otp",{otp:this.otpCode,token:this.tempToken},{headers:{"Content-Type":"application/json"}});console.log("[DEBUG] Risposta verifica OTP:",e.data),localStorage.setItem("token",e.data.token),P.A.defaults.headers.common["Authorization"]=`Bearer ${e.data.token}`,this.$router.push("/")}else{const e=await P.A.post("https://dev.gixflow.cloud/api/login",{usernameOrEmail:this.usernameOrEmail,password:this.password});console.log("[DEBUG] Risposta login:",e.data),e.data.twoFactorRequired?(this.twoFactorRequired=!0,this.tempToken=e.data.tempToken,console.log("[DEBUG] Token temporaneo ricevuto:",this.tempToken)):(localStorage.setItem("token",e.data.token),P.A.defaults.headers.common["Authorization"]=`Bearer ${e.data.token}`,this.$router.push("/user/profile"))}}catch(e){console.error("[DEBUG] Errore login:",e.response?.data||e.message),this.errorMessage=e.response?.data?.message||"Errore durante il login"}},async handleOTPVerification(){try{const e=await P.A.post("https://dev.gixflow.cloud/api/verify-login-otp",{otp:this.otpCode,token:this.tempToken});console.log("[DEBUG] Nuovo token ricevuto:",e.data.token),localStorage.setItem("token",e.data.token),P.A.defaults.headers.common["Authorization"]=`Bearer ${e.data.token}`,this.$router.push("/")}catch(e){console.error("[DEBUG] Errore OTP:",e.response?.data||e.message),this.errorMessage=e.response?.data?.message||"Errore durante la verifica OTP"}}}};const ba=(0,x.A)(va,[["render",La],["__scopeId","data-v-407190bb"]]);var ya=ba;const _a={class:"reports-dashboard"},Ca={class:"filters"},wa=["value"],Aa=["value"],Ea=["value"],Pa={key:0,class:"cards"},Da={key:1,class:"export-section"};function Sa(e,t,o,i,s,r){return(0,l.uX)(),(0,l.CE)("div",_a,[t[15]||(t[15]=(0,l.Lk)("h1",null,"📊 Dashboard Report Avanzato",-1)),(0,l.Lk)("div",Ca,[(0,l.Lk)("div",null,[t[7]||(t[7]=(0,l.Lk)("label",null,"Dal:",-1)),(0,l.bo)((0,l.Lk)("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=e=>s.from=e)},null,512),[[a.Jo,s.from]])]),(0,l.Lk)("div",null,[t[8]||(t[8]=(0,l.Lk)("label",null,"Al:",-1)),(0,l.bo)((0,l.Lk)("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=e=>s.to=e)},null,512),[[a.Jo,s.to]])]),(0,l.Lk)("div",null,[t[10]||(t[10]=(0,l.Lk)("label",null,"Agente:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>s.agent_id=e)},[t[9]||(t[9]=(0,l.Lk)("option",{value:""},"Tutti",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.agents,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.nome)+" "+(0,n.v_)(e.cognome),9,wa)))),128))],512),[[a.u1,s.agent_id]])]),(0,l.Lk)("div",null,[t[12]||(t[12]=(0,l.Lk)("label",null,"Sede:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>s.location_id=e)},[t[11]||(t[11]=(0,l.Lk)("option",{value:""},"Tutte",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.locations,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.location),9,Aa)))),128))],512),[[a.u1,s.location_id]])]),(0,l.Lk)("div",null,[t[14]||(t[14]=(0,l.Lk)("label",null,"Vendor:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>s.vendor_id=e)},[t[13]||(t[13]=(0,l.Lk)("option",{value:""},"Tutti",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.vendors,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.name),9,Ea)))),128))],512),[[a.u1,s.vendor_id]])]),(0,l.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>r.fetchFilteredReport&&r.fetchFilteredReport(...e))},"Genera")]),s.report?((0,l.uX)(),(0,l.CE)("div",Pa,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.report,((e,t)=>((0,l.uX)(),(0,l.CE)("div",{class:"card",key:t},[(0,l.Lk)("h3",null,(0,n.v_)(s.labels[t]),1),(0,l.Lk)("p",null,[(0,l.Lk)("strong",null,(0,n.v_)(e),1)])])))),128))])):(0,l.Q3)("",!0),s.report?((0,l.uX)(),(0,l.CE)("div",Da,[(0,l.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>r.exportCSV&&r.exportCSV(...e))},"📁 Esporta CSV")])):(0,l.Q3)("",!0)])}var xa={name:"ReportsDashboard",data(){return{from:"",to:"",agent_id:"",location_id:"",vendor_id:"",agents:[],locations:[],vendors:[],report:null,labels:{total_appointments:"Totale Appuntamenti",total_contracts:"Totale Contratti",conversion_rate:"Tasso Conversione (%)",avg_products:"Media Prodotti/Contratto"}}},mounted(){this.fetchFilters()},methods:{async fetchFilters(){const[e,t,o]=await Promise.all([P.A.get("https://dev.gixflow.cloud/api/users"),P.A.get("https://dev.gixflow.cloud/api/locations-table"),P.A.get("https://dev.gixflow.cloud/api/vendors")]);this.agents=e.data.filter((e=>2===e.role_id)),this.locations=t.data,this.vendors=o.data},async fetchFilteredReport(){try{const{from:e,to:t,agent_id:o,location_id:a,vendor_id:l}=this,n=await P.A.get("https://dev.gixflow.cloud/api/reports/filtered-summary",{params:{from:e,to:t,agent_id:o,location_id:a,vendor_id:l}});this.report=n.data}catch(e){console.error("Errore nel fetch report:",e)}},exportCSV(){const e=[["Metrica","Valore"]];for(const[l,n]of Object.entries(this.report))e.push([this.labels[l]||l,n]);const t=e.map((e=>e.join(","))).join("\n"),o=new Blob([t],{type:"text/csv"}),a=document.createElement("a");a.href=URL.createObjectURL(o),a.download="report_filtrato.csv",a.click()}}};const Fa=(0,x.A)(xa,[["render",Sa],["__scopeId","data-v-6afab6d1"]]);var Ma=Fa;const Va={class:"clients-page"},Ua={key:0,class:"modal-overlay"},Ia={class:"modal-content large scrollable"},Oa={class:"modal-header"},Xa={class:"table-wrapper"},Ta={class:"table"},$a=["onClick"],za={class:"link-name"},Ra={key:0},Wa={class:"modal-footer"},Na={class:"search-bar"},ja={key:1,class:"client-details"},Ba={class:"client-details-container"},qa={class:"header-details"},Ka={class:"tab-container"},Ya={class:"tabs"},Ja=["onClick"],Qa={class:"tab-content"},Ga={key:0,class:"tab-pane"},Ha={key:1,class:"tab-pane"},Za={key:2,class:"tab-pane"},el={key:0,class:"modal-overlay"},tl={class:"modal-content"},ol={class:"form-grid"},al={class:"form-column"},ll=["value"],nl={class:"form-column"},il={class:"form-column"},sl={class:"modal-buttons"},rl={class:"section-container"},dl={class:"table"},cl={key:0},ul=["onClick"],pl={key:0,class:"modal-overlay"},hl={class:"modal-content"},ml={class:"modal-buttons"},gl={class:"section-container"},kl={class:"table"},fl={key:0},Ll=["onClick"],vl={key:0,class:"modal-overlay"},bl={class:"modal-content"},yl={class:"contract-details-table"},_l={class:"modal-buttons"};function Cl(e,t,o,i,s,r){return(0,l.uX)(),(0,l.CE)("div",Va,[t[79]||(t[79]=(0,l.Lk)("div",{class:"header"},[(0,l.Lk)("h1",null,[(0,l.Lk)("i",{class:"fa-solid fa-shop icon-green"}),(0,l.eW)("Ricerca Cliente")]),(0,l.Lk)("div",{class:"actions"})],-1)),s.filteredClients.length?((0,l.uX)(),(0,l.CE)("div",Ua,[(0,l.Lk)("div",Ia,[(0,l.Lk)("div",Oa,[(0,l.Lk)("h2",null,"Risultati Ricerca ("+(0,n.v_)(r.limitedResults.length)+")",1)]),(0,l.Lk)("div",Xa,[(0,l.Lk)("table",Ta,[t[24]||(t[24]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Ragione Sociale"),(0,l.Lk)("th",null,"P.IVA"),(0,l.Lk)("th",null,"Città"),(0,l.Lk)("th",null,"Provincia"),(0,l.Lk)("th",null,"Telefono")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.limitedResults,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id,onClick:t=>r.selectClient(e)},[(0,l.Lk)("td",null,[(0,l.Lk)("span",za,[(0,l.eW)((0,n.v_)(e.ragione_sociale)+" ",1),e.forma_giuridica?((0,l.uX)(),(0,l.CE)("span",Ra," ("+(0,n.v_)(e.forma_giuridica)+") ",1)):(0,l.Q3)("",!0)])]),(0,l.Lk)("td",null,(0,n.v_)(e.partita_iva),1),(0,l.Lk)("td",null,(0,n.v_)(e.citta),1),(0,l.Lk)("td",null,(0,n.v_)(e.provincia),1),(0,l.Lk)("td",null,(0,n.v_)(e.telefono),1)],8,$a)))),128))])])]),(0,l.Lk)("div",Wa,[(0,l.Lk)("button",{class:"btn-close",onClick:t[0]||(t[0]=e=>s.filteredClients=[])}," Chiudi ")])])])):(0,l.Q3)("",!0),(0,l.Lk)("div",Na,[(0,l.bo)((0,l.Lk)("input",{type:"text",id:"search",class:"input-search-client","onUpdate:modelValue":t[1]||(t[1]=e=>s.searchQuery=e),onInput:t[2]||(t[2]=(...e)=>r.debouncedSearch&&r.debouncedSearch(...e)),placeholder:"Ricerca Cliente per Ragione Sociale, PI o Telefono"},null,544),[[a.Jo,s.searchQuery]]),(0,l.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>r.resetSearch&&r.resetSearch(...e)),class:"reset-button"},"Reset")]),s.selectedClient?((0,l.uX)(),(0,l.CE)("div",ja,[(0,l.Lk)("div",Ba,[(0,l.Lk)("div",qa,[(0,l.Lk)("h2",null," Dettagli Cliente #"+(0,n.v_)(s.selectedClient.id)+": "+(0,n.v_)(s.selectedClient.ragione_sociale),1),(0,l.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>r.openEditModal&&r.openEditModal(...e)),class:"edit-button"}," Modifica Cliente ")]),(0,l.Lk)("div",Ka,[(0,l.Lk)("div",Ya,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.tabs,(e=>((0,l.uX)(),(0,l.CE)("button",{key:e.name,class:(0,n.C4)({active:s.currentTab===e.name}),onClick:t=>s.currentTab=e.name},(0,n.v_)(e.label),11,Ja)))),128))]),t[42]||(t[42]=(0,l.Lk)("div",{class:"tab-content"},null,-1)),(0,l.Lk)("div",Qa,["azienda"===s.currentTab?((0,l.uX)(),(0,l.CE)("div",Ga,[(0,l.Lk)("table",null,[(0,l.Lk)("tbody",null,[(0,l.Lk)("tr",null,[t[25]||(t[25]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"ID:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedClient.id),1)]),(0,l.Lk)("tr",null,[t[26]||(t[26]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Stato:")],-1)),(0,l.Lk)("td",null,(0,n.v_)("si"===s.selectedClient.is_active?"Attivo":"Non Attivo"),1)]),(0,l.Lk)("tr",null,[t[27]||(t[27]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Ragione Sociale:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedClient.ragione_sociale),1)]),(0,l.Lk)("tr",null,[t[28]||(t[28]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Forma Giuridica:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedClient.forma_giuridica),1)]),(0,l.Lk)("tr",null,[t[29]||(t[29]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Partita IVA:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedClient.partita_iva),1)]),(0,l.Lk)("tr",null,[t[30]||(t[30]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Codice Fiscale:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedClient.codice_fiscale),1)])])])])):(0,l.Q3)("",!0),"contatti"===s.currentTab?((0,l.uX)(),(0,l.CE)("div",Ha,[(0,l.Lk)("table",null,[(0,l.Lk)("tbody",null,[(0,l.Lk)("tr",null,[t[31]||(t[31]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Telefono:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedClient.telefono),1)]),(0,l.Lk)("tr",null,[t[32]||(t[32]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Email:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedClient.email),1)]),(0,l.Lk)("tr",null,[t[33]||(t[33]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Indirizzo:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedClient.indirizzo),1)]),(0,l.Lk)("tr",null,[t[34]||(t[34]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Città:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedClient.citta),1)]),(0,l.Lk)("tr",null,[t[35]||(t[35]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Provincia:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedClient.provincia),1)]),(0,l.Lk)("tr",null,[t[36]||(t[36]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"CAP:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedClient.cap),1)])])])])):(0,l.Q3)("",!0),"referente"===s.currentTab?((0,l.uX)(),(0,l.CE)("div",Za,[(0,l.Lk)("table",null,[(0,l.Lk)("tbody",null,[(0,l.Lk)("tr",null,[t[37]||(t[37]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Nome:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedClient.ref_nome),1)]),(0,l.Lk)("tr",null,[t[38]||(t[38]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Cognome:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedClient.ref_cognome),1)]),(0,l.Lk)("tr",null,[t[39]||(t[39]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Ruolo:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedClient.ref_ruolo),1)]),(0,l.Lk)("tr",null,[t[40]||(t[40]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Email:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedClient.ref_email),1)]),(0,l.Lk)("tr",null,[t[41]||(t[41]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Telefono:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedClient.ref_telefono),1)])])])])):(0,l.Q3)("",!0)])])]),s.isEditModalOpen?((0,l.uX)(),(0,l.CE)("div",el,[(0,l.Lk)("div",tl,[(0,l.Lk)("h2",null,"Modifica Cliente #"+(0,n.v_)(s.editableClient.id),1),(0,l.Lk)("form",{onSubmit:t[21]||(t[21]=(0,a.D$)(((...e)=>r.updateClient&&r.updateClient(...e)),["prevent"]))},[(0,l.Lk)("div",ol,[(0,l.Lk)("div",al,[(0,l.Lk)("label",null,[t[43]||(t[43]=(0,l.eW)(" Ragione Sociale: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=e=>s.editableClient.ragione_sociale=e),required:""},null,512),[[a.Jo,s.editableClient.ragione_sociale]])]),(0,l.Lk)("label",null,[t[45]||(t[45]=(0,l.eW)(" Forma Giuridica: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>s.editableClient.forma_giuridica_id=e),required:""},[t[44]||(t[44]=(0,l.Lk)("option",{disabled:"",value:""}," Seleziona una forma giuridica ",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.legalForms,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.name),9,ll)))),128))],512),[[a.u1,s.editableClient.forma_giuridica_id]])]),(0,l.Lk)("label",null,[t[46]||(t[46]=(0,l.eW)(" Partita IVA: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[7]||(t[7]=e=>s.editableClient.partita_iva=e),required:""},null,512),[[a.Jo,s.editableClient.partita_iva]])]),(0,l.Lk)("label",null,[t[47]||(t[47]=(0,l.eW)(" Codice Fiscale: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[8]||(t[8]=e=>s.editableClient.codice_fiscale=e),required:""},null,512),[[a.Jo,s.editableClient.codice_fiscale]])]),(0,l.Lk)("label",null,[t[48]||(t[48]=(0,l.eW)(" Telefono: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[9]||(t[9]=e=>s.editableClient.telefono=e)},null,512),[[a.Jo,s.editableClient.telefono]])]),(0,l.Lk)("label",null,[t[49]||(t[49]=(0,l.eW)(" Email: ")),(0,l.bo)((0,l.Lk)("input",{type:"email","onUpdate:modelValue":t[10]||(t[10]=e=>s.editableClient.email=e)},null,512),[[a.Jo,s.editableClient.email]])])]),(0,l.Lk)("div",nl,[(0,l.Lk)("label",null,[t[50]||(t[50]=(0,l.eW)(" Indirizzo: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[11]||(t[11]=e=>s.editableClient.indirizzo=e)},null,512),[[a.Jo,s.editableClient.indirizzo]])]),(0,l.Lk)("label",null,[t[51]||(t[51]=(0,l.eW)(" Città: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[12]||(t[12]=e=>s.editableClient.citta=e)},null,512),[[a.Jo,s.editableClient.citta]])]),(0,l.Lk)("label",null,[t[52]||(t[52]=(0,l.eW)(" Provincia: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[13]||(t[13]=e=>s.editableClient.provincia=e)},null,512),[[a.Jo,s.editableClient.provincia]])]),(0,l.Lk)("label",null,[t[53]||(t[53]=(0,l.eW)(" CAP: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[14]||(t[14]=e=>s.editableClient.cap=e)},null,512),[[a.Jo,s.editableClient.cap]])])]),(0,l.Lk)("div",il,[(0,l.Lk)("label",null,[t[54]||(t[54]=(0,l.eW)(" Nome Referente: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[15]||(t[15]=e=>s.editableClient.ref_nome=e)},null,512),[[a.Jo,s.editableClient.ref_nome]])]),(0,l.Lk)("label",null,[t[55]||(t[55]=(0,l.eW)(" Cognome Referente: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[16]||(t[16]=e=>s.editableClient.ref_cognome=e)},null,512),[[a.Jo,s.editableClient.ref_cognome]])]),(0,l.Lk)("label",null,[t[56]||(t[56]=(0,l.eW)(" Ruolo Referente: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[17]||(t[17]=e=>s.editableClient.ref_ruolo=e)},null,512),[[a.Jo,s.editableClient.ref_ruolo]])]),(0,l.Lk)("label",null,[t[57]||(t[57]=(0,l.eW)(" E-Mail Referente: ")),(0,l.bo)((0,l.Lk)("input",{type:"email","onUpdate:modelValue":t[18]||(t[18]=e=>s.editableClient.ref_email=e)},null,512),[[a.Jo,s.editableClient.ref_email]])]),(0,l.Lk)("label",null,[t[58]||(t[58]=(0,l.eW)(" Telefono Referente: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[19]||(t[19]=e=>s.editableClient.ref_telefono=e)},null,512),[[a.Jo,s.editableClient.ref_telefono]])])])]),(0,l.Lk)("div",sl,[(0,l.Lk)("button",{type:"button",onClick:t[20]||(t[20]=(...e)=>r.closeEditModal&&r.closeEditModal(...e))},"Annulla"),t[59]||(t[59]=(0,l.Lk)("button",{type:"submit"},"Salva Modifiche",-1))])],32)])])):(0,l.Q3)("",!0),(0,l.Lk)("div",rl,[t[67]||(t[67]=(0,l.Lk)("h3",null,"Storico Appuntamenti",-1)),(0,l.Lk)("table",dl,[t[61]||(t[61]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"ID"),(0,l.Lk)("th",null,"Data"),(0,l.Lk)("th",null,"Agente"),(0,l.Lk)("th",null,"Operatore"),(0,l.Lk)("th",null,"Stato"),(0,l.Lk)("th",null,"Azioni")])],-1)),(0,l.Lk)("tbody",null,[0===s.clientAppointments.length?((0,l.uX)(),(0,l.CE)("tr",cl,t[60]||(t[60]=[(0,l.Lk)("td",{colspan:"6",class:"no-results"}," Nessun appuntamento trovato ",-1)]))):((0,l.uX)(!0),(0,l.CE)(l.FK,{key:1},(0,l.pI)(s.clientAppointments,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id},[(0,l.Lk)("td",null,(0,n.v_)(e.id),1),(0,l.Lk)("td",null,(0,n.v_)(new Date(e.date_start).toLocaleDateString()),1),(0,l.Lk)("td",null,(0,n.v_)(e.agent_surname||"N/A")+" "+(0,n.v_)(e.agent_name||""),1),(0,l.Lk)("td",null,(0,n.v_)(e.operator_surname||"N/A")+" "+(0,n.v_)(e.operator_name||""),1),(0,l.Lk)("td",null,(0,n.v_)(e.status),1),(0,l.Lk)("td",null,[(0,l.Lk)("button",{onClick:t=>r.openAppointmentModal(e)}," Dettagli ",8,ul)])])))),128))])]),s.selectedAppointment?((0,l.uX)(),(0,l.CE)("div",pl,[(0,l.Lk)("div",hl,[(0,l.Lk)("h2",null,"Dettagli Appuntamento #"+(0,n.v_)(s.selectedAppointment.id),1),(0,l.Lk)("table",null,[(0,l.Lk)("tbody",null,[(0,l.Lk)("tr",null,[t[62]||(t[62]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Data Appuntamento:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(r.formatDateTime(s.selectedAppointment.date_start)),1)]),(0,l.Lk)("tr",null,[t[63]||(t[63]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Agente:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedAppointment.agent_surname||"N/D")+" "+(0,n.v_)(s.selectedAppointment.agent_name||""),1)]),(0,l.Lk)("tr",null,[t[64]||(t[64]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Operatore:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedAppointment.operator_surname||"N/D")+" "+(0,n.v_)(s.selectedAppointment.operator_name||""),1)]),(0,l.Lk)("tr",null,[t[65]||(t[65]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Status:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedAppointment.status||"N/D"),1)]),(0,l.Lk)("tr",null,[t[66]||(t[66]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Note:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedAppointment.notes||"Nessuna nota"),1)])])]),(0,l.Lk)("div",ml,[(0,l.Lk)("button",{onClick:t[22]||(t[22]=e=>s.selectedAppointment=null)},"Chiudi")])])])):(0,l.Q3)("",!0)]),(0,l.Lk)("div",gl,[t[78]||(t[78]=(0,l.Lk)("h3",null,"Storico Contratti",-1)),(0,l.Lk)("table",kl,[t[69]||(t[69]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"ID"),(0,l.Lk)("th",null,"Data Firma"),(0,l.Lk)("th",null,"Vendor"),(0,l.Lk)("th",null,"Agente"),(0,l.Lk)("th",null,"Stato"),(0,l.Lk)("th",null,"Azioni")])],-1)),(0,l.Lk)("tbody",null,[0===s.clientContracts.length?((0,l.uX)(),(0,l.CE)("tr",fl,t[68]||(t[68]=[(0,l.Lk)("td",{colspan:"6",class:"no-results"},"Nessun contratto trovato",-1)]))):((0,l.uX)(!0),(0,l.CE)(l.FK,{key:1},(0,l.pI)(s.clientContracts,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id},[(0,l.Lk)("td",null,(0,n.v_)(e.id),1),(0,l.Lk)("td",null,(0,n.v_)(e.signature_date),1),(0,l.Lk)("td",null,(0,n.v_)(e.vendor),1),(0,l.Lk)("td",null,(0,n.v_)(e.agent),1),(0,l.Lk)("td",null,(0,n.v_)(e.status),1),(0,l.Lk)("td",null,[(0,l.Lk)("button",{onClick:t=>r.openContractModal(e)},"Dettagli",8,Ll)])])))),128))])]),s.selectedContract?((0,l.uX)(),(0,l.CE)("div",vl,[(0,l.Lk)("div",bl,[(0,l.Lk)("h2",null,"Dettagli Contratto #"+(0,n.v_)(s.selectedContract.id),1),(0,l.Lk)("table",yl,[(0,l.Lk)("tbody",null,[(0,l.Lk)("tr",null,[t[70]||(t[70]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Numero Contratto:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedContract.contract_number),1)]),(0,l.Lk)("tr",null,[t[71]||(t[71]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Data Firma:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedContract.signature_date),1)]),(0,l.Lk)("tr",null,[t[72]||(t[72]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Vendor:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedContract.vendor),1)]),(0,l.Lk)("tr",null,[t[73]||(t[73]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Agente:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedContract.agent),1)]),(0,l.Lk)("tr",null,[t[74]||(t[74]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Stato:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedContract.status),1)]),(0,l.Lk)("tr",null,[t[75]||(t[75]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Note:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedContract.notes||"Nessuna nota"),1)]),(0,l.Lk)("tr",null,[t[76]||(t[76]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Data Completamento:")],-1)),(0,l.Lk)("td",null,(0,n.v_)(s.selectedContract.completion_date||"Non disponibile"),1)]),(0,l.Lk)("tr",null,[t[77]||(t[77]=(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,"Prodotti:")],-1)),(0,l.Lk)("td",null,[(0,l.Lk)("ul",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.selectedContract.products,((e,t)=>((0,l.uX)(),(0,l.CE)("li",{key:t},(0,n.v_)(e.name)+" (x"+(0,n.v_)(e.quantity)+") ",1)))),128))])])])])]),(0,l.Lk)("div",_l,[(0,l.Lk)("button",{onClick:t[23]||(t[23]=e=>s.selectedContract=null)},"Chiudi")])])])):(0,l.Q3)("",!0)])])):(0,l.Q3)("",!0)])}var wl=o(8626),Al={name:"ClientsPage",data(){return{searchQuery:"",clients:[],filteredClients:[],selectedClient:null,selectedContract:null,selectedAppointment:null,clientAppointments:[],clientContracts:[],isEditModalOpen:!1,editableClient:null,tabs:[{name:"azienda",label:"Dati Azienda"},{name:"contatti",label:"Contatti"},{name:"referente",label:"Referente"}],currentTab:"azienda",legalForms:[]}},computed:{limitedResults(){return this.filteredClients.slice(0,10)}},methods:{openEditModal(){this.editableClient={...this.selectedClient},this.legalForms.length||this.fetchLegalForms().then((()=>{})),this.isEditModalOpen=!0},closeEditModal(){this.isEditModalOpen=!1,this.editableClient=null},openAppointmentModal(e){this.selectedAppointment=e},async updateClient(){try{await P.A.put(`https://dev.gixflow.cloud/api/clients/${this.editableClient.id}`,{...this.editableClient,forma_giuridica:void 0}),this.$toast.show("Cliente aggiornato con successo.",{position:"bottom-right",duration:5e3,type:"default"}),await this.fetchClients(),this.selectClient(this.clients.find((e=>e.id===this.editableClient.id))),this.closeEditModal()}catch(e){console.error("Errore durante l'aggiornamento del cliente:",e),this.$toast.show("Errore durante l'aggiornamento del cliente.",{position:"bottom-right",duration:5e3,type:"error"})}},formatDateTime(e){if(!e)return"N/A";const t=new Date(e),o=t.toLocaleDateString("it-IT"),a=t.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit",hour12:!1});return`${o} ${a}`},async editAppointment(){alert("Funziona! Aggiungi il codice per modificare l'appuntamento.")},async created(){try{await this.fetchLegalForms(),await this.fetchClients()}catch(e){console.error("Errore durante il caricamento iniziale:",e)}},async fetchLegalForms(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/legal-forms");Array.isArray(e.data)?this.legalForms=e.data:(console.error("Formato non valido delle forme giuridiche:",e.data),this.$toast.show("Errore nel caricamento delle forme giuridiche.",{position:"bottom-right",duration:5e3,type:"error"}))}catch(e){console.error("Errore nel recupero delle forme giuridiche:",e),this.$toast.show("Errore nel caricamento delle forme giuridiche.",{position:"bottom-right",duration:5e3,type:"error"})}},async fetchClients(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/clients");Array.isArray(e.data)?this.clients=e.data.map((e=>{if(e.forma_giuridica)return e;const t=this.legalForms.find((t=>parseInt(t.id)===parseInt(e.forma_giuridica_id)));return{...e,forma_giuridica:t?t.name:"Non specificata"}})):console.error("Formato dei dati dei clienti non valido:",e.data)}catch(e){console.error("Errore durante il recupero dei clienti:",e)}},debouncedSearch:(0,wl.debounce)((function(){this.searchQuery.length<3?this.filteredClients=[]:this.filteredClients=this.clients.filter((e=>[e.ragione_sociale,e.partita_iva,e.telefono].join(" ").toLowerCase().includes(this.searchQuery.toLowerCase())))}),300),selectClient(e){this.selectedClient={...e},this.searchQuery="",this.filteredClients=[],this.fetchClientAppointments(e.id),this.fetchClientContracts(e.id)},async fetchClientAppointments(e){try{const t=await P.A.get(`https://dev.gixflow.cloud/api/appointments/client/${e}`);let o=[];Array.isArray(t.data)?t.data.forEach((e=>{Array.isArray(e)?o.push(...e):e&&o.push(e)})):t.data&&"object"===typeof t.data&&(o=[t.data]),this.clientAppointments=o}catch(t){console.error("Nessun appuntamento trovato:",t),this.$toast.show("Nessun appuntamento trovato.",{position:"bottom-right",duration:5e3,type:"default"})}},async fetchClientContracts(e){try{const t=await P.A.get(`https://dev.gixflow.cloud/api/contracts/client/${e}`);Array.isArray(t.data)?this.clientContracts=t.data.map((e=>({id:e.id,contract_number:e.contract_number,signature_date:e.signature_date?new Date(e.signature_date).toLocaleDateString("it-IT"):"N/D",vendor:e.vendor?.name||"N/D",agent:e.agent?.name||"N/D",status:e.status?.name||"N/D",notes:e.notes,completion_date:e.completion_date?new Date(e.completion_date).toLocaleDateString("it-IT"):null,products:e.products||[]}))):this.clientContracts=[]}catch(t){console.error("Nessun contratto trovato.",t),this.clientContracts=[],this.$toast.show("Nessun contratto trovato.",{position:"bottom-right",duration:5e3,type:"default"})}},openContractModal(e){this.selectedContract=e},resetSearch(){this.searchQuery="",this.filteredClients=[],this.selectedClient=null,this.clientAppointments=[],this.clientContracts=[]}},mounted(){this.fetchClients(),document.addEventListener("click",this.handleOutsideClick),document.addEventListener("keydown",this.handleKeyPress)},beforeUnmount(){document.removeEventListener("click",this.handleOutsideClick),document.removeEventListener("keydown",this.handleKeyPress)},handleOutsideClick(e){this.$el.contains(e.target)||(this.filteredClients=[])},handleKeyPress(e){"Escape"===e.key&&(this.filteredClients=[])}};const El=(0,x.A)(Al,[["render",Cl],["__scopeId","data-v-79e2dba3"]]);var Pl=El;const Dl={class:"filters"},Sl=["value"],xl=["value"],Fl={class:"table"},Ml=["onClick"],Vl={key:0},Ul={class:"pagination"},Il=["disabled"],Ol=["onClick"],Xl=["disabled"];function Tl(e,t,o,i,s,r){const d=(0,l.g2)("flat-pickr");return(0,l.uX)(),(0,l.CE)("div",null,[t[22]||(t[22]=(0,l.Lk)("div",{class:"header"},[(0,l.Lk)("h1",null,[(0,l.Lk)("i",{class:"fa-solid fa-file-signature icon-green"}),(0,l.eW)("Elenco Contratti ")]),(0,l.Lk)("div",{class:"actions"})],-1)),(0,l.Lk)("div",Dl,[(0,l.Lk)("label",null,[t[10]||(t[10]=(0,l.eW)(" Cerca: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>s.tempFilters.client=e),placeholder:"Ragione sociale, Partita IVA o Telefono...",onInput:t[1]||(t[1]=(...e)=>r.debouncedSearch&&r.debouncedSearch(...e))},null,544),[[a.Jo,s.tempFilters.client]])]),(0,l.Lk)("label",null,[t[12]||(t[12]=(0,l.eW)(" Agente: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>s.tempFilters.agent=e)},[t[11]||(t[11]=(0,l.Lk)("option",{value:""},"Tutti",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.agents,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.cognome?`${e.cognome} ${e.nome||""}`:"Senza Nome"),9,Sl)))),128))],512),[[a.u1,s.tempFilters.agent]])]),(0,l.Lk)("label",null,[t[14]||(t[14]=(0,l.eW)(" Stato: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>s.tempFilters.status_id=e)},[t[13]||(t[13]=(0,l.Lk)("option",{value:""},"Tutti",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.contractStatuses,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.name),9,xl)))),128))],512),[[a.u1,s.tempFilters.status_id]])]),(0,l.Lk)("label",null,[t[15]||(t[15]=(0,l.eW)(" Data Inizio: ")),(0,l.bF)(d,{modelValue:s.tempFilters.dateStart,"onUpdate:modelValue":t[4]||(t[4]=e=>s.tempFilters.dateStart=e),config:i.configDate,class:"custom-datepicker",placeholder:"Data inizio"},null,8,["modelValue","config"])]),(0,l.Lk)("label",null,[t[16]||(t[16]=(0,l.eW)(" Data Fine: ")),(0,l.bF)(d,{modelValue:s.tempFilters.dateEnd,"onUpdate:modelValue":t[5]||(t[5]=e=>s.tempFilters.dateEnd=e),config:i.configDate,class:"custom-datepicker",placeholder:"Data fine"},null,8,["modelValue","config"])]),(0,l.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>r.applyFilters&&r.applyFilters(...e))},"Applica Filtri"),(0,l.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>r.resetFilters&&r.resetFilters(...e))},"Reset")]),(0,l.Lk)("table",Fl,[t[19]||(t[19]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"ID"),(0,l.Lk)("th",null,"Cliente"),(0,l.Lk)("th",null,"Agente"),(0,l.Lk)("th",null,"Vendor"),(0,l.Lk)("th",null,"Data Inserimento"),(0,l.Lk)("th",null,"Data Firma"),(0,l.Lk)("th",null,"Data Completamento"),(0,l.Lk)("th",null,"Stato"),(0,l.Lk)("th",null,"Azioni")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.filteredContracts,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id},[(0,l.Lk)("td",null,(0,n.v_)(e.id),1),(0,l.Lk)("td",null,(0,n.v_)(e.client_name),1),(0,l.Lk)("td",null,(0,n.v_)(e.agent_name),1),(0,l.Lk)("td",null,(0,n.v_)(e.vendor_name),1),(0,l.Lk)("td",null,(0,n.v_)(r.formatDate(e.creation_date)),1),(0,l.Lk)("td",null,(0,n.v_)(r.formatDate(e.signature_date)),1),(0,l.Lk)("td",null,(0,n.v_)(e.completion_date?r.formatDate(e.completion_date):"Non completato"),1),(0,l.Lk)("td",null,(0,n.v_)(e.status_name),1),(0,l.Lk)("td",null,[(0,l.Lk)("button",{class:"in-grid",onClick:t=>r.editContract(e.id),title:"Modifica"},t[17]||(t[17]=[(0,l.Lk)("i",{class:"fa-solid fa-pen"},null,-1)]),8,Ml)])])))),128)),0===r.filteredContracts.length?((0,l.uX)(),(0,l.CE)("tr",Vl,t[18]||(t[18]=[(0,l.Lk)("td",{colspan:"9",class:"no-data"},"Nessun contratto trovato.",-1)]))):(0,l.Q3)("",!0)])]),(0,l.Lk)("div",Ul,[(0,l.Lk)("button",{disabled:1===s.currentPage,onClick:t[8]||(t[8]=e=>r.changePage(s.currentPage-1))},t[20]||(t[20]=[(0,l.Lk)("i",{class:"fa-solid fa-backward-step"},null,-1)]),8,Il),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.totalPages,(e=>((0,l.uX)(),(0,l.CE)("span",{key:e},[(0,l.Lk)("button",{class:(0,n.C4)({active:e===s.currentPage}),onClick:t=>r.changePage(e)},(0,n.v_)(e),11,Ol)])))),128)),(0,l.Lk)("button",{disabled:s.currentPage===r.totalPages,onClick:t[9]||(t[9]=e=>r.changePage(s.currentPage+1))},t[21]||(t[21]=[(0,l.Lk)("i",{class:"fa-solid fa-forward-step"},null,-1)]),8,Xl)])])}var $l=o(9148),zl=o.n($l),Rl={components:{FlatPickr:vt.A},setup(){const e=(0,Ce.KR)({dateFormat:"d/m/Y",altInput:!0,altFormat:"d/m/Y",locale:bt.Italian}),t=(0,Ce.KR)({enableTime:!0,dateFormat:"Y-m-d H:i",altInput:!0,altFormat:"d/m/Y H:i",time_24hr:!0,locale:bt.Italian});return{configDate:e,configDateTime:t}},data(){return{contracts:[],agents:[],clients:[],contractStatuses:[],filters:{agent:"",client:"",status_id:"",dateStart:"",dateEnd:""},tempFilters:{agent:"",client:"",status_id:"",dateStart:"",dateEnd:""},searchTimer:null,currentPage:1,itemsPerPage:10}},computed:{filteredContracts(){const e=this.filters.client.toLowerCase().trim(),t=this.filters.agent,o=this.filters.status_id,a=this.filters.dateStart,l=this.filters.dateEnd;return this.contracts.filter((n=>{const i=!e||((n.client_name?.toLowerCase()||"").includes(e)||(n.partita_iva||"").includes(e)||(n.telefono||"").includes(e)),s=!t||String(n.agent_id)===String(t),r=!o||String(n.status_id)===String(o),d=n.creation_date?zl()(n.creation_date,"YYYY-MM-DD"):null,c=a?zl()(a,"DD/MM/YYYY"):null,u=l?zl()(l,"DD/MM/YYYY").endOf("day"):null,p=d&&(!c||d.isSameOrAfter(c))&&(!u||d.isSameOrBefore(u));return i&&s&&r&&p}))},paginatedContracts(){const e=(this.currentPage-1)*this.itemsPerPage,t=e+this.itemsPerPage;return this.filteredContracts.slice(e,t)},totalPages(){return Math.ceil(this.filteredContracts.length/this.itemsPerPage)}},methods:{async fetchContracts(){this.contracts=[];try{const e=await P.A.get("https://dev.gixflow.cloud/api/contracts"),t=await P.A.get("https://dev.gixflow.cloud/api/clients"),o=new Map(t.data.map((e=>[e.id,e])));this.contracts=e.data.map((e=>{const t=o.get(e.client_id)||{};return{id:e.id,client_id:e.client_id,client_name:e.client_name||"",partita_iva:t.partita_iva||"",telefono:t.telefono||"",agent_id:e.agent_id,agent_name:e.agent_name||"Senza Agente",vendor_name:e.vendor||"Sconosciuto",status_id:e.status_id,status_name:e.status_name||"Sconosciuto",creation_date:e.creation_date||"",signature_date:e.signature_date||"",completion_date:e.completion_date||null,notes:e.notes||""}})),console.log("📌 Contratti aggiornati:",this.contracts)}catch(e){console.error("❌ Errore nel caricamento dei contratti:",e)}},async fetchContractStatuses(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/contract-status");this.contractStatuses=e.data||[]}catch(e){console.error("Errore durante il recupero degli stati dei contratti:",e)}},async fetchClients(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/clients");this.clients=e.data||[],console.log("Clienti ricevuti:",this.clients)}catch(e){console.error("Errore durante il recupero dei clienti:",e)}},async fetchAgents(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/users");console.log("Risposta completa /users:",e.data);let t=e.data;Array.isArray(t)&&Array.isArray(t[0])&&(t=t[0]),this.agents=t.filter((e=>2===e.role_id))}catch(e){console.error("Errore durante il recupero degli agenti:",e),this.agents=[]}},applyFilters(){this.filters={...this.tempFilters},this.currentPage=1,console.log("🔍 Filtri applicati:",this.filters)},resetFilters(){this.tempFilters={agent:"",client:"",status_id:"",dateStart:"",dateEnd:""},this.filters={...this.tempFilters},this.currentPage=1},parseDateFromInput(e){if(!e)return null;const t=e.split("/");if(3!==t.length)return null;const[o,a,l]=t,n=`${l}-${a.padStart(2,"0")}-${o.padStart(2,"0")}`,i=new Date(n);return isNaN(i)?null:i},debouncedSearch(){clearTimeout(this.searchTimer),this.searchTimer=setTimeout((()=>{this.filters.client=this.tempFilters.client.trim(),this.currentPage=1}),300)},editContract(e){console.log("🛠️ Modifica contratto con ID:",e),this.$router.push({name:"ContractsDetails",params:{id:e.toString()}})},formatDate(e){if(!e)return"-";const t=new Date(e);return t.toLocaleDateString("it-IT")},changePage(e){e>=1&&e<=this.totalPages&&(this.currentPage=e)}},mounted(){this.fetchContracts(),this.fetchAgents(),this.fetchClients(),this.fetchContractStatuses()}};const Wl=(0,x.A)(Rl,[["render",Tl]]);var Nl=Wl;const jl={class:"section-standard"},Bl=["disabled"],ql={class:"table"},Kl=["onClick"],Yl={key:0},Jl={key:0,class:"modal-overlay"},Ql={class:"modal-content"},Gl=["value"],Hl={class:"modal-buttons"},Zl=["disabled"],en={key:1,class:"section-step"},tn={class:"file-input-label"},on={key:0,class:"anagrafica-completa"},an={key:1,class:"anagrafica-incompleta"},ln={key:2,class:"modal-overlay"},nn={class:"modal-content"},sn={class:"form-grid"},rn={class:"form-column"},dn=["value"],cn={class:"form-column"},un={class:"form-column"},pn={class:"modal-buttons"},hn={key:2,class:"section-step"},mn={class:"file-input-label"},gn={key:0,class:"modal-overlay"},kn={class:"modal-content"},fn=["value"],Ln=["value"],vn={class:"modal-buttons"},bn=["disabled"],yn={key:0,class:"table"},_n=["onClick"],Cn=["onClick"],wn={key:3,class:"section-step"},An={class:"file-input-label"},En={class:"file-reset-label"},Pn={key:0,class:"table"},Dn=["onUpdate:modelValue"],Sn=["value"],xn=["onClick"],Fn={key:4},Mn=["disabled"],Vn={class:"file-reset-label"},Un={key:0,class:"modal-overlay"},In={class:"modal-content"},On={class:"table"},Xn={class:"modal-section"},Tn={class:"table"},$n={class:"modal-section"},zn={class:"table"},Rn={class:"modal-section"},Wn={key:0,class:"error-message"},Nn={class:"modal-buttons"},jn=["disabled"];function Bn(e,t,o,i,s,r){const d=(0,l.g2)("flat-pickr");return(0,l.uX)(),(0,l.CE)("div",null,[t[97]||(t[97]=(0,l.Lk)("h1",null,"Nuovo Contratto",-1)),(0,l.Lk)("section",jl,[t[43]||(t[43]=(0,l.Lk)("h3",null," Seleziona un appuntamento in stato positivo oppure cercalo tramite l'input ",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>s.search=e),placeholder:"Cerca cliente o agente",onInput:t[1]||(t[1]=(...e)=>r.filterAppointments&&r.filterAppointments(...e)),disabled:null!==s.selectedAppointment},null,40,Bl),[[a.Jo,s.search]]),(0,l.Lk)("table",ql,[t[42]||(t[42]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"ID"),(0,l.Lk)("th",null,"Cliente"),(0,l.Lk)("th",null,"Telefono"),(0,l.Lk)("th",null,"Indirizzo"),(0,l.Lk)("th",null,"Città"),(0,l.Lk)("th",null,"Provincia"),(0,l.Lk)("th",null,"CAP"),(0,l.Lk)("th",null,"Operatore"),(0,l.Lk)("th",null,"Agente"),(0,l.Lk)("th",null,"Data e ora"),(0,l.Lk)("th",null,"Stato"),(0,l.Lk)("th",null,"Azioni")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.visibleAppointments,(o=>((0,l.uX)(),(0,l.CE)("tr",{key:o.id},[(0,l.Lk)("td",null,(0,n.v_)(o.id),1),(0,l.Lk)("td",null,(0,n.v_)(o.client_name),1),(0,l.Lk)("td",null,(0,n.v_)(o.telefono),1),(0,l.Lk)("td",null,(0,n.v_)(o.indirizzo),1),(0,l.Lk)("td",null,(0,n.v_)(o.city),1),(0,l.Lk)("td",null,(0,n.v_)(o.provincia),1),(0,l.Lk)("td",null,(0,n.v_)(o.cap),1),(0,l.Lk)("td",null,(0,n.v_)(o.agent_name),1),(0,l.Lk)("td",null,(0,n.v_)(o.operator_name),1),(0,l.Lk)("td",null,(0,n.v_)(r.formatDateTime(o.date_start)),1),(0,l.Lk)("td",null,(0,n.v_)(o.status_name),1),(0,l.Lk)("td",null,[s.selectedAppointment?.id!==o.id?((0,l.uX)(),(0,l.CE)("button",{key:0,onClick:e=>r.selectAppointment(o)}," Seleziona ",8,Kl)):(0,l.Q3)("",!0),s.selectedAppointment?.id===o.id&&e.temporaryContractId?((0,l.uX)(),(0,l.CE)("button",{key:1,onClick:t[2]||(t[2]=(...e)=>r.cancelContract&&r.cancelContract(...e)),class:"cancel-contract-button"}," Annulla Contratto ")):(0,l.Q3)("",!0)])])))),128)),0===r.visibleAppointments.length?((0,l.uX)(),(0,l.CE)("tr",Yl,t[41]||(t[41]=[(0,l.Lk)("td",{colspan:"12"},"Nessun appuntamento trovato.",-1)]))):(0,l.Q3)("",!0)])])]),s.isVendorModalOpen?((0,l.uX)(),(0,l.CE)("div",Jl,[(0,l.Lk)("div",Ql,[t[45]||(t[45]=(0,l.Lk)("h3",null,"Seleziona il vendor per questo contratto",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>s.vendorPreselected=e),required:""},[t[44]||(t[44]=(0,l.Lk)("option",{disabled:"",value:""},"Scegli un vendor",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.vendors,(e=>((0,l.uX)(),(0,l.CE)("option",{value:e.id,key:e.id},(0,n.v_)(e.name),9,Gl)))),128))],512),[[a.u1,s.vendorPreselected]]),(0,l.Lk)("div",Hl,[(0,l.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>r.confirmVendorSelection&&r.confirmVendorSelection(...e)),disabled:!s.vendorPreselected}," Procedi ",8,Zl),(0,l.Lk)("button",{onClick:t[5]||(t[5]=(...t)=>e.cancelVendorSelection&&e.cancelVendorSelection(...t))},"Annulla")])])])):(0,l.Q3)("",!0),s.selectedAppointment?((0,l.uX)(),(0,l.CE)("section",en,[t[65]||(t[65]=(0,l.Lk)("h3",null,"Step #2 - Completa anagrafica cliente",-1)),(0,l.Lk)("form",{onSubmit:t[7]||(t[7]=(0,a.D$)((()=>{}),["prevent"])),class:"file-upload-form"},[(0,l.Lk)("label",tn,[(0,l.Lk)("input",{type:"button",onClick:t[6]||(t[6]=(...e)=>r.openEditModal&&r.openEditModal(...e)),hidden:""}),t[46]||(t[46]=(0,l.Lk)("i",{class:"fas fa-list-ul"},null,-1)),t[47]||(t[47]=(0,l.eW)(" Verifica Anagrafica "))])],32),r.isAnagraficaCompleta?((0,l.uX)(),(0,l.CE)("p",on," L'anagrafica è completa! Verifica se apportare modifiche o procedi al prossimo passo. ")):((0,l.uX)(),(0,l.CE)("p",an," Controlla o completa l'anagrafica per procedere al passaggio successivo. ")),s.isEditModalOpen&&s.editableClient?((0,l.uX)(),(0,l.CE)("div",ln,[(0,l.Lk)("div",nn,[(0,l.Lk)("h2",null,"Modifica Cliente #"+(0,n.v_)(s.editableClient.id),1),(0,l.Lk)("form",{onSubmit:t[24]||(t[24]=(0,a.D$)(((...e)=>r.updateClient&&r.updateClient(...e)),["prevent"]))},[(0,l.Lk)("div",sn,[(0,l.Lk)("div",rn,[(0,l.Lk)("label",null,[t[48]||(t[48]=(0,l.eW)(" Ragione Sociale: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[8]||(t[8]=e=>s.editableClient.ragsoc=e),required:""},null,512),[[a.Jo,s.editableClient.ragsoc]])]),(0,l.Lk)("label",null,[t[50]||(t[50]=(0,l.eW)(" Forma Giuridica: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[9]||(t[9]=e=>s.editableClient.forma_giuridica_id=e),required:""},[t[49]||(t[49]=(0,l.Lk)("option",{disabled:"",value:""}," Seleziona una forma giuridica ",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.legalForms,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.name),9,dn)))),128))],512),[[a.u1,s.editableClient.forma_giuridica_id]])]),(0,l.Lk)("label",null,[t[51]||(t[51]=(0,l.eW)(" Partita IVA: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[10]||(t[10]=e=>s.editableClient.partita_iva=e),required:""},null,512),[[a.Jo,s.editableClient.partita_iva]])]),(0,l.Lk)("label",null,[t[52]||(t[52]=(0,l.eW)(" Codice Fiscale: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[11]||(t[11]=e=>s.editableClient.codice_fiscale=e),required:""},null,512),[[a.Jo,s.editableClient.codice_fiscale]])]),(0,l.Lk)("label",null,[t[53]||(t[53]=(0,l.eW)(" Telefono: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[12]||(t[12]=e=>s.editableClient.telefono=e)},null,512),[[a.Jo,s.editableClient.telefono]])]),(0,l.Lk)("label",null,[t[54]||(t[54]=(0,l.eW)(" Email: ")),(0,l.bo)((0,l.Lk)("input",{type:"email","onUpdate:modelValue":t[13]||(t[13]=e=>s.editableClient.email=e)},null,512),[[a.Jo,s.editableClient.email]])])]),(0,l.Lk)("div",cn,[(0,l.Lk)("label",null,[t[55]||(t[55]=(0,l.eW)(" Indirizzo: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[14]||(t[14]=e=>s.editableClient.indirizzo=e)},null,512),[[a.Jo,s.editableClient.indirizzo]])]),(0,l.Lk)("label",null,[t[56]||(t[56]=(0,l.eW)(" Città: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[15]||(t[15]=e=>s.editableClient.city=e)},null,512),[[a.Jo,s.editableClient.city]])]),(0,l.Lk)("label",null,[t[57]||(t[57]=(0,l.eW)(" Provincia: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[16]||(t[16]=e=>s.editableClient.provincia=e)},null,512),[[a.Jo,s.editableClient.provincia]])]),(0,l.Lk)("label",null,[t[58]||(t[58]=(0,l.eW)(" CAP: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[17]||(t[17]=e=>s.editableClient.cap=e)},null,512),[[a.Jo,s.editableClient.cap]])])]),(0,l.Lk)("div",un,[(0,l.Lk)("label",null,[t[59]||(t[59]=(0,l.eW)(" Nome Referente: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[18]||(t[18]=e=>s.editableClient.ref_nome=e)},null,512),[[a.Jo,s.editableClient.ref_nome]])]),(0,l.Lk)("label",null,[t[60]||(t[60]=(0,l.eW)(" Cognome Referente: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[19]||(t[19]=e=>s.editableClient.ref_cognome=e)},null,512),[[a.Jo,s.editableClient.ref_cognome]])]),(0,l.Lk)("label",null,[t[61]||(t[61]=(0,l.eW)(" Ruolo Referente: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[20]||(t[20]=e=>s.editableClient.ref_ruolo=e)},null,512),[[a.Jo,s.editableClient.ref_ruolo]])]),(0,l.Lk)("label",null,[t[62]||(t[62]=(0,l.eW)(" E-Mail Referente: ")),(0,l.bo)((0,l.Lk)("input",{type:"email","onUpdate:modelValue":t[21]||(t[21]=e=>s.editableClient.ref_email=e)},null,512),[[a.Jo,s.editableClient.ref_email]])]),(0,l.Lk)("label",null,[t[63]||(t[63]=(0,l.eW)(" Telefono Referente: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[22]||(t[22]=e=>s.editableClient.ref_telefono=e)},null,512),[[a.Jo,s.editableClient.ref_telefono]])])])]),(0,l.Lk)("div",pn,[t[64]||(t[64]=(0,l.Lk)("button",{type:"submit"},"Salva Modifiche",-1)),(0,l.Lk)("button",{type:"button",onClick:t[23]||(t[23]=(...e)=>r.closeEditModal&&r.closeEditModal(...e))},"Annulla")])],32)])])):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0),s.selectedAppointment?((0,l.uX)(),(0,l.CE)("section",hn,[t[75]||(t[75]=(0,l.Lk)("h3",null,"Step #3 - Inserisci prodotti venduti",-1)),(0,l.Lk)("div",null,[(0,l.Lk)("form",{onSubmit:t[26]||(t[26]=(0,a.D$)((()=>{}),["prevent"])),class:"file-upload-form"},[(0,l.Lk)("label",mn,[(0,l.Lk)("input",{type:"button",onClick:t[25]||(t[25]=(...e)=>r.openProductModal&&r.openProductModal(...e)),hidden:""}),t[66]||(t[66]=(0,l.Lk)("i",{class:"fas fa-box-open"},null,-1)),t[67]||(t[67]=(0,l.eW)(" Aggiungi Prodotti "))])],32),s.isProductModalOpen?((0,l.uX)(),(0,l.CE)("div",gn,[(0,l.Lk)("div",kn,[t[72]||(t[72]=(0,l.Lk)("h2",null,"Inserisci Prodotti per il Contratto",-1)),t[73]||(t[73]=(0,l.Lk)("p",null," Seleziona un Vendor, scegli i prodotti associati ed inserisci la quantità. ",-1)),(0,l.Lk)("form",{onSubmit:t[30]||(t[30]=(0,a.D$)(((...e)=>r.addProductToContract&&r.addProductToContract(...e)),["prevent"]))},[(0,l.Lk)("label",null,[t[68]||(t[68]=(0,l.eW)(" Vendor: ")),(0,l.Lk)("input",{type:"text",value:s.vendors.find((e=>e.id===s.selectedVendor))?.name||"Vendor selezionato",disabled:"",class:"input-readonly"},null,8,fn)]),(0,l.Lk)("label",null,[t[70]||(t[70]=(0,l.eW)(" Prodotto: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[27]||(t[27]=e=>s.selectedProduct=e)},[t[69]||(t[69]=(0,l.Lk)("option",{disabled:"",value:""},"Seleziona un prodotto",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.products,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.name),9,Ln)))),128))],512),[[a.u1,s.selectedProduct]])]),(0,l.Lk)("label",null,[t[71]||(t[71]=(0,l.eW)(" Quantità: ")),(0,l.bo)((0,l.Lk)("input",{type:"number","onUpdate:modelValue":t[28]||(t[28]=e=>s.quantity=e),min:"1",required:""},null,512),[[a.Jo,s.quantity,void 0,{number:!0}]])]),(0,l.Lk)("div",vn,[(0,l.Lk)("button",{type:"submit",disabled:!s.selectedProduct||s.quantity<1}," Aggiungi ",8,bn),(0,l.Lk)("button",{type:"button",onClick:t[29]||(t[29]=(...e)=>r.closeProductModal&&r.closeProductModal(...e))}," Annulla ")])],32)])])):(0,l.Q3)("",!0)]),s.contractProducts.length||s.stagedProducts.length?((0,l.uX)(),(0,l.CE)("table",yn,[t[74]||(t[74]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Vendor"),(0,l.Lk)("th",null,"Codice"),(0,l.Lk)("th",null,"Prodotto"),(0,l.Lk)("th",null,"Descrizione"),(0,l.Lk)("th",null,"Quantità"),(0,l.Lk)("th",null,"Azioni")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.contractProducts,(t=>((0,l.uX)(),(0,l.CE)("tr",{key:`saved-${t.product_id}`},[(0,l.Lk)("td",null,(0,n.v_)(t.vendor_name),1),(0,l.Lk)("td",null,(0,n.v_)(t.code||"N/A"),1),(0,l.Lk)("td",null,(0,n.v_)(t.product_name),1),(0,l.Lk)("td",null,(0,n.v_)(t.description||"Nessuna descrizione"),1),(0,l.Lk)("td",null,(0,n.v_)(t.quantity),1),(0,l.Lk)("td",null,[(0,l.Lk)("button",{onClick:o=>e.removeSavedProduct(t.product_id),class:"cancel-contract-button"}," Rimuovi ",8,_n)])])))),128)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.stagedProducts,((e,t)=>((0,l.uX)(),(0,l.CE)("tr",{key:`staged-${t}`,class:"staged"},[(0,l.Lk)("td",null,(0,n.v_)(e.vendor_name),1),(0,l.Lk)("td",null,(0,n.v_)(e.code||"N/A"),1),(0,l.Lk)("td",null,(0,n.v_)(e.product_name),1),(0,l.Lk)("td",null,(0,n.v_)(e.description||"Nessuna descrizione"),1),(0,l.Lk)("td",null,(0,n.v_)(e.quantity),1),(0,l.Lk)("td",null,[(0,l.Lk)("button",{onClick:e=>r.removeStagedProduct(t),class:"cancel-contract-button"}," Rimuovi ",8,Cn)])])))),128))])])):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0),s.selectedAppointment?((0,l.uX)(),(0,l.CE)("section",wn,[t[82]||(t[82]=(0,l.Lk)("h3",null,"Step #4 - Carica la documentazione",-1)),(0,l.Lk)("form",{onSubmit:t[33]||(t[33]=(0,a.D$)((()=>{}),["prevent"])),class:"file-upload-form"},[(0,l.Lk)("label",An,[(0,l.Lk)("input",{type:"file",multiple:"",onChange:t[31]||(t[31]=(...e)=>r.handleFileSelection&&r.handleFileSelection(...e)),hidden:""},null,32),t[76]||(t[76]=(0,l.Lk)("i",{class:"fas fa-upload"},null,-1)),t[77]||(t[77]=(0,l.eW)(" Seleziona File "))]),(0,l.Lk)("label",En,[(0,l.Lk)("input",{type:"button",onClick:t[32]||(t[32]=(...e)=>r.resetFileSelection&&r.resetFileSelection(...e)),hidden:""}),t[78]||(t[78]=(0,l.Lk)("i",{class:"fas fa-eraser"},null,-1)),t[79]||(t[79]=(0,l.eW)(" Reset "))])],32),s.selectedFiles.length?((0,l.uX)(),(0,l.CE)("table",Pn,[t[81]||(t[81]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Nome File"),(0,l.Lk)("th",null,"Dimensione"),(0,l.Lk)("th",null,"Tipo Documento"),(0,l.Lk)("th",null,"Azioni")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.selectedFiles,((e,o)=>((0,l.uX)(),(0,l.CE)("tr",{key:o},[(0,l.Lk)("td",null,(0,n.v_)(e.name),1),(0,l.Lk)("td",null,(0,n.v_)(r.formatFileSize(e.size)),1),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t=>e.documentType=t,class:"document-type-select",required:""},[t[80]||(t[80]=(0,l.Lk)("option",{disabled:"",value:""},"Seleziona Tipo",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.documentTemplates,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.description),9,Sn)))),128))],8,Dn),[[a.u1,e.documentType]])]),(0,l.Lk)("td",null,[(0,l.Lk)("button",{onClick:e=>r.removeFile(o),class:"cancel-contract-button"}," Rimuovi ",8,xn)])])))),128))])])):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0),s.selectedAppointment?((0,l.uX)(),(0,l.CE)("section",Fn,[t[95]||(t[95]=(0,l.Lk)("h2",null,"Azioni finali",-1)),t[96]||(t[96]=(0,l.Lk)("p",null,' Completa le informazioni mancanti del cliente, apri il riepilogo cliccando su "Conferma Contratto" o annulla l\'operazione e torna alla lista degli appuntamenti in stato "Positivo". ',-1)),(0,l.Lk)("form",{onSubmit:t[36]||(t[36]=(0,a.D$)((()=>{}),["prevent"])),class:"file-upload-form"},[(0,l.Lk)("label",{class:(0,n.C4)(["file-input-label",{"disabled-button":!s.confirmButtonEnabled}])},[(0,l.Lk)("input",{type:"button",onClick:t[34]||(t[34]=(...e)=>r.openConfirmModal&&r.openConfirmModal(...e)),hidden:"",disabled:!s.confirmButtonEnabled},null,8,Mn),t[83]||(t[83]=(0,l.Lk)("i",{class:"fas fa-check-circle"},null,-1)),t[84]||(t[84]=(0,l.eW)(" Conferma Contratto "))],2),(0,l.Lk)("label",Vn,[(0,l.Lk)("input",{type:"button",onClick:t[35]||(t[35]=(...e)=>r.cancelContract&&r.cancelContract(...e)),hidden:""}),t[85]||(t[85]=(0,l.Lk)("i",{class:"fas fa-ban"},null,-1)),t[86]||(t[86]=(0,l.eW)(" Annulla "))])],32),s.isConfirmModalOpen?((0,l.uX)(),(0,l.CE)("div",Un,[(0,l.Lk)("div",In,[t[94]||(t[94]=(0,l.Lk)("div",{class:"modal-header"},[(0,l.Lk)("h2",null,"Riepilogo Contratto"),(0,l.Lk)("p",{class:"modal-subtitle"}," Controlla tutti i dettagli prima di confermare. ")],-1)),(0,l.Lk)("table",On,[t[87]||(t[87]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Cliente"),(0,l.Lk)("th",null,"Agente")])],-1)),(0,l.Lk)("tbody",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("td",null,(0,n.v_)(s.selectedAppointment.client_name),1),(0,l.Lk)("td",null,(0,n.v_)(s.selectedAppointment.agent_name),1)])])]),(0,l.Lk)("section",Xn,[t[89]||(t[89]=(0,l.Lk)("h3",{class:"modal-section-title"},"Prodotti Selezionati",-1)),(0,l.Lk)("table",Tn,[t[88]||(t[88]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Prodotto"),(0,l.Lk)("th",null,"Quantità")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.contractProducts,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:`saved-${e.product_id}`},[(0,l.Lk)("td",null,(0,n.v_)(e.product_name),1),(0,l.Lk)("td",null,(0,n.v_)(e.quantity),1)])))),128)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.stagedProducts,((e,t)=>((0,l.uX)(),(0,l.CE)("tr",{key:`staged-${t}`},[(0,l.Lk)("td",null,(0,n.v_)(e.product_name),1),(0,l.Lk)("td",null,(0,n.v_)(e.quantity),1)])))),128))])])]),(0,l.Lk)("section",$n,[t[91]||(t[91]=(0,l.Lk)("h3",{class:"modal-section-title"},"Documenti Allegati",-1)),(0,l.Lk)("table",zn,[t[90]||(t[90]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Nome File"),(0,l.Lk)("th",null,"Tipo")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.selectedFiles,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.name},[(0,l.Lk)("td",null,(0,n.v_)(e.name),1),(0,l.Lk)("td",null,(0,n.v_)(r.getDocumentTypeName(e.documentType)),1)])))),128))])])]),(0,l.Lk)("section",Rn,[t[92]||(t[92]=(0,l.Lk)("h3",{class:"modal-section-title"},"Note Contratto",-1)),(0,l.bo)((0,l.Lk)("textarea",{"onUpdate:modelValue":t[37]||(t[37]=e=>s.contractNotes=e),placeholder:"Inserisci eventuali note sul contratto...",class:"contract-notes-input"},null,512),[[a.Jo,s.contractNotes]]),t[93]||(t[93]=(0,l.Lk)("h3",{class:"modal-section-title"},"Data firma",-1)),(0,l.bF)(d,{modelValue:s.contractSignatureDate,"onUpdate:modelValue":t[38]||(t[38]=e=>s.contractSignatureDate=e),config:i.configDate,class:"custom-datepicker",placeholder:"Inserisci la data di firma del contratto",required:""},null,8,["modelValue","config"]),s.contractSignatureDate?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("p",Wn," Questo campo è obbligatorio! "))]),(0,l.Lk)("div",Nn,[(0,l.Lk)("button",{onClick:t[39]||(t[39]=(...e)=>r.closeConfirmModal&&r.closeConfirmModal(...e)),class:"input-button-blu"}," Torna a modificare "),(0,l.Lk)("button",{onClick:t[40]||(t[40]=(...e)=>r.confirmContract&&r.confirmContract(...e)),class:(0,n.C4)(["input-button",{"disabled-button":!r.canConfirmContract}]),disabled:!r.canConfirmContract}," Conferma Contratto ",10,jn)])])])):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0)])}o(1148);var qn={components:{FlatPickr:vt.A},setup(){const e=(0,Ce.KR)({dateFormat:"d/m/Y",altInput:!0,altFormat:"d/m/Y",locale:bt.Italian});return{configDate:e}},data(){return{appointments:[],filteredAppointments:[],search:"",selectedAppointment:null,legalForms:[],isEditModalOpen:!1,editableClient:null,isConfirmModalOpen:!1,confirmButtonEnabled:!1,vendors:[],products:[],selectedVendor:"",selectedProduct:"",quantity:1,isProductModalOpen:!1,contractProducts:[],stagedProducts:[],isVendorModalOpen:!1,vendorPreselected:null,isVendorSelectionOpen:!1,uploadedFiles:[],vendorLocked:!1,selectedFiles:[],documentTemplates:[],contractNotes:"",contractSignatureDate:""}},computed:{visibleAppointments(){return this.selectedAppointment?[this.selectedAppointment]:this.filteredAppointments},isAnagraficaCompleta(){if(!this.editableClient)return!1;const e=[this.editableClient.ragsoc,this.editableClient.forma_giuridica_id,this.editableClient.partita_iva,this.editableClient.codice_fiscale,this.editableClient.indirizzo,this.editableClient.city,this.editableClient.provincia,this.editableClient.cap,this.editableClient.ref_nome,this.editableClient.ref_cognome,this.editableClient.ref_ruolo,this.editableClient.ref_email,this.editableClient.ref_telefono];return e.every((e=>"string"===typeof e?""!==e.trim():null!=e))},canConfirmContract(){return!!this.contractSignatureDate&&(this.contractProducts.length>0||this.stagedProducts.length>0)&&this.selectedFiles.length>0&&this.selectedFiles.every((e=>e.documentType))}},watch:{editableClient:{handler(){this.updateConfirmButtonState()},deep:!0},contractProducts:{handler(){this.updateConfirmButtonState()},deep:!0},stagedProducts:{handler(){this.updateConfirmButtonState()},deep:!0},selectedFiles:{handler(){this.updateConfirmButtonState()},deep:!0},contractSignatureDate(e){this.contractSignatureDate=e?e.trim():"",this.updateConfirmModalButtonState()}},methods:{async fetchAppointments(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/appointments/positive");this.appointments=e.data,this.filteredAppointments=e.data}catch(e){console.error("[DEBUG] Errore nel recupero degli appuntamenti:",e),this.$toast.show("Errore nel caricamento degli appuntamenti.",{position:"bottom-right",duration:5e3,type:"error"})}},async selectAppointment(e){if(this.selectedAppointment=e,!e.contract_id)return this.isVendorModalOpen=!0,void(this.vendorPreselected=null);this.selectedVendor=e.contract_vendor_id,this.vendorLocked=!0,await this.fetchProductsByVendor()},async fetchLegalForms(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/legal-forms");this.legalForms=e.data}catch(e){console.error("Errore nel recupero delle forme giuridiche:",e)}},async fetchClientDetails(e){if(!e)return console.error("ID cliente non fornito."),void this.$toast.show("Impossibile recuperare i dati del cliente.",{position:"bottom-right",duration:5e3,type:"error"});try{const t=await P.A.get(`https://dev.gixflow.cloud/api/clients/${e}`);this.editableClient={...t.data}}catch(t){console.error("Errore durante il recupero dei dati del cliente:",t),this.$toast.show("Errore durante il recupero dei dati del cliente.",{position:"bottom-right",duration:5e3,type:"error"})}},async fetchDocuments(){try{const e=await P.A.get(`https://dev.gixflow.cloud/api/contracts/${this.selectedAppointment.contract_id}/documents`);this.uploadedFiles=e.data.map((e=>e.file_path))}catch(e){console.error("[DEBUG] Errore durante il recupero dei documenti:",e.response||e),this.$toast.show("Errore durante il recupero dei documenti.",{position:"bottom-right",duration:5e3,type:"error"})}},async uploadFile(){if(!this.file)return void alert("Seleziona un file prima di caricare.");const e=new FormData;e.append("file",this.file),e.append("client_id",this.selectedAppointment.client_id),e.append("contract_id",this.selectedAppointment.contract_id);try{const t=await P.A.post("https://dev.gixflow.cloud/api/contracts/upload",e,{headers:{"Content-Type":"multipart/form-data"}});t.data.fileUrl?(this.uploadedFiles.push(t.data.fileUrl),alert("File caricato con successo!")):(console.error("[DEBUG] Risposta del server senza fileUrl:",t.data),alert("Errore: fileUrl non presente nella risposta."))}catch(t){console.error("[DEBUG] Errore durante il caricamento del file:",t.response||t),alert("Errore durante il caricamento del file.")}},async updateClient(){if(this.editableClient.ragsoc)try{await P.A.put(`https://dev.gixflow.cloud/api/clients/${this.editableClient.id}`,this.editableClient),this.$toast.show("Dati cliente aggiornati con successo.",{position:"bottom-right",duration:5e3,type:"success"}),this.closeEditModal()}catch(e){console.error("Errore durante l'aggiornamento del cliente:",e),this.$toast.show("Errore durante l'aggiornamento del cliente.",{position:"bottom-right",duration:5e3,type:"error"})}},async fetchVendors(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/vendors");this.vendors=e.data}catch(e){console.error("[DEBUG] Errore nel recupero dei vendor:",e),e.response&&(console.error("[DEBUG] Status Code:",e.response.status),console.error("[DEBUG] Response Data:",e.response.data)),alert("Errore nel recupero dei vendor.")}},async fetchProductsByVendor(){if(this.selectedVendor)try{const e=await P.A.get("https://dev.gixflow.cloud/api/products",{params:{vendor_id:this.selectedVendor}});this.products=e.data.map((e=>({id:e.id,name:e.name,description:e.description||"Nessuna descrizione",code:e.code||"N/A"})))}catch(e){console.error("[DEBUG] Errore nel recupero dei prodotti:",e),alert("Errore nel recupero dei prodotti.")}else console.warn("[DEBUG] Nessun vendor selezionato. Interrompo la richiesta.")},async fetchProducts(){if(this.selectedVendor)try{const e=await P.A.get(`https://dev.gixflow.cloud/api/products?vendor_id=${this.selectedVendor}`);this.products=e.data}catch(e){console.error("Errore nel recupero dei prodotti:",e),alert("Errore nel caricamento dei prodotti.")}},async fetchDocumentTemplates(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/document-types");this.documentTemplates=e.data}catch(e){console.error("Errore nel recupero dei tipi di documenti:",e)}},async addProductToContract(){if(!this.selectedProduct||this.quantity<1)return void this.$toast.show("Seleziona un prodotto valido con quantità > 0.",{position:"bottom-right",type:"warning"});const e=this.products.find((e=>e.id===this.selectedProduct));if(!e)return void this.$toast.show("Prodotto non trovato.",{position:"bottom-right",type:"warning"});if(this.selectedAppointment?.contract_id&&this.selectedVendor)try{await P.A.put(`https://dev.gixflow.cloud/api/contracts/${this.selectedAppointment.contract_id}`,{client_id:this.selectedAppointment.client_id,agent_id:this.selectedAppointment.agent_id,status_id:1,notes:this.contractNotes||"",contract_vendor_id:this.selectedVendor}),this.vendorLocked=!0}catch(o){return console.error("Errore durante aggiornamento contract_vendor_id:",o),void this.$toast.show("Errore nel salvataggio del vendor nel contratto.",{position:"bottom-right",type:"error"})}const t={vendor_id:this.selectedVendor,vendor_name:this.vendors.find((e=>e.id===this.selectedVendor))?.name||"Sconosciuto",product_id:e.id,product_name:e.name,description:e.description,code:e.code,quantity:this.quantity,isNew:!0};this.stagedProducts.push(t),this.closeProductModal(),this.$toast.show("Prodotto aggiunto alla lista temporanea.",{position:"bottom-right",type:"default"})},async removeProduct(e){const t=this.selectedAppointment?.contract_id,o=`https://dev.gixflow.cloud/api/contracts/${t}/products/${e}`;try{await P.A.delete(o);this.contractProducts=this.contractProducts.filter((t=>Number(t.product_id)!==Number(e))),this.$toast.show("Prodotto rimosso con successo!",{position:"bottom-right",duration:5e3,type:"default"})}catch(a){console.error("[DEBUG] Errore nella rimozione del prodotto:",a),a.response&&(console.error("[DEBUG] Status Code:",a.response.status),console.error("[DEBUG] Response Data:",a.response.data)),this.$toast.show("Errore nella rimozione del prodotto.",{position:"bottom-right",duration:5e3,type:"error"})}},async createTemporaryContract(e){try{const t=await P.A.post("https://dev.gixflow.cloud/api/contracts",{client_id:e.client_id,appointment_id:e.id,agent_id:e.agent_id,status_id:1,temporary:!0});this.selectedAppointment={...e,contract_id:t.data.contract_id},this.temporaryContractId=t.data.contract_id,this.$toast.show("Creato contratto temporaneo",{position:"bottom-right",duration:5e3,type:"default"})}catch(t){console.error("[DEBUG] Errore durante la creazione del contratto:",t),alert("Errore durante la creazione del contratto.")}},async confirmContract(){if(!this.selectedAppointment?.contract_id)return console.error("[ERRORE] Nessun contratto associato all'appuntamento!"),void this.$toast.show("Errore: Nessun contratto selezionato.",{position:"bottom-right",duration:5e3,type:"error"});const e=this.selectedAppointment.contract_id,t=this.selectedAppointment?.id,o=this.formatDateToISOString(this.contractSignatureDate);if(o)try{if(await P.A.put(`https://dev.gixflow.cloud/api/contracts/${e}/confirm`),await P.A.put(`https://dev.gixflow.cloud/api/contracts/${e}/confirm`,{notes:this.contractNotes,signature_date:o}),this.stagedProducts.length>0){const t=this.stagedProducts.map((t=>P.A.post(`https://dev.gixflow.cloud/api/contracts/${e}/products`,{product_id:t.product_id,quantity:t.quantity})));await Promise.all(t)}if(this.selectedFiles.length>0){const e=new FormData;this.selectedFiles.forEach((t=>{e.append("files",t.file),e.append("document_type_id",t.documentType)})),e.append("client_id",String(this.selectedAppointment.client_id)),e.append("contract_id",String(this.selectedAppointment.contract_id)),await P.A.post("https://dev.gixflow.cloud/api/contracts/upload",e,{headers:{"Content-Type":"multipart/form-data"}})}this.selectedAppointment.temporary=!1,this.temporaryContractId=null,this.isConfirmModalOpen=!1,t?await P.A.put(`https://dev.gixflow.cloud/api/appointments/${t}/status`,{status_id:2}):console.warn("[DEBUG] Nessun appointment_id trovato, stato appuntamento non aggiornato."),await this.fetchAppointments(),this.clearContractState(),this.$router.push("/contracts/new"),this.$toast.show("Contratto confermato con successo!",{position:"bottom-right",duration:5e3,type:"success"})}catch(a){console.error("[DEBUG] Errore nella conferma del contratto:",a),this.$toast.show("Errore nella conferma del contratto.",{position:"bottom-right",duration:5e3,type:"error"})}else this.$toast.show("⚠️ Data firma non valida!",{position:"bottom-right",type:"error"})},async confirmVendorSelection(){this.isVendorModalOpen=!1;try{const e=await P.A.post("https://dev.gixflow.cloud/api/contracts",{client_id:this.selectedAppointment.client_id,appointment_id:this.selectedAppointment.id,agent_id:this.selectedAppointment.agent_id,status_id:1,temporary:!0,contract_vendor_id:this.vendorPreselected});this.selectedAppointment={...this.selectedAppointment,contract_id:e.data.contract_id},this.temporaryContractId=e.data.contract_id,this.selectedVendor=this.vendorPreselected,this.$toast.show("Contratto temporaneo creato!",{position:"bottom-right",type:"success"}),this.$toast.show("Vendor selezionato per questo contratto.",{position:"bottom-right",type:"info"})}catch(e){console.error("[DEBUG] Errore creazione contratto:",e),this.$toast.show("Errore nella creazione del contratto.",{position:"bottom-right",type:"error"})}},async cancelContract(){if(this.temporaryContractId)try{await P.A.delete(`https://dev.gixflow.cloud/api/contracts/${this.temporaryContractId}`),this.clearProducts(),this.selectedFiles=[],this.temporaryContractId=null,this.selectedAppointment=null,await this.fetchAppointments(),this.$toast.show("Contratto temporaneo annullato con successo.",{position:"bottom-right",duration:5e3,type:"default"})}catch(e){console.error("[DEBUG] Errore annullamento contratto:",e),this.$toast.show("Errore nell'annullamento del contratto.",{position:"bottom-right",duration:5e3,type:"error"})}else console.warn("[DEBUG] Nessun contratto temporaneo da annullare.")},filterAppointments(){const e=this.search.toLowerCase();this.filteredAppointments=this.appointments.filter((t=>t.client_name.toLowerCase().includes(e)||t.agent_name.toLowerCase().includes(e)))},async resetAppointments(){this.temporaryContractId&&await this.cancelContract(),this.clearSelectionState()},clearSelectionState(){this.selectedAppointment=null,this.temporaryContractId=null,this.filteredAppointments=this.appointments,this.search="",this.contractProducts=[],this.$forceUpdate()},formatDate(e){const t={year:"numeric",month:"long",day:"numeric"};return new Date(e).toLocaleDateString("it-IT",t)},formatDateTime(e){if(!e)return"N/A";const t=new Date(e),o=t.toLocaleDateString("it-IT"),a=t.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit",hour12:!1});return`${o} ${a}`},formatDateToISOString(e){if(!e)return null;if("[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e))return e.toISOString();const t=e.split("/");if(3!==t.length)return console.warn("⚠️ Data in formato non valido:",e),null;const[o,a,l]=t,n=new Date(`${l}-${a}-${o}T00:00:00Z`);return isNaN(n)?(console.warn("⚠️ Errore nel parsing ISO:",n),null):n.toISOString()},openEditModal(){this.selectedAppointment&&this.selectedAppointment.client_id?(this.fetchClientDetails(this.selectedAppointment.client_id),this.isEditModalOpen=!0):(alert("Errore: Nessun cliente selezionato."),this.$toast.show("Nessun cliente selezionato.",{position:"bottom-right",duration:5e3,type:"error"}))},closeEditModal(){this.isEditModalOpen=!1,this.isAnagraficaCompleta?this.$toast.show("Anagrafica completa. Puoi procedere allo step successivo.",{position:"bottom-right",duration:5e3,type:"default"}):this.$toast.show("Anagrafica incompleta.",{position:"bottom-right",duration:5e3,type:"error"})},async openProductModal(){this.isProductModalOpen=!0,this.selectedVendor&&!this.products.length&&await this.fetchProductsByVendor()},onVendorSelected(){!this.vendorLocked&&this.selectedVendor&&this.fetchProductsByVendor()},closeProductModal(){this.isProductModalOpen=!1,this.resetProductForm()},resetProductForm(){this.selectedProduct="",this.products=[],this.quantity=1},removeStagedProduct(e){this.stagedProducts.splice(e,1),this.$toast.show("Prodotto rimosso dalla lista temporanea.",{position:"bottom-right",duration:5e3,type:"default"})},clearProducts(){this.stagedProducts=[],this.contractProducts=[]},handleFileSelection(e){const t=Array.from(e.target.files).map((e=>({file:e,name:e.name,size:e.size,documentType:""})));this.selectedFiles=[...this.selectedFiles,...t]},removeFile(e){this.selectedFiles.splice(e,1)},resetFileSelection(){this.selectedFiles=[]},formatFileSize(e){return e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1048576).toFixed(1)} MB`},openConfirmModal(){this.isConfirmModalOpen=!0},closeConfirmModal(){this.isConfirmModalOpen=!1},updateConfirmButtonState(){this.confirmButtonEnabled=this.isAnagraficaCompleta&&(this.contractProducts.length>0||this.stagedProducts.length>0)&&this.selectedFiles.length>0&&this.selectedFiles.every((e=>e.documentType))},updateConfirmModalButtonState(){this.$nextTick((()=>{this.confirmButtonEnabled=!!this.contractSignatureDate.trim()&&(this.contractProducts.length>0||this.stagedProducts.length>0)&&this.selectedFiles.length>0&&this.selectedFiles.every((e=>e.documentType))}))},clearContractState(){this.selectedAppointment=null,this.temporaryContractId=null,this.stagedProducts=[],this.contractProducts=[],this.selectedFiles=[],this.isConfirmModalOpen=!1},getDocumentTypeName(e){const t=this.documentTemplates.find((t=>t.id===e));return t?t.description:"Sconosciuto"},handleSignatureDateChange(e){this.contractSignatureDate=e.target.value||""}},mounted(){this.fetchAppointments(),this.fetchLegalForms(),this.fetchVendors(),this.fetchDocumentTemplates(),window.addEventListener("beforeunload",this.cancelContract),this.$router.beforeEach(((e,t,o)=>{this.cancelContract(),o()}))},beforeUnmount(){window.removeEventListener("beforeunload",this.cancelContract)}};const Kn=(0,x.A)(qn,[["render",Bn]]);var Yn=Kn;const Jn={class:"client-info"},Qn={class:"input-row"},Gn=["value"],Hn={class:"input-row"},Zn={class:"input-row"},ei={class:"input-row"},ti={key:0,class:"modal-overlay"},oi={class:"modal-content"},ai={class:"form-grid"},li={class:"form-column"},ni={class:"form-column"},ii={class:"form-column"},si={class:"modal-buttons"},ri={key:1,class:"modal-overlay"},di={class:"modal-content"},ci={class:"form-grid"},ui={class:"form-column"},pi={class:"form-column"},hi={class:"form-column"},mi={class:"modal-buttons"},gi={class:"table"},ki=["onUpdate:modelValue"],fi=["onClick"],Li={key:0,class:"modal-overlay"},vi={class:"modal-content"},bi=["value"],yi=["disabled"],_i=["value"],Ci={class:"modal-buttons"},wi=["disabled"],Ai={class:"table"},Ei=["onClick"],Pi=["onClick"],Di={class:"modal-content pdf-modal"},Si=["src"],xi=["disabled"],Fi={key:1,class:"table"},Mi=["onUpdate:modelValue"],Vi=["value"],Ui=["onClick"],Ii={class:"status-container"},Oi=["value"],Xi={key:0,class:"completion-container"},Ti=["required"],$i={class:"note-container"},zi={class:"action-buttons"};function Ri(e,t,o,i,s,r){const d=(0,l.g2)("flat-pickr");return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.Lk)("h1",null,"Modifica Contratto #"+(0,n.v_)(s.contract.id),1),(0,l.Lk)("section",Jn,[(0,l.Lk)("div",Qn,[t[52]||(t[52]=(0,l.Lk)("label",null,"Cliente:",-1)),(0,l.Lk)("input",{type:"text",value:r.formattedClientName,disabled:""},null,8,Gn),(0,l.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>r.openClientModal&&r.openClientModal(...e)),class:"info-button"},"Dettagli")]),(0,l.Lk)("div",Hn,[t[53]||(t[53]=(0,l.Lk)("label",null,"Agente:",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>s.contract.agent_name=e),disabled:""},null,512),[[a.Jo,s.contract.agent_name]]),(0,l.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>r.openAgentModal&&r.openAgentModal(...e)),class:"info-button"},"Dettagli")]),(0,l.Lk)("div",Zn,[t[54]||(t[54]=(0,l.Lk)("label",null,"Firmato il:",-1)),(0,l.bF)(d,{modelValue:s.contract.signature_date,"onUpdate:modelValue":t[3]||(t[3]=e=>s.contract.signature_date=e),config:i.configDate,class:"custom-datepicker",disabled:""},null,8,["modelValue","config"])]),(0,l.Lk)("div",ei,[t[55]||(t[55]=(0,l.Lk)("label",null,"Creato il:",-1)),(0,l.bF)(d,{modelValue:s.contract.creation_date,"onUpdate:modelValue":t[4]||(t[4]=e=>s.contract.creation_date=e),config:i.configDate,class:"custom-datepicker",disabled:""},null,8,["modelValue","config"])])]),s.isClientModalOpen?((0,l.uX)(),(0,l.CE)("div",ti,[(0,l.Lk)("div",oi,[t[70]||(t[70]=(0,l.Lk)("h2",null,"Dettagli Cliente",-1)),(0,l.Lk)("div",ai,[(0,l.Lk)("div",li,[(0,l.Lk)("label",null,[t[56]||(t[56]=(0,l.eW)("Ragione Sociale: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=e=>s.clientData.ragsoc=e),disabled:""},null,512),[[a.Jo,s.clientData.ragsoc]])]),(0,l.Lk)("label",null,[t[57]||(t[57]=(0,l.eW)("Partita IVA: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[6]||(t[6]=e=>s.clientData.partita_iva=e),disabled:""},null,512),[[a.Jo,s.clientData.partita_iva]])]),(0,l.Lk)("label",null,[t[58]||(t[58]=(0,l.eW)("Codice Fiscale: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[7]||(t[7]=e=>s.clientData.codice_fiscale=e),disabled:""},null,512),[[a.Jo,s.clientData.codice_fiscale]])]),(0,l.Lk)("label",null,[t[59]||(t[59]=(0,l.eW)("Telefono: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[8]||(t[8]=e=>s.clientData.telefono=e),disabled:""},null,512),[[a.Jo,s.clientData.telefono]])]),(0,l.Lk)("label",null,[t[60]||(t[60]=(0,l.eW)("Email: ")),(0,l.bo)((0,l.Lk)("input",{type:"email","onUpdate:modelValue":t[9]||(t[9]=e=>s.clientData.email=e),disabled:""},null,512),[[a.Jo,s.clientData.email]])])]),(0,l.Lk)("div",ni,[(0,l.Lk)("label",null,[t[61]||(t[61]=(0,l.eW)("Indirizzo: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[10]||(t[10]=e=>s.clientData.indirizzo=e),disabled:""},null,512),[[a.Jo,s.clientData.indirizzo]])]),(0,l.Lk)("label",null,[t[62]||(t[62]=(0,l.eW)("Città: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[11]||(t[11]=e=>s.clientData.city=e),disabled:""},null,512),[[a.Jo,s.clientData.city]])]),(0,l.Lk)("label",null,[t[63]||(t[63]=(0,l.eW)("Provincia: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[12]||(t[12]=e=>s.clientData.provincia=e),disabled:""},null,512),[[a.Jo,s.clientData.provincia]])]),(0,l.Lk)("label",null,[t[64]||(t[64]=(0,l.eW)("CAP: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[13]||(t[13]=e=>s.clientData.cap=e),disabled:""},null,512),[[a.Jo,s.clientData.cap]])])]),(0,l.Lk)("div",ii,[(0,l.Lk)("label",null,[t[65]||(t[65]=(0,l.eW)("Nome Referente: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[14]||(t[14]=e=>s.clientData.ref_nome=e),disabled:""},null,512),[[a.Jo,s.clientData.ref_nome]])]),(0,l.Lk)("label",null,[t[66]||(t[66]=(0,l.eW)("Cognome Referente: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[15]||(t[15]=e=>s.clientData.ref_cognome=e),disabled:""},null,512),[[a.Jo,s.clientData.ref_cognome]])]),(0,l.Lk)("label",null,[t[67]||(t[67]=(0,l.eW)("Ruolo Referente: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[16]||(t[16]=e=>s.clientData.ref_ruolo=e),disabled:""},null,512),[[a.Jo,s.clientData.ref_ruolo]])]),(0,l.Lk)("label",null,[t[68]||(t[68]=(0,l.eW)("Email Referente: ")),(0,l.bo)((0,l.Lk)("input",{type:"email","onUpdate:modelValue":t[17]||(t[17]=e=>s.clientData.ref_email=e),disabled:""},null,512),[[a.Jo,s.clientData.ref_email]])]),(0,l.Lk)("label",null,[t[69]||(t[69]=(0,l.eW)("Telefono Referente: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[18]||(t[18]=e=>s.clientData.ref_telefono=e),disabled:""},null,512),[[a.Jo,s.clientData.ref_telefono]])])])]),(0,l.Lk)("div",si,[(0,l.Lk)("button",{onClick:t[19]||(t[19]=(...e)=>r.closeClientModal&&r.closeClientModal(...e))},"Chiudi")])])])):(0,l.Q3)("",!0),s.isAgentModalOpen?((0,l.uX)(),(0,l.CE)("div",ri,[(0,l.Lk)("div",di,[t[81]||(t[81]=(0,l.Lk)("h2",null,"Dettagli Agente",-1)),(0,l.Lk)("div",ci,[(0,l.Lk)("div",ui,[(0,l.Lk)("label",null,[t[71]||(t[71]=(0,l.eW)("Nome: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[20]||(t[20]=e=>s.agentData.nome=e),disabled:""},null,512),[[a.Jo,s.agentData.nome]])]),(0,l.Lk)("label",null,[t[72]||(t[72]=(0,l.eW)("Cognome: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[21]||(t[21]=e=>s.agentData.cognome=e),disabled:""},null,512),[[a.Jo,s.agentData.cognome]])]),(0,l.Lk)("label",null,[t[73]||(t[73]=(0,l.eW)("Email: ")),(0,l.bo)((0,l.Lk)("input",{type:"email","onUpdate:modelValue":t[22]||(t[22]=e=>s.agentData.email=e),disabled:""},null,512),[[a.Jo,s.agentData.email]])]),(0,l.Lk)("label",null,[t[74]||(t[74]=(0,l.eW)("Telefono: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[23]||(t[23]=e=>s.agentData.telefono=e),disabled:""},null,512),[[a.Jo,s.agentData.telefono]])])]),(0,l.Lk)("div",pi,[(0,l.Lk)("label",null,[t[75]||(t[75]=(0,l.eW)("Indirizzo: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[24]||(t[24]=e=>s.agentData.indirizzo=e),disabled:""},null,512),[[a.Jo,s.agentData.indirizzo]])]),(0,l.Lk)("label",null,[t[76]||(t[76]=(0,l.eW)("Città: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[25]||(t[25]=e=>s.agentData.city=e),disabled:""},null,512),[[a.Jo,s.agentData.city]])]),(0,l.Lk)("label",null,[t[77]||(t[77]=(0,l.eW)("Provincia: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[26]||(t[26]=e=>s.agentData.provincia=e),disabled:""},null,512),[[a.Jo,s.agentData.provincia]])]),(0,l.Lk)("label",null,[t[78]||(t[78]=(0,l.eW)("CAP: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[27]||(t[27]=e=>s.agentData.cap=e),disabled:""},null,512),[[a.Jo,s.agentData.cap]])])]),(0,l.Lk)("div",hi,[(0,l.Lk)("label",null,[t[79]||(t[79]=(0,l.eW)("Codice Fiscale: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[28]||(t[28]=e=>s.agentData.codice_fiscale=e),disabled:""},null,512),[[a.Jo,s.agentData.codice_fiscale]])]),(0,l.Lk)("label",null,[t[80]||(t[80]=(0,l.eW)("Partita IVA: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[29]||(t[29]=e=>s.agentData.partita_iva=e),disabled:""},null,512),[[a.Jo,s.agentData.partita_iva]])])])]),(0,l.Lk)("div",mi,[(0,l.Lk)("button",{onClick:t[30]||(t[30]=(...e)=>r.closeAgentModal&&r.closeAgentModal(...e))},"Chiudi")])])])):(0,l.Q3)("",!0),(0,l.Lk)("section",null,[t[91]||(t[91]=(0,l.Lk)("h3",null,"Prodotti",-1)),(0,l.Lk)("form",{onSubmit:t[32]||(t[32]=(0,a.D$)((()=>{}),["prevent"])),class:"file-upload-form"},[(0,l.Lk)("button",{type:"button",class:"file-input-label",onClick:t[31]||(t[31]=(...e)=>r.openProductModal&&r.openProductModal(...e))},t[82]||(t[82]=[(0,l.Lk)("i",{class:"fas fa-box-open"},null,-1),(0,l.eW)(" Aggiungi Prodotti ")]))],32),(0,l.Lk)("table",gi,[t[84]||(t[84]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Vendor"),(0,l.Lk)("th",null,"Codice"),(0,l.Lk)("th",null,"Prodotto"),(0,l.Lk)("th",null,"Descrizione"),(0,l.Lk)("th",null,"Quantità"),(0,l.Lk)("th",null,"Azioni")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.contractProducts,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.product_id},[(0,l.Lk)("td",null,(0,n.v_)(e.vendor_name),1),(0,l.Lk)("td",null,(0,n.v_)(e.product_code),1),(0,l.Lk)("td",null,(0,n.v_)(e.product_name),1),(0,l.Lk)("td",null,(0,n.v_)(e.product_description),1),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("input",{type:"number","onUpdate:modelValue":t=>e.quantity=t,min:"1",class:"quantity-input"},null,8,ki),[[a.Jo,e.quantity]])]),(0,l.Lk)("td",null,[(0,l.Lk)("button",{class:"in-grid-red",onClick:t=>r.removeProduct(e.product_id)},t[83]||(t[83]=[(0,l.Lk)("i",{class:"fas fa-trash"},null,-1)]),8,fi)])])))),128))])]),s.isProductModalOpen?((0,l.uX)(),(0,l.CE)("div",Li,[(0,l.Lk)("div",vi,[t[89]||(t[89]=(0,l.Lk)("h2",null,"Inserisci Prodotti per il Contratto",-1)),t[90]||(t[90]=(0,l.Lk)("p",null," Seleziona un Vendor, scegli i prodotti associati ed inserisci la quantità. ",-1)),(0,l.Lk)("form",{onSubmit:t[36]||(t[36]=(0,a.D$)(((...e)=>r.addProductToContract&&r.addProductToContract(...e)),["prevent"]))},[(0,l.Lk)("label",null,[t[85]||(t[85]=(0,l.eW)(" Vendor: ")),(0,l.Lk)("input",{type:"text",value:r.vendorName,class:"input-readonly",disabled:""},null,8,bi)]),(0,l.Lk)("label",null,[t[87]||(t[87]=(0,l.eW)(" Prodotto: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[33]||(t[33]=e=>s.selectedProduct=e),disabled:!s.products.length},[t[86]||(t[86]=(0,l.Lk)("option",{disabled:"",value:""},"Seleziona un prodotto",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.products,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.name),9,_i)))),128))],8,yi),[[a.u1,s.selectedProduct]])]),(0,l.Lk)("label",null,[t[88]||(t[88]=(0,l.eW)(" Quantità: ")),(0,l.bo)((0,l.Lk)("input",{type:"number","onUpdate:modelValue":t[34]||(t[34]=e=>s.quantity=e),min:"1",required:""},null,512),[[a.Jo,s.quantity,void 0,{number:!0}]])]),(0,l.Lk)("div",Ci,[(0,l.Lk)("button",{type:"submit",disabled:!s.selectedProduct||s.quantity<1}," Aggiungi ",8,wi),(0,l.Lk)("button",{type:"button",onClick:t[35]||(t[35]=(...e)=>r.closeProductModal&&r.closeProductModal(...e))},"Annulla")])],32)])])):(0,l.Q3)("",!0)]),(0,l.Lk)("section",null,[(0,l.Lk)("div",null,[t[100]||(t[100]=(0,l.Lk)("h3",null,"Documenti esistenti",-1)),(0,l.Lk)("table",Ai,[t[94]||(t[94]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Nome File"),(0,l.Lk)("th",null,"Dimensione"),(0,l.Lk)("th",null,"Tipo Documento"),(0,l.Lk)("th",null,"Data Upload"),(0,l.Lk)("th",null,"Azioni")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.contractDocuments,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id},[(0,l.Lk)("td",null,(0,n.v_)(e.file_name),1),(0,l.Lk)("td",null,(0,n.v_)(r.formatFileSize(e.size)),1),(0,l.Lk)("td",null,(0,n.v_)(e.document_description),1),(0,l.Lk)("td",null,(0,n.v_)(r.formatDate(e.upload_date)),1),(0,l.Lk)("td",null,[(0,l.Lk)("button",{class:"in-grid-blue",onClick:t=>r.previewDocument(e)},t[92]||(t[92]=[(0,l.Lk)("i",{class:"fas fa-eye"},null,-1)]),8,Ei),(0,l.Lk)("button",{class:"in-grid-red",onClick:t=>r.deleteDocument(e.id)},t[93]||(t[93]=[(0,l.Lk)("i",{class:"fas fa-trash"},null,-1)]),8,Pi)])])))),128))])]),s.pdfPreviewUrl?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"modal-overlay",onClick:t[38]||(t[38]=(0,a.D$)((e=>s.pdfPreviewUrl=null),["self"]))},[(0,l.Lk)("div",Di,[(0,l.Lk)("button",{class:"close-btn",onClick:t[37]||(t[37]=e=>s.pdfPreviewUrl=null)},"×"),(0,l.Lk)("iframe",{src:s.pdfPreviewUrl,width:"100%",height:"600px",style:{border:"none"}},null,8,Si)])])):(0,l.Q3)("",!0),(0,l.Lk)("form",{onSubmit:t[43]||(t[43]=(0,a.D$)((()=>{}),["prevent"])),class:"file-upload-form"},[(0,l.Lk)("button",{type:"button",class:"file-input-label",onClick:t[39]||(t[39]=(...e)=>r.triggerFileInput&&r.triggerFileInput(...e))},t[95]||(t[95]=[(0,l.Lk)("i",{class:"fas fa-upload"},null,-1),(0,l.eW)(" Aggiungi File ")])),(0,l.Lk)("input",{type:"file",multiple:"",onChange:t[40]||(t[40]=(...e)=>r.handleFileSelection&&r.handleFileSelection(...e)),ref:"fileInput",hidden:"",required:""},null,544),(0,l.Lk)("button",{type:"button",class:"file-reset-label",onClick:t[41]||(t[41]=(...e)=>r.resetFileSelection&&r.resetFileSelection(...e))},t[96]||(t[96]=[(0,l.Lk)("i",{class:"fas fa-trash"},null,-1),(0,l.eW)(" Reset ")])),(0,l.Lk)("button",{type:"button",class:(0,n.C4)(["file-upload-label",{"disabled-button":!r.canUploadFiles}]),onClick:t[42]||(t[42]=(...e)=>r.uploadSelectedFiles&&r.uploadSelectedFiles(...e)),disabled:!r.canUploadFiles},t[97]||(t[97]=[(0,l.Lk)("i",{class:"fas fa-upload"},null,-1),(0,l.eW)(" Carica Documenti ")]),10,xi)],32),s.selectedFiles.length?((0,l.uX)(),(0,l.CE)("table",Fi,[t[99]||(t[99]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Nome File"),(0,l.Lk)("th",null,"Dimensione"),(0,l.Lk)("th",null,"Tipo Documento"),(0,l.Lk)("th",null,"Azioni")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.selectedFiles,((e,o)=>((0,l.uX)(),(0,l.CE)("tr",{key:o},[(0,l.Lk)("td",null,(0,n.v_)(e.name),1),(0,l.Lk)("td",null,(0,n.v_)(r.formatFileSize(e.size)),1),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t=>e.documentType=t,required:""},[t[98]||(t[98]=(0,l.Lk)("option",{disabled:"",value:""},"Seleziona Tipo",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.documentTemplates,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.description),9,Vi)))),128))],8,Mi),[[a.u1,e.documentType]])]),(0,l.Lk)("td",null,[(0,l.Lk)("button",{onClick:e=>r.removeFile(o),class:"cancel-contract-button"}," Rimuovi ",8,Ui)])])))),128))])])):(0,l.Q3)("",!0)])]),(0,l.Lk)("section",null,[t[103]||(t[103]=(0,l.Lk)("h3",null,"Stato Contratto",-1)),(0,l.Lk)("div",Ii,[t[101]||(t[101]=(0,l.Lk)("label",null,"Stato Contratto:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[44]||(t[44]=e=>s.contract.status_id=e)},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.contractStatus,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.name),9,Oi)))),128))],512),[[a.u1,s.contract.status_id]])]),r.isCompleted?((0,l.uX)(),(0,l.CE)("div",Xi,[t[102]||(t[102]=(0,l.Lk)("label",null,"Data Completamento:",-1)),(0,l.bF)(d,{modelValue:s.contract.completion_date,"onUpdate:modelValue":t[45]||(t[45]=e=>s.contract.completion_date=e),config:i.configDate,class:"custom-datepicker",required:""},null,8,["modelValue","config"]),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[46]||(t[46]=e=>s.contract.completion_date=e),required:r.isCompleted,style:{opacity:"0",height:"0",position:"absolute","pointer-events":"none"}},null,8,Ti),[[a.Jo,s.contract.completion_date]])])):(0,l.Q3)("",!0)]),(0,l.Lk)("section",$i,[t[104]||(t[104]=(0,l.Lk)("h3",null,"Note",-1)),(0,l.bo)((0,l.Lk)("textarea",{"onUpdate:modelValue":t[47]||(t[47]=e=>s.contract.notes=e),class:"note-textarea",placeholder:"Aggiungi eventuali note per il contratto..."},null,512),[[a.Jo,s.contract.notes]])]),(0,l.Lk)("section",zi,[(0,l.Lk)("form",{onSubmit:t[51]||(t[51]=(0,a.D$)((()=>{}),["prevent"])),class:"file-upload-form"},[(0,l.Lk)("button",{type:"button",class:"file-input-label",onClick:t[48]||(t[48]=(...e)=>r.saveContract&&r.saveContract(...e))},t[105]||(t[105]=[(0,l.Lk)("i",{class:"fas fa-save"},null,-1),(0,l.eW)(" Salva Contratto ")])),(0,l.Lk)("button",{type:"button",class:"file-reset-label",onClick:t[49]||(t[49]=(...e)=>r.deleteContract&&r.deleteContract(...e))},t[106]||(t[106]=[(0,l.Lk)("i",{class:"fas fa-eraser"},null,-1),(0,l.eW)(" Elimina Contratto ")])),(0,l.Lk)("button",{type:"button",class:"file-upload-label",onClick:t[50]||(t[50]=(...e)=>r.goToContractList&&r.goToContractList(...e))},t[107]||(t[107]=[(0,l.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,l.eW)(" Torna all'elenco contratti ")]))],32)])])}var Wi={components:{FlatPickr:vt.A},setup(){const e=(0,Ce.KR)({dateFormat:"d/m/Y",altInput:!0,altFormat:"d/m/Y",locale:bt.Italian}),t=(0,Ce.KR)({enableTime:!0,dateFormat:"Y-m-d H:i",altInput:!0,altFormat:"d/m/Y H:i",time_24hr:!0,locale:bt.Italian});return{configDate:e,configDateTime:t}},data(){return{contract:{signature_date:null,creation_date:null,completion_date:null},contractProducts:[],contractDocuments:[],contractStatus:[],vendors:[],products:[],selectedProduct:null,quantity:1,isProductModalOpen:!1,clientData:{},agentData:{},isClientModalOpen:!1,isAgentModalOpen:!1,selectedFiles:[],documentTemplates:[],pdfPreviewUrl:null}},computed:{contractId(){return Number(this.$route.params.id)},canUploadFiles(){return this.selectedFiles.length>0&&this.selectedFiles.every((e=>e.documentType))},isCompleted(){const e=[2,3,4,5];return e.includes(this.contract.status_id)},vendorName(){if(0===this.contractProducts.length)return"Vendor non disponibile";const e=this.contractProducts[0]?.vendor_name;return e||"Vendor non disponibile"},formattedClientName(){return this.contract.client_name?this.contract.forma_giuridica_name?`${this.contract.client_name} - ${this.contract.forma_giuridica_name}`:this.contract.client_name:"N/D"}},methods:{async fetchContract(){if(this.contractId)try{const e=await P.A.get(`https://dev.gixflow.cloud/api/contracts/${this.contractId}`);if(!e.data||0===e.data.length)return console.warn("Nessun contratto trovato!"),void(this.contract={});const t=e.data;this.contract={...t,signature_date:t.signature_date?new Date(t.signature_date):null,creation_date:t.creation_date?new Date(t.creation_date):null,completion_date:t.completion_date?new Date(t.completion_date):null},this.selectedVendor=t.vendor_id}catch(e){console.error("[ERRORE] Errore nel caricamento del contratto:",e)}else console.error("[ERRORE] ID contratto non valido:",this.contractId)},async fetchContractDetails(){if(this.contractId)try{const[e,t]=await Promise.all([P.A.get(`https://dev.gixflow.cloud/api/contracts/${this.contractId}/products-with-details`),P.A.get(`https://dev.gixflow.cloud/api/contracts/${this.contractId}/documents`)]);this.contractProducts=e.data,this.contractDocuments=t.data}catch(e){console.error("Errore nel caricamento dei dettagli:",e)}},async fetchContractStatus(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/contract-status");this.contractStatus=e.data}catch(e){console.error("Errore nel caricamento degli stati:",e)}},async fetchVendors(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/vendors");this.vendors=e.data}catch(e){console.error("[DEBUG] Errore nel recupero dei vendor:",e)}},async fetchProductsByVendor(){const e=this.contractProducts[0]?.vendor_name,t=this.vendors.find((t=>t.name===e)),o=t?.id;if(o)try{const e=await P.A.get(`https://dev.gixflow.cloud/api/products?vendor_id=${o}`);this.products=e.data.map((e=>({id:e.id,name:e.name,description:e.description||"Nessuna descrizione",code:e.code||"N/A"}))),this.products.length||console.warn(`[DEBUG] Nessun prodotto trovato per vendor ID ${o}`)}catch(a){console.error("[DEBUG] Errore nel recupero dei prodotti:",a),this.$toast.show("Errore nel caricamento dei prodotti.",{type:"error",position:"bottom-right"})}else console.warn("[DEBUG] Vendor non trovato nel contratto o vendor mancante.")},async removeProduct(e){if(this.contractId)try{await P.A.delete(`https://dev.gixflow.cloud/api/contracts/${this.contractId}/products/${e}`),await this.fetchContractDetails()}catch(t){console.error("[DEBUG] Errore nella rimozione del prodotto:",t)}},async saveContract(){if(!this.contractId)return console.error("[ERRORE] ID contratto non valido:",this.contractId),void this.$toast.show("Errore: ID contratto non valido.",{position:"bottom-right",duration:5e3,type:"error"});if(!this.isCompleted||this.contract.completion_date)try{1===this.contract.status_id&&(this.contract.completion_date=null);const e={...this.contract,signature_date:this.formatDateForBackend(this.contract.signature_date),creation_date:this.formatDateForBackend(this.contract.creation_date),completion_date:this.contract.completion_date?this.formatDateForBackend(this.contract.completion_date):null};if(this.isCompleted&&(!this.contract.signature_date||!e.signature_date))return void this.$toast.show("La data di firma è obbligatoria.",{type:"error",position:"bottom-right"});if(await P.A.put(`https://dev.gixflow.cloud/api/contracts/${this.contractId}`,e),this.contract.appointment_id){let e=null;switch(this.contract.status_id){case 2:e=3;break;case 3:case 4:case 5:e=4;break;default:console.warn("Stato contratto non gestito:",this.contract.status_id)}e&&await P.A.put(`https://dev.gixflow.cloud/api/appointments/${this.contract.appointment_id}/status`,{status_id:e})}this.$toast.show("Contratto aggiornato con successo!",{position:"bottom-right",duration:5e3,type:"success"}),this.$router.push("/contracts")}catch(e){console.error("[ERRORE] Aggiornamento contratto fallito:",e),this.$toast.show("Errore nel salvataggio del contratto.",{position:"bottom-right",duration:5e3,type:"error"})}else this.$toast.show("La data di completamento è obbligatoria.",{type:"error",position:"bottom-right"})},async addProductToContract(){if(!this.selectedProduct||this.quantity<1)return void this.$toast.show("Seleziona un prodotto valido e una quantità maggiore di 0.",{type:"warning",position:"bottom-right"});const e=this.products.find((e=>e.id===this.selectedProduct));if(e)try{await P.A.post(`https://dev.gixflow.cloud/api/contracts/${this.contractId}/products`,{product_id:this.selectedProduct,quantity:this.quantity}),this.$toast.show("Prodotto aggiunto al contratto.",{type:"success",position:"bottom-right"}),await this.fetchContractDetails(),this.closeProductModal()}catch(t){console.error("[DEBUG] Errore nell'aggiunta del prodotto:",t),this.$toast.show("Errore durante l'aggiunta del prodotto.",{type:"error",position:"bottom-right"})}else this.$toast.show("Prodotto non valido o non appartiene al vendor selezionato.",{type:"error",position:"bottom-right"})},async deleteContract(){if(!this.contractId)return console.error("[ERRORE] ID contratto non valido:",this.contractId),void alert("Errore: ID contratto non valido.");const e=confirm("Sei sicuro di voler eliminare questo contratto?");if(e)try{const{appointment_id:e}=this.contract;await P.A.delete(`https://dev.gixflow.cloud/api/contracts/${this.contractId}`),e?await P.A.put(`https://dev.gixflow.cloud/api/appointments/${e}/status`,{status_id:10}):console.warn("[DEBUG] Nessun appointment_id trovato, stato appuntamento non aggiornato."),alert("Contratto eliminato con successo!"),this.$router.push("/contracts")}catch(t){console.error("[ERRORE] Eliminazione contratto fallita:",t),alert("Errore durante l'eliminazione del contratto.")}},async fetchClientDetails(){try{const e=await P.A.get(`https://dev.gixflow.cloud/api/clients/${this.contract.client_id}`);this.clientData=e.data}catch(e){console.error("Errore nel recupero dei dettagli cliente:",e)}},async fetchAgentDetails(){try{const e=await P.A.get(`https://dev.gixflow.cloud/api/users/${this.contract.agent_id}`);this.agentData=e.data}catch(e){console.error("Errore nel recupero dei dettagli agente:",e)}},async fetchContractDocuments(){try{const e=await P.A.get(`https://dev.gixflow.cloud/api/contracts/${this.contractId}/documents`);this.contractDocuments=e.data}catch(e){console.error("Errore nel recupero dei documenti:",e)}},async fetchDocumentTemplates(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/document-types");this.documentTemplates=e.data}catch(e){console.error("Errore nel recupero dei tipi di documenti:",e)}},async uploadSelectedFiles(){if(!this.selectedFiles.length)return;const e=new FormData;this.selectedFiles.forEach(((t,o)=>{e.append("files",t.file),e.append("document_type_id[]",t.documentType)})),e.append("contract_id",this.contractId),e.append("client_id",this.contract.client_id);try{await P.A.post("https://dev.gixflow.cloud/api/contracts/upload",e,{headers:{"Content-Type":"multipart/form-data"}}),this.selectedFiles=[],this.fetchContractDocuments(),alert("Documenti caricati con successo!")}catch(t){console.error("[ERRORE] Caricamento documenti:",t.response?.data||t)}},async previewDocument(e){try{const t=await P.A.get(`https://dev.gixflow.cloud/api/documents/${e.id}/presigned-url`);t.data?.url?this.pdfPreviewUrl=t.data.url:console.warn("⚠️ Nessuna URL ricevuta dal backend")}catch(t){console.error("❌ Errore preview documento:",t)}},async deleteDocument(e){try{await P.A.delete(`https://dev.gixflow.cloud/api/contracts/${this.contractId}/documents/${e}`),this.fetchContractDocuments()}catch(t){console.error("Errore nell'eliminazione del documento:",t)}},triggerFileInput(){this.$refs.fileInput.click()},handleFileSelection(e){const t=Array.from(e.target.files),o=new Set(this.selectedFiles.map((e=>e.name)));t.forEach((e=>{o.has(e.name)||this.selectedFiles.push({file:e,name:e.name,size:e.size||e.file?.size||0,documentType:""})}))},resetFileSelection(){this.selectedFiles=[]},removeFile(e){this.selectedFiles.splice(e,1)},openProductModal(){this.isProductModalOpen=!0,0===this.products.length&&this.fetchProductsByVendor()},closeProductModal(){this.isProductModalOpen=!1,this.selectedVendor=null,this.selectedProduct=null,this.quantity=1},openClientModal(){this.fetchClientDetails(),this.isClientModalOpen=!0},closeClientModal(){this.isClientModalOpen=!1},openAgentModal(){this.fetchAgentDetails(),this.isAgentModalOpen=!0},closeAgentModal(){this.isAgentModalOpen=!1},formatFileSize(e){return`${(e/1024).toFixed(2)} KB`},formatDate(e){return new Date(e).toLocaleDateString("it-IT")},goToContractList(){this.$router.push("/contracts")},formatDateForBackend(e){if(!e)return null;if("[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e)){const t=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${o}-${a}`}const t=e.split("/");if(3!==t.length)return console.warn("⚠️ Data in formato non riconosciuto:",e),null;const[o,a,l]=t;return`${l}-${a.padStart(2,"0")}-${o.padStart(2,"0")}`}},watch:{contractId:{immediate:!0,handler(e){e&&this.fetchContract()}}},mounted(){this.fetchContract(),this.fetchContractDetails(),this.fetchContractStatus(),this.fetchVendors(),this.fetchDocumentTemplates()}};const Ni=(0,x.A)(Wi,[["render",Ri]]);var ji=Ni;const Bi={class:"edit-table-container"},qi={key:0,class:"loading-spinner"},Ki={class:"table-container"},Yi={class:"table"},Ji=["onUpdate:modelValue"],Qi={key:1},Gi={class:"actions"},Hi=["onClick"],Zi=["onClick"],es={class:"add-form"},ts=["onUpdate:modelValue","placeholder"];function os(e,t,o,i,s,r){return(0,l.uX)(),(0,l.CE)("div",Bi,[(0,l.Lk)("h3",null,"Modifica "+(0,n.v_)(s.tableLabel),1),e.isLoading?((0,l.uX)(),(0,l.CE)("div",qi,"Caricamento...")):(0,l.Q3)("",!0),(0,l.Lk)("div",Ki,[(0,l.Lk)("table",Yi,[(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.columns,(e=>((0,l.uX)(),(0,l.CE)("th",{key:e},(0,n.v_)(e),1)))),128)),t[1]||(t[1]=(0,l.Lk)("th",null,"Azioni",-1))])]),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.tableData,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.columns,(t=>((0,l.uX)(),(0,l.CE)("td",{key:t},[e.isEditing?(0,l.bo)(((0,l.uX)(),(0,l.CE)("input",{key:0,"onUpdate:modelValue":o=>e[t]=o,class:"editable-input"},null,8,Ji)),[[a.Jo,e[t]]]):((0,l.uX)(),(0,l.CE)("span",Qi,(0,n.v_)(e[t]),1))])))),128)),(0,l.Lk)("td",Gi,[(0,l.Lk)("button",{onClick:t=>r.toggleEdit(e),class:"in-grid"},(0,n.v_)(e.isEditing?"Salva":"Modifica"),9,Hi),(0,l.Lk)("button",{onClick:t=>r.deleteRow(e.id),class:"in-grid-red"}," Elimina ",8,Zi)])])))),128))])])]),t[2]||(t[2]=(0,l.Lk)("h2",null,"Aggiungi Nuova Entry",-1)),(0,l.Lk)("div",es,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.columns,(e=>(0,l.bo)(((0,l.uX)(),(0,l.CE)("input",{key:e,"onUpdate:modelValue":t=>s.newRow[e]=t,placeholder:e},null,8,ts)),[[a.Jo,s.newRow[e]]]))),128)),(0,l.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>r.addRow&&r.addRow(...e)),class:"add-button"},"Aggiungi")])])}o(8237);var as={props:{tableName:String},data(){return{tableLabel:"",columns:[],tableData:[],newRow:{},tables:[{name:"legal-forms-table",label:"Forme Giuridiche"},{name:"documents-template-table",label:"Template Documenti"},{name:"roles-table",label:"Ruoli"},{name:"appointment-status-table",label:"Stati Appuntamento"},{name:"contract-status-table",label:"Stati Contratto"},{name:"adjustment-types-table",label:"Aggiustamenti manuali"},{name:"locations-table",label:"Sedi"},{name:"hourly-payments-table",label:"Paghe orarie"}]}},watch:{tableName:{immediate:!0,handler(e){this.tableLabel=this.tables.find((t=>t.name===e))?.label||e,this.fetchTableData()}}},methods:{async fetchTableData(){this.isLoading=!0;try{const e=await P.A.get(`https://dev.gixflow.cloud/api/${this.tableName}`);this.tableData=e.data.map((e=>({...e,isEditing:!1}))),this.columns=e.data.length?Object.keys(e.data[0]):[],this.resetNewRow()}catch(e){console.error("Errore nel caricamento:",e)}finally{this.isLoading=!1}},async updateRow(e){try{await P.A.put(`https://dev.gixflow.cloud/api/${this.tableName}/${e.id}`,e),this.$toast.show("Aggiornato con successo!",{type:"success"})}catch(t){console.error("Errore nell'aggiornamento:",t)}},async deleteRow(e){if(confirm("Sei sicuro di voler eliminare questa voce?"))try{await P.A.delete(`https://dev.gixflow.cloud/api/${this.tableName}/${e}`),this.tableData=this.tableData.filter((t=>t.id!==e)),this.$toast.show("Eliminato con successo!",{type:"success"})}catch(t){console.error("Errore nell'eliminazione:",t)}},async addRow(){try{const e=await P.A.post(`https://dev.gixflow.cloud/api/${this.tableName}`,this.newRow);this.tableData.push({id:e.data.id,...this.newRow}),this.resetNewRow(),this.$toast.show("Aggiunto con successo!",{type:"success"})}catch(e){console.error("Errore nella creazione:",e)}},resetNewRow(){this.newRow=this.columns.reduce(((e,t)=>({...e,[t]:""})),{})},toggleEdit(e){e.isEditing&&this.updateRow(e),e.isEditing=!e.isEditing}}};const ls=(0,x.A)(as,[["render",os],["__scopeId","data-v-6d4eee0c"]]);var ns=ls;const is={class:"header"},ss={class:"actions"},rs={class:"tabs-container"},ds={class:"tabs"},cs=["onClick"],us={class:"tab-label"},ps={class:"tab-content"};function hs(e,t,o,a,i,s){const r=(0,l.g2)("EditTable");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.Lk)("div",is,[t[2]||(t[2]=(0,l.Lk)("h1",null,"Modifica Tabelle di sistema",-1)),(0,l.Lk)("div",ss,[(0,l.Lk)("button",{class:"create-button",onClick:t[0]||(t[0]=(...t)=>e.openCreateModal&&e.openCreateModal(...t))},"+"),(0,l.Lk)("button",{class:"csv-button",onClick:t[1]||(t[1]=(...t)=>e.exportAppointments&&e.exportAppointments(...t))},"CSV")])]),(0,l.Lk)("div",rs,[(0,l.Lk)("div",ds,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.tables,(e=>((0,l.uX)(),(0,l.CE)("div",{key:e.name,onClick:t=>i.selectedTab=e.name,class:(0,n.C4)(["tab",{active:i.selectedTab===e.name}])},[(0,l.Lk)("i",{class:(0,n.C4)([e.icon,"tab-icon"])},null,2),(0,l.Lk)("span",us,(0,n.v_)(e.label),1)],10,cs)))),128))]),(0,l.Lk)("div",ps,[(0,l.bF)(r,{tableName:i.selectedTab},null,8,["tableName"])])])],64)}var ms={components:{EditTable:ns},data(){return{selectedTab:"legal-forms-table",tables:[{name:"legal-forms-table",label:"Forme Giuridiche",icon:""},{name:"documents-template-table",label:"Tipi di Documenti",icon:""},{name:"roles-table",label:"Ruoli",icon:""},{name:"appointment-status-table",label:"Stati Appuntamento",icon:""},{name:"contract-status-table",label:"Stati Contratto",icon:""},{name:"locations-table",label:"Sedi",icon:""},{name:"hourly-payments-table",label:"Paghe orarie",icon:""}]}}};const gs=(0,x.A)(ms,[["render",hs],["__scopeId","data-v-e11d6a4c"]]);var ks=gs;const fs={class:"header"},Ls={class:"actions"},vs={class:"logs-page"},bs={class:"filters"},ys=["value"],_s=["value"],Cs={class:"table"},ws=["onClick"],As={key:0},Es={class:"pagination-controls"},Ps=["value"],Ds={class:"pagination"},Ss=["disabled"],xs=["onClick"],Fs={key:1,class:"ellipsis"},Ms=["disabled"],Vs={class:"modal-content"};function Us(e,t,o,i,s,r){return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.Lk)("div",fs,[t[13]||(t[13]=(0,l.Lk)("h1",null,"Log di Sistema",-1)),(0,l.Lk)("div",Ls,[(0,l.Lk)("button",{class:"csv-button",onClick:t[0]||(t[0]=(...t)=>e.exportAppointments&&e.exportAppointments(...t))},"CSV")])]),(0,l.Lk)("div",vs,[(0,l.Lk)("div",bs,[(0,l.Lk)("label",null,[t[15]||(t[15]=(0,l.eW)(" Metodo: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>s.filters.method=e)},[t[14]||(t[14]=(0,l.Lk)("option",{value:""},"Tutti",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.methodOptions,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,n.v_)(e),9,ys)))),128))],512),[[a.u1,s.filters.method]])]),(0,l.Lk)("label",null,[t[16]||(t[16]=(0,l.eW)(" Utente: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>s.filters.user=e),placeholder:"Username"},null,512),[[a.Jo,s.filters.user]])]),(0,l.Lk)("label",null,[t[17]||(t[17]=(0,l.eW)(" IP: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=e=>s.filters.ip=e),placeholder:"Indirizzo IP"},null,512),[[a.Jo,s.filters.ip]])]),(0,l.Lk)("label",null,[t[19]||(t[19]=(0,l.eW)(" Status: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>s.filters.status=e)},[t[18]||(t[18]=(0,l.Lk)("option",{value:""},"Tutti",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.statusOptions,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,n.v_)(e),9,_s)))),128))],512),[[a.u1,s.filters.status]])]),(0,l.Lk)("label",null,[t[20]||(t[20]=(0,l.eW)(" Endpoint: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=e=>s.filters.endpoint=e),placeholder:"/api/..."},null,512),[[a.Jo,s.filters.endpoint]])]),(0,l.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>r.applyFilters&&r.applyFilters(...e))},"Applica"),(0,l.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>r.resetFilters&&r.resetFilters(...e))},"Reset")]),(0,l.Lk)("table",Cs,[t[22]||(t[22]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Timestamp"),(0,l.Lk)("th",null,"Metodo"),(0,l.Lk)("th",null,"Endpoint"),(0,l.Lk)("th",null,"Utente"),(0,l.Lk)("th",null,"IP"),(0,l.Lk)("th",null,"Status"),(0,l.Lk)("th",null,"Data")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.paginatedLogs,((e,t)=>((0,l.uX)(),(0,l.CE)("tr",{key:t},[(0,l.Lk)("td",null,(0,n.v_)(e.timestamp),1),(0,l.Lk)("td",{class:(0,n.C4)(r.getMethodClass(e.method))},(0,n.v_)(e.method),3),(0,l.Lk)("td",null,(0,n.v_)(e.endpoint),1),(0,l.Lk)("td",null,(0,n.v_)(e.user),1),(0,l.Lk)("td",null,(0,n.v_)(e.ip),1),(0,l.Lk)("td",null,(0,n.v_)(e.status),1),(0,l.Lk)("td",null,["N/A"!==e.data&&"LOGIN"!==e.method&&"LOGOUT"!==e.method?((0,l.uX)(),(0,l.CE)("button",{key:0,class:"in-grid",onClick:t=>r.openModal(e.data)},"Vedi",8,ws)):(0,l.Q3)("",!0)])])))),128)),0===s.filteredLogs.length?((0,l.uX)(),(0,l.CE)("tr",As,t[21]||(t[21]=[(0,l.Lk)("td",{colspan:"7"},"Nessun log trovato.",-1)]))):(0,l.Q3)("",!0)])]),(0,l.Lk)("div",Es,[(0,l.Lk)("label",null,[t[23]||(t[23]=(0,l.eW)(" Elementi per pagina: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>s.itemsPerPage=e)},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.itemsPerPageOptions,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,n.v_)(e),9,Ps)))),128))],512),[[a.u1,s.itemsPerPage]])])]),(0,l.Lk)("div",Ds,[(0,l.Lk)("button",{disabled:1===s.currentPage,onClick:t[9]||(t[9]=e=>r.changePage(s.currentPage-1))},t[24]||(t[24]=[(0,l.Lk)("i",{class:"fa-solid fa-backward-step"},null,-1)]),8,Ss),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.visiblePages(),(e=>((0,l.uX)(),(0,l.CE)("span",{key:e},["..."!==e?((0,l.uX)(),(0,l.CE)("button",{key:0,class:(0,n.C4)({active:e===s.currentPage}),onClick:t=>r.changePage(e)},(0,n.v_)(e),11,xs)):((0,l.uX)(),(0,l.CE)("span",Fs,"..."))])))),128)),(0,l.Lk)("button",{disabled:s.currentPage===r.totalPages,onClick:t[10]||(t[10]=e=>r.changePage(s.currentPage+1))},t[25]||(t[25]=[(0,l.Lk)("i",{class:"fa-solid fa-forward-step"},null,-1)]),8,Ms)]),s.showModal?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"modal-overlay",onClick:t[12]||(t[12]=(0,a.D$)(((...e)=>r.closeModal&&r.closeModal(...e)),["self"]))},[(0,l.Lk)("div",Vs,[t[26]||(t[26]=(0,l.Lk)("h3",null,"Dati Log",-1)),(0,l.Lk)("pre",null,(0,n.v_)(s.modalData),1),(0,l.Lk)("button",{class:"close-btn",onClick:t[11]||(t[11]=(...e)=>r.closeModal&&r.closeModal(...e))},"Chiudi")])])):(0,l.Q3)("",!0)])],64)}var Is={data(){return{logs:[],filteredLogs:[],currentPage:1,itemsPerPage:15,itemsPerPageOptions:[5,10,20,50],showModal:!1,modalData:"",filters:{method:"",user:"",ip:"",status:"",endpoint:""},methodOptions:["GET","POST","PUT","DELETE","LOGIN","LOGOUT"],statusOptions:["200","400","401","403","404","500"]}},computed:{formattedLogs(){return this.logs.map((e=>{const t=e.match(/\[(.*?)\] (LOGIN|LOGOUT|PUT|POST|DELETE|GET)?\s*(\/[^\s]*)?\s*\|\s*User:\s*(.*?)\s*\|\s*IP:\s*(.*?)\s*\|\s*Status:\s*(\d+)(?:\s*\|\s*Data:\s*(.*))?/);if(!t)return{timestamp:"❓",method:"❓",endpoint:"—",user:"❓",ip:"❓",status:"❓",data:"❓"};const o=this.formatDate(t[1]);let a="N/A";if(t[7]&&"{}"!==t[7].trim()&&"undefined"!==t[7].trim())try{a=JSON.stringify(JSON.parse(t[7]),null,2)}catch(l){a=t[7]||"N/A"}return{timestamp:o,method:t[2]||"—",endpoint:t[3]||"—",user:t[4],ip:t[5],status:t[6],data:a}}))},paginatedLogs(){const e=(this.currentPage-1)*this.itemsPerPage,t=e+this.itemsPerPage;return this.filteredLogs.slice(e,t)},totalPages(){return Math.ceil(this.filteredLogs.length/this.itemsPerPage)}},methods:{async fetchLogs(){try{const e=localStorage.getItem("token");if(!e)return;const t=await P.A.get("https://app.gixflow.cloud/api/logs",{headers:{Authorization:`Bearer ${e}`}});this.logs=t.data.logs,this.filteredLogs=[...this.formattedLogs]}catch(e){console.error("Errore nel recupero dei log:",e.response?.data||e.message)}},visiblePages(){const e=this.totalPages,t=this.currentPage,o=5;if(e<=o)return Array.from({length:e},((e,t)=>t+1));const a=[];t>2&&a.push(1),t>3&&a.push("...");const l=Math.max(2,t-1),n=Math.min(e-1,t+1);for(let i=l;i<=n;i++)a.push(i);return t<e-2&&a.push("..."),t<e-1&&a.push(e),a},getMethodClass(e){return{"log-get":"GET"===e,"log-post":"POST"===e,"log-put":"PUT"===e,"log-delete":"DELETE"===e,"log-login":"LOGIN"===e,"log-logout":"LOGOUT"===e}},applyFilters(){this.filteredLogs=this.formattedLogs.filter((e=>(!this.filters.method||e.method===this.filters.method)&&(!this.filters.user||e.user.includes(this.filters.user))&&(!this.filters.ip||e.ip.includes(this.filters.ip))&&(!this.filters.status||e.status===this.filters.status)&&(!this.filters.endpoint||e.endpoint.includes(this.filters.endpoint)))),this.currentPage=1},resetFilters(){this.filters={method:"",user:"",ip:"",status:"",endpoint:""},this.filteredLogs=[...this.formattedLogs]},changePage(e){e>0&&e<=this.totalPages&&(this.currentPage=e)},formatDate(e){if(!e)return"❓";const t=new Date(e);return`${t.toLocaleDateString("it-IT")} - ${t.toLocaleTimeString("it-IT")}`},openModal(e){this.modalData=e,this.showModal=!0},closeModal(){this.showModal=!1,this.modalData=""}},mounted(){this.fetchLogs()}};const Os=(0,x.A)(Is,[["render",Us],["__scopeId","data-v-46769e10"]]);var Xs=Os;const Ts={class:"api-keys"},$s={key:0,class:"table"},zs={class:"masked-key"},Rs={key:0,class:"full-key"},Ws={class:"actions"},Ns=["onClick"],js=["onClick"],Bs=["onClick"],qs={key:1,class:"no-keys"},Ks=["disabled"],Ys={key:2,class:"max-keys-warning"};function Js(e,t,o,a,i,s){return(0,l.uX)(),(0,l.CE)("div",Ts,[t[2]||(t[2]=(0,l.Lk)("div",{class:"header"},[(0,l.Lk)("h1",null,"Le mie Api Keys"),(0,l.Lk)("div",{class:"actions"})],-1)),i.apiKeys.length>0?((0,l.uX)(),(0,l.CE)("table",$s,[t[1]||(t[1]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"API Key"),(0,l.Lk)("th",null,"Azioni")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.apiKeys,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id},[(0,l.Lk)("td",zs,[(0,l.eW)(" ••••••••"+(0,n.v_)(e.api_key?e.api_key.slice(-4):"????")+" ",1),e.showFull?((0,l.uX)(),(0,l.CE)("span",Rs,(0,n.v_)(e.api_key),1)):(0,l.Q3)("",!0)]),(0,l.Lk)("td",Ws,[(0,l.Lk)("button",{onClick:t=>s.toggleKeyVisibility(e),class:"btn view"},(0,n.v_)(e.showFull?"Nascondi":"Mostra"),9,Ns),(0,l.Lk)("button",{onClick:t=>s.copyKey(e.api_key),class:"btn copy"}," Copia ",8,js),(0,l.Lk)("button",{onClick:t=>s.deleteKey(e.id),class:"btn delete"}," Elimina ",8,Bs)])])))),128))])])):((0,l.uX)(),(0,l.CE)("p",qs,"Non hai ancora generato API Keys.")),(0,l.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>s.generateKey&&s.generateKey(...e)),class:"btn generate",disabled:i.apiKeys.length>=5}," + Genera Nuova API Key ",8,Ks),i.apiKeys.length>=5?((0,l.uX)(),(0,l.CE)("p",Ys," ⚠️ Hai raggiunto il limite di 5 API Keys. Elimina una chiave per generarne un'altra. ")):(0,l.Q3)("",!0)])}var Qs={data(){return{apiKeys:[]}},async mounted(){await this.fetchApiKeys()},methods:{async fetchApiKeys(){try{const e=localStorage.getItem("token"),t=await P.A.get("https://dev.gixflow.cloud/api/api-keys",{headers:{Authorization:`Bearer ${e}`}});this.apiKeys=t.data.map((e=>({id:e.id,api_key:e.api_key||"",showFull:!1})))}catch(e){console.error("Errore nel recupero delle API Keys",e)}},async generateKey(){try{const e=localStorage.getItem("token");await P.A.post("https://dev.gixflow.cloud/api/generate-api-key",{},{headers:{Authorization:`Bearer ${e}`}}),await this.fetchApiKeys()}catch(e){console.error("Errore nella generazione della API Key",e)}},async deleteKey(e){try{const t=localStorage.getItem("token");await P.A.delete(`https://dev.gixflow.cloud/api/api-keys/${e}`,{headers:{Authorization:`Bearer ${t}`}}),this.apiKeys=this.apiKeys.filter((t=>t.id!==e))}catch(t){console.error("Errore nell'eliminazione della API Key",t)}},copyKey(e){navigator.clipboard.writeText(e),alert("API Key copiata!")},toggleKeyVisibility(e){e.showFull=!e.showFull}}};const Gs=(0,x.A)(Qs,[["render",Js],["__scopeId","data-v-7f772553"]]);var Hs=Gs;const Zs={class:"tab-container"},er=["onClick"],tr={class:"tab-content"};function or(e,t,o,a,i,s){return(0,l.uX)(),(0,l.CE)("div",null,[t[0]||(t[0]=(0,l.Lk)("h1",null,"Commissioning Agenti",-1)),(0,l.Lk)("div",Zs,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.tabs,(e=>((0,l.uX)(),(0,l.CE)("div",{key:e.name,class:(0,n.C4)(["tab-item",{active:i.selectedTab===e.name}]),onClick:t=>i.selectedTab=e.name},[(0,l.Lk)("i",{class:(0,n.C4)(e.icon)},null,2),(0,l.Lk)("span",null,(0,n.v_)(e.label),1)],10,er)))),128))]),(0,l.Lk)("div",tr,[((0,l.uX)(),(0,l.Wv)((0,l.$y)(i.selectedTab)))])])}const ar={class:"header"},lr={class:"actions"},nr={class:"filters"},ir={class:"switch"},sr={key:0,class:"modal-overlay"},rr={class:"modal-content"},dr={class:"modal-buttons"},cr={class:"table"},ur=["onClick"],pr=["onClick"],hr=["onClick","title"],mr={key:0,class:"fas fa-undo","aria-hidden":"true"},gr={key:1,class:"fa fa-archive","aria-hidden":"true"},kr={key:0},fr={class:"pagination"},Lr=["disabled"],vr=["onClick"],br=["disabled"];function yr(e,t,o,i,s,r){return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.Lk)("div",ar,[t[10]||(t[10]=(0,l.Lk)("h3",null,"Gestione Vendor",-1)),(0,l.Lk)("div",lr,[(0,l.Lk)("button",{class:"create-button",onClick:t[0]||(t[0]=(...e)=>r.openAddModal&&r.openAddModal(...e))},"+")])]),(0,l.Lk)("div",nr,[(0,l.Lk)("label",null,[t[11]||(t[11]=(0,l.eW)(" Nome Vendor: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>s.filterName=e),placeholder:"Cerca vendor..."},null,512),[[a.Jo,s.filterName]])]),(0,l.Lk)("label",ir,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=e=>s.showArchived=e)},null,512),[[a.lH,s.showArchived]]),t[12]||(t[12]=(0,l.Lk)("span",{class:"slider"},null,-1))]),t[13]||(t[13]=(0,l.Lk)("span",null,"Mostra archiviati",-1)),(0,l.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>r.resetFilters&&r.resetFilters(...e))},"Reset")]),s.showModal?((0,l.uX)(),(0,l.CE)("div",sr,[(0,l.Lk)("div",rr,[(0,l.Lk)("h2",null,(0,n.v_)(s.isEditing?"Modifica Vendor":"Nuovo Vendor"),1),t[14]||(t[14]=(0,l.Lk)("label",null,"Nome Vendor",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>s.currentVendor.name=e),placeholder:"Inserisci nome"},null,512),[[a.Jo,s.currentVendor.name]]),t[15]||(t[15]=(0,l.Lk)("label",null,"Descrizione",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>s.currentVendor.description=e),placeholder:"Inserisci descrizione"},null,512),[[a.Jo,s.currentVendor.description]]),(0,l.Lk)("div",dr,[(0,l.Lk)("button",{class:"close-button",onClick:t[6]||(t[6]=(...e)=>r.closeModal&&r.closeModal(...e))},"Annulla"),(0,l.Lk)("button",{type:"submit",onClick:t[7]||(t[7]=e=>s.isEditing?r.updateVendor():r.addVendor())}," Salva ")])])])):(0,l.Q3)("",!0),(0,l.Lk)("table",cr,[t[19]||(t[19]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"ID"),(0,l.Lk)("th",null,"Nome"),(0,l.Lk)("th",null,"Descrizione"),(0,l.Lk)("th",null,"Stato"),(0,l.Lk)("th",null,"Azioni")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.paginatedVendors,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id,class:(0,n.C4)({"archived-row":e.is_archived})},[(0,l.Lk)("td",null,(0,n.v_)(e.id),1),(0,l.Lk)("td",null,(0,n.v_)(e.name),1),(0,l.Lk)("td",null,(0,n.v_)(e.description),1),(0,l.Lk)("td",null,[(0,l.Lk)("span",{class:(0,n.C4)({archived:e.is_archived})},(0,n.v_)(e.is_archived?"Archiviato":"Attivo"),3)]),(0,l.Lk)("td",null,[(0,l.Lk)("button",{class:"in-grid",onClick:t=>r.openEditModal(e),title:"Modifica"},t[16]||(t[16]=[(0,l.Lk)("i",{class:"fa-duotone fa-solid fa-pen"},null,-1)]),8,ur),(0,l.Lk)("button",{class:"in-grid-red",onClick:t=>r.deleteVendor(e.id),title:"Elimina"},t[17]||(t[17]=[(0,l.Lk)("i",{class:"fa-duotone fa-solid fa-trash"},null,-1)]),8,pr),(0,l.Lk)("button",{class:"in-grid-blue",onClick:t=>r.toggleArchive(e),title:e.is_archived?"Ripristina vendor":"Archivia vendor"},[e.is_archived?((0,l.uX)(),(0,l.CE)("i",mr)):((0,l.uX)(),(0,l.CE)("i",gr))],8,hr)])],2)))),128)),0===r.paginatedVendors.length?((0,l.uX)(),(0,l.CE)("tr",kr,t[18]||(t[18]=[(0,l.Lk)("td",{colspan:"5",class:"no-results"},"Nessun risultato trovato",-1)]))):(0,l.Q3)("",!0)])]),(0,l.Lk)("div",fr,[(0,l.Lk)("button",{disabled:1===s.currentPage,onClick:t[8]||(t[8]=(...e)=>r.prevPage&&r.prevPage(...e))},t[20]||(t[20]=[(0,l.Lk)("i",{class:"fa-solid fa-backward-step"},null,-1)]),8,Lr),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.totalPages,(e=>((0,l.uX)(),(0,l.CE)("span",{key:e},[(0,l.Lk)("button",{class:(0,n.C4)({active:e===s.currentPage}),onClick:t=>r.changePage(e)},(0,n.v_)(e),11,vr)])))),128)),(0,l.Lk)("button",{disabled:s.currentPage===r.totalPages,onClick:t[9]||(t[9]=(...e)=>r.nextPage&&r.nextPage(...e))},t[21]||(t[21]=[(0,l.Lk)("i",{class:"fa-solid fa-forward-step"},null,-1)]),8,br)])])}var _r={data(){return{vendors:[],currentVendor:{name:"",description:"",is_archived:0},showModal:!1,isEditing:!1,filterName:"",showArchived:!1,currentPage:1,itemsPerPage:10}},watch:{showArchived(){this.fetchVendors()}},computed:{filteredVendors(){return this.vendors.filter((e=>{const t=!this.filterName||e.name.toLowerCase().includes(this.filterName.toLowerCase()),o=this.showArchived||0===e.is_archived;return t&&o}))},paginatedVendors(){const e=(this.currentPage-1)*this.itemsPerPage;return this.filteredVendors.slice(e,e+this.itemsPerPage)},totalPages(){return Math.ceil(this.filteredVendors.length/this.itemsPerPage)}},async mounted(){await this.fetchVendors()},methods:{async fetchVendors(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/vendors",{params:{showArchived:this.showArchived}});this.vendors=e.data}catch(e){console.error("Errore nel recupero dei vendor:",e)}},async addVendor(){if(!this.currentVendor.name)return alert("Compila tutti i campi!");try{await P.A.post("https://dev.gixflow.cloud/api/vendors",this.currentVendor),this.closeModal(),this.fetchVendors()}catch(e){console.error("Errore nella creazione del vendor:",e)}},async updateVendor(){try{await P.A.put(`https://dev.gixflow.cloud/api/vendors/${this.currentVendor.id}`,this.currentVendor),alert("Vendor aggiornato!"),this.closeModal(),this.fetchVendors()}catch(e){console.error("Errore nell'aggiornamento del vendor:",e)}},async deleteVendor(e){if(confirm("Eliminare questo vendor?"))try{await P.A.delete(`https://dev.gixflow.cloud/api/vendors/${e}`),this.fetchVendors()}catch(t){console.error("Errore nell'eliminazione del vendor:",t)}},async toggleArchive(e){try{const t=e.is_archived?0:1;await P.A.put(`https://dev.gixflow.cloud/api/vendors/${e.id}/archive`,{is_archived:t}),this.fetchVendors()}catch(t){console.error("Errore nell'archiviazione del vendor:",t)}},openEditModal(e){this.currentVendor={...e},this.isEditing=!0,this.showModal=!0},openAddModal(){this.currentVendor={name:"",description:"",is_archived:0},this.isEditing=!1,this.showModal=!0},closeModal(){this.showModal=!1},resetFilters(){this.filterName="",this.showArchived=!1},changePage(e){e!==this.currentPage&&(this.currentPage=e)},prevPage(){this.currentPage>1&&this.currentPage--},nextPage(){this.currentPage<this.totalPages&&this.currentPage++}}};const Cr=(0,x.A)(_r,[["render",yr],["__scopeId","data-v-d9eb5fda"]]);var wr=Cr;const Ar={class:"header"},Er={class:"actions"},Pr={class:"filters"},Dr=["value"],Sr={class:"switch"},xr={key:0,class:"modal-overlay"},Fr={class:"modal-content"},Mr=["value"],Vr={class:"modal-buttons"},Ur={class:"table"},Ir={key:0},Or=["onClick"],Xr=["onClick"],Tr=["onClick","title"],$r={key:0,class:"fas fa-undo","aria-hidden":"true"},zr={key:1,class:"fa fa-archive","aria-hidden":"true"},Rr={class:"pagination"},Wr=["disabled"],Nr=["onClick"],jr=["disabled"];function Br(e,t,o,i,s,r){return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.Lk)("div",Ar,[t[13]||(t[13]=(0,l.Lk)("h3",null,"Gestione Prodotti",-1)),(0,l.Lk)("div",Er,[(0,l.Lk)("button",{class:"create-button",onClick:t[0]||(t[0]=(...e)=>r.openAddModal&&r.openAddModal(...e))},"+")])]),(0,l.Lk)("div",Pr,[(0,l.Lk)("label",null,[t[15]||(t[15]=(0,l.eW)(" Vendor: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>s.filterVendor=e)},[t[14]||(t[14]=(0,l.Lk)("option",{value:""},"Tutti",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.vendors,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.name),9,Dr)))),128))],512),[[a.u1,s.filterVendor]])]),(0,l.Lk)("label",null,[t[16]||(t[16]=(0,l.eW)(" Nome Prodotto: ")),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>s.filterName=e),placeholder:"Cerca prodotto..."},null,512),[[a.Jo,s.filterName]])]),(0,l.Lk)("label",Sr,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>s.showArchived=e)},null,512),[[a.lH,s.showArchived]]),t[17]||(t[17]=(0,l.Lk)("span",{class:"slider"},null,-1))]),t[18]||(t[18]=(0,l.Lk)("span",null,"Mostra archiviate",-1)),(0,l.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>r.resetFilters&&r.resetFilters(...e))},"Reset")]),s.showModal?((0,l.uX)(),(0,l.CE)("div",xr,[(0,l.Lk)("div",Fr,[(0,l.Lk)("h2",null,(0,n.v_)(s.isEditing?"Modifica Prodotto":"Nuovo Prodotto"),1),t[19]||(t[19]=(0,l.Lk)("label",null,"Nome Prodotto",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>s.currentProduct.name=e),placeholder:"Inserisci nome"},null,512),[[a.Jo,s.currentProduct.name]]),t[20]||(t[20]=(0,l.Lk)("label",null,"Descrizione Prodotto",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>s.currentProduct.description=e),placeholder:"Inserisci descrizione"},null,512),[[a.Jo,s.currentProduct.description]]),t[21]||(t[21]=(0,l.Lk)("label",null,"Codice",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>s.currentProduct.code=e),placeholder:"Inserisci codice"},null,512),[[a.Jo,s.currentProduct.code]]),t[22]||(t[22]=(0,l.Lk)("label",null,"Vendor",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>s.currentProduct.vendor_id=e)},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.vendors,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.name),9,Mr)))),128))],512),[[a.u1,s.currentProduct.vendor_id]]),(0,l.Lk)("div",Vr,[(0,l.Lk)("button",{class:"close-button",onClick:t[9]||(t[9]=(...e)=>r.closeModal&&r.closeModal(...e))},"Annulla"),(0,l.Lk)("button",{type:"submit",onClick:t[10]||(t[10]=e=>s.isEditing?r.updateProduct():r.addProduct())}," Salva ")])])])):(0,l.Q3)("",!0),(0,l.Lk)("table",Ur,[t[26]||(t[26]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"ID"),(0,l.Lk)("th",null,"Nome"),(0,l.Lk)("th",null,"Descrizione"),(0,l.Lk)("th",null,"Vendor"),(0,l.Lk)("th",null,"Codice"),(0,l.Lk)("th",null,"Stato"),(0,l.Lk)("th",null,"Azioni")])],-1)),0===r.paginatedProducts.length?((0,l.uX)(),(0,l.CE)("tr",Ir,t[23]||(t[23]=[(0,l.Lk)("td",{colspan:"6",class:"no-results"},"Nessun risultato trovato",-1)]))):(0,l.Q3)("",!0),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.paginatedProducts,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id,class:(0,n.C4)({"archived-row":e.is_archived})},[(0,l.Lk)("td",null,(0,n.v_)(e.id),1),(0,l.Lk)("td",null,(0,n.v_)(e.name),1),(0,l.Lk)("td",null,(0,n.v_)(e.description),1),(0,l.Lk)("td",null,(0,n.v_)(r.getVendorName(e.vendor_id)),1),(0,l.Lk)("td",null,(0,n.v_)(e.code),1),(0,l.Lk)("td",null,[(0,l.Lk)("span",{class:(0,n.C4)({archived:e.is_archived})},(0,n.v_)(e.is_archived?"Archiviato":"Attivo"),3)]),(0,l.Lk)("td",null,[(0,l.Lk)("button",{class:"in-grid",onClick:t=>r.openEditModal(e),title:"Modifica prodotto"},t[24]||(t[24]=[(0,l.Lk)("i",{class:"fa-duotone fa-solid fa-pen"},null,-1)]),8,Or),(0,l.Lk)("button",{class:"in-grid-red",onClick:t=>r.deleteProduct(e.id),title:"Cancella prodotto"},t[25]||(t[25]=[(0,l.Lk)("i",{class:"fa-duotone fa-solid fa-trash"},null,-1)]),8,Xr),(0,l.Lk)("button",{class:"in-grid-blue",onClick:t=>r.toggleArchive(e),title:e.is_archived?"Ripristina prodotto":"Archivia prodotto"},[e.is_archived?((0,l.uX)(),(0,l.CE)("i",$r)):((0,l.uX)(),(0,l.CE)("i",zr))],8,Tr)])],2)))),128))])]),(0,l.Lk)("div",Rr,[(0,l.Lk)("button",{disabled:1===s.currentPage,onClick:t[11]||(t[11]=(...e)=>r.prevPage&&r.prevPage(...e))},t[27]||(t[27]=[(0,l.Lk)("i",{class:"fa-solid fa-forward-step"},null,-1)]),8,Wr),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.totalPages,(e=>((0,l.uX)(),(0,l.CE)("span",{key:e},[(0,l.Lk)("button",{class:(0,n.C4)({active:e===s.currentPage}),onClick:t=>r.changePage(e)},(0,n.v_)(e),11,Nr)])))),128)),(0,l.Lk)("button",{disabled:s.currentPage===r.totalPages,onClick:t[12]||(t[12]=(...e)=>r.nextPage&&r.nextPage(...e))},t[28]||(t[28]=[(0,l.Lk)("i",{class:"fa-solid fa-backward-step"},null,-1)]),8,jr)])])}var qr={data(){return{products:[],vendors:[],currentProduct:{name:"",code:"",vendor_id:"",is_archived:0},showModal:!1,isEditing:!1,filterVendor:"",filterName:"",showArchived:!1,currentPage:1,itemsPerPage:10}},watch:{showArchived(){this.fetchData()}},computed:{filteredProducts(){return this.products.filter((e=>{const t=!this.filterVendor||e.vendor_id===this.filterVendor,o=!this.filterName||e.name.toLowerCase().includes(this.filterName.toLowerCase()),a=this.showArchived||0===e.is_archived;return t&&o&&a}))},paginatedProducts(){const e=(this.currentPage-1)*this.itemsPerPage;return this.filteredProducts.slice(e,e+this.itemsPerPage)},totalPages(){return Math.ceil(this.filteredProducts.length/this.itemsPerPage)}},async mounted(){await this.fetchData()},methods:{async fetchData(){try{const[e,t]=await Promise.all([P.A.get("https://dev.gixflow.cloud/api/productsComm",{params:{showArchived:this.showArchived}}),P.A.get("https://dev.gixflow.cloud/api/vendors")]);this.products=e.data,this.vendors=t.data}catch(e){console.error("Errore nel recupero dei dati:",e)}},async addProduct(){if(!this.currentProduct.name||!this.currentProduct.vendor_id)return alert("Compila tutti i campi!");try{await P.A.post("https://dev.gixflow.cloud/api/products",this.currentProduct),this.closeModal(),this.fetchData()}catch(e){console.error("Errore nella creazione del prodotto:",e)}},async updateProduct(){try{await P.A.put(`https://dev.gixflow.cloud/api/products/${this.currentProduct.id}`,this.currentProduct),alert("Prodotto aggiornato!"),this.closeModal(),this.fetchData()}catch(e){console.error("Errore nell'aggiornamento del prodotto:",e)}},async deleteProduct(e){if(confirm("Eliminare questo prodotto?"))try{await P.A.delete(`https://dev.gixflow.cloud/api/products/${e}`),this.fetchData()}catch(t){console.error("Errore nell'eliminazione del prodotto:",t)}},async toggleArchive(e){try{const t=e.is_archived?0:1;await P.A.put(`https://dev.gixflow.cloud/api/products/${e.id}/archive`,{is_archived:t}),this.fetchData()}catch(t){console.error("Errore nell'archiviazione del prodotto:",t)}},openEditModal(e){this.currentProduct={...e},this.isEditing=!0,this.showModal=!0},openAddModal(){this.currentProduct={name:"",code:"",vendor_id:""},this.isEditing=!1,this.showModal=!0},closeModal(){this.showModal=!1},resetFilters(){this.filterVendor="",this.filterName="",this.showArchived=!1},getVendorName(e){const t=this.vendors.find((t=>t.id===e));return t?t.name:"N/A"},changePage(e){e!==this.currentPage&&(this.currentPage=e)},prevPage(){this.currentPage>1&&this.currentPage--},nextPage(){this.currentPage<this.totalPages&&this.currentPage++}}};const Kr=(0,x.A)(qr,[["render",Br],["__scopeId","data-v-21e32573"]]);var Yr=Kr;const Jr={class:"header"},Qr={class:"actions"},Gr={class:"filters"},Hr=["value"],Zr=["value"],ed={class:"switch"},td={class:"table"},od={key:0},ad=["onClick"],ld=["onClick"],nd=["onClick","title"],id={key:0,class:"fas fa-undo","aria-hidden":"true"},sd={key:1,class:"fa fa-archive","aria-hidden":"true"},rd={class:"pagination"},dd=["disabled"],cd=["onClick","disabled"],ud=["disabled"],pd={key:0,class:"modal-overlay"},hd={class:"modal-content"},md=["value"],gd=["value"],kd={class:"modal-buttons"};function fd(e,t,o,i,s,r){return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.Lk)("div",Jr,[t[15]||(t[15]=(0,l.Lk)("h3",null,"Provvigioni",-1)),(0,l.Lk)("div",Qr,[(0,l.Lk)("button",{class:"create-button",onClick:t[0]||(t[0]=(...e)=>r.openAddModal&&r.openAddModal(...e))},"+")])]),(0,l.Lk)("div",Gr,[(0,l.Lk)("label",null,[t[17]||(t[17]=(0,l.eW)(" Vendor: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>s.filterVendor=e)},[t[16]||(t[16]=(0,l.Lk)("option",{value:""},"Tutti",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.vendors,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.name},(0,n.v_)(e.name),9,Hr)))),128))],512),[[a.u1,s.filterVendor]])]),(0,l.Lk)("label",null,[t[19]||(t[19]=(0,l.eW)(" Prodotto: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>s.currentCommission.product_id=e)},[t[18]||(t[18]=(0,l.Lk)("option",{value:"",disabled:""},"Seleziona un Prodotto",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.filteredProducts,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.name),9,Zr)))),128))],512),[[a.u1,s.currentCommission.product_id]])]),(0,l.Lk)("label",ed,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>s.showArchived=e)},null,512),[[a.lH,s.showArchived]]),t[20]||(t[20]=(0,l.Lk)("span",{class:"slider"},null,-1))]),t[21]||(t[21]=(0,l.Lk)("span",null,"Mostra archiviate",-1)),(0,l.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>r.resetFilters&&r.resetFilters(...e))},"Reset")]),(0,l.Lk)("table",td,[t[25]||(t[25]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"ID"),(0,l.Lk)("th",null,"Vendor"),(0,l.Lk)("th",null,"Prodotto"),(0,l.Lk)("th",null,"Provvigione (€)"),(0,l.Lk)("th",null,"Valido dal"),(0,l.Lk)("th",null,"Valido fino al"),(0,l.Lk)("th",null,"Stato"),(0,l.Lk)("th",null,"Azioni")])],-1)),0===r.paginatedCommissions.length?((0,l.uX)(),(0,l.CE)("tr",od,t[22]||(t[22]=[(0,l.Lk)("td",{colspan:"8",class:"no-results"},"Nessun risultato trovato",-1)]))):(0,l.Q3)("",!0),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.paginatedCommissions,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id,class:(0,n.C4)({"archived-row":e.is_archived})},[(0,l.Lk)("td",null,(0,n.v_)(e.id),1),(0,l.Lk)("td",null,(0,n.v_)(e.vendor_name),1),(0,l.Lk)("td",null,(0,n.v_)(e.product_name||"N/A"),1),(0,l.Lk)("td",null,(0,n.v_)(e.commission)+" €",1),(0,l.Lk)("td",null,(0,n.v_)(r.formatDate(e.valid_from)),1),(0,l.Lk)("td",null,(0,n.v_)(r.formatDate(e.valid_to)),1),(0,l.Lk)("td",null,[(0,l.Lk)("span",{class:(0,n.C4)({archived:e.is_archived})},(0,n.v_)(e.is_archived?"Archiviata":"Attiva"),3)]),(0,l.Lk)("td",null,[(0,l.Lk)("button",{class:"in-grid",onClick:t=>r.openEditModal(e),title:"Modifica provvigione"},t[23]||(t[23]=[(0,l.Lk)("i",{class:"fa-duotone fa-solid fa-pen"},null,-1)]),8,ad),(0,l.Lk)("button",{class:"in-grid-red",onClick:t=>r.deleteCommission(e.id),title:"Cancella provvigione"},t[24]||(t[24]=[(0,l.Lk)("i",{class:"fa-duotone fa-solid fa-trash"},null,-1)]),8,ld),(0,l.Lk)("button",{class:"in-grid-blue",onClick:t=>r.toggleArchive(e),title:e.is_archived?"Ripristina provvigione":"Archivia provvigione"},[e.is_archived?((0,l.uX)(),(0,l.CE)("i",id)):((0,l.uX)(),(0,l.CE)("i",sd))],8,nd)])],2)))),128))])]),(0,l.Lk)("div",rd,[(0,l.Lk)("button",{disabled:1===s.currentPage,onClick:t[5]||(t[5]=(...e)=>r.prevPage&&r.prevPage(...e))},t[26]||(t[26]=[(0,l.Lk)("i",{class:"fa-solid fa-backward-step"},null,-1)]),8,dd),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.totalPages,(e=>((0,l.uX)(),(0,l.CE)("span",{key:e},[(0,l.Lk)("button",{class:(0,n.C4)({active:e===s.currentPage}),onClick:t=>r.changePage(e),disabled:e===s.currentPage},(0,n.v_)(e),11,cd)])))),128)),(0,l.Lk)("button",{disabled:s.currentPage===r.totalPages,onClick:t[6]||(t[6]=(...e)=>r.nextPage&&r.nextPage(...e))},t[27]||(t[27]=[(0,l.Lk)("i",{class:"fa-solid fa-forward-step"},null,-1)]),8,ud)]),s.showModal?((0,l.uX)(),(0,l.CE)("div",pd,[(0,l.Lk)("div",hd,[(0,l.Lk)("h2",null,(0,n.v_)(s.isEditing?"Modifica Provvigione":"Nuova Provvigione"),1),t[30]||(t[30]=(0,l.Lk)("label",null,"Vendor",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>s.currentCommission.vendor_id=e),onChange:t[8]||(t[8]=(...e)=>r.fetchProductsByVendor&&r.fetchProductsByVendor(...e))},[t[28]||(t[28]=(0,l.Lk)("option",{value:"",disabled:""},"Seleziona un Vendor",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.vendors,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.name),9,md)))),128))],544),[[a.u1,s.currentCommission.vendor_id]]),t[31]||(t[31]=(0,l.Lk)("label",null,"Prodotto",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[9]||(t[9]=e=>s.currentCommission.product_id=e)},[t[29]||(t[29]=(0,l.Lk)("option",{value:"",disabled:""},"Seleziona un Prodotto",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.filteredProducts,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.name),9,gd)))),128))],512),[[a.u1,s.currentCommission.product_id]]),t[32]||(t[32]=(0,l.Lk)("label",null,"Provvigione (€)",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[10]||(t[10]=e=>s.currentCommission.commission=e),type:"number",step:"0.01",placeholder:"Importo in €"},null,512),[[a.Jo,s.currentCommission.commission]]),t[33]||(t[33]=(0,l.Lk)("label",null,"Valido dal",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>s.currentCommission.valid_from=e),type:"date"},null,512),[[a.Jo,s.currentCommission.valid_from]]),t[34]||(t[34]=(0,l.Lk)("label",null,"Valido fino",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[12]||(t[12]=e=>s.currentCommission.valid_to=e),type:"date"},null,512),[[a.Jo,s.currentCommission.valid_to]]),(0,l.Lk)("div",kd,[(0,l.Lk)("button",{class:"close-button",onClick:t[13]||(t[13]=(...e)=>r.closeModal&&r.closeModal(...e))},"Annulla"),(0,l.Lk)("button",{type:"submit",onClick:t[14]||(t[14]=e=>s.isEditing?r.updateCommission():r.addCommission())}," Salva ")])])])):(0,l.Q3)("",!0)])}o(3579);var Ld={data(){return{commissions:[],vendors:[],products:[],filteredProducts:[],filterVendor:"",filterProduct:"",showArchived:JSON.parse(localStorage.getItem("showArchived"))||!1,currentCommission:{vendor_id:"",product_id:"",commission:"",valid_from:"",valid_to:""},showModal:!1,isEditing:!1,currentPage:1,itemsPerPage:10}},async mounted(){await this.fetchCommissions(),await this.fetchVendors(),await this.fetchProducts()},watch:{showArchived(e){localStorage.setItem("showArchived",JSON.stringify(e)),this.fetchCommissions()},"currentCommission.vendor_id":function(){this.fetchProductsByVendor()}},computed:{filteredCommissions(){return this.commissions.filter((e=>{const t=!this.filterVendor||e.vendor_name===this.filterVendor,o=!this.filterProduct||e.product_name===this.filterProduct,a=this.showArchived||!e.is_archived;return t&&o&&a}))},paginatedCommissions(){const e=(this.currentPage-1)*this.itemsPerPage,t=e+this.itemsPerPage;return this.filteredCommissions.slice(e,t)},totalPages(){return Math.ceil(this.filteredCommissions.length/this.itemsPerPage)}},methods:{async fetchProductsByVendor(){const e=this.currentCommission.vendor_id;if(!e)return console.warn("⚠️ Nessun vendor selezionato."),void(this.filteredProducts=[]);this.products.length||await this.fetchProducts(),this.filteredProducts=this.products.filter((t=>Number(t.vendor_id)===Number(e))),this.filteredProducts.some((e=>e.id===this.currentCommission.product_id))||(console.warn("⚠️ Prodotto non disponibile, resetto."),this.currentCommission.product_id="")},async fetchCommissions(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/products_commissioning",{params:{showArchived:this.showArchived,page:this.currentPage,limit:this.itemsPerPage}});this.commissions=e.data}catch(e){console.error("Errore nel recupero delle provvigioni:",e)}},async fetchVendors(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/vendors");this.vendors=e.data}catch(e){console.error("Errore nel recupero dei vendor:",e)}},async fetchProducts(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/productsComm");this.products=e.data}catch(e){console.error("Errore nel recupero dei prodotti:",e)}},async openEditModal(e){this.currentCommission={id:e.id,vendor_id:e.vendor_id?Number(e.vendor_id):null,product_id:e.product_id?Number(e.product_id):null,commission:e.commission,valid_from:this.formatDateForInput(e.valid_from),valid_to:this.formatDateForInput(e.valid_to)},this.currentCommission.vendor_id?await this.fetchProductsByVendor():console.warn("⚠️ Nessun vendor assegnato! Bug nel backend o frontend?"),this.isEditing=!0,this.showModal=!0},async addCommission(){if(this.currentCommission.vendor_id&&this.currentCommission.product_id&&this.currentCommission.commission)try{await P.A.post("https://dev.gixflow.cloud/api/products_commissioning",this.currentCommission),this.closeModal(),this.fetchCommissions()}catch(e){console.error("Errore nella creazione della provvigione:",e)}else alert("Compila tutti i campi!")},async updateCommission(){try{await P.A.put(`https://dev.gixflow.cloud/api/products_commissioning/${this.currentCommission.id}`,this.currentCommission),alert("Provvigione aggiornata!"),this.closeModal(),this.fetchCommissions()}catch(e){console.error("Errore nell'aggiornamento della provvigione:",e)}},async deleteCommission(e){confirm("Eliminare questa provvigione?")&&(await P.A.delete(`https://dev.gixflow.cloud/api/products_commissioning/${e}`),this.fetchCommissions())},async toggleArchive(e){try{const t=e.is_archived?0:1;await P.A.put(`https://dev.gixflow.cloud/api/products_commissioning/${e.id}/archive`,{is_archived:t}),await this.fetchCommissions()}catch(t){console.error("Errore nell'archiviazione della provvigione:",t)}},openAddModal(){this.currentCommission={vendor_id:"",product_id:"",commission:"",valid_from:"",valid_to:""},this.isEditing=!1,this.showModal=!0,this.filteredProducts=[]},formatDate(e){if(!e)return"";const t=new Date(e);return t.toLocaleDateString("it-IT")},formatDateForInput(e){return e?e.split("T")[0]:""},resetFilters(){this.filterVendor="",this.filterProduct="",this.showArchived=!1},closeModal(){this.showModal=!1},changePage(e){e!==this.currentPage&&(this.currentPage=e,this.fetchCommissions())},prevPage(){this.currentPage>1&&(this.currentPage--,this.fetchCommissions())},nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.fetchCommissions())}}};const vd=(0,x.A)(Ld,[["render",fd],["__scopeId","data-v-64c638f6"]]);var bd=vd;const yd={class:"header"},_d={class:"actions"},Cd={class:"filters"},wd=["value"],Ad=["value"],Ed={class:"switch"},Pd={class:"table"},Dd=["onClick"],Sd=["onClick"],xd=["onClick","title"],Fd={key:0,class:"fas fa-undo"},Md={key:1,class:"fa fa-archive"},Vd={key:0},Ud={class:"pagination"},Id=["disabled"],Od=["onClick"],Xd=["disabled"],Td={key:0,class:"modal-overlay"},$d={class:"modal-content"},zd=["value"],Rd=["value"],Wd={class:"modal-buttons"};function Nd(e,t,o,i,s,r){return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.Lk)("div",yd,[t[14]||(t[14]=(0,l.Lk)("h3",null,"Aggiustamenti Manuali",-1)),(0,l.Lk)("div",_d,[(0,l.Lk)("button",{class:"create-button",onClick:t[0]||(t[0]=(...e)=>r.openAddModal&&r.openAddModal(...e))},"+")])]),(0,l.Lk)("div",Cd,[(0,l.Lk)("label",null,[t[16]||(t[16]=(0,l.eW)(" Tipo Aggiustamento: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>s.filterAdjustmentType=e)},[t[15]||(t[15]=(0,l.Lk)("option",{value:""},"Tutti",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.adjustmentTypes,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.name},(0,n.v_)(e.name),9,wd)))),128))],512),[[a.u1,s.filterAdjustmentType]])]),(0,l.Lk)("label",null,[t[18]||(t[18]=(0,l.eW)(" Agente: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>s.filterAgent=e)},[t[17]||(t[17]=(0,l.Lk)("option",{value:""},"Tutti",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.agents,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.cognome)+" "+(0,n.v_)(e.nome),9,Ad)))),128))],512),[[a.u1,s.filterAgent]])]),(0,l.Lk)("label",Ed,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>s.showArchived=e)},null,512),[[a.lH,s.showArchived]]),t[19]||(t[19]=(0,l.Lk)("span",{class:"slider"},null,-1))]),t[20]||(t[20]=(0,l.Lk)("span",null,"Mostra archiviate",-1)),(0,l.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>r.resetFilters&&r.resetFilters(...e))},"Reset")]),(0,l.Lk)("table",Pd,[t[24]||(t[24]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"ID"),(0,l.Lk)("th",null,"Nome Aggiustamento"),(0,l.Lk)("th",null,"Agente"),(0,l.Lk)("th",null,"Importo (€)"),(0,l.Lk)("th",null,"Valido dal"),(0,l.Lk)("th",null,"Valido fino al"),(0,l.Lk)("th",null,"Stato"),(0,l.Lk)("th",null,"Azioni")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.paginatedAdjustments,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id,class:(0,n.C4)({"archived-row":e.is_archived})},[(0,l.Lk)("td",null,(0,n.v_)(e.id),1),(0,l.Lk)("td",null,(0,n.v_)(e.adjustment_name),1),(0,l.Lk)("td",null,(0,n.v_)(e.agent_name),1),(0,l.Lk)("td",null,(0,n.v_)(e.amount)+" €",1),(0,l.Lk)("td",null,(0,n.v_)(r.formatDate(e.valid_from)),1),(0,l.Lk)("td",null,(0,n.v_)(r.formatDate(e.valid_to)),1),(0,l.Lk)("td",null,[(0,l.Lk)("span",{class:(0,n.C4)({archived:e.is_archived})},(0,n.v_)(e.is_archived?"Archiviato":"Attivo"),3)]),(0,l.Lk)("td",null,[(0,l.Lk)("button",{class:"in-grid",onClick:t=>r.openEditModal(e),title:"Modifica"},t[21]||(t[21]=[(0,l.Lk)("i",{class:"fa fa-pen"},null,-1)]),8,Dd),(0,l.Lk)("button",{class:"in-grid-red",onClick:t=>r.deleteAdjustment(e.id),title:"Elimina"},t[22]||(t[22]=[(0,l.Lk)("i",{class:"fa fa-trash"},null,-1)]),8,Sd),(0,l.Lk)("button",{class:"in-grid-blue",onClick:t=>r.toggleArchive(e),title:e.is_archived?"Ripristina":"Archivia"},[e.is_archived?((0,l.uX)(),(0,l.CE)("i",Fd)):((0,l.uX)(),(0,l.CE)("i",Md))],8,xd)])],2)))),128)),0===r.paginatedAdjustments.length?((0,l.uX)(),(0,l.CE)("tr",Vd,t[23]||(t[23]=[(0,l.Lk)("td",{colspan:"8",class:"no-results"},"Nessun risultato trovato",-1)]))):(0,l.Q3)("",!0)])]),(0,l.Lk)("div",Ud,[(0,l.Lk)("button",{disabled:1===s.currentPage,onClick:t[5]||(t[5]=(...e)=>r.prevPage&&r.prevPage(...e))},t[25]||(t[25]=[(0,l.Lk)("i",{class:"fa-solid fa-backward-step"},null,-1)]),8,Id),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.totalPages,(e=>((0,l.uX)(),(0,l.CE)("span",{key:e},[(0,l.Lk)("button",{class:(0,n.C4)({active:e===s.currentPage}),onClick:t=>r.changePage(e)},(0,n.v_)(e),11,Od)])))),128)),(0,l.Lk)("button",{disabled:s.currentPage===r.totalPages,onClick:t[6]||(t[6]=(...e)=>r.nextPage&&r.nextPage(...e))},t[26]||(t[26]=[(0,l.Lk)("i",{class:"fa-solid fa-forward-step"},null,-1)]),8,Xd)]),s.showModal?((0,l.uX)(),(0,l.CE)("div",Td,[(0,l.Lk)("div",$d,[(0,l.Lk)("h2",null,(0,n.v_)(s.isEditing?"Modifica Aggiustamento":"Nuovo Aggiustamento"),1),t[29]||(t[29]=(0,l.Lk)("label",null,"Tipo Aggiustamento",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>s.currentAdjustment.adjustment_type_id=e)},[t[27]||(t[27]=(0,l.Lk)("option",{value:"",disabled:""},"Seleziona un tipo",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.adjustmentTypes,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.name),9,zd)))),128))],512),[[a.u1,s.currentAdjustment.adjustment_type_id]]),t[30]||(t[30]=(0,l.Lk)("label",null,"Agente",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>s.currentAdjustment.user_id=e)},[t[28]||(t[28]=(0,l.Lk)("option",{value:"",disabled:""},"Seleziona un agente",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.agents,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.cognome)+" "+(0,n.v_)(e.nome),9,Rd)))),128))],512),[[a.u1,s.currentAdjustment.user_id]]),t[31]||(t[31]=(0,l.Lk)("label",null,"Importo (€)",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>s.currentAdjustment.amount=e),type:"number",step:"0.01",placeholder:"Importo in €"},null,512),[[a.Jo,s.currentAdjustment.amount]]),t[32]||(t[32]=(0,l.Lk)("label",null,"Valido dal",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[10]||(t[10]=e=>s.currentAdjustment.valid_from=e),type:"date"},null,512),[[a.Jo,s.currentAdjustment.valid_from]]),t[33]||(t[33]=(0,l.Lk)("label",null,"Valido fino",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>s.currentAdjustment.valid_to=e),type:"date"},null,512),[[a.Jo,s.currentAdjustment.valid_to]]),(0,l.Lk)("div",Wd,[(0,l.Lk)("button",{class:"close-button",onClick:t[12]||(t[12]=(...e)=>r.closeModal&&r.closeModal(...e))},"Annulla"),(0,l.Lk)("button",{type:"submit",onClick:t[13]||(t[13]=e=>s.isEditing?r.updateAdjustment():r.addAdjustment())}," Salva ")])])])):(0,l.Q3)("",!0)])}var jd={data(){return{adjustments:[],adjustmentTypes:[],agents:[],currentAdjustment:{adjustment_type_id:"",user_id:"",amount:"",valid_from:"",valid_to:""},filterAdjustmentType:"",filterAgent:"",showModal:!1,isEditing:!1,showArchived:JSON.parse(localStorage.getItem("showArchived"))||!1,currentPage:1,itemsPerPage:10}},async mounted(){await this.fetchAdjustments(),await this.fetchAdjustmentTypes(),await this.fetchAgents()},watch:{showArchived(e){localStorage.setItem("showArchived",JSON.stringify(e)),this.fetchAdjustments()}},computed:{filteredAdjustments(){return this.adjustments.filter((e=>{const t=!this.filterAdjustmentType||e.adjustment_name===this.filterAdjustmentType,o=!this.filterAgent||e.agent_name===this.filterAgent;return t&&o}))},paginatedAdjustments(){const e=(this.currentPage-1)*this.itemsPerPage,t=e+this.itemsPerPage;return this.filteredAdjustments.slice(e,t)},totalPages(){return Math.ceil(this.filteredAdjustments.length/this.itemsPerPage)}},methods:{async fetchAdjustments(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/manual-adjustments",{params:{showArchived:this.showArchived}});this.adjustments=e.data}catch(e){console.error("Errore nel recupero degli aggiustamenti:",e)}},async fetchAdjustmentTypes(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/adjustment-types-table");this.adjustmentTypes=e.data.types||e.data||[]}catch(e){console.error("Errore nel recupero dei tipi di aggiustamenti:",e)}},async fetchAgents(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/users"),t=Array.isArray(e.data)?e.data.flat():[];this.agents=this.removeDuplicates(t.filter((e=>2===e.role_id)).map((e=>({...e,surname:e.surname||e.last_name,name:e.name||e.first_name}))))}catch(e){console.error("Errore nel recupero degli agenti:",e)}},async addAdjustment(){try{const e={adjustment_type_id:this.currentAdjustment.adjustment_type_id,user_id:this.currentAdjustment.user_id,amount:this.currentAdjustment.amount,valid_from:this.formatDateForBackend(this.currentAdjustment.valid_from),valid_to:this.formatDateForBackend(this.currentAdjustment.valid_to)};await P.A.post("https://dev.gixflow.cloud/api/manual-adjustments",e),this.closeModal(),this.fetchAdjustments()}catch(e){console.error("Errore nella creazione dell'aggiustamento:",e.response?.data||e)}},async updateAdjustment(){try{if(!this.currentAdjustment.id)return void console.error("Errore: ID aggiustamento mancante!");const e={adjustment_type_id:this.currentAdjustment.adjustment_type_id,user_id:this.currentAdjustment.user_id,amount:this.currentAdjustment.amount,valid_from:this.formatDateForBackend(this.currentAdjustment.valid_from),valid_to:this.formatDateForBackend(this.currentAdjustment.valid_to)};await P.A.put(`https://dev.gixflow.cloud/api/manual-adjustments/${this.currentAdjustment.id}`,e),this.closeModal(),this.fetchAdjustments()}catch(e){console.error("Errore nell'aggiornamento dell'aggiustamento:",e.response?.data||e)}},async deleteAdjustment(e){confirm("Eliminare questo aggiustamento?")&&(await P.A.delete(`https://dev.gixflow.cloud/api/manual-adjustments/${e}`),this.fetchAdjustments())},async toggleArchive(e){try{const t=e.is_archived?0:1;await P.A.put(`https://dev.gixflow.cloud/api/manual-adjustments/${e.id}/archive`,{is_archived:t}),await this.fetchAdjustments()}catch(t){console.error("Errore nell'archiviazione dell'aggiustamento:",t)}},openAddModal(){this.currentAdjustment={adjustment_type_id:"",user_id:"",amount:"",valid_from:"",valid_to:""},this.isEditing=!1,this.showModal=!0},openEditModal(e){this.currentAdjustment={...e,valid_from:this.formatDateForInput(e.valid_from),valid_to:this.formatDateForInput(e.valid_to)},this.isEditing=!0,this.showModal=!0},closeModal(){this.showModal=!1},removeDuplicates(e){return e.filter(((e,t,o)=>t===o.findIndex((t=>t.id===e.id))))},formatDate(e){if(!e)return"";const t=new Date(e);return t.toLocaleDateString("it-IT")},formatDateForInput(e){return e?e.split("T")[0]:""},formatDateForBackend(e){return e?new Date(e).toISOString().split("T")[0]:null},resetFilters(){this.filterAdjustmentType="",this.filterAgent="",this.showArchived=!1},changePage(e){e!==this.currentPage&&(this.currentPage=e,this.fetchAdjustments())},prevPage(){this.currentPage>1&&(this.currentPage--,this.fetchAdjustments())},nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.fetchAdjustments())}}};const Bd=(0,x.A)(jd,[["render",Nd],["__scopeId","data-v-3e1bcc5a"]]);var qd=Bd;const Kd={class:"filters"},Yd=["value"],Jd=["disabled"],Qd={key:0,class:"error-message"},Gd={key:0,class:"table commissioning-preview"},Hd={class:"left-align"},Zd={key:1,class:"actions"};function ec(e,t,o,i,s,r){return(0,l.uX)(),(0,l.CE)("div",null,[t[8]||(t[8]=(0,l.Lk)("div",{class:"header"},[(0,l.Lk)("h3",null,"Genera Consuntivi")],-1)),(0,l.Lk)("div",Kd,[(0,l.Lk)("label",null,[t[5]||(t[5]=(0,l.eW)(" Anno: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>s.selectedYear=e)},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.years,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e},(0,n.v_)(e),1)))),128))],512),[[a.u1,s.selectedYear]])]),(0,l.Lk)("label",null,[t[6]||(t[6]=(0,l.eW)(" Mese: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>s.selectedMonth=e)},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.months,((e,t)=>((0,l.uX)(),(0,l.CE)("option",{key:t,value:t+1},(0,n.v_)(e),9,Yd)))),128))],512),[[a.u1,s.selectedMonth]])]),(0,l.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>r.previewCommissions&&r.previewCommissions(...e)),disabled:s.isArchived}," Genera Anteprima ",8,Jd),s.isArchived?((0,l.uX)(),(0,l.CE)("p",Qd," ❌ Questa mensilità è già archiviata e non può essere modificata. ")):(0,l.Q3)("",!0)]),s.commissions.length>0?((0,l.uX)(),(0,l.CE)("table",Gd,[t[7]||(t[7]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Agente"),(0,l.Lk)("th",null,"Provvigione Base"),(0,l.Lk)("th",null,"Fisso Mensile"),(0,l.Lk)("th",null,"Rimborso Spese"),(0,l.Lk)("th",null,"Aggiustamenti Manuali"),(0,l.Lk)("th",null,"Totale")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.sortedCommissions,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.agent_id},[(0,l.Lk)("td",Hd,(0,n.v_)(r.formatAgentName(e.agent_name)),1),(0,l.Lk)("td",null,(0,n.v_)(r.formatCurrency(e.baseCommission)),1),(0,l.Lk)("td",null,(0,n.v_)(r.formatCurrency(e.fixedSalary)),1),(0,l.Lk)("td",null,(0,n.v_)(r.formatCurrency(e.expenseReimbursement)),1),(0,l.Lk)("td",null,(0,n.v_)(r.formatCurrency(e.manualAdjustments)),1),(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,(0,n.v_)(r.formatCurrency(e.total)),1)])])))),128))])])):(0,l.Q3)("",!0),s.commissions.length>0?((0,l.uX)(),(0,l.CE)("div",Zd,[(0,l.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>r.saveCommissions&&r.saveCommissions(...e))},"Salva Provvigioni"),(0,l.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>r.resetCommissions&&r.resetCommissions(...e))},"Reset")])):(0,l.Q3)("",!0)])}var tc={data(){return{selectedYear:(new Date).getFullYear(),selectedMonth:(new Date).getMonth()+1,commissions:[],isArchived:!1,years:Array.from({length:5},((e,t)=>(new Date).getFullYear()-t)),months:["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"]}},watch:{selectedYear(){this.isArchived=!1},selectedMonth(){this.isArchived=!1}},computed:{sortedCommissions(){return[...this.commissions].sort(((e,t)=>{const o=this.extractLastName(e.agent_name),a=this.extractLastName(t.agent_name);return o.localeCompare(a)}))}},methods:{async previewCommissions(){try{const{data:e}=await P.A.get("https://dev.gixflow.cloud/api/preview-commissions",{params:{year:this.selectedYear,month:this.selectedMonth}});this.commissions=e,this.isArchived=!1}catch(e){console.error("Errore Axios (anteprima):",e),409===e.response?.status?this.isArchived=!0:alert("Errore nel calcolo dell'anteprima delle provvigioni.")}},async saveCommissions(){try{await P.A.post("https://dev.gixflow.cloud/api/save-commissions",{year:this.selectedYear,month:this.selectedMonth,commissions:this.commissions}),alert("Provvigioni salvate con successo!"),this.commissions=[]}catch(e){console.error("Errore Axios (salvataggio):",e),alert("Errore nel salvataggio delle provvigioni.")}},resetCommissions(){this.commissions=[]},formatCurrency(e){return parseFloat(e).toFixed(2)+" €"},extractLastName(e){const t=e.split(" ");return t.length>1?t[t.length-1]:e},formatAgentName(e){const t=e.split(" ");return t.length>1?`${t[t.length-1]} ${t.slice(0,-1).join(" ")}`:e}}};const oc=(0,x.A)(tc,[["render",ec],["__scopeId","data-v-31095a96"]]);var ac=oc;const lc={class:"filters"},nc=["value"],ic=["value"],sc={class:"table"},rc={key:0},dc=["onClick"],cc=["title"],uc=["onClick"],pc=["onClick"],hc={key:1},mc={colspan:"6"},gc={class:"sub-table"},kc=["onClick"],fc=["title"],Lc={key:0},vc={colspan:"5"},bc={class:"sub-table deeper-level"},yc=["onClick"],_c=["title"],Cc={key:0},wc={colspan:"5"},Ac={class:"sub-table deepest-level"},Ec={key:0,class:"pagination"},Pc=["disabled"],Dc=["disabled"];function Sc(e,t,o,i,s,r){return(0,l.uX)(),(0,l.CE)("div",null,[t[20]||(t[20]=(0,l.Lk)("div",{class:"header"},[(0,l.Lk)("h3",null,"Archivio Consuntivi")],-1)),(0,l.Lk)("div",lc,[(0,l.Lk)("label",null,[t[8]||(t[8]=(0,l.eW)(" Anno: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>s.selectedYear=e),onChange:t[1]||(t[1]=(...t)=>e.applyFilters&&e.applyFilters(...t))},[t[7]||(t[7]=(0,l.Lk)("option",{value:""},"Tutti",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.years,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,n.v_)(e),9,nc)))),128))],544),[[a.u1,s.selectedYear]])]),(0,l.Lk)("label",null,[t[10]||(t[10]=(0,l.eW)(" Mese: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>s.selectedMonthFilter=e),onChange:t[3]||(t[3]=(...t)=>e.applyFilters&&e.applyFilters(...t))},[t[9]||(t[9]=(0,l.Lk)("option",{value:""},"Tutti",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.months,((e,t)=>((0,l.uX)(),(0,l.CE)("option",{key:t,value:t+1},(0,n.v_)(e),9,ic)))),128))],544),[[a.u1,s.selectedMonthFilter]])]),(0,l.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>r.resetSelections&&r.resetSelections(...e))},"Reset")]),(0,l.Lk)("table",sc,[t[17]||(t[17]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Anno"),(0,l.Lk)("th",null,"Mese"),(0,l.Lk)("th",null,"Agenti Coinvolti"),(0,l.Lk)("th",null,"Totale Provvigioni"),(0,l.Lk)("th",null,"Creata il"),(0,l.Lk)("th",null,"Azioni")])],-1)),(0,l.Lk)("tbody",null,[0===r.paginatedMonths.length?((0,l.uX)(),(0,l.CE)("tr",rc,t[11]||(t[11]=[(0,l.Lk)("td",{colspan:"5",class:"no-results"},"Nessuna mensilità trovata",-1)]))):(0,l.Q3)("",!0),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.paginatedMonths,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:`${e.year}-${e.month}`,class:"clickable",onClick:t=>r.toggleMonthDetails(e)},[(0,l.Lk)("td",null,(0,n.v_)(e.year),1),(0,l.Lk)("td",null,(0,n.v_)(r.getMonthName(e.month)),1),(0,l.Lk)("td",null,(0,n.v_)(e.totalAgents),1),(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,(0,n.v_)(r.formatCurrency(e.totalCommission)),1)]),(0,l.Lk)("td",null,(0,n.v_)(r.formatDate(e.created_at)),1),(0,l.Lk)("td",null,[(0,l.Lk)("button",{class:(0,n.C4)(r.isSelectedMonth(e)?"in-grid-blue":"in-grid"),title:r.isSelectedMonth(e)?"Chiudi":"Espandi"},[(0,l.Lk)("i",{class:(0,n.C4)(["fa",r.isSelectedMonth(e)?"fa-minus-square":"fa-plus-square"])},null,2)],10,cc),(0,l.Lk)("button",{class:"in-grid-blue",onClick:t=>r.generatePDF(e),title:"Scarica PDF dettagliato"},t[12]||(t[12]=[(0,l.Lk)("i",{class:"fa fa-file-pdf"},null,-1)]),8,uc),(0,l.Lk)("button",{class:"in-grid-red",onClick:(0,a.D$)((t=>r.deleteCommissionMonth(e)),["stop"]),title:"Cancella mensilità"},t[13]||(t[13]=[(0,l.Lk)("i",{class:"fa-duotone fa-solid fa-trash"},null,-1)]),8,pc)])],8,dc)))),128)),s.selectedMonth?((0,l.uX)(),(0,l.CE)("tr",hc,[(0,l.Lk)("td",mc,[(0,l.Lk)("table",gc,[t[16]||(t[16]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Agente"),(0,l.Lk)("th",null,"Provvigione Totale"),(0,l.Lk)("th",null,"Azioni")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.computedAgents,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.agent_id,class:"clickable sub-row",onClick:(0,a.D$)((t=>r.toggleAgentDetails(e)),["stop"])},[(0,l.Lk)("td",null,(0,n.v_)(e.agent_name),1),(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,(0,n.v_)(r.formatCurrency(e.totalCommission)),1)]),(0,l.Lk)("td",null,[(0,l.Lk)("button",{class:(0,n.C4)(r.isSelectedAgent(e)?"in-grid-blue":"in-grid"),title:r.isSelectedAgent(e)?"Chiudi":"Espandi"},[(0,l.Lk)("i",{class:(0,n.C4)(["fa",r.isSelectedAgent(e)?"fa-minus-square":"fa-plus-square"])},null,2)],10,fc)])],8,kc)))),128)),s.selectedAgent?((0,l.uX)(),(0,l.CE)("tr",Lc,[(0,l.Lk)("td",vc,[(0,l.Lk)("table",bc,[t[15]||(t[15]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Numero Contratto"),(0,l.Lk)("th",null,"Cliente"),(0,l.Lk)("th",null,"Data Firma"),(0,l.Lk)("th",null,"Stato"),(0,l.Lk)("th",null,"Azioni")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.computedContracts,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.contract_id,class:"clickable sub-row deeper-level",onClick:(0,a.D$)((t=>r.toggleContractDetails(e)),["stop"])},[(0,l.Lk)("td",null,(0,n.v_)(e.contract_number||"N/A"),1),(0,l.Lk)("td",null,(0,n.v_)(e.client_name||"N/A"),1),(0,l.Lk)("td",null,(0,n.v_)(r.formatDate(e.signature_date)),1),(0,l.Lk)("td",null,(0,n.v_)(e.status_name||"N/A"),1),(0,l.Lk)("td",null,[(0,l.Lk)("button",{class:(0,n.C4)(r.isSelectedContract(e)?"in-grid-blue":"in-grid"),title:r.isSelectedContract(e)?"Chiudi":"Espandi"},[(0,l.Lk)("i",{class:(0,n.C4)(["fa",r.isSelectedContract(e)?"fa-minus-square":"fa-plus-square"])},null,2)],10,_c)])],8,yc)))),128)),s.selectedContract?((0,l.uX)(),(0,l.CE)("tr",Cc,[(0,l.Lk)("td",wc,[(0,l.Lk)("table",Ac,[t[14]||(t[14]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Prodotto"),(0,l.Lk)("th",null,"Quantità"),(0,l.Lk)("th",null,"Provvigione")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.computedProducts,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id,class:"sub-row deepest-level"},[(0,l.Lk)("td",null,(0,n.v_)(e.name),1),(0,l.Lk)("td",null,(0,n.v_)(e.quantity),1),(0,l.Lk)("td",null,(0,n.v_)(r.formatCurrency(e.commission)),1)])))),128))])])])])):(0,l.Q3)("",!0)])])])])):(0,l.Q3)("",!0)])])])])):(0,l.Q3)("",!0)])]),r.totalPages>1?((0,l.uX)(),(0,l.CE)("div",Ec,[(0,l.Lk)("button",{onClick:t[5]||(t[5]=e=>r.changePage("prev")),disabled:1===s.currentPage},t[18]||(t[18]=[(0,l.Lk)("i",{class:"fa-solid fa-backward-step"},null,-1)]),8,Pc),(0,l.Lk)("span",null,"Pagina "+(0,n.v_)(s.currentPage)+" di "+(0,n.v_)(r.totalPages),1),(0,l.Lk)("button",{onClick:t[6]||(t[6]=e=>r.changePage("next")),disabled:s.currentPage===r.totalPages},t[19]||(t[19]=[(0,l.Lk)("i",{class:"fa-solid fa-forward-step"},null,-1)]),8,Dc)])):(0,l.Q3)("",!0)])}var xc={data(){return{monthsList:[],agentDetails:[],contractsDetails:[],selectedMonth:null,selectedAgent:null,selectedContract:null,selectedYear:(new Date).getFullYear(),selectedMonthFilter:"",years:Array.from({length:5},((e,t)=>(new Date).getFullYear()-t)),months:["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"],currentPage:1,itemsPerPage:10}},computed:{filteredMonths(){return this.monthsList.filter((e=>(!this.selectedYear||e.year==this.selectedYear)&&(!this.selectedMonthFilter||e.month==this.selectedMonthFilter)))},computedMonths(){return this.filteredMonths.filter((e=>e.totalCommission>0))},computedAgents(){return this.agentDetails.filter((e=>e.totalCommission>0))},computedContracts(){return this.contractsDetails.filter((e=>e.products.length>0))},computedProducts(){return this.selectedContract?.products.filter((e=>e.commission>0))||[]},paginatedMonths(){const e=(this.currentPage-1)*this.itemsPerPage,t=e+this.itemsPerPage;return this.computedMonths.slice(e,t)},totalPages(){return Math.ceil(this.computedMonths.length/this.itemsPerPage)}},methods:{async fetchMonths(){try{const{data:e}=await P.A.get("https://dev.gixflow.cloud/api/get-archived-commissions");this.monthsList=e,this.currentPage=1}catch(e){console.error("Errore nel recupero delle mensilità:",e)}},async fetchAgents(){if(this.selectedMonth)try{const{data:e}=await P.A.get("https://dev.gixflow.cloud/api/get-agents-by-month",{params:{year:this.selectedMonth.year,month:this.selectedMonth.month}});this.agentDetails=e}catch(e){console.error("Errore nel caricamento degli agenti:",e)}},async fetchContracts(e){if(this.selectedAgent)try{const{data:t}=await P.A.get("https://dev.gixflow.cloud/api/get-contracts-by-agent",{params:{agentId:e.agent_id,year:this.selectedMonth.year,month:this.selectedMonth.month}});this.contractsDetails=t}catch(t){console.error("Errore nel recupero dei contratti:",t)}},async fetchContractDetailsComm(e){if(e&&e.contract_id)try{const t=await P.A.get(`https://dev.gixflow.cloud/api/contractscomm/${e.contract_id}`);this.selectedContract={...t.data.contract,products:t.data.products||[]}}catch(t){console.error("Errore nel recupero dettagli contratto:",t)}else console.error("Errore: `contract` non valido",e)},async deleteCommissionMonth(e){if(!e.year||!e.month)return console.error("Errore: dati della mensilità mancanti",e),void alert("Errore: impossibile trovare i dati della mensilità.");if(confirm(`⚠️ Sei sicuro di voler eliminare le provvigioni di ${this.getMonthName(e.month)} ${e.year}?`))try{const t=await P.A.delete(`https://dev.gixflow.cloud/api/delete-commission-month/${e.year}/${e.month}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});alert(t.data.message),this.fetchMonths(),this.isSelectedMonth(e)&&(this.selectedMonth=null,this.agentDetails=[],this.selectedAgent=null,this.contractsDetails=[],this.selectedContract=null)}catch(t){console.error("Errore durante l'eliminazione:",t),alert("Errore durante l'eliminazione della mensilità.")}},async generatePDF(e){try{const t=await P.A.get("https://dev.gixflow.cloud/api/export-detailed-pdf",{params:{year:e.year,month:e.month},responseType:"blob",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),o=new Blob([t.data],{type:"application/pdf"}),a=window.URL.createObjectURL(o),l=document.createElement("a");l.href=a,l.download=`Provvigioni_${e.year}_${e.month}.pdf`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(a)}catch(t){console.error("Errore nel download del PDF:",t),alert("❌ Errore nella generazione del PDF!")}},toggleMonthDetails(e){this.isSelectedMonth(e)?(this.selectedMonth=null,this.resetSelections()):(this.selectedMonth={...e},this.resetSelections(),this.fetchAgents())},toggleAgentDetails(e){this.isSelectedAgent(e)?(this.selectedAgent=null,this.contractsDetails=[],this.selectedContract=null):(this.selectedAgent=e,this.contractsDetails=[],this.selectedContract=null,this.fetchContracts(e))},toggleContractDetails(e){this.isSelectedContract(e)?this.selectedContract=null:(this.selectedContract=e,this.fetchContractDetailsComm(e))},resetSelections(){this.agentDetails=[],this.selectedAgent=null,this.contractsDetails=[],this.selectedContract=null},isSelectedMonth(e){return this.selectedMonth?.year===e.year&&this.selectedMonth?.month===e.month},isSelectedAgent(e){return this.selectedAgent?.agent_id===e.agent_id},isSelectedContract(e){return this.selectedContract?.contract_id===e.contract_id},getMonthName(e){return this.months[e-1]||e},formatDate(e){return e?new Date(e).toLocaleDateString("it-IT"):"N/A"},formatCurrency(e){return e?parseFloat(e).toFixed(2)+" €":"N/A"},changePage(e){"next"===e&&this.currentPage<this.totalPages?this.currentPage++:"prev"===e&&this.currentPage>1&&this.currentPage--}},created(){this.fetchMonths()}};const Fc=(0,x.A)(xc,[["render",Sc],["__scopeId","data-v-56fe02e2"]]);var Mc=Fc,Vc={components:{CommAgVendors:wr,CommAgProducts:Yr,CommAgPrices:bd,CommAgAdj:qd,CommAgGen:ac,CommAgArch:Mc},data(){return{selectedTab:"CommAgVendors",tabs:[{name:"CommAgVendors",label:"Vendors",icon:"fas fa-building"},{name:"CommAgProducts",label:"Prodotti",icon:"fas fa-box"},{name:"CommAgPrices",label:"Provvigioni",icon:"fas fa-percent"},{name:"CommAgAdj",label:"Altri elementi",icon:"fas fa-cogs"},{name:"CommAgGen",label:"Genera consuntivi",icon:"fas fa-coins"},{name:"CommAgArch",label:"Archivio consuntivi",icon:"fas fa-coins"}]}}};const Uc=(0,x.A)(Vc,[["render",or],["__scopeId","data-v-4e5ac46e"]]);var Ic=Uc;const Oc={class:"header"},Xc={class:"actions"},Tc={class:"in-grid-blue"},$c={class:"fa-solid fa-question icon-tip"},zc={class:"tab-container"},Rc=["onClick"],Wc={class:"tab-content"};function Nc(e,t,o,a,i,s){const r=(0,l.gN)("tippy");return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.Lk)("div",Oc,[t[0]||(t[0]=(0,l.Lk)("h1",null,[(0,l.Lk)("i",{class:"fa-solid fa-money-check icon-green"}),(0,l.eW)("Commissioning Operatori ")],-1)),(0,l.Lk)("div",Xc,[(0,l.Lk)("button",Tc,[(0,l.bo)((0,l.Lk)("i",$c,null,512),[[r,{content:i.tooltipText,allowHTML:!0,maxWidth:"450px"}]])])])]),(0,l.Lk)("div",zc,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.tabs,(e=>((0,l.uX)(),(0,l.CE)("div",{key:e.name,class:(0,n.C4)(["tab-item",{active:i.selectedTab===e.name}]),onClick:t=>i.selectedTab=e.name},[(0,l.Lk)("i",{class:(0,n.C4)(e.icon)},null,2),(0,l.Lk)("span",null,(0,n.v_)(e.label),1)],10,Rc)))),128))]),(0,l.Lk)("div",Wc,[((0,l.uX)(),(0,l.Wv)((0,l.$y)(i.selectedTab)))])])}const jc={class:"config-container"},Bc={class:"table"},qc=["onUpdate:modelValue"],Kc=["onClick"],Yc={key:0,class:"check-icon"};function Jc(e,t,o,i,s,r){return(0,l.uX)(),(0,l.CE)("div",null,[t[1]||(t[1]=(0,l.Lk)("div",{class:"header"},[(0,l.Lk)("h3",null,[(0,l.Lk)("i",{class:"fa-solid fa-asterisk icon-green"}),(0,l.eW)("Configurazioni Asterisk")])],-1)),(0,l.Lk)("div",jc,[(0,l.Lk)("table",Bc,[t[0]||(t[0]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Parametro"),(0,l.Lk)("th",null,"Valore"),(0,l.Lk)("th",null,"Azioni")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.configurations,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.key_name},[(0,l.Lk)("td",null,(0,n.v_)(e.key_name),1),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t=>e.value=t,type:"text"},null,8,qc),[[a.Jo,e.value]])]),(0,l.Lk)("td",null,[(0,l.Lk)("button",{onClick:t=>r.saveConfig(e)},"Salva",8,Kc),e.saved?((0,l.uX)(),(0,l.CE)("span",Yc,"✔️")):(0,l.Q3)("",!0)])])))),128))])])])])}var Qc={data(){return{configurations:[],operators:[]}},methods:{async fetchConfig(){try{const{data:e}=await P.A.get("https://dev.gixflow.cloud/api/ast/config");this.configurations=e.map((e=>({...e,saved:!1})))}catch(e){console.error("Errore nel recupero delle configurazioni:",e)}},async saveConfig(e){try{await P.A.post("https://dev.gixflow.cloud/api/ast/config",{key_name:e.key_name,value:e.value}),e.saved=!0,setTimeout((()=>e.saved=!1),2e3)}catch(t){console.error("Errore nel salvataggio:",t)}},formatDate(e){return e?new Date(e).toLocaleDateString("it-IT"):"N/D"}},async created(){await this.fetchConfig()}};const Gc=(0,x.A)(Qc,[["render",Jc]]);var Hc=Gc;const Zc={class:"auto-generate-row"},eu={class:"checkbox-label"},tu={key:0,class:"time-label"},ou={class:"manual-generate"},au=["value"],lu=["disabled"],nu={key:0},iu={key:1,class:"table"},su={key:2,style:{"margin-top":"20px",background:"#f4f4f4",padding:"10px","border-radius":"5px"}},ru={key:3,class:"actions"},du=["disabled"];function cu(e,t,o,i,s,r){return(0,l.uX)(),(0,l.CE)(l.FK,null,[t[17]||(t[17]=(0,l.Lk)("div",{class:"header"},[(0,l.Lk)("h3",null,[(0,l.Lk)("i",{class:"fa-solid fa-calendar-days icon-green"}),(0,l.eW)("Imposta Generazione Automatica")]),(0,l.Lk)("div",{class:"actions"})],-1)),(0,l.Lk)("div",Zc,[(0,l.Lk)("label",eu,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=e=>s.autoGenerateEnabled=e),class:"big-checkbox"},null,512),[[a.lH,s.autoGenerateEnabled]]),t[9]||(t[9]=(0,l.Lk)("span",null,"Abilita Generazione Automatica",-1))]),s.autoGenerateEnabled?((0,l.uX)(),(0,l.CE)("label",tu,[t[10]||(t[10]=(0,l.eW)(" Orario di esecuzione: ")),(0,l.bo)((0,l.Lk)("input",{type:"time","onUpdate:modelValue":t[1]||(t[1]=e=>s.autoGenerateTime=e),class:"time-input"},null,512),[[a.Jo,s.autoGenerateTime]])])):(0,l.Q3)("",!0),(0,l.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>r.saveAutoGenerateSettings&&r.saveAutoGenerateSettings(...e)),class:"saveITEM-button"}," Salva ")]),t[18]||(t[18]=(0,l.Lk)("pre",null,"Tramite questo strumento è possibile schedulare la sincronizzazione automatica da Asterisk. Essa verrà eseguita per tutte le sedi disponibili.",-1)),t[19]||(t[19]=(0,l.Lk)("hr",{class:"section-divider"},null,-1)),(0,l.Lk)("div",null,[t[16]||(t[16]=(0,l.Lk)("h3",null,[(0,l.Lk)("i",{class:"fa-solid fa-clock icon-green"}),(0,l.eW)("Genera Ore da Asterisk")],-1)),(0,l.Lk)("div",ou,[(0,l.Lk)("label",null,[t[11]||(t[11]=(0,l.eW)(" Dal: ")),(0,l.bo)((0,l.Lk)("input",{type:"date","onUpdate:modelValue":t[3]||(t[3]=e=>s.startDate=e),class:"input"},null,512),[[a.Jo,s.startDate]])]),(0,l.Lk)("label",null,[t[12]||(t[12]=(0,l.eW)(" Al: ")),(0,l.bo)((0,l.Lk)("input",{type:"date","onUpdate:modelValue":t[4]||(t[4]=e=>s.endDate=e),class:"input"},null,512),[[a.Jo,s.endDate]])]),(0,l.Lk)("label",null,[t[14]||(t[14]=(0,l.eW)(" Sede: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>s.selectedLocation=e)},[t[13]||(t[13]=(0,l.Lk)("option",{value:""},"Tutte",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.locations,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.location),9,au)))),128))],512),[[a.u1,s.selectedLocation]])]),(0,l.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>r.generatePreview&&r.generatePreview(...e)),disabled:s.loading,class:"saveITEM-button"}," Genera Anteprima ",8,lu)]),s.loading?((0,l.uX)(),(0,l.CE)("p",nu,"Caricamento in corso...")):(0,l.Q3)("",!0),s.hours.length>0?((0,l.uX)(),(0,l.CE)("table",iu,[t[15]||(t[15]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Operatore"),(0,l.Lk)("th",null,"Chiamate"),(0,l.Lk)("th",null,"Login (h)"),(0,l.Lk)("th",null,"Attesa (h)"),(0,l.Lk)("th",null,"Parlato (h)"),(0,l.Lk)("th",null,"Dispo (h)"),(0,l.Lk)("th",null,"Pausa (h)")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.hours,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.user_id},[(0,l.Lk)("td",null,(0,n.v_)(e.operator_name||"Sconosciuto"),1),(0,l.Lk)("td",null,(0,n.v_)(e.calls),1),(0,l.Lk)("td",null,(0,n.v_)(e.login)+" h",1),(0,l.Lk)("td",null,(0,n.v_)(e.wait)+" h",1),(0,l.Lk)("td",null,(0,n.v_)(e.talk)+" h",1),(0,l.Lk)("td",null,(0,n.v_)(e.dispo)+" h",1),(0,l.Lk)("td",null,(0,n.v_)(e.pause)+" h",1)])))),128))])])):(0,l.Q3)("",!0),s.feedbackDetails?((0,l.uX)(),(0,l.CE)("pre",su,"  "+(0,n.v_)(s.feedbackDetails)+"\n",1)):(0,l.Q3)("",!0),s.hours.length>0?((0,l.uX)(),(0,l.CE)("div",ru,[(0,l.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>r.saveHours&&r.saveHours(...e)),disabled:!s.canSave||s.saving,class:"saveITEM-button"}," Salva Ore ",8,du),(0,l.Lk)("button",{onClick:t[8]||(t[8]=(...e)=>r.resetPreview&&r.resetPreview(...e)),class:"resetITEM-button"},"Reset")])):(0,l.Q3)("",!0)])],64)}var uu={data(){return{startDate:(new Date).toISOString().split("T")[0],endDate:(new Date).toISOString().split("T")[0],hours:[],loading:!1,saving:!1,canSave:!1,feedbackDetails:"",selectedLocation:"",locations:[],autoGenerateEnabled:!1,autoGenerateTime:"03:00"}},methods:{async generatePreview(){this.loading=!0,this.hours=[],this.canSave=!1;try{const{data:e}=await P.A.post("https://dev.gixflow.cloud/api/ast/fetch-timelogs",{start_date:this.startDate,end_date:this.endDate,location_id:this.selectedLocation});Array.isArray(e)&&e.length>0?(this.hours=e,this.canSave=!0):this.$toast.show("Nessun dato disponibile per l'intervallo selezionato.",{type:"error"})}catch(e){this.$toast.show("Errore nel recupero dei dati.",{type:"error"})}finally{this.loading=!1}},async saveHours(){if(this.canSave&&0!==this.hours.length){this.saving=!0;try{const e=await P.A.post("https://dev.gixflow.cloud/api/ast/save-hours",{hours:this.hours});this.$toast.show("Ore salvate con successo.",{type:"success"}),this.resetPreview();const{inserted:t=[],skipped:o=[]}=e.data;if(o.length>0){const e=o.sort(((e,t)=>(e.date+e.user_id).localeCompare(t.date+t.user_id))).map((e=>`- Utente ID ${e.user_id}, Data ${e.date}`)).join("\n");this.feedbackDetails=`\n✅ Salvati ${t.length} record.\n⚠️ Ignorati ${o.length} già presenti:\n${e}\n      `}else this.feedbackDetails=`✅ Tutti i ${t.length} timelog sono stati salvati.`}catch(e){this.$toast.show("Errore nel salvataggio.",{type:"error"})}finally{this.saving=!1}}else this.$toast.show("Nessun dato da salvare.",{type:"error"})},resetPreview(){this.hours=[],this.canSave=!1},async fetchLocations(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/locations-table");this.locations=Array.isArray(e.data)?e.data:[]}catch(e){console.error("Errore nel recupero delle sedi",e)}},async saveAutoGenerateSettings(){try{await P.A.post("https://dev.gixflow.cloud/api/settings/update",{key_name:"auto_generate_timelog",value:JSON.stringify({enabled:this.autoGenerateEnabled,time:this.autoGenerateTime})}),this.$toast.show("Impostazioni aggiornate con successo.",{position:"bottom-right",duration:5e3,type:"success"})}catch(e){this.$toast.show("Errore nell'aggiornamento delle impostazioni.",{position:"bottom-right",duration:5e3,type:"error"})}},async loadAutoGenerateSettings(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/settings/get?key=auto_generate_timelog");if(e.data.value){const t=JSON.parse(e.data.value);this.autoGenerateEnabled=t.enabled,this.autoGenerateTime=t.time}}catch(e){console.error("Errore nel caricamento delle impostazioni")}}},mounted(){this.loadAutoGenerateSettings(),this.loadAutoGenerateSettings(),this.fetchLocations()}};const pu=(0,x.A)(uu,[["render",cu],["__scopeId","data-v-18e80884"]]);var hu=pu;const mu={class:"filters"},gu=["value"],ku=["value"],fu={class:"table"},Lu=["onUpdate:modelValue"],vu=["onUpdate:modelValue"],bu=["onUpdate:modelValue"],yu=["onUpdate:modelValue"],_u=["onUpdate:modelValue"],Cu=["onUpdate:modelValue"],wu=["onClick"],Au={class:"pagination"},Eu=["disabled"],Pu=["onClick"],Du=["disabled"];function Su(e,t,o,i,s,r){return(0,l.uX)(),(0,l.CE)("div",null,[t[16]||(t[16]=(0,l.Lk)("div",{class:"header"},[(0,l.Lk)("h3",null,[(0,l.Lk)("i",{class:"fa-solid fa-pen icon-green"}),(0,l.eW)("Correzioni manuali")])],-1)),(0,l.Lk)("div",mu,[(0,l.Lk)("label",null,[t[7]||(t[7]=(0,l.eW)("Data Inizio: ")),(0,l.bo)((0,l.Lk)("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=e=>s.startDate=e)},null,512),[[a.Jo,s.startDate]])]),(0,l.Lk)("label",null,[t[8]||(t[8]=(0,l.eW)("Data Fine: ")),(0,l.bo)((0,l.Lk)("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=e=>s.endDate=e)},null,512),[[a.Jo,s.endDate]])]),(0,l.Lk)("label",null,[t[10]||(t[10]=(0,l.eW)(" Sede: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>s.selectedLocation=e)},[t[9]||(t[9]=(0,l.Lk)("option",{value:""},"Tutte",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.locations,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.location),9,gu)))),128))],512),[[a.u1,s.selectedLocation]])]),(0,l.Lk)("label",null,[t[12]||(t[12]=(0,l.eW)("Operatore: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>s.selectedUser=e)},[t[11]||(t[11]=(0,l.Lk)("option",{value:""},"Tutti",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.users,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.cognome)+" "+(0,n.v_)(e.nome),9,ku)))),128))],512),[[a.u1,s.selectedUser]])]),(0,l.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>r.fetchTimelogs&&r.fetchTimelogs(...e)),class:"btn primary"},"Filtra")]),(0,l.Lk)("table",fu,[t[13]||(t[13]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Operatore"),(0,l.Lk)("th",null,"Sede"),(0,l.Lk)("th",null,"Data"),(0,l.Lk)("th",null,"Chiamate"),(0,l.Lk)("th",null,"Login (h)"),(0,l.Lk)("th",null,"Attesa (h)"),(0,l.Lk)("th",null,"Parlato (h)"),(0,l.Lk)("th",null,"Dispo (h)"),(0,l.Lk)("th",null,"Pausa (h)"),(0,l.Lk)("th",null,"Azioni")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.timelogs,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id},[(0,l.Lk)("td",null,(0,n.v_)(e.cognome)+" "+(0,n.v_)(e.nome),1),(0,l.Lk)("td",null,(0,n.v_)(e.location_name||"—"),1),(0,l.Lk)("td",null,(0,n.v_)(r.formatDate(e.date)),1),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("input",{type:"number","onUpdate:modelValue":t=>e.calls=t},null,8,Lu),[[a.Jo,e.calls,void 0,{number:!0}]])]),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("input",{type:"number","onUpdate:modelValue":t=>e.login=t},null,8,vu),[[a.Jo,e.login,void 0,{number:!0}]])]),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("input",{type:"number","onUpdate:modelValue":t=>e.wait=t},null,8,bu),[[a.Jo,e.wait,void 0,{number:!0}]])]),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("input",{type:"number","onUpdate:modelValue":t=>e.talk=t},null,8,yu),[[a.Jo,e.talk,void 0,{number:!0}]])]),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("input",{type:"number","onUpdate:modelValue":t=>e.dispo=t},null,8,_u),[[a.Jo,e.dispo,void 0,{number:!0}]])]),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("input",{type:"number","onUpdate:modelValue":t=>e.pause=t},null,8,Cu),[[a.Jo,e.pause,void 0,{number:!0}]])]),(0,l.Lk)("td",null,[(0,l.Lk)("button",{onClick:t=>r.updateTimelog(e),class:"in-grid"},"Salva",8,wu)])])))),128))])]),(0,l.Lk)("div",Au,[(0,l.Lk)("button",{disabled:1===s.currentPage,onClick:t[5]||(t[5]=(...e)=>r.prevPage&&r.prevPage(...e))},t[14]||(t[14]=[(0,l.Lk)("i",{class:"fa-solid fa-backward-step"},null,-1)]),8,Eu),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.totalPages,(e=>((0,l.uX)(),(0,l.CE)("span",{key:e},[(0,l.Lk)("button",{class:(0,n.C4)({active:e===s.currentPage}),onClick:t=>r.changePage(e)},(0,n.v_)(e),11,Pu)])))),128)),(0,l.Lk)("button",{disabled:s.currentPage===s.totalPages,onClick:t[6]||(t[6]=(...e)=>r.nextPage&&r.nextPage(...e))},t[15]||(t[15]=[(0,l.Lk)("i",{class:"fa-solid fa-forward-step"},null,-1)]),8,Du)])])}var xu={data(){return{startDate:(new Date).toISOString().split("T")[0],endDate:(new Date).toISOString().split("T")[0],selectedUser:"",selectedLocation:"",locations:[],users:[],timelogs:[],limit:10,totalPages:1,currentPage:1}},methods:{async fetchTimelogs(){try{const{data:e}=await P.A.get("https://dev.gixflow.cloud/api/ast/timelogs",{params:{startDate:this.startDate,endDate:this.endDate,userId:this.selectedUser,locationId:this.selectedLocation,page:this.currentPage,limit:this.limit}});this.timelogs=e.data,this.totalPages=e.totalPages}catch(e){alert("Errore nel recupero dei timelog.")}},async fetchUsers(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/users"),t=Array.isArray(e.data)?e.data.flat():[];this.users=t.filter((e=>1===e.role_id))}catch(e){this.$toast.show("Errore durante il caricamento degli operatori.",{position:"bottom-right",duration:5e3,type:"error"})}},async fetchLocations(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/locations-table");this.locations=Array.isArray(e.data)?e.data:[]}catch(e){console.error("Errore nel recupero delle sedi",e)}},async updateTimelog(e){try{await P.A.put(`https://dev.gixflow.cloud/api/ast/timelogs/${e.id}`,{calls:e.calls,login:e.login,wait:e.wait,talk:e.talk,dispo:e.dispo,pause:e.pause}),alert("Timelog aggiornato con successo!")}catch(t){alert("Errore nell'aggiornamento del timelog.")}},changePage(e){e!==this.currentPage&&(this.currentPage=e,this.fetchTimelogs())},prevPage(){this.currentPage>1&&(this.currentPage--,this.fetchTimelogs())},nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.fetchTimelogs())},formatDate(e){if(!e)return"";const t=new Date(e),o=String(t.getDate()).padStart(2,"0"),a=String(t.getMonth()+1).padStart(2,"0"),l=t.getFullYear();return`${o}/${a}/${l}`}},mounted(){this.fetchUsers(),this.fetchTimelogs(),this.fetchLocations()}};const Fu=(0,x.A)(xu,[["render",Su]]);var Mu=Fu;const Vu={class:"filters"},Uu=["value"],Iu=["value"],Ou={key:0},Xu={key:1,class:"table"},Tu={class:"totals-row"},$u={key:2,class:"pagination"},zu=["disabled"],Ru=["onClick"],Wu=["disabled"];function Nu(e,t,o,i,s,r){return(0,l.uX)(),(0,l.CE)("div",null,[t[17]||(t[17]=(0,l.Lk)("div",{class:"header"},[(0,l.Lk)("h3",null,[(0,l.Lk)("i",{class:"fa-solid fa-box-open icon-green"}),(0,l.eW)("Archivio Consuntivi")])],-1)),(0,l.Lk)("div",Vu,[(0,l.Lk)("label",null,[t[7]||(t[7]=(0,l.eW)("Data Inizio: ")),(0,l.bo)((0,l.Lk)("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=e=>s.startDate=e)},null,512),[[a.Jo,s.startDate]])]),(0,l.Lk)("label",null,[t[8]||(t[8]=(0,l.eW)("Data Fine: ")),(0,l.bo)((0,l.Lk)("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=e=>s.endDate=e)},null,512),[[a.Jo,s.endDate]])]),(0,l.Lk)("label",null,[t[10]||(t[10]=(0,l.eW)("Sede: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>s.selectedLocation=e)},[t[9]||(t[9]=(0,l.Lk)("option",{value:""},"Tutte",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.locations,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.location),9,Uu)))),128))],512),[[a.u1,s.selectedLocation]])]),(0,l.Lk)("label",null,[t[12]||(t[12]=(0,l.eW)("Operatore: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>s.selectedUser=e)},[t[11]||(t[11]=(0,l.Lk)("option",{value:""},"Tutti",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.users,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.cognome)+" "+(0,n.v_)(e.nome),9,Iu)))),128))],512),[[a.u1,s.selectedUser]])]),(0,l.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>r.fetchTimelogs&&r.fetchTimelogs(...e)),class:"btn primary"},"Cerca")]),s.loading?((0,l.uX)(),(0,l.CE)("p",Ou,"Caricamento in corso...")):(0,l.Q3)("",!0),s.timelogs.length>0?((0,l.uX)(),(0,l.CE)("table",Xu,[t[14]||(t[14]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Operatore"),(0,l.Lk)("th",null,"Sede"),(0,l.Lk)("th",null,"Chiamate"),(0,l.Lk)("th",null,"Login (h)"),(0,l.Lk)("th",null,"Attesa (h)"),(0,l.Lk)("th",null,"Parlato (h)"),(0,l.Lk)("th",null,"Dispo (h)"),(0,l.Lk)("th",null,"Pausa (h)")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.timelogs,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.user_id},[(0,l.Lk)("td",null,(0,n.v_)(e.cognome)+" "+(0,n.v_)(e.nome),1),(0,l.Lk)("td",null,(0,n.v_)(e.location_name),1),(0,l.Lk)("td",null,(0,n.v_)(e.calls),1),(0,l.Lk)("td",null,(0,n.v_)(Number(e.login).toFixed(2)),1),(0,l.Lk)("td",null,(0,n.v_)(Number(e.wait).toFixed(2)),1),(0,l.Lk)("td",null,(0,n.v_)(Number(e.talk).toFixed(2)),1),(0,l.Lk)("td",null,(0,n.v_)(Number(e.dispo).toFixed(2)),1),(0,l.Lk)("td",null,(0,n.v_)(Number(e.pause).toFixed(2)),1)])))),128))]),(0,l.Lk)("tfoot",null,[(0,l.Lk)("tr",Tu,[t[13]||(t[13]=(0,l.Lk)("td",{colspan:"2"},[(0,l.Lk)("strong",null,"Totali")],-1)),(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,(0,n.v_)(r.totals.calls),1)]),(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,(0,n.v_)(r.totals.login.toFixed(2)),1)]),(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,(0,n.v_)(r.totals.wait.toFixed(2)),1)]),(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,(0,n.v_)(r.totals.talk.toFixed(2)),1)]),(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,(0,n.v_)(r.totals.dispo.toFixed(2)),1)]),(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,(0,n.v_)(r.totals.pause.toFixed(2)),1)])])])])):(0,l.Q3)("",!0),s.totalPages>1?((0,l.uX)(),(0,l.CE)("div",$u,[(0,l.Lk)("button",{disabled:1===s.currentPage,onClick:t[5]||(t[5]=(...e)=>r.prevPage&&r.prevPage(...e))},t[15]||(t[15]=[(0,l.Lk)("i",{class:"fa-solid fa-backward-step"},null,-1)]),8,zu),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.totalPages,(e=>((0,l.uX)(),(0,l.CE)("span",{key:e},[(0,l.Lk)("button",{class:(0,n.C4)({active:e===s.currentPage}),onClick:t=>r.changePage(e)},(0,n.v_)(e),11,Ru)])))),128)),(0,l.Lk)("button",{disabled:s.currentPage===s.totalPages,onClick:t[6]||(t[6]=(...e)=>r.nextPage&&r.nextPage(...e))},t[16]||(t[16]=[(0,l.Lk)("i",{class:"fa-solid fa-forward-step"},null,-1)]),8,Wu)])):(0,l.Q3)("",!0)])}var ju={data(){return{startDate:(new Date).toISOString().split("T")[0],endDate:(new Date).toISOString().split("T")[0],selectedUser:"",users:[],selectedLocation:"",locations:[],timelogs:[],loading:!1,currentPage:1,limit:10,totalPages:1}},methods:{async fetchUsers(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/users"),t=Array.isArray(e.data)?e.data.flat():[];this.users=t.filter((e=>1===e.role_id))}catch(e){this.$toast.show("Errore durante il caricamento degli operatori.",{position:"bottom-right",duration:5e3,type:"error"})}},async fetchLocations(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/locations-table");this.locations=Array.isArray(e.data)?e.data:[]}catch(e){console.error("Errore nel recupero delle sedi",e)}},async fetchTimelogs(){this.loading=!0;try{const{data:e}=await P.A.get("https://dev.gixflow.cloud/api/ast/timelogs/summary",{params:{startDate:this.startDate,endDate:this.endDate,userId:this.selectedUser,locationId:this.selectedLocation}});this.timelogs=e.map((e=>({...e,calls:Number(e.calls)||0,login:Number(e.login)||0,wait:Number(e.wait)||0,talk:Number(e.talk)||0,dispo:Number(e.dispo)||0,pause:Number(e.pause)||0})))}catch(e){alert("Errore nel recupero dei consuntivi.")}finally{this.loading=!1}},changePage(e){e!==this.currentPage&&(this.currentPage=e,this.fetchTimelogs())},prevPage(){this.currentPage>1&&(this.currentPage--,this.fetchTimelogs())},nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.fetchTimelogs())},formatDate(e){if(!e)return"";const t=new Date(e);return`${String(t.getDate()).padStart(2,"0")}/${String(t.getMonth()+1).padStart(2,"0")}/${t.getFullYear()}`}},computed:{totals(){return this.timelogs.reduce(((e,t)=>(e.calls+=t.calls,e.login+=t.login,e.wait+=t.wait,e.talk+=t.talk,e.dispo+=t.dispo,e.pause+=t.pause,e)),{calls:0,login:0,wait:0,talk:0,dispo:0,pause:0})}},mounted(){this.fetchUsers(),this.fetchTimelogs(),this.fetchLocations()}};const Bu=(0,x.A)(ju,[["render",Nu],["__scopeId","data-v-72194da6"]]);var qu=Bu;const Ku={class:"header"},Yu={class:"actions"},Ju={class:"filters"},Qu=["value"],Gu=["value"],Hu={class:"switch"},Zu={class:"table"},ep={key:0},tp=["onClick"],op=["onClick"],ap=["onClick","title"],lp={key:0,class:"fas fa-undo","aria-hidden":"true"},np={key:1,class:"fa fa-archive","aria-hidden":"true"},ip={class:"pagination"},sp=["disabled"],rp=["onClick"],dp=["disabled"],cp={key:0,class:"modal-overlay"},up={class:"modal-content"},pp=["disabled"],hp=["disabled"],mp=["disabled"],gp=["disabled"],kp={class:"modal-buttons"};function fp(e,t,o,i,s,r){return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.Lk)("div",Ku,[t[18]||(t[18]=(0,l.Lk)("h3",null,[(0,l.Lk)("i",{class:"fa-solid fa-trophy icon-green"}),(0,l.eW)("Gestione Bonus Operatori")],-1)),(0,l.Lk)("div",Yu,[(0,l.Lk)("button",{class:"create-button",onClick:t[0]||(t[0]=e=>r.openModal(null))},"+")])]),(0,l.Lk)("div",Ju,[(0,l.Lk)("label",null,[t[19]||(t[19]=(0,l.eW)(" Anno: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>s.filterYear=e)},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.availableYears,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,n.v_)(e),9,Qu)))),128))],512),[[a.u1,s.filterYear]])]),(0,l.Lk)("label",null,[t[20]||(t[20]=(0,l.eW)(" Mese: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>s.filterMonth=e)},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.months,((e,t)=>((0,l.uX)(),(0,l.CE)("option",{key:t,value:t+1},(0,n.v_)(e),9,Gu)))),128))],512),[[a.u1,s.filterMonth]])]),(0,l.Lk)("label",Hu,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>s.showArchived=e),onChange:t[4]||(t[4]=(...e)=>r.fetchBonuses&&r.fetchBonuses(...e))},null,544),[[a.lH,s.showArchived]]),t[21]||(t[21]=(0,l.Lk)("span",{class:"slider"},null,-1))]),t[22]||(t[22]=(0,l.Lk)("span",null,"Mostra archiviate",-1)),(0,l.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>r.resetFilters&&r.resetFilters(...e))},"Reset")]),(0,l.Lk)("table",Zu,[t[26]||(t[26]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Tipo Gara"),(0,l.Lk)("th",null,"Min Appuntamenti"),(0,l.Lk)("th",null,"Min Appuntamenti Positivi"),(0,l.Lk)("th",null,"Min Ore"),(0,l.Lk)("th",null,"% Min Conversione"),(0,l.Lk)("th",null,"Bonus (€)"),(0,l.Lk)("th",null,"Validità"),(0,l.Lk)("th",null,"Stato"),(0,l.Lk)("th",null,"Azioni")])],-1)),(0,l.Lk)("tbody",null,[0===r.paginatedBonuses.length?((0,l.uX)(),(0,l.CE)("tr",ep,t[23]||(t[23]=[(0,l.Lk)("td",{colspan:"9",class:"no-results"},"Nessun bonus trovato",-1)]))):(0,l.Q3)("",!0),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.paginatedBonuses,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id,class:(0,n.C4)({"archived-row":e.is_archived})},[(0,l.Lk)("td",null,(0,n.v_)(e.rule_type),1),(0,l.Lk)("td",null,(0,n.v_)(e.min_appointments||"-"),1),(0,l.Lk)("td",null,(0,n.v_)(e.min_positive_appointments||"-"),1),(0,l.Lk)("td",null,(0,n.v_)(e.min_hours||"-"),1),(0,l.Lk)("td",null,(0,n.v_)(e.min_conversion?e.min_conversion+"%":"-"),1),(0,l.Lk)("td",null,(0,n.v_)(e.bonus_amount),1),(0,l.Lk)("td",null,(0,n.v_)(r.formatDate(e.valid_from))+" → "+(0,n.v_)(r.formatDate(e.valid_to)),1),(0,l.Lk)("td",null,[(0,l.Lk)("span",{class:(0,n.C4)({archived:e.is_archived})},(0,n.v_)(e.is_archived?"Archiviato":"Attivo"),3)]),(0,l.Lk)("td",null,[(0,l.Lk)("button",{class:"in-grid",onClick:t=>r.openEditModal(e),title:"Modifica Bonus"},t[24]||(t[24]=[(0,l.Lk)("i",{class:"fa-duotone fa-solid fa-pen"},null,-1)]),8,tp),(0,l.Lk)("button",{class:"in-grid-red",onClick:t=>r.deleteBonus(e.id),title:"Cancella Bonus"},t[25]||(t[25]=[(0,l.Lk)("i",{class:"fa-duotone fa-solid fa-trash"},null,-1)]),8,op),(0,l.Lk)("button",{class:"in-grid-blue",onClick:t=>r.toggleArchive(e),title:e.is_archived?"Ripristina Bonus":"Archivia Bonus"},[e.is_archived?((0,l.uX)(),(0,l.CE)("i",lp)):((0,l.uX)(),(0,l.CE)("i",np))],8,ap)])],2)))),128))])]),(0,l.Lk)("div",ip,[(0,l.Lk)("button",{disabled:1===s.currentPage,onClick:t[6]||(t[6]=e=>r.changePage(s.currentPage-1))},t[27]||(t[27]=[(0,l.Lk)("i",{class:"fa-solid fa-backward-step"},null,-1)]),8,sp),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.totalPages,(e=>((0,l.uX)(),(0,l.CE)("span",{key:e},[(0,l.Lk)("button",{class:(0,n.C4)({active:e===s.currentPage}),onClick:t=>r.changePage(e)},(0,n.v_)(e),11,rp)])))),128)),(0,l.Lk)("button",{disabled:s.currentPage===r.totalPages,onClick:t[7]||(t[7]=e=>r.changePage(s.currentPage+1))},t[28]||(t[28]=[(0,l.Lk)("i",{class:"fa-solid fa-forward-step"},null,-1)]),8,dp)]),s.showModal?((0,l.uX)(),(0,l.CE)("div",cp,[(0,l.Lk)("div",up,[(0,l.Lk)("h2",null,(0,n.v_)(s.isEditing?"Modifica Bonus":"Nuovo Bonus"),1),(0,l.Lk)("label",null,[t[30]||(t[30]=(0,l.eW)("Tipo Gara: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>s.currentBonus.rule_type=e)},t[29]||(t[29]=[(0,l.Lk)("option",{value:"positivi"},"Numero Appuntamenti",-1),(0,l.Lk)("option",{value:"appuntamenti_positivi"}," Numero Appuntamenti Positivi ",-1),(0,l.Lk)("option",{value:"resa_oraria"},"Resa Oraria",-1),(0,l.Lk)("option",{value:"mix"},"Mix di criteri",-1)]),512),[[a.u1,s.currentBonus.rule_type]])]),(0,l.Lk)("label",null,[t[31]||(t[31]=(0,l.eW)("Min Appuntamenti: ")),(0,l.bo)((0,l.Lk)("input",{type:"number","onUpdate:modelValue":t[9]||(t[9]=e=>s.currentBonus.min_appointments=e),disabled:!r.enableMinAppointments},null,8,pp),[[a.Jo,s.currentBonus.min_appointments]])]),(0,l.Lk)("label",null,[t[32]||(t[32]=(0,l.eW)("Numero Appuntamenti Positivi: ")),(0,l.bo)((0,l.Lk)("input",{type:"number","onUpdate:modelValue":t[10]||(t[10]=e=>s.currentBonus.min_positive_appointments=e),disabled:!r.enableMinPositiveAppointments},null,8,hp),[[a.Jo,s.currentBonus.min_positive_appointments]])]),(0,l.Lk)("label",null,[t[33]||(t[33]=(0,l.eW)("Min Ore: ")),(0,l.bo)((0,l.Lk)("input",{type:"number","onUpdate:modelValue":t[11]||(t[11]=e=>s.currentBonus.min_hours=e),disabled:!r.enableMinHours},null,8,mp),[[a.Jo,s.currentBonus.min_hours]])]),(0,l.Lk)("label",null,[t[34]||(t[34]=(0,l.eW)("% Min Conversione: ")),(0,l.bo)((0,l.Lk)("input",{type:"number",step:"0.1","onUpdate:modelValue":t[12]||(t[12]=e=>s.currentBonus.min_conversion=e),disabled:!r.enableMinConversion},null,8,gp),[[a.Jo,s.currentBonus.min_conversion]])]),(0,l.Lk)("label",null,[t[35]||(t[35]=(0,l.eW)("Bonus (€): ")),(0,l.bo)((0,l.Lk)("input",{type:"number",step:"0.01","onUpdate:modelValue":t[13]||(t[13]=e=>s.currentBonus.bonus_amount=e),required:""},null,512),[[a.Jo,s.currentBonus.bonus_amount]])]),(0,l.Lk)("label",null,[t[36]||(t[36]=(0,l.eW)("Validità Inizio: ")),(0,l.bo)((0,l.Lk)("input",{type:"date","onUpdate:modelValue":t[14]||(t[14]=e=>s.currentBonus.valid_from=e)},null,512),[[a.Jo,s.currentBonus.valid_from]])]),(0,l.Lk)("label",null,[t[37]||(t[37]=(0,l.eW)("Validità Fine: ")),(0,l.bo)((0,l.Lk)("input",{type:"date","onUpdate:modelValue":t[15]||(t[15]=e=>s.currentBonus.valid_to=e)},null,512),[[a.Jo,s.currentBonus.valid_to]])]),(0,l.Lk)("div",kp,[(0,l.Lk)("button",{class:"close-button",onClick:t[16]||(t[16]=(...e)=>r.closeModal&&r.closeModal(...e))},"Annulla"),(0,l.Lk)("button",{onClick:t[17]||(t[17]=e=>s.isEditing?r.updateBonus():r.saveBonus())}," Salva ")])])])):(0,l.Q3)("",!0)])}var Lp={data(){return{bonuses:[],filterStartDate:"",filterEndDate:"",filterYear:(new Date).getFullYear(),filterMonth:(new Date).getMonth()+1,availableYears:Array.from({length:5},((e,t)=>(new Date).getFullYear()-t)),months:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],showArchived:!1,showModal:!1,isEditing:!1,currentBonus:{rule_type:"positivi",min_appointments:"",min_positive_appointments:"",min_hours:"",min_conversion:"",bonus_amount:"",valid_from:(new Date).toISOString().split("T")[0],valid_to:""},currentPage:1,itemsPerPage:10}},computed:{filteredBonuses(){return this.bonuses.filter((e=>{const t=new Date(e.valid_from).getFullYear(),o=new Date(e.valid_from).getMonth()+1,a=t===this.filterYear&&o===this.filterMonth,l=this.filterStartDate?new Date(this.filterStartDate):null,n=this.filterEndDate?new Date(this.filterEndDate):null,i=new Date(e.valid_from),s=new Date(e.valid_to),r=!l||i<=l&&s>=l,d=!n||i<=n&&s>=n,c=this.showArchived||!e.is_archived;return a&&r&&d&&c}))},enableMinAppointments(){return"appuntamenti"===this.currentBonus.rule_type||"resa_oraria"===this.currentBonus.rule_type||"mix"===this.currentBonus.rule_type},enableMinPositiveAppointments(){return"appuntamenti_positivi"===this.currentBonus.rule_type||"mix"===this.currentBonus.rule_type},enableMinHours(){return"resa_oraria"===this.currentBonus.rule_type||"mix"===this.currentBonus.rule_type},enableMinConversion(){return"mix"===this.currentBonus.rule_type},paginatedBonuses(){const e=(this.currentPage-1)*this.itemsPerPage,t=e+this.itemsPerPage;return this.filteredBonuses.slice(e,t)},totalPages(){return Math.ceil(this.filteredBonuses.length/this.itemsPerPage)}},methods:{async fetchBonuses(){try{const{data:e}=await P.A.get("https://dev.gixflow.cloud/api/operators/bonus",{params:{showArchived:this.showArchived}});this.bonuses=e}catch(e){console.error("Errore nel recupero dei bonus:",e)}},async saveBonus(){if(!this.currentBonus.bonus_amount)return void this.$toast.show("Devi inserire un importo per il bonus.",{position:"bottom-right",duration:5e3,type:"error"});if(!this.currentBonus.valid_from||!this.currentBonus.valid_to)return void this.$toast.show("Devi selezionare un intervallo di validità.",{position:"bottom-right",duration:5e3,type:"error"});const e={...this.currentBonus,min_positive_appointments:this.currentBonus.min_positive_appointments||null,valid_from:this.currentBonus.valid_from.trim(),valid_to:this.currentBonus.valid_to.trim()};try{const t=this.isEditing?`https://dev.gixflow.cloud/api/operators/bonus/${this.currentBonus.id}`:"https://dev.gixflow.cloud/api/operators/bonus",o=this.isEditing?P.A.put:P.A.post;await o(t,e),this.$toast.show("Bonus salvato con successo.",{position:"bottom-right",duration:5e3,type:"success"}),this.closeModal(),this.fetchBonuses()}catch(t){this.$toast.show("Errore nel salvataggio del bonus.",{position:"bottom-right",duration:5e3,type:"error"})}},async updateBonus(){try{await P.A.put(`https://dev.gixflow.cloud/api/operators/bonus/${this.currentBonus.id}`,this.currentBonus),this.closeModal(),this.fetchBonuses()}catch(e){this.$toast.show("Errore nell'aggiornamento del bonus.",{position:"bottom-right",duration:5e3,type:"error"})}},async deleteBonus(e){if(confirm("Sei sicuro di voler eliminare questo bonus?"))try{await P.A.delete(`https://dev.gixflow.cloud/api/operators/bonus/${e}`),this.$toast.show("Bonus eliminato con successo.",{position:"bottom-right",duration:5e3,type:"success"}),this.fetchBonuses()}catch(t){console.error("Errore nell'eliminazione del bonus:",t),this.$toast.show("Errore nell'eliminazione.",{position:"bottom-right",duration:5e3,type:"error"})}},async toggleArchive(e){try{const t=e.is_archived?0:1,o=await P.A.put(`https://dev.gixflow.cloud/api/operators/bonus/${e.id}/archive`,{is_archived:t});if(200!==o.status)throw new Error("Errore nell'archiviazione.");e.is_archived=t,this.$toast.show(0===t?"Bonus ripristinato.":"Bonus archiviato.",{position:"bottom-right",duration:5e3,type:"success"})}catch(t){console.error("Errore nell'archiviazione del bonus:",t),this.$toast.show("Errore nell'operazione.",{position:"bottom-right",duration:5e3,type:"error"}),this.fetchBonuses()}},openEditModal(e){this.isEditing=!0,this.currentBonus={...e,valid_from:e.valid_from?e.valid_from.split("T")[0]:"",valid_to:e.valid_to?e.valid_to.split("T")[0]:""},this.showModal=!0},openModal(e){this.isEditing=!!e,this.currentBonus=e?{...e}:{rule_type:"appuntamenti",min_appointments:"",min_positive_appointments:"",min_hours:"",min_conversion:"",bonus_amount:"",valid_from:(new Date).toISOString().split("T")[0],valid_to:""},this.showModal=!0},closeModal(){this.showModal=!1},resetFilters(){this.filterYear=(new Date).getFullYear(),this.filterMonth=(new Date).getMonth()+1,this.fetchBonuses()},formatDate(e){return e?new Date(e).toLocaleDateString("it-IT"):"-"},changePage(e){e>0&&e<=this.totalPages&&(this.currentPage=e)}},mounted(){this.fetchBonuses()}};const vp=(0,x.A)(Lp,[["render",fp],["__scopeId","data-v-56442a94"]]);var bp=vp;const yp={class:"filters"},_p=["value"],Cp=["value"],wp=["value"],Ap={key:0},Ep={key:1,class:"table"};function Pp(e,t,o,i,s,r){return(0,l.uX)(),(0,l.CE)("div",null,[t[9]||(t[9]=(0,l.Lk)("div",{class:"header"},[(0,l.Lk)("h3",null,[(0,l.Lk)("i",{class:"fa-solid fa-money-bill icon-green"}),(0,l.eW)("Report Paghe Operatori")]),(0,l.Lk)("div",{class:"actions"})],-1)),(0,l.Lk)("div",yp,[(0,l.Lk)("label",null,[t[4]||(t[4]=(0,l.eW)("Anno: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>s.selectedYear=e)},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.years,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,n.v_)(e),9,_p)))),128))],512),[[a.u1,s.selectedYear]])]),(0,l.Lk)("label",null,[t[5]||(t[5]=(0,l.eW)("Mese: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>s.selectedMonth=e)},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.months,((e,t)=>((0,l.uX)(),(0,l.CE)("option",{key:t+1,value:t+1},(0,n.v_)(e),9,Cp)))),128))],512),[[a.u1,s.selectedMonth]])]),(0,l.Lk)("label",null,[t[7]||(t[7]=(0,l.eW)(" Sede: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>s.selectedLocation=e)},[t[6]||(t[6]=(0,l.Lk)("option",{value:""},"Tutte",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.locations,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.location),9,wp)))),128))],512),[[a.u1,s.selectedLocation]])]),(0,l.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>r.fetchPayments&&r.fetchPayments(...e))},"Calcola")]),s.loading?((0,l.uX)(),(0,l.CE)("p",Ap,"Caricamento...")):(0,l.Q3)("",!0),s.payments.length>0?((0,l.uX)(),(0,l.CE)("table",Ep,[t[8]||(t[8]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Operatore"),(0,l.Lk)("th",null,"Sede"),(0,l.Lk)("th",null,"Ore Totali"),(0,l.Lk)("th",null,"Tariffa Oraria (€)"),(0,l.Lk)("th",null,"Appuntamenti Positivi"),(0,l.Lk)("th",null,"Bonus (€)"),(0,l.Lk)("th",null,"Paga Totale (€)")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.payments,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.user_id},[(0,l.Lk)("td",null,(0,n.v_)(e.cognome)+" "+(0,n.v_)(e.nome),1),(0,l.Lk)("td",null,(0,n.v_)(e.location_name||"—"),1),(0,l.Lk)("td",null,(0,n.v_)(Number(e.ore_totali||0).toFixed(2)),1),(0,l.Lk)("td",null,(0,n.v_)(Number(e.tariffa_oraria||0).toFixed(2)),1),(0,l.Lk)("td",null,(0,n.v_)(e.appuntamenti_positivi||0),1),(0,l.Lk)("td",null,(0,n.v_)(Number(e.bonus||0).toFixed(2)),1),(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,(0,n.v_)(Number(e.paga_totale||0).toFixed(2)),1)])])))),128))])])):(0,l.Q3)("",!0)])}var Dp={data(){return{selectedYear:(new Date).getFullYear(),selectedMonth:(new Date).getMonth()+1,payments:[],loading:!1,years:this.generateYears(),months:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],selectedLocation:"",locations:[]}},methods:{async fetchPayments(){this.loading=!0;try{const{startDate:e,endDate:t}=this.getDateRange();console.log("📆 [DEBUG] Date calcolate:",{startDate:e,endDate:t});const o=await P.A.get("https://dev.gixflow.cloud/api/operators/payments",{params:{startDate:e,endDate:t,locationId:this.selectedLocation}});this.payments=o.data}catch(e){alert("Errore nel caricamento delle paghe.")}finally{this.loading=!1}},async fetchLocations(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/locations-table");this.locations=Array.isArray(e.data)?e.data:[]}catch(e){console.error("Errore nel caricamento delle sedi:",e)}},getDateRange(){const e=this.selectedYear,t=this.selectedMonth.toString().padStart(2,"0"),o=`${e}-${t}-01`,a=new Date(e,this.selectedMonth,0).toISOString().split("T")[0];return{startDate:o,endDate:a}},generateYears(){const e=(new Date).getFullYear();return Array.from({length:10},((t,o)=>e-o))}},mounted(){this.fetchLocations()}};const Sp=(0,x.A)(Dp,[["render",Pp],["__scopeId","data-v-5a731d60"]]);var xp=Sp,Fp={components:{CommOpConfig:Hc,CommOpGen:hu,CommOpLogs:Mu,CommOpArch:qu,CommOpBonus:bp,CommOpComm:xp},data(){return{selectedTab:"CommOpConfig",tabs:[{name:"CommOpConfig",label:"Configurazioni",icon:"fa fa-asterisk"},{name:"CommOpGen",label:"Genera Ore",icon:"fa fa-calendar-days"},{name:"CommOpLogs",label:"Correggi Ore",icon:"fa fa-pen"},{name:"CommOpArch",label:"Archivio Ore",icon:"fa fa-box-open"},{name:"CommOpBonus",label:"Bonus",icon:"fa fa-trophy"},{name:"CommOpComm",label:"Genera paghe",icon:"fa fa-money-bill"}],tooltipText:"\n  <div style='text-align: left; font-size: 14px; line-height: 1.5; max-width: 450px;'>\n    <strong>Commissioning Operatori</strong><br>\n    Questo modulo permette la gestione completa delle ore, bonus e paghe degli operatori.<br><br>\n\n    <strong>Configurazioni</strong><br>\n    Imposta i parametri di collegamento con Asterisk/Vicidial (URL, credenziali, gruppi, campagne). Questi dati sono fondamentali per l'estrazione delle ore.<br><br>\n\n    <strong>Genera Ore</strong><br>\n    Calcola automaticamente le ore lavorate dagli operatori per un intervallo di date. È possibile filtrare per sede e salvare i dati nel sistema.<br><br>\n\n    <strong>Correggi Ore</strong><br>\n    Visualizza e modifica manualmente i timelog degli operatori. Utile per correggere dati errati o incompleti.<br><br>\n\n    <strong>Archivio Ore</strong><br>\n    Consulta lo storico dei timelog già registrati nel sistema. Puoi filtrare per data, sede e operatore.<br><br>\n\n    <strong>Bonus</strong><br>\n    Gestisci le regole di bonus: puoi crearle, archiviarle o modificarle. I bonus sono applicati automaticamente durante il calcolo delle paghe.<br><br>\n\n    <strong>Genera Paghe</strong><br>\n    Calcola la retribuzione totale degli operatori (ore x tariffa + bonus). Include i dettagli su ore lavorate, appuntamenti positivi e importo del bonus.<br><br>\n\n    <em>💡 Suggerimento: imposta correttamente le configurazioni prima di generare ore o paghe!</em>\n  </div>\n"}}};const Mp=(0,x.A)(Fp,[["render",Nc],["__scopeId","data-v-52f4d7e2"]]);var Vp=Mp;const Up={class:"profile-container"},Ip={key:0},Op={class:"grid-container"},Xp={class:"input-group"},Tp={class:"input-group"},$p={class:"input-group"},zp={class:"input-group"},Rp={class:"input-group"},Wp={class:"input-group"},Np={class:"input-group"},jp={class:"input-group"},Bp={class:"input-group"},qp={class:"input-group"},Kp={class:"grid-container"},Yp={class:"input-group"},Jp={class:"password-container"},Qp=["type"],Gp={class:"input-group"},Hp={class:"password-container"},Zp=["type"],eh={class:"input-group"},th={class:"password-container"},oh=["type"],ah={class:"grid-container"},lh={class:"form-section"},nh={key:1},ih=["src"],sh={key:0,class:"error-message"},rh={key:1,class:"success-message"};function dh(e,t,o,i,s,r){return(0,l.uX)(),(0,l.CE)("div",Up,[t[44]||(t[44]=(0,l.Lk)("h2",null,"Area Personale",-1)),i.user?((0,l.uX)(),(0,l.CE)("div",Ip,[(0,l.Lk)("form",{onSubmit:t[10]||(t[10]=(0,a.D$)(((...e)=>i.updateProfile&&i.updateProfile(...e)),["prevent"])),class:"form-section"},[t[32]||(t[32]=(0,l.Lk)("h3",null,"Dati Personali",-1)),(0,l.Lk)("div",Op,[(0,l.Lk)("div",Xp,[t[22]||(t[22]=(0,l.Lk)("label",null,"Nome",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.user.nome=e),type:"text",required:""},null,512),[[a.Jo,i.user.nome]])]),(0,l.Lk)("div",Tp,[t[23]||(t[23]=(0,l.Lk)("label",null,"Cognome",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>i.user.cognome=e),type:"text",required:""},null,512),[[a.Jo,i.user.cognome]])]),(0,l.Lk)("div",$p,[t[24]||(t[24]=(0,l.Lk)("label",null,"Email",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>i.user.email=e),type:"email",required:""},null,512),[[a.Jo,i.user.email]])]),(0,l.Lk)("div",zp,[t[25]||(t[25]=(0,l.Lk)("label",null,"Telefono",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>i.user.telefono=e),type:"text"},null,512),[[a.Jo,i.user.telefono]])]),(0,l.Lk)("div",Rp,[t[26]||(t[26]=(0,l.Lk)("label",null,"Codice Fiscale",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>i.user.codice_fiscale=e),type:"text"},null,512),[[a.Jo,i.user.codice_fiscale]])]),(0,l.Lk)("div",Wp,[t[27]||(t[27]=(0,l.Lk)("label",null,"Partita IVA",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>i.user.partita_iva=e),type:"text"},null,512),[[a.Jo,i.user.partita_iva]])]),(0,l.Lk)("div",Np,[t[28]||(t[28]=(0,l.Lk)("label",null,"Indirizzo",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>i.user.indirizzo=e),type:"text"},null,512),[[a.Jo,i.user.indirizzo]])]),(0,l.Lk)("div",jp,[t[29]||(t[29]=(0,l.Lk)("label",null,"Città",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>i.user.city=e),type:"text"},null,512),[[a.Jo,i.user.city]])]),(0,l.Lk)("div",Bp,[t[30]||(t[30]=(0,l.Lk)("label",null,"Provincia",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>i.user.provincia=e),type:"text"},null,512),[[a.Jo,i.user.provincia]])]),(0,l.Lk)("div",qp,[t[31]||(t[31]=(0,l.Lk)("label",null,"CAP",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>i.user.cap=e),type:"text"},null,512),[[a.Jo,i.user.cap]])])]),t[33]||(t[33]=(0,l.Lk)("button",{type:"submit",class:"btn-primary"},"Salva Modifiche",-1))],32),(0,l.Lk)("div",Kp,[(0,l.Lk)("form",{onSubmit:t[17]||(t[17]=(0,a.D$)(((...e)=>i.changePassword&&i.changePassword(...e)),["prevent"])),class:"form-section"},[t[40]||(t[40]=(0,l.Lk)("h3",null,"Cambia Password",-1)),(0,l.Lk)("div",Yp,[t[35]||(t[35]=(0,l.Lk)("label",null,"Password attuale",-1)),(0,l.Lk)("div",Jp,[(0,l.bo)((0,l.Lk)("input",{type:i.showOldPassword?"text":"password","onUpdate:modelValue":t[11]||(t[11]=e=>i.passwords.oldPassword=e),required:""},null,8,Qp),[[a.hp,i.passwords.oldPassword]]),(0,l.Lk)("span",{onClick:t[12]||(t[12]=e=>i.showOldPassword=!i.showOldPassword),class:"toggle-password"},t[34]||(t[34]=[(0,l.Lk)("i",{class:"fa-solid fa-eye"},null,-1)]))])]),(0,l.Lk)("div",Gp,[t[37]||(t[37]=(0,l.Lk)("label",null,"Nuova Password",-1)),(0,l.Lk)("div",Hp,[(0,l.bo)((0,l.Lk)("input",{type:i.showNewPassword?"text":"password","onUpdate:modelValue":t[13]||(t[13]=e=>i.passwords.newPassword=e),required:""},null,8,Zp),[[a.hp,i.passwords.newPassword]]),(0,l.Lk)("span",{onClick:t[14]||(t[14]=e=>i.showNewPassword=!i.showNewPassword),class:"toggle-password"},t[36]||(t[36]=[(0,l.Lk)("i",{class:"fa-solid fa-eye"},null,-1)]))])]),(0,l.Lk)("div",eh,[t[39]||(t[39]=(0,l.Lk)("label",null,"Conferma Nuova Password",-1)),(0,l.Lk)("div",th,[(0,l.bo)((0,l.Lk)("input",{type:i.showConfirmPassword?"text":"password","onUpdate:modelValue":t[15]||(t[15]=e=>i.passwords.confirmPassword=e),required:""},null,8,oh),[[a.hp,i.passwords.confirmPassword]]),(0,l.Lk)("span",{onClick:t[16]||(t[16]=e=>i.showConfirmPassword=!i.showConfirmPassword),class:"toggle-password"},t[38]||(t[38]=[(0,l.Lk)("i",{class:"fa-solid fa-eye"},null,-1)]))])]),t[41]||(t[41]=(0,l.Lk)("button",{type:"submit",class:"btn-primary"},"Cambia Password",-1))],32)]),(0,l.Lk)("div",ah,[(0,l.Lk)("div",lh,[t[43]||(t[43]=(0,l.Lk)("h3",null,"Autenticazione a Due Fattori (2FA)",-1)),i.user.two_factor_enabled?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("button",{key:0,onClick:t[18]||(t[18]=(...e)=>i.enable2FA&&i.enable2FA(...e)),class:"btn-secondary"}," Abilita 2FA ")),i.qrCode?((0,l.uX)(),(0,l.CE)("div",nh,[t[42]||(t[42]=(0,l.Lk)("p",null,"Scansiona il codice con Google Authenticator",-1)),(0,l.Lk)("img",{src:i.qrCode,alt:"QR Code",class:"qr-code"},null,8,ih),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[19]||(t[19]=e=>i.otpCode=e),type:"text",placeholder:"Inserisci codice OTP"},null,512),[[a.Jo,i.otpCode]]),(0,l.Lk)("button",{onClick:t[20]||(t[20]=(...e)=>i.verify2FA&&i.verify2FA(...e)),class:"btn-primary"},"Verifica OTP")])):(0,l.Q3)("",!0),i.user.two_factor_enabled?((0,l.uX)(),(0,l.CE)("button",{key:2,onClick:t[21]||(t[21]=(...e)=>i.disable2FA&&i.disable2FA(...e)),class:"btn-danger"}," Disabilita 2FA ")):(0,l.Q3)("",!0)])]),i.errorMessage?((0,l.uX)(),(0,l.CE)("p",sh,(0,n.v_)(i.errorMessage),1)):(0,l.Q3)("",!0),i.successMessage?((0,l.uX)(),(0,l.CE)("p",rh,(0,n.v_)(i.successMessage),1)):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0)])}var ch={setup(){const e=(0,Ce.KR)(null),t=(0,Ce.KR)({oldPassword:"",newPassword:"",confirmPassword:""}),o=(0,Ce.KR)(null),a=(0,Ce.KR)(""),n=(0,Ce.KR)(""),i=(0,Ce.KR)(""),s=(0,Ce.KR)(!1),r=(0,Ce.KR)(!1),d=(0,Ce.KR)(!1),c=async()=>{try{const t=await P.A.get("https://dev.gixflow.cloud/api/user/me");e.value=t.data}catch(t){console.error("Errore nel caricamento utente:",t)}},u=async()=>{try{await P.A.put("https://dev.gixflow.cloud/api/user/update",e.value),i.value="Profilo aggiornato con successo!"}catch(t){n.value="Errore nell'aggiornamento del profilo."}},p=async()=>{if(t.value.newPassword===t.value.confirmPassword)try{await P.A.post("https://dev.gixflow.cloud/api/user/change-password",t.value),i.value="Password cambiata con successo!",t.value={oldPassword:"",newPassword:"",confirmPassword:""}}catch(e){n.value="Errore nel cambio password."}else n.value="Le password non coincidono!"},h=async()=>{try{const e=await P.A.post("https://dev.gixflow.cloud/api/user/enable-2fa");o.value=e.data.qrCode}catch(e){n.value="Errore nell'abilitazione del 2FA."}},m=async()=>{try{await P.A.post("https://dev.gixflow.cloud/api/user/verify-2fa",{otp:a.value}),i.value="2FA abilitato con successo!",e.value.two_factor_enabled=1,o.value=null}catch(t){n.value="Codice OTP errato."}},g=async()=>{try{await P.A.post("https://dev.gixflow.cloud/api/user/disable-2fa"),i.value="2FA disabilitato.",e.value.two_factor_enabled=0,o.value=null}catch(t){n.value="Errore nella disabilitazione del 2FA."}};return(0,l.sV)(c),{user:e,passwords:t,qrCode:o,otpCode:a,errorMessage:n,successMessage:i,showOldPassword:s,showNewPassword:r,showConfirmPassword:d,updateProfile:u,changePassword:p,enable2FA:h,verify2FA:m,disable2FA:g}}};const uh=(0,x.A)(ch,[["render",dh],["__scopeId","data-v-61940564"]]);var ph=uh;const hh={class:"smtp-container"},mh={class:"form-group"},gh={class:"form-group"},kh={class:"form-group"},fh={class:"table"},Lh={key:0},vh={key:1},bh={class:"form-group"},yh={class:"form-group"},_h={class:"form-group"};function Ch(e,t,o,i,s,r){return(0,l.uX)(),(0,l.CE)("div",hh,[t[21]||(t[21]=(0,l.Lk)("h2",null,"Configurazione SMTP",-1)),(0,l.Lk)("fieldset",null,[t[12]||(t[12]=(0,l.Lk)("legend",null,"Impostazioni",-1)),(0,l.Lk)("form",{onSubmit:t[3]||(t[3]=(0,a.D$)(((...e)=>r.saveSettings&&r.saveSettings(...e)),["prevent"]))},[(0,l.Lk)("div",mh,[t[8]||(t[8]=(0,l.Lk)("label",null,"Email:",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>s.settings.email=e),type:"email",required:""},null,512),[[a.Jo,s.settings.email]])]),(0,l.Lk)("div",gh,[t[9]||(t[9]=(0,l.Lk)("label",null,"Password per App:",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>s.settings.password=e),type:"password",required:""},null,512),[[a.Jo,s.settings.password]])]),(0,l.Lk)("div",kh,[t[10]||(t[10]=(0,l.Lk)("label",null,"Alias Email:",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>s.settings.alias=e),type:"text",required:""},null,512),[[a.Jo,s.settings.alias]])]),t[11]||(t[11]=(0,l.Lk)("div",{class:"modal-buttons"},[(0,l.Lk)("button",{type:"submit"},"Salva")],-1))],32)]),(0,l.Lk)("fieldset",null,[t[15]||(t[15]=(0,l.Lk)("legend",null,"Impostazioni Salvate",-1)),(0,l.Lk)("table",fh,[t[14]||(t[14]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Email"),(0,l.Lk)("th",null,"Alias")])],-1)),(0,l.Lk)("tbody",null,[s.settings.email?((0,l.uX)(),(0,l.CE)("tr",Lh,[(0,l.Lk)("td",null,(0,n.v_)(s.settings.email),1),(0,l.Lk)("td",null,(0,n.v_)(s.settings.alias),1)])):((0,l.uX)(),(0,l.CE)("tr",vh,t[13]||(t[13]=[(0,l.Lk)("td",{colspan:"2",class:"empty-row"},"Nessuna impostazione salvata",-1)])))])])]),(0,l.Lk)("fieldset",null,[t[20]||(t[20]=(0,l.Lk)("legend",null,"Test Invio Email",-1)),(0,l.Lk)("form",{onSubmit:t[7]||(t[7]=(0,a.D$)(((...e)=>r.sendTestEmail&&r.sendTestEmail(...e)),["prevent"]))},[(0,l.Lk)("div",bh,[t[16]||(t[16]=(0,l.Lk)("label",null,"Destinatario:",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>s.testEmail.to=e),type:"email",required:""},null,512),[[a.Jo,s.testEmail.to]])]),(0,l.Lk)("div",yh,[t[17]||(t[17]=(0,l.Lk)("label",null,"Oggetto:",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>s.testEmail.subject=e),type:"text",required:""},null,512),[[a.Jo,s.testEmail.subject]])]),(0,l.Lk)("div",_h,[t[18]||(t[18]=(0,l.Lk)("label",null,"Messaggio:",-1)),(0,l.bo)((0,l.Lk)("textarea",{"onUpdate:modelValue":t[6]||(t[6]=e=>s.testEmail.message=e),required:""},null,512),[[a.Jo,s.testEmail.message]])]),t[19]||(t[19]=(0,l.Lk)("div",{class:"modal-buttons"},[(0,l.Lk)("button",{type:"submit",class:"generate-button"},"Invia Test")],-1))],32)]),s.feedback.message?((0,l.uX)(),(0,l.CE)("div",{key:0,class:(0,n.C4)(["feedback",s.feedback.success?"success":"error"])},(0,n.v_)(s.feedback.message),3)):(0,l.Q3)("",!0)])}var wh={data(){return{settings:{email:"",password:"",alias:""},testEmail:{to:"",subject:"Test SMTP",message:"Questa è una mail di test"},feedback:{message:"",success:!0}}},methods:{async saveSettings(){try{await P.A.post("https://dev.gixflow.cloud/api/settings/smtp",this.settings),this.feedback={message:"✅ Impostazioni salvate con successo!",success:!0}}catch(e){this.feedback={message:"❌ Errore nel salvataggio.",success:!1}}},async loadSettings(){try{const e=await P.A.get("https://dev.gixflow.cloud/api/settings/smtp");e.data.success&&(this.settings=e.data.settings)}catch(e){console.error("Errore nel recupero impostazioni SMTP:",e)}},async sendTestEmail(){try{const e=await P.A.post("https://dev.gixflow.cloud/api/send-email",this.testEmail);this.feedback={message:e.data.message,success:!0}}catch(e){this.feedback={message:"❌ Errore nell'invio della mail.",success:!1}}}},mounted(){this.loadSettings()}};const Ah=(0,x.A)(wh,[["render",Ch],["__scopeId","data-v-781c67c0"]]);var Eh=Ah;const Ph={class:"report-page"},Dh={key:0,class:"loading-overlay"},Sh={key:0,class:"placeholder"},xh={key:1},Fh={class:"report-range"},Mh={class:"summary-wrapper"},Vh={class:"summary-box"},Uh={key:0},Ih={class:"summary-box"},Oh={class:"status-summary"},Xh={class:"percentage"},Th={class:"top-controls"},$h={class:"left-controls"},zh={class:"table-search-wrapper"},Rh={class:"table-wrapper"},Wh={class:"table"},Nh=["onClick"],jh={key:0},Bh={key:0},qh={class:"table-footer"},Kh={class:"footer-left"},Yh=["value"],Jh={class:"total-count"},Qh={class:"pagination"},Gh=["disabled"],Hh=["onClick"],Zh={key:1,class:"ellipsis"},em=["disabled"];function tm(e,t,o,i,s,r){const d=(0,l.g2)("ReportFilterModal"),c=(0,l.g2)("SendReportModal");return(0,l.uX)(),(0,l.CE)("div",Ph,[s.loading?((0,l.uX)(),(0,l.CE)("div",Dh,t[11]||(t[11]=[(0,l.Lk)("div",{class:"spinner-box"},[(0,l.Lk)("i",{class:"fa-solid fa-spinner fa-spin fa-2x"}),(0,l.Lk)("p",null,"Caricamento...")],-1)]))):(0,l.Q3)("",!0),s.showModal?((0,l.uX)(),(0,l.Wv)(d,{key:1,loading:s.loading,filters:["agent","operator","location","dateRange"],reportName:"Report Appuntamenti",onGenerate:r.handleGenerate,onClose:t[0]||(t[0]=e=>s.showModal=!1)},null,8,["loading","onGenerate"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:2},[s.reportReady?((0,l.uX)(),(0,l.CE)("div",xh,[t[40]||(t[40]=(0,l.Lk)("h2",null,[(0,l.Lk)("i",{class:"fa-solid fa-calendar-check icon-green"}),(0,l.eW)(" Report Appuntamenti ")],-1)),(0,l.Lk)("p",Fh,[t[15]||(t[15]=(0,l.Lk)("strong",null,"Report dal:",-1)),(0,l.eW)(" "+(0,n.v_)(r.formatDate(s.dates.from))+" al "+(0,n.v_)(r.formatDate(s.dates.to))+" | ",1),t[16]||(t[16]=(0,l.Lk)("strong",null,"Generato il:",-1)),(0,l.eW)(" "+(0,n.v_)(r.formatDate(new Date)),1)]),(0,l.Lk)("div",Mh,[(0,l.Lk)("div",Vh,[t[28]||(t[28]=(0,l.Lk)("h3",null,[(0,l.Lk)("i",{class:"fa-solid fa-sliders icon-green"}),(0,l.eW)(" Filtri applicati: ")],-1)),(0,l.Lk)("ul",null,[(0,l.Lk)("li",null,[t[17]||(t[17]=(0,l.Lk)("i",{class:"fa-solid fa-calendar-days"},null,-1)),t[18]||(t[18]=(0,l.eW)(" Periodo: ")),(0,l.Lk)("strong",null,(0,n.v_)(r.formatDateOnly(s.appliedFilters.from)),1),t[19]||(t[19]=(0,l.eW)(" - ")),(0,l.Lk)("strong",null,(0,n.v_)(r.formatDateOnly(s.appliedFilters.to)),1)]),(0,l.Lk)("li",null,[t[20]||(t[20]=(0,l.Lk)("i",{class:"fa-solid fa-user-tie"},null,-1)),t[21]||(t[21]=(0,l.eW)(" Agente: ")),(0,l.Lk)("strong",null,(0,n.v_)(r.resolveFilterNames(s.appliedFilters.agent_id,e.agents).join(", ")),1)]),(0,l.Lk)("li",null,[t[22]||(t[22]=(0,l.Lk)("i",{class:"fa-solid fa-headset"},null,-1)),t[23]||(t[23]=(0,l.eW)(" Operatore: ")),(0,l.Lk)("strong",null,(0,n.v_)(r.resolveFilterNames(s.appliedFilters.operator_id,e.operators).join(", ")),1)]),(0,l.Lk)("li",null,[t[24]||(t[24]=(0,l.Lk)("i",{class:"fa-solid fa-building"},null,-1)),t[25]||(t[25]=(0,l.eW)(" Sede: ")),(0,l.Lk)("strong",null,(0,n.v_)(r.resolveFilterNames(s.appliedFilters.location_id,e.locations,"location").join(", ")),1)]),s.appliedFilters.vendor_id?((0,l.uX)(),(0,l.CE)("li",Uh,[t[26]||(t[26]=(0,l.Lk)("i",{class:"fa-solid fa-store"},null,-1)),t[27]||(t[27]=(0,l.eW)(" Vendor: ")),(0,l.Lk)("strong",null,(0,n.v_)(r.resolveFilterNames(s.appliedFilters.vendor_id,e.vendors,"name").join(", ")),1)])):(0,l.Q3)("",!0)])]),(0,l.Lk)("div",Ih,[(0,l.Lk)("h3",null,[t[29]||(t[29]=(0,l.Lk)("i",{class:"fa-solid fa-list-ol icon-green"},null,-1)),t[30]||(t[30]=(0,l.eW)(" Totale Appuntamenti: ")),(0,l.Lk)("strong",null,(0,n.v_)(s.summary.total),1)]),(0,l.Lk)("ul",Oh,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.summary.statusBreakdown,((e,o)=>((0,l.uX)(),(0,l.CE)("li",{key:o},[t[31]||(t[31]=(0,l.Lk)("i",{class:"fa-solid fa-circle-info icon-green"},null,-1)),(0,l.eW)(" "+(0,n.v_)(r.capitalize(o))+": ",1),(0,l.Lk)("strong",null,(0,n.v_)(e),1),(0,l.Lk)("span",Xh,"("+(0,n.v_)(r.percentage(e))+"%)",1)])))),128))])])]),(0,l.Lk)("div",Th,[(0,l.Lk)("div",$h,[(0,l.Lk)("button",{class:"function-button-primary",onClick:t[2]||(t[2]=(...e)=>r.exportCSV&&r.exportCSV(...e)),title:"Scarica il report in formato CSV"},t[32]||(t[32]=[(0,l.Lk)("i",{class:"fa-solid fa-download"},null,-1)])),(0,l.Lk)("button",{class:"function-button-primary",onClick:t[3]||(t[3]=e=>s.showModal=!0),title:"Modifica i filtri applicati"},t[33]||(t[33]=[(0,l.Lk)("i",{class:"fa-solid fa-filter-circle-xmark"},null,-1)])),(0,l.Lk)("button",{class:"function-button-primary",onClick:t[4]||(t[4]=e=>s.sendModalOpen=!0),title:"Invia il report via email"},t[34]||(t[34]=[(0,l.Lk)("i",{class:"fa-solid fa-paper-plane"},null,-1)])),(0,l.Lk)("button",{class:"function-button-primary",onClick:t[5]||(t[5]=(...e)=>r.copyAllReportToClipboard&&r.copyAllReportToClipboard(...e)),title:"Copia tutti dati"},t[35]||(t[35]=[(0,l.Lk)("i",{class:"fa-solid fa-copy"},null,-1)]))]),(0,l.Lk)("div",zh,[(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>s.searchText=e),type:"text",placeholder:"Cerca nei risultati..."},null,512),[[a.Jo,s.searchText]])])]),s.sendModalOpen?((0,l.uX)(),(0,l.Wv)(c,{key:0,csvBase64:r.generateCSVBase64(),reportType:"appointments",defaultSubject:`Report Appuntamenti (${r.formatDateOnly(s.dates.from)} - ${r.formatDateOnly(s.dates.to)})`,filters:r.computedFilters,summary:s.summary.statusBreakdown,total:s.summary.total,onClose:t[7]||(t[7]=e=>s.sendModalOpen=!1)},null,8,["csvBase64","defaultSubject","filters","summary","total"])):(0,l.Q3)("",!0),(0,l.Lk)("div",Rh,[(0,l.Lk)("table",Wh,[(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.columns,(e=>((0,l.uX)(),(0,l.CE)("th",{key:e.field,onClick:t=>r.sort(e.field)},[(0,l.eW)((0,n.v_)(e.label)+" ",1),s.sortField===e.field?((0,l.uX)(),(0,l.CE)("span",jh,[(0,l.Lk)("i",{class:(0,n.C4)("asc"===s.sortOrder?"fa-solid fa-caret-up":"fa-solid fa-caret-down")},null,2)])):(0,l.Q3)("",!0)],8,Nh)))),128))])]),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.paginatedRows,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id},[(0,l.Lk)("td",null,(0,n.v_)(e.id),1),(0,l.Lk)("td",null,(0,n.v_)(r.formatDate(e.date_start)),1),(0,l.Lk)("td",null,(0,n.v_)(e.agent),1),(0,l.Lk)("td",null,(0,n.v_)(e.operator),1),(0,l.Lk)("td",null,(0,n.v_)(r.capitalize(e.status)),1),(0,l.Lk)("td",null,(0,n.v_)(e.sede),1)])))),128)),0===r.paginatedRows.length?((0,l.uX)(),(0,l.CE)("tr",Bh,t[36]||(t[36]=[(0,l.Lk)("td",{colspan:"6"},"Nessun appuntamento trovato.",-1)]))):(0,l.Q3)("",!0)])]),(0,l.Lk)("div",qh,[(0,l.Lk)("div",Kh,[(0,l.Lk)("label",null,[t[37]||(t[37]=(0,l.eW)(" Risultati: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>s.itemsPerPage=e)},[((0,l.uX)(),(0,l.CE)(l.FK,null,(0,l.pI)([5,10,20,50,100],(e=>(0,l.Lk)("option",{key:e,value:e},(0,n.v_)(e),9,Yh))),64))],512),[[a.u1,s.itemsPerPage,void 0,{number:!0}]])]),(0,l.Lk)("span",Jh,(0,n.v_)(r.filteredRows.length)+" risultati totali",1)]),(0,l.Lk)("div",Qh,[(0,l.Lk)("button",{disabled:1===s.currentPage,onClick:t[9]||(t[9]=e=>r.changePage(s.currentPage-1))},t[38]||(t[38]=[(0,l.Lk)("i",{class:"fa-solid fa-backward-step"},null,-1)]),8,Gh),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.visiblePages,(e=>((0,l.uX)(),(0,l.CE)("span",{key:e},["..."!==e?((0,l.uX)(),(0,l.CE)("button",{key:0,class:(0,n.C4)({active:e===s.currentPage}),onClick:t=>r.changePage(e)},(0,n.v_)(e),11,Hh)):((0,l.uX)(),(0,l.CE)("span",Zh,"..."))])))),128)),(0,l.Lk)("button",{disabled:s.currentPage===r.totalPages,onClick:t[10]||(t[10]=e=>r.changePage(s.currentPage+1))},t[39]||(t[39]=[(0,l.Lk)("i",{class:"fa-solid fa-forward-step"},null,-1)]),8,em)])])])])):((0,l.uX)(),(0,l.CE)("div",Sh,[t[13]||(t[13]=(0,l.Lk)("i",{class:"fa-solid fa-filter-circle-exclamation icon-green"},null,-1)),t[14]||(t[14]=(0,l.Lk)("p",{class:"placeholder-text"}," Seleziona i parametri dal filtro per generare il report! ",-1)),(0,l.Lk)("button",{class:"filter-again-btn",onClick:t[1]||(t[1]=e=>s.showModal=!0)},t[12]||(t[12]=[(0,l.Lk)("i",{class:"fa-solid fa-filter"},null,-1),(0,l.eW)(" Apri filtri ")]))]))],64))])}const om={class:"modal-content"},am={key:0},lm={class:"quick-range-buttons"},nm={class:"modal-buttons"},im=["disabled"];function sm(e,t,o,i,s,r){const d=(0,l.g2)("flat-pickr"),c=(0,l.g2)("MultiSelectField");return(0,l.uX)(),(0,l.CE)("div",{class:"modal-overlay",onClick:t[13]||(t[13]=(0,a.D$)((t=>e.$emit("close")),["self"]))},[(0,l.Lk)("div",om,[(0,l.Lk)("h2",null,[t[14]||(t[14]=(0,l.eW)("Parametri Report")),o.reportName?((0,l.uX)(),(0,l.CE)("span",am," – "+(0,n.v_)(o.reportName),1)):(0,l.Q3)("",!0)]),(0,l.Lk)("form",{onSubmit:t[12]||(t[12]=(0,a.D$)(((...e)=>r.submit&&r.submit(...e)),["prevent"]))},[(0,l.Lk)("div",lm,[(0,l.Lk)("button",{type:"button",onClick:t[0]||(t[0]=(...e)=>r.setYesterday&&r.setYesterday(...e)),class:(0,n.C4)({active:"yesterday"===s.activeQuickRange})}," Ieri ",2),(0,l.Lk)("button",{type:"button",onClick:t[1]||(t[1]=(...e)=>r.setThisWeek&&r.setThisWeek(...e)),class:(0,n.C4)({active:"thisWeek"===s.activeQuickRange})}," Settimana in corso ",2),(0,l.Lk)("button",{type:"button",onClick:t[2]||(t[2]=(...e)=>r.setLastWeek&&r.setLastWeek(...e)),class:(0,n.C4)({active:"lastWeek"===s.activeQuickRange})}," Settimana scorsa ",2),(0,l.Lk)("button",{type:"button",onClick:t[3]||(t[3]=(...e)=>r.setCurrentMonth&&r.setCurrentMonth(...e)),class:(0,n.C4)({active:"currentMonth"===s.activeQuickRange})}," Mese in corso ",2),(0,l.Lk)("button",{type:"button",onClick:t[4]||(t[4]=(...e)=>r.setLastMonth&&r.setLastMonth(...e)),class:(0,n.C4)({active:"lastMonth"===s.activeQuickRange})}," Mese precedente ",2),(0,l.Lk)("button",{type:"button",onClick:t[5]||(t[5]=(...e)=>r.setLastThreeMonths&&r.setLastThreeMonths(...e)),class:(0,n.C4)({active:"lastThreeMonths"===s.activeQuickRange})}," Ultimi 3 mesi ",2)]),(0,l.Lk)("label",null,[t[15]||(t[15]=(0,l.eW)(" Da: ")),(0,l.bF)(d,{modelValue:s.form.from,"onUpdate:modelValue":t[6]||(t[6]=e=>s.form.from=e),config:s.configDate,class:"custom-datepicker"},null,8,["modelValue","config"])]),(0,l.Lk)("label",null,[t[16]||(t[16]=(0,l.eW)(" A: ")),(0,l.bF)(d,{modelValue:s.form.to,"onUpdate:modelValue":t[7]||(t[7]=e=>s.form.to=e),config:s.configDate,class:"custom-datepicker"},null,8,["modelValue","config"])]),o.filters.includes("agent")?((0,l.uX)(),(0,l.Wv)(c,{key:0,modelValue:s.form.agent_id,"onUpdate:modelValue":t[8]||(t[8]=e=>s.form.agent_id=e),options:r.agents,label:"Agente:",labelKey:"cognome_nome",trackBy:"id",placeholder:"Seleziona agenti"},null,8,["modelValue","options"])):(0,l.Q3)("",!0),o.filters.includes("operator")?((0,l.uX)(),(0,l.Wv)(c,{key:1,modelValue:s.form.operator_id,"onUpdate:modelValue":t[9]||(t[9]=e=>s.form.operator_id=e),options:r.enhancedOperators,label:"Operatore:",labelKey:"cognome_nome",trackBy:"id",placeholder:"Seleziona operatori"},null,8,["modelValue","options"])):(0,l.Q3)("",!0),o.filters.includes("location")?((0,l.uX)(),(0,l.Wv)(c,{key:2,modelValue:s.form.location_id,"onUpdate:modelValue":t[10]||(t[10]=e=>s.form.location_id=e),options:s.locations,label:"Sede:",labelKey:"location",trackBy:"id",placeholder:"Seleziona sedi"},null,8,["modelValue","options"])):(0,l.Q3)("",!0),o.filters.includes("vendor")?((0,l.uX)(),(0,l.Wv)(c,{key:3,modelValue:s.form.vendor_id,"onUpdate:modelValue":t[11]||(t[11]=e=>s.form.vendor_id=e),options:s.vendors,label:"Vendor:",labelKey:"name",trackBy:"id",placeholder:"Seleziona vendor"},null,8,["modelValue","options"])):(0,l.Q3)("",!0),(0,l.Lk)("div",nm,[(0,l.Lk)("button",{class:"function-button-primary",type:"submit",disabled:o.loading}," Genera ",8,im)])],32)])])}var rm=o(742),dm=o.n(rm);const cm={class:"multiselect-field"},um={class:"field-label"},pm={key:0,class:"multiselect__tag tag-it"},hm=["onClick"],mm={key:0,class:"multiselect__single",style:{cursor:"default"}},gm=["onClick"],km={key:0,class:"select-controls"};function fm(e,t,o,i,s,r){const d=(0,l.g2)("MultiSelectCustom");return(0,l.uX)(),(0,l.CE)("div",cm,[(0,l.Lk)("label",um,(0,n.v_)(o.label),1),(0,l.bF)(d,{"model-value":o.modelValue,"onUpdate:modelValue":t[0]||(t[0]=t=>e.$emit("update:modelValue",t)),options:o.options,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,"custom-label":r.formatLabel,"track-by":o.trackBy,placeholder:o.placeholder,"hide-selected":!0,class:"multiselect-custom"},{noOptions:(0,l.k6)((()=>t[3]||(t[3]=[(0,l.eW)(" Nessuna opzione disponibile ")]))),noResult:(0,l.k6)((()=>t[4]||(t[4]=[(0,l.eW)(" Nessun risultato trovato ")]))),tag:(0,l.k6)((({option:e,remove:t})=>[o.modelValue.length!==o.options.length?((0,l.uX)(),(0,l.CE)("span",pm,[(0,l.eW)((0,n.v_)(r.formatLabel(e))+" ",1),(0,l.Lk)("i",{class:"remove-tag",onClick:(0,a.D$)((o=>t(e)),["stop"])},"×",8,hm)])):(0,l.Q3)("",!0)])),selection:(0,l.k6)((({values:e,remove:t})=>[e.length===o.options.length&&o.options.length>0?((0,l.uX)(),(0,l.CE)("span",mm," Tutti ")):((0,l.uX)(!0),(0,l.CE)(l.FK,{key:1},(0,l.pI)(e,((e,o)=>((0,l.uX)(),(0,l.CE)("span",{key:o,class:"multiselect__tag",onClick:o=>t(e),style:{cursor:"pointer"}},(0,n.v_)(r.formatLabel(e)),9,gm)))),128))])),_:1},8,["model-value","options","custom-label","track-by","placeholder"]),o.showControls?((0,l.uX)(),(0,l.CE)("div",km,[(0,l.Lk)("button",{type:"button",class:"control-btn",onClick:t[1]||(t[1]=(...e)=>r.selectAll&&r.selectAll(...e))}," Tutti "),(0,l.Lk)("button",{type:"button",class:"control-btn",onClick:t[2]||(t[2]=(...e)=>r.clearAll&&r.clearAll(...e))}," Deseleziona ")])):(0,l.Q3)("",!0)])}const Lm=["tabindex","aria-expanded","aria-owns","aria-activedescendant"],vm={ref:"tags",class:"multiselect__tags"},bm={class:"multiselect__tags-wrap"},ym=["textContent"],_m=["onKeypress","onMousedown"],Cm=["textContent"],wm={class:"multiselect__spinner"},Am=["name","id","spellcheck","placeholder","required","value","disabled","tabindex","aria-label","aria-controls"],Em=["id","aria-multiselectable"],Pm={key:0},Dm={class:"multiselect__option"},Sm=["aria-selected","id","role"],xm=["onClick","onMouseenter","data-select","data-selected","data-deselect"],Fm=["data-select","data-deselect","onMouseenter","onMousedown"],Mm={class:"multiselect__option"},Vm={class:"multiselect__option"};function Um(e,t,o,i,s,r){return(0,l.uX)(),(0,l.CE)("div",{tabindex:e.searchable?-1:o.tabindex,class:(0,n.C4)([{"multiselect--active":e.isOpen,"multiselect--disabled":o.disabled,"multiselect--above":r.isAbove,"multiselect--has-options-group":r.hasOptionGroup},"multiselect"]),onFocus:t[14]||(t[14]=t=>e.activate()),onBlur:t[15]||(t[15]=t=>!e.searchable&&e.deactivate()),onKeydown:[t[16]||(t[16]=(0,a.jR)((0,a.D$)((t=>e.pointerForward()),["self","prevent"]),["down"])),t[17]||(t[17]=(0,a.jR)((0,a.D$)((t=>e.pointerBackward()),["self","prevent"]),["up"]))],onKeypress:t[18]||(t[18]=(0,a.jR)((0,a.D$)((t=>e.addPointerElement(t)),["stop","self"]),["enter","tab"])),onKeyup:t[19]||(t[19]=(0,a.jR)((t=>e.deactivate()),["esc"])),role:"combobox","aria-expanded":e.isOpen,"aria-owns":"listbox-"+e.id,"aria-activedescendant":e.isOpen&&null!==e.pointer?e.id+"-"+e.pointer:null},[(0,l.RG)(e.$slots,"caret",{toggle:e.toggle},(()=>[(0,l.Lk)("div",{onMousedown:t[0]||(t[0]=(0,a.D$)((t=>e.toggle()),["prevent","stop"])),class:"multiselect__select"},null,32)])),(0,l.RG)(e.$slots,"clear",{search:e.search}),(0,l.Lk)("div",vm,[(0,l.RG)(e.$slots,"selection",{search:e.search,remove:e.removeElement,values:r.visibleValues,isOpen:e.isOpen},(()=>[(0,l.bo)((0,l.Lk)("div",bm,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.visibleValues,((o,i)=>(0,l.RG)(e.$slots,"tag",{option:o,search:e.search,remove:e.removeElement},(()=>[((0,l.uX)(),(0,l.CE)("span",{class:"multiselect__tag",key:i,onMousedown:t[1]||(t[1]=(0,a.D$)((()=>{}),["prevent"]))},[(0,l.Lk)("span",{textContent:(0,n.v_)(e.getOptionLabel(o))},null,8,ym),(0,l.Lk)("i",{tabindex:"1",onKeypress:(0,a.jR)((0,a.D$)((t=>e.removeElement(o)),["prevent"]),["enter"]),onMousedown:(0,a.D$)((t=>e.removeElement(o)),["prevent"]),class:"multiselect__tag-icon"},null,40,_m)],32))])))),256))],512),[[a.aG,r.visibleValues.length>0]]),e.internalValue&&e.internalValue.length>o.limit?(0,l.RG)(e.$slots,"limit",{key:0},(()=>[(0,l.Lk)("strong",{class:"multiselect__strong",textContent:(0,n.v_)(o.limitText(e.internalValue.length-o.limit))},null,8,Cm)])):(0,l.Q3)("",!0)])),(0,l.bF)(a.eB,{name:"multiselect__loading"},{default:(0,l.k6)((()=>[(0,l.RG)(e.$slots,"loading",{},(()=>[(0,l.bo)((0,l.Lk)("div",wm,null,512),[[a.aG,o.loading]])]))])),_:3}),e.searchable?((0,l.uX)(),(0,l.CE)("input",{key:0,ref:"search",name:o.name,id:e.id,type:"text",autocomplete:"off",spellcheck:o.spellcheck,placeholder:e.placeholder,required:r.isRequired,style:(0,n.Tr)(r.inputStyle),value:e.search,disabled:o.disabled,tabindex:o.tabindex,"aria-label":o.name+"-searchbox",onInput:t[2]||(t[2]=t=>e.updateSearch(t.target.value)),onFocus:t[3]||(t[3]=(0,a.D$)((t=>e.activate()),["prevent"])),onBlur:t[4]||(t[4]=(0,a.D$)((t=>e.deactivate()),["prevent"])),onKeyup:t[5]||(t[5]=(0,a.jR)((t=>e.deactivate()),["esc"])),onKeydown:[t[6]||(t[6]=(0,a.jR)((0,a.D$)((t=>e.pointerForward()),["prevent"]),["down"])),t[7]||(t[7]=(0,a.jR)((0,a.D$)((t=>e.pointerBackward()),["prevent"]),["up"])),t[9]||(t[9]=(0,a.jR)((0,a.D$)((t=>e.removeLastElement()),["stop"]),["delete"]))],onKeypress:t[8]||(t[8]=(0,a.jR)((0,a.D$)((t=>e.addPointerElement(t)),["prevent","stop","self"]),["enter"])),class:"multiselect__input","aria-controls":"listbox-"+e.id},null,44,Am)):(0,l.Q3)("",!0),r.isSingleLabelVisible?((0,l.uX)(),(0,l.CE)("span",{key:1,class:"multiselect__single",onMousedown:t[10]||(t[10]=(0,a.D$)(((...t)=>e.toggle&&e.toggle(...t)),["prevent"]))},[(0,l.RG)(e.$slots,"singleLabel",{option:r.singleValue},(()=>[(0,l.eW)((0,n.v_)(e.currentOptionLabel),1)]))],32)):(0,l.Q3)("",!0),r.isPlaceholderVisible?((0,l.uX)(),(0,l.CE)("span",{key:2,class:"multiselect__placeholder",onMousedown:t[11]||(t[11]=(0,a.D$)(((...t)=>e.toggle&&e.toggle(...t)),["prevent"]))},[(0,l.RG)(e.$slots,"placeholder",{},(()=>[(0,l.eW)((0,n.v_)(e.placeholder),1)]))],32)):(0,l.Q3)("",!0)],512),(0,l.bF)(a.eB,{name:"multiselect"},{default:(0,l.k6)((()=>[(0,l.bo)((0,l.Lk)("div",{class:"multiselect__content-wrapper",onFocus:t[12]||(t[12]=(...t)=>e.activate&&e.activate(...t)),tabindex:"-1",onMousedown:t[13]||(t[13]=(0,a.D$)((()=>{}),["prevent"])),style:(0,n.Tr)({maxHeight:e.optimizedHeight+"px"}),ref:"list"},[(0,l.Lk)("ul",{class:"multiselect__content",style:(0,n.Tr)(r.contentStyle),role:"listbox",id:"listbox-"+e.id,"aria-multiselectable":e.multiple},[(0,l.RG)(e.$slots,"beforeList"),e.multiple&&e.max===e.internalValue.length?((0,l.uX)(),(0,l.CE)("li",Pm,[(0,l.Lk)("span",Dm,[(0,l.RG)(e.$slots,"maxElements",{},(()=>[(0,l.eW)("Maximum of "+(0,n.v_)(e.max)+" options selected. First remove a selected option to select another.",1)]))])])):(0,l.Q3)("",!0),!e.max||e.internalValue.length<e.max?((0,l.uX)(!0),(0,l.CE)(l.FK,{key:1},(0,l.pI)(e.filteredOptions,((t,o)=>((0,l.uX)(),(0,l.CE)("li",{class:"multiselect__element",key:o,"aria-selected":e.isSelected(t),id:e.id+"-"+o,role:t&&(t.$isLabel||t.$isDisabled)?null:"option"},[t&&(t.$isLabel||t.$isDisabled)?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("span",{key:0,class:(0,n.C4)([e.optionHighlight(o,t),"multiselect__option"]),onClick:(0,a.D$)((o=>e.select(t)),["stop"]),onMouseenter:(0,a.D$)((t=>e.pointerSet(o)),["self"]),"data-select":t&&t.isTag?e.tagPlaceholder:r.selectLabelText,"data-selected":r.selectedLabelText,"data-deselect":r.deselectLabelText},[(0,l.RG)(e.$slots,"option",{option:t,search:e.search,index:o},(()=>[(0,l.Lk)("span",null,(0,n.v_)(e.getOptionLabel(t)),1)]))],42,xm)),t&&(t.$isLabel||t.$isDisabled)?((0,l.uX)(),(0,l.CE)("span",{key:1,"data-select":e.groupSelect&&r.selectGroupLabelText,"data-deselect":e.groupSelect&&r.deselectGroupLabelText,class:(0,n.C4)([e.groupHighlight(o,t),"multiselect__option"]),onMouseenter:(0,a.D$)((t=>e.groupSelect&&e.pointerSet(o)),["self"]),onMousedown:(0,a.D$)((o=>e.selectGroup(t)),["prevent"])},[(0,l.RG)(e.$slots,"option",{option:t,search:e.search,index:o},(()=>[(0,l.Lk)("span",null,(0,n.v_)(e.getOptionLabel(t)),1)]))],42,Fm)):(0,l.Q3)("",!0)],8,Sm)))),128)):(0,l.Q3)("",!0),(0,l.bo)((0,l.Lk)("li",null,[(0,l.Lk)("span",Mm,[(0,l.RG)(e.$slots,"noResult",{search:e.search},(()=>[t[20]||(t[20]=(0,l.eW)("No elements found. Consider changing the search query."))]))])],512),[[a.aG,o.showNoResults&&0===e.filteredOptions.length&&e.search&&!o.loading]]),(0,l.bo)((0,l.Lk)("li",null,[(0,l.Lk)("span",Vm,[(0,l.RG)(e.$slots,"noOptions",{},(()=>[t[21]||(t[21]=(0,l.eW)("List is empty."))]))])],512),[[a.aG,o.showNoOptions&&(0===e.options.length||!0===r.hasOptionGroup&&0===e.filteredOptions.length)&&!e.search&&!o.loading]]),(0,l.RG)(e.$slots,"afterList")],12,Em)],36),[[a.aG,e.isOpen]])])),_:3})],42,Lm)}function Im(e){return 0!==e&&(!(!Array.isArray(e)||0!==e.length)||!e)}function Om(e){return(...t)=>!e(...t)}function Xm(e,t){void 0===e&&(e="undefined"),null===e&&(e="null"),!1===e&&(e="false");const o=e.toString().toLowerCase();return-1!==o.indexOf(t.trim())}function Tm(e){return e.filter((e=>!e.$isLabel))}function $m(e,t){return o=>o.reduce(((o,a)=>a[e]&&a[e].length?(o.push({$groupLabel:a[t],$isLabel:!0}),o.concat(a[e])):o),[])}const zm=(...e)=>t=>e.reduce(((e,t)=>t(e)),t);var Rm={data(){return{search:"",isOpen:!1,preferredOpenDirection:"below",optimizedHeight:this.maxHeight}},props:{internalSearch:{type:Boolean,default:!0},options:{type:Array,required:!0},multiple:{type:Boolean,default:!1},trackBy:{type:String},label:{type:String},searchable:{type:Boolean,default:!0},clearOnSelect:{type:Boolean,default:!0},hideSelected:{type:Boolean,default:!1},placeholder:{type:String,default:"Select option"},allowEmpty:{type:Boolean,default:!0},resetAfter:{type:Boolean,default:!1},closeOnSelect:{type:Boolean,default:!0},customLabel:{type:Function,default(e,t){return Im(e)?"":t?e[t]:e}},taggable:{type:Boolean,default:!1},tagPlaceholder:{type:String,default:"Press enter to create a tag"},tagPosition:{type:String,default:"top"},max:{type:[Number,Boolean],default:!1},id:{default:null},optionsLimit:{type:Number,default:1e3},groupValues:{type:String},groupLabel:{type:String},groupSelect:{type:Boolean,default:!1},blockKeys:{type:Array,default(){return[]}},preserveSearch:{type:Boolean,default:!1},preselectFirst:{type:Boolean,default:!1},preventAutofocus:{type:Boolean,default:!1},filteringSortFunc:{type:Function,default:null}},mounted(){!this.multiple&&this.max&&console.warn("[Vue-Multiselect warn]: Max prop should not be used when prop Multiple equals false."),this.preselectFirst&&!this.internalValue.length&&this.options.length&&this.select(this.filteredOptions[0])},computed:{internalValue(){return this.modelValue||0===this.modelValue?Array.isArray(this.modelValue)?this.modelValue:[this.modelValue]:[]},filteredOptions(){const e=this.search||"",t=e.toLowerCase().trim();let o=this.options.concat();return o=this.internalSearch?this.groupValues?this.filterAndFlat(o,t,this.label):this.filterOptions(o,t,this.label,this.customLabel):this.groupValues?$m(this.groupValues,this.groupLabel)(o):o,o=this.hideSelected?o.filter(Om(this.isSelected)):o,this.taggable&&t.length&&!this.isExistingOption(t)&&("bottom"===this.tagPosition?o.push({isTag:!0,label:e}):o.unshift({isTag:!0,label:e})),o.slice(0,this.optionsLimit)},valueKeys(){return this.trackBy?this.internalValue.map((e=>e[this.trackBy])):this.internalValue},optionKeys(){const e=this.groupValues?this.flatAndStrip(this.options):this.options;return e.map((e=>this.customLabel(e,this.label).toString().toLowerCase()))},currentOptionLabel(){return this.multiple?this.searchable?"":this.placeholder:this.internalValue.length?this.getOptionLabel(this.internalValue[0]):this.searchable?"":this.placeholder}},watch:{internalValue:{handler(){this.resetAfter&&this.internalValue.length&&(this.search="",this.$emit("update:modelValue",this.multiple?[]:null))},deep:!0},search(){this.$emit("search-change",this.search)}},emits:["open","search-change","close","select","update:modelValue","remove","tag"],methods:{getValue(){return this.multiple?this.internalValue:0===this.internalValue.length?null:this.internalValue[0]},filterAndFlat(e,t,o){return zm(this.filterGroups(t,o,this.groupValues,this.groupLabel,this.customLabel),$m(this.groupValues,this.groupLabel))(e)},flatAndStrip(e){return zm($m(this.groupValues,this.groupLabel),Tm)(e)},updateSearch(e){this.search=e},isExistingOption(e){return!!this.options&&this.optionKeys.indexOf(e)>-1},isSelected(e){const t=this.trackBy?e[this.trackBy]:e;return this.valueKeys.indexOf(t)>-1},isOptionDisabled(e){return!!e.$isDisabled},getOptionLabel(e){if(Im(e))return"";if(e.isTag)return e.label;if(e.$isLabel)return e.$groupLabel;const t=this.customLabel(e,this.label);return Im(t)?"":t},select(e,t){if(e.$isLabel&&this.groupSelect)this.selectGroup(e);else if(!(-1!==this.blockKeys.indexOf(t)||this.disabled||e.$isDisabled||e.$isLabel)&&(!this.max||!this.multiple||this.internalValue.length!==this.max)&&("Tab"!==t||this.pointerDirty)){if(e.isTag)this.$emit("tag",e.label,this.id),this.search="",this.closeOnSelect&&!this.multiple&&this.deactivate();else{const o=this.isSelected(e);if(o)return void("Tab"!==t&&this.removeElement(e));this.multiple?this.$emit("update:modelValue",this.internalValue.concat([e])):this.$emit("update:modelValue",e),this.$emit("select",e,this.id),this.clearOnSelect&&(this.search="")}this.closeOnSelect&&this.deactivate()}},selectGroup(e){const t=this.options.find((t=>t[this.groupLabel]===e.$groupLabel));if(t){if(this.wholeGroupSelected(t)){this.$emit("remove",t[this.groupValues],this.id);const e=this.trackBy?t[this.groupValues].map((e=>e[this.trackBy])):t[this.groupValues],o=this.internalValue.filter((t=>-1===e.indexOf(this.trackBy?t[this.trackBy]:t)));this.$emit("update:modelValue",o)}else{const e=t[this.groupValues].filter((e=>!(this.isOptionDisabled(e)||this.isSelected(e))));this.max&&e.splice(this.max-this.internalValue.length),this.$emit("select",e,this.id),this.$emit("update:modelValue",this.internalValue.concat(e))}this.closeOnSelect&&this.deactivate()}},wholeGroupSelected(e){return e[this.groupValues].every((e=>this.isSelected(e)||this.isOptionDisabled(e)))},wholeGroupDisabled(e){return e[this.groupValues].every(this.isOptionDisabled)},removeElement(e,t=!0){if(this.disabled)return;if(e.$isDisabled)return;if(!this.allowEmpty&&this.internalValue.length<=1)return void this.deactivate();const o="object"===typeof e?this.valueKeys.indexOf(e[this.trackBy]):this.valueKeys.indexOf(e);if(this.multiple){const e=this.internalValue.slice(0,o).concat(this.internalValue.slice(o+1));this.$emit("update:modelValue",e)}else this.$emit("update:modelValue",null);this.$emit("remove",e,this.id),this.closeOnSelect&&t&&this.deactivate()},removeLastElement(){-1===this.blockKeys.indexOf("Delete")&&0===this.search.length&&Array.isArray(this.internalValue)&&this.internalValue.length&&this.removeElement(this.internalValue[this.internalValue.length-1],!1)},activate(){this.isOpen||this.disabled||(this.adjustPosition(),this.groupValues&&0===this.pointer&&this.filteredOptions.length&&(this.pointer=1),this.isOpen=!0,this.searchable?(this.preserveSearch||(this.search=""),this.preventAutofocus||this.$nextTick((()=>this.$refs.search&&this.$refs.search.focus()))):this.preventAutofocus||"undefined"!==typeof this.$el&&this.$el.focus(),this.$emit("open",this.id))},deactivate(){this.isOpen&&(this.isOpen=!1,this.searchable?null!==this.$refs.search&&"undefined"!==typeof this.$refs.search&&this.$refs.search.blur():"undefined"!==typeof this.$el&&this.$el.blur(),this.preserveSearch||(this.search=""),this.$emit("close",this.getValue(),this.id))},toggle(){this.isOpen?this.deactivate():this.activate()},adjustPosition(){if("undefined"===typeof window)return;const e=this.$el.getBoundingClientRect().top,t=window.innerHeight-this.$el.getBoundingClientRect().bottom,o=t>this.maxHeight;o||t>e||"below"===this.openDirection||"bottom"===this.openDirection?(this.preferredOpenDirection="below",this.optimizedHeight=Math.min(t-40,this.maxHeight)):(this.preferredOpenDirection="above",this.optimizedHeight=Math.min(e-40,this.maxHeight))},filterOptions(e,t,o,a){return t?e.filter((e=>Xm(a(e,o),t))).sort(((e,t)=>"function"===typeof this.filteringSortFunc?this.filteringSortFunc(e,t):a(e,o).length-a(t,o).length)):e},filterGroups(e,t,o,a,l){return n=>n.map((n=>{if(!n[o])return console.warn("Options passed to vue-multiselect do not contain groups, despite the config."),[];const i=this.filterOptions(n[o],e,t,l);return i.length?{[a]:n[a],[o]:i}:[]}))}}},Wm={data(){return{pointer:0,pointerDirty:!1}},props:{showPointer:{type:Boolean,default:!0},optionHeight:{type:Number,default:40}},computed:{pointerPosition(){return this.pointer*this.optionHeight},visibleElements(){return this.optimizedHeight/this.optionHeight}},watch:{filteredOptions(){this.pointerAdjust()},isOpen(){this.pointerDirty=!1},pointer(){this.$refs.search&&this.$refs.search.setAttribute("aria-activedescendant",this.id+"-"+this.pointer.toString())}},methods:{optionHighlight(e,t){return{"multiselect__option--highlight":e===this.pointer&&this.showPointer,"multiselect__option--selected":this.isSelected(t)}},groupHighlight(e,t){if(!this.groupSelect)return["multiselect__option--disabled",{"multiselect__option--group":t.$isLabel}];const o=this.options.find((e=>e[this.groupLabel]===t.$groupLabel));return o&&!this.wholeGroupDisabled(o)?["multiselect__option--group",{"multiselect__option--highlight":e===this.pointer&&this.showPointer},{"multiselect__option--group-selected":this.wholeGroupSelected(o)}]:"multiselect__option--disabled"},addPointerElement({key:e}="Enter"){this.filteredOptions.length>0&&this.select(this.filteredOptions[this.pointer],e),this.pointerReset()},pointerForward(){this.pointer<this.filteredOptions.length-1&&(this.pointer++,this.$refs.list.scrollTop<=this.pointerPosition-(this.visibleElements-1)*this.optionHeight&&(this.$refs.list.scrollTop=this.pointerPosition-(this.visibleElements-1)*this.optionHeight),this.filteredOptions[this.pointer]&&this.filteredOptions[this.pointer].$isLabel&&!this.groupSelect&&this.pointerForward()),this.pointerDirty=!0},pointerBackward(){this.pointer>0?(this.pointer--,this.$refs.list.scrollTop>=this.pointerPosition&&(this.$refs.list.scrollTop=this.pointerPosition),this.filteredOptions[this.pointer]&&this.filteredOptions[this.pointer].$isLabel&&!this.groupSelect&&this.pointerBackward()):this.filteredOptions[this.pointer]&&this.filteredOptions[0].$isLabel&&!this.groupSelect&&this.pointerForward(),this.pointerDirty=!0},pointerReset(){this.closeOnSelect&&(this.pointer=0,this.$refs.list&&(this.$refs.list.scrollTop=0))},pointerAdjust(){this.pointer>=this.filteredOptions.length-1&&(this.pointer=this.filteredOptions.length?this.filteredOptions.length-1:0),this.filteredOptions.length>0&&this.filteredOptions[this.pointer].$isLabel&&!this.groupSelect&&this.pointerForward()},pointerSet(e){this.pointer=e,this.pointerDirty=!0}}},Nm={name:"vue-multiselect",mixins:[Rm,Wm],compatConfig:{MODE:3,ATTR_ENUMERATED_COERCION:!1},props:{name:{type:String,default:""},modelValue:{type:null,default(){return[]}},selectLabel:{type:String,default:"Premi invio per selezionare"},selectGroupLabel:{type:String,default:"Premi invio per selezionare il gruppo"},selectedLabel:{type:String,default:"Selezionato"},deselectLabel:{type:String,default:"Premi invio per rimuovere"},deselectGroupLabel:{type:String,default:"Premi invio per deselezionare il gruppo"},showLabels:{type:Boolean,default:!0},limit:{type:Number,default:99999},maxHeight:{type:Number,default:300},limitText:{type:Function,default:e=>`and ${e} more`},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},spellcheck:{type:Boolean,default:!1},openDirection:{type:String,default:""},showNoOptions:{type:Boolean,default:!0},showNoResults:{type:Boolean,default:!0},tabindex:{type:Number,default:0},required:{type:Boolean,default:!1}},computed:{hasOptionGroup(){return this.groupValues&&this.groupLabel&&this.groupSelect},isSingleLabelVisible(){return(this.singleValue||0===this.singleValue)&&(!this.isOpen||!this.searchable)&&!this.visibleValues.length},isPlaceholderVisible(){return!this.internalValue.length&&(!this.searchable||!this.isOpen)},visibleValues(){return this.multiple?this.internalValue.slice(0,this.limit):[]},singleValue(){return this.internalValue[0]},deselectLabelText(){return this.showLabels?this.deselectLabel:""},deselectGroupLabelText(){return this.showLabels?this.deselectGroupLabel:""},selectLabelText(){return this.showLabels?this.selectLabel:""},selectGroupLabelText(){return this.showLabels?this.selectGroupLabel:""},selectedLabelText(){return this.showLabels?this.selectedLabel:""},inputStyle(){return this.searchable||this.multiple&&this.modelValue&&this.modelValue.length?this.isOpen?{width:"100%"}:{width:"0",position:"absolute",padding:"0"}:""},contentStyle(){return this.options.length?{display:"inline-block"}:{display:"block"}},isAbove(){return"above"===this.openDirection||"top"===this.openDirection||"below"!==this.openDirection&&"bottom"!==this.openDirection&&"above"===this.preferredOpenDirection},showSearchInput(){return this.searchable&&(!this.hasSingleSelectedSlot||!this.visibleSingleValue&&0!==this.visibleSingleValue||this.isOpen)},isRequired(){return!1!==this.required&&this.internalValue.length<=0}}};const jm=(0,x.A)(Nm,[["render",Um]]);var Bm=jm,qm={name:"MultiSelectField",components:{MultiSelectCustom:Bm},props:{label:String,modelValue:Array,options:Array,labelKey:{type:String,default:"label"},trackBy:{type:String,default:"id"},placeholder:{type:String,default:"Seleziona..."},showControls:{type:Boolean,default:!0}},emits:["update:modelValue"],methods:{formatLabel(e){return e[this.labelKey]},selectAll(){this.$emit("update:modelValue",[...this.options])},clearAll(){this.$emit("update:modelValue",[]),this.$toast.show("Deselezionando tutti gli elementi la ricerca avverrà su tutti.",{type:"default",position:"bottom-right"})}}};const Km=(0,x.A)(qm,[["render",fm],["__scopeId","data-v-42131a18"]]);var Ym=Km;ue().extend(dm());var Jm={props:["filters","loading","reportName"],emits:["generate","close"],components:{FlatPickr:vt.A,MultiSelectField:Ym},data(){const e=ue()();return{form:{from:e.startOf("month").toDate(),to:e.endOf("month").toDate(),agent_id:[],operator_id:[],location_id:[],vendor_id:[]},rawAgents:[],operators:[],locations:[],vendors:[],configDate:{dateFormat:"Y-m-d",altInput:!0,altFormat:"d/m/Y",locale:bt.Italian},activeQuickRange:null,isQuickRangeSelection:!1}},computed:{agents(){return this.formatAndSort(this.rawAgents,"cognome","nome","cognome_nome")},enhancedOperators(){return this.formatAndSort(this.operators,"cognome","nome","cognome_nome")},enhancedVendors(){return this.sortByKey(this.vendors,"name")},enhancedLocations(){return this.sortByKey(this.locations,"location")}},async mounted(){const e=[P.A.get("https://dev.gixflow.cloud/api/users"),P.A.get("https://dev.gixflow.cloud/api/locations-table")];this.filters.includes("vendor")&&e.push(P.A.get("https://dev.gixflow.cloud/api/vendors"));const[t,o,a]=await Promise.all(e),l=Array.isArray(t.data)?t.data.flat():[];this.rawAgents=l.filter((e=>2===e.role_id)),this.operators=l.filter((e=>1===e.role_id)),this.locations=o.data||[],this.filters.includes("vendor")&&(this.vendors=a?.data||[]),this.filters.includes("agent")&&(this.form.agent_id=[...this.agents]),this.filters.includes("operator")&&(this.form.operator_id=[...this.enhancedOperators]),this.filters.includes("location")&&(this.form.location_id=[...this.enhancedLocations]),this.filters.includes("vendor")&&(this.form.vendor_id=[...this.enhancedVendors]),console.log("✅ Dati pre-caricati:",{agent_id:this.form.agent_id,operator_id:this.form.operator_id,location_id:this.form.location_id,vendor_id:this.form.vendor_id})},watch:{form:{handler(){this.isQuickRangeSelection||(this.activeQuickRange=null)},deep:!0}},methods:{onDateChanged(){this.isQuickRangeSelection||(this.activeQuickRange=null)},resetQuickRange(){this.activeQuickRange=null},customLabel(e){return`${e.cognome} ${e.nome}`},formatAndSort(e,t,o,a){return(e||[]).map((e=>({...e,[a]:`${e[t]} ${e[o]}`}))).sort(((e,t)=>e[a].localeCompare(t[a])))},sortByKey(e,t){return(e||[]).sort(((e,o)=>(e[t]||"").localeCompare(o[t]||"")))},getAllOptionsByKey(e){switch(e){case"agent_id":return this.agents;case"operator_id":return this.enhancedOperators;case"location_id":return this.enhancedLocations;case"vendor_id":return this.enhancedVendors;default:return[]}},submit(){const e={...this.form};console.log("🔍 form.operator_id (prima):",this.form.operator_id),["agent_id","operator_id","location_id","vendor_id"].forEach((t=>{if(Array.isArray(e[t]))if(0===e[t].length){const o=this.getAllOptionsByKey(t);e[t]=o.map((e=>e.id))}else e[t]=e[t].map((e=>e.id))})),console.log("📤 payload finale:",e),e.from&&(e.from=ue()(e.from).startOf("day").format("YYYY-MM-DD HH:mm:ss")),e.to&&(e.to=ue()(e.to).endOf("day").format("YYYY-MM-DD HH:mm:ss")),Object.keys(e).forEach((t=>(null==e[t]||""===e[t]||0===e[t]?.length)&&delete e[t])),this.$emit("generate",e)},setYesterday(){this.isQuickRangeSelection=!0;const e=ue()().subtract(1,"day");this.form.from=e.startOf("day").toDate(),this.form.to=e.endOf("day").toDate(),this.activeQuickRange="yesterday",this.$nextTick((()=>{setTimeout((()=>{this.isQuickRangeSelection=!1}),0)}))},setThisWeek(){this.isQuickRangeSelection=!0;const e=ue()().startOf("isoWeek"),t=ue()().endOf("isoWeek");this.form.from=e.startOf("day").toDate(),this.form.to=t.endOf("day").toDate(),this.activeQuickRange="thisWeek",this.$nextTick((()=>{setTimeout((()=>{this.isQuickRangeSelection=!1}),0)}))},setLastWeek(){this.isQuickRangeSelection=!0;const e=ue()().startOf("isoWeek").subtract(1,"week"),t=ue()().endOf("isoWeek").subtract(1,"week");this.form.from=e.startOf("day").toDate(),this.form.to=t.endOf("day").toDate(),this.activeQuickRange="lastWeek",this.$nextTick((()=>{setTimeout((()=>{this.isQuickRangeSelection=!1}),0)}))},setCurrentMonth(){this.isQuickRangeSelection=!0;const e=ue()();this.form.from=e.startOf("month").toDate(),this.form.to=e.endOf("month").toDate(),this.activeQuickRange="currentMonth",this.$nextTick((()=>{setTimeout((()=>{this.isQuickRangeSelection=!1}),0)}))},setLastMonth(){this.isQuickRangeSelection=!0;const e=ue()().subtract(1,"month");this.form.from=e.startOf("month").toDate(),this.form.to=e.endOf("month").toDate(),this.activeQuickRange="lastMonth",this.$nextTick((()=>{setTimeout((()=>{this.isQuickRangeSelection=!1}),0)}))},setLastThreeMonths(){this.isQuickRangeSelection=!0;const e=ue()(),t=e.subtract(2,"month").startOf("month"),o=e.endOf("day");this.form.from=t.toDate(),this.form.to=o.toDate(),this.activeQuickRange="lastThreeMonths",this.$nextTick((()=>{setTimeout((()=>{this.isQuickRangeSelection=!1}),0)}))}}};const Qm=(0,x.A)(Jm,[["render",sm],["__scopeId","data-v-601168b7"]]);var Gm=Qm;const Hm={class:"modal-overlay"},Zm={class:"modal-content"},eg={class:"form-group"},tg={class:"form-group"},og={class:"form-group"},ag={class:"modal-actions"},lg=["disabled"];function ng(e,t,o,i,s,r){return(0,l.uX)(),(0,l.CE)("div",Hm,[(0,l.Lk)("div",Zm,[t[10]||(t[10]=(0,l.Lk)("h2",null,[(0,l.Lk)("i",{class:"fa-solid fa-paper-plane icon-green"}),(0,l.eW)(" Invia Report via Email ")],-1)),(0,l.Lk)("form",{onSubmit:t[4]||(t[4]=(0,a.D$)(((...e)=>r.submit&&r.submit(...e)),["prevent"]))},[(0,l.Lk)("div",eg,[t[5]||(t[5]=(0,l.Lk)("label",{for:"recipients"},"Destinatari",-1)),(0,l.bo)((0,l.Lk)("textarea",{id:"recipients","onUpdate:modelValue":t[0]||(t[0]=e=>s.recipients=e),placeholder:"Inserisci una o più email separate da virgola",rows:"3",required:""},null,512),[[a.Jo,s.recipients]])]),(0,l.Lk)("div",tg,[t[6]||(t[6]=(0,l.Lk)("label",{for:"subject"},"Oggetto",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",id:"subject","onUpdate:modelValue":t[1]||(t[1]=e=>s.subject=e),placeholder:"Oggetto dell'email",required:""},null,512),[[a.Jo,s.subject]])]),(0,l.Lk)("div",og,[t[7]||(t[7]=(0,l.Lk)("label",{for:"message"},"Messaggio (HTML)",-1)),(0,l.bo)((0,l.Lk)("textarea",{id:"message","onUpdate:modelValue":t[2]||(t[2]=e=>s.htmlContent=e),placeholder:"Contenuto della mail in HTML",rows:"6",required:""},null,512),[[a.Jo,s.htmlContent]])]),(0,l.Lk)("div",ag,[(0,l.Lk)("button",{type:"button",onClick:t[3]||(t[3]=t=>e.$emit("close"))},t[8]||(t[8]=[(0,l.Lk)("i",{class:"fa-solid fa-xmark"},null,-1),(0,l.eW)(" Annulla ")])),(0,l.Lk)("button",{type:"submit",disabled:s.loading},[t[9]||(t[9]=(0,l.Lk)("i",{class:"fa-solid fa-paper-plane"},null,-1)),(0,l.eW)(" "+(0,n.v_)(s.loading?"Invio in corso...":"Invia Email"),1)],8,lg)])],32)])])}var ig={name:"SendReportModal",props:{csvBase64:{type:String,required:!0},reportType:{type:String,default:"appointments"},defaultSubject:{type:String,default:"Report Appuntamenti"},defaultHtml:{type:String,default:`\n            <h3>Report Appuntamenti</h3>\n            <p>In allegato trovi il report degli appuntamenti.</p>\n            <p>Periodo: <strong>${(new Date).toLocaleDateString("it-IT")}</strong></p>\n        `},filters:{type:Object,required:!0},summary:{type:Object,required:!0},total:{type:Number,required:!0}},data(){return{recipients:"",subject:this.defaultSubject,htmlContent:this.defaultHtml,loading:!1}},methods:{async submit(){const e=this.recipients.split(",").map((e=>e.trim())).filter((e=>e.includes("@")));if(0!==e.length){this.loading=!0;try{const t={recipients:e,subject:this.subject,reportType:this.reportType,csvBase64:this.csvBase64,filters:this.filters,summary:this.summary,total:this.total};await P.A.post("https://dev.gixflow.cloud/api/reports/send-email",t),this.$toast.show("Email inviata con successo.",{type:"success"}),this.$emit("sent"),this.$emit("close")}catch(t){console.error("Errore invio email:",t),this.$toast.show("Errore durante l'invio della mail.",{type:"error"})}finally{this.loading=!1}}else this.$toast.show("Inserisci almeno un indirizzo email valido",{type:"warning"})}}};const sg=(0,x.A)(ig,[["render",ng]]);var rg=sg,dg={name:"AppointmentsReport",components:{ReportFilterModal:Gm,SendReportModal:rg},data(){return{showModal:!0,loading:!1,data:[],summary:{total:0,statusBreakdown:{}},dates:{from:null,to:null},columns:[{label:"ID",field:"id"},{label:"Data",field:"date_start"},{label:"Agente",field:"agent"},{label:"Operatore",field:"operator"},{label:"Stato",field:"status"},{label:"Sede",field:"sede"}],sortField:"date_start",sortOrder:"asc",currentPage:1,itemsPerPage:10,searchText:"",reportReady:!1,appliedFilters:{},sendModalOpen:!1}},computed:{filteredRows(){const e=this.searchText.toLowerCase(),t=this.data.filter((t=>Object.values(t).some((t=>String(t).toLowerCase().includes(e)))));return this.sortRows(t)},paginatedRows(){const e=(this.currentPage-1)*this.itemsPerPage;return this.filteredRows.slice(e,e+this.itemsPerPage)},totalPages(){return Math.ceil(this.filteredRows.length/this.itemsPerPage)},visiblePages(){const e=this.totalPages,t=this.currentPage,o=[];if(e<=5)return Array.from({length:e},((e,t)=>t+1));t>2&&o.push(1),t>3&&o.push("...");for(let a=Math.max(2,t-1);a<=Math.min(e-1,t+1);a++)o.push(a);return t<e-2&&o.push("..."),t<e&&o.push(e),o},computedFilters(){return{from:this.appliedFilters.from,to:this.appliedFilters.to,agentLabel:this.resolveFilterNames(this.appliedFilters.agent_id,this.agents).join(", "),operatorLabel:this.resolveFilterNames(this.appliedFilters.operator_id,this.operators).join(", "),locationLabel:this.resolveFilterNames(this.appliedFilters.location_id,this.locations,"location").join(", "),vendorLabel:this.resolveFilterNames(this.appliedFilters.vendor_id,this.vendors,"name").join(", ")}}},mounted(){this.loadLookupData()},methods:{async loadLookupData(){try{const[e,t,o]=await Promise.all([P.A.get("https://dev.gixflow.cloud/api/users"),P.A.get("https://dev.gixflow.cloud/api/locations-table"),P.A.get("https://dev.gixflow.cloud/api/vendors")]),a=Array.isArray(e.data)?e.data.flat():[];this.agents=a.filter((e=>2===e.role_id)),this.operators=a.filter((e=>1===e.role_id)),this.locations=t.data||[],this.vendors=o.data||[],this.lookupReady=!0}catch(e){console.error("Errore caricamento lookup:",e)}},async handleGenerate(e){this.loading=!0;try{this.lookupReady||await this.loadLookupData();const t=await P.A.get("https://dev.gixflow.cloud/api/reports/appointments",{params:e});this.data=t.data.data||[],this.summary.total=t.data.total||0,this.summary.statusBreakdown=t.data.summary||{},this.dates={from:e.from,to:e.to},this.currentPage=1,this.reportReady=!0,this.showModal=!1,this.appliedFilters={...e,agent_names:this.resolveFilterNames(e.agent_id,this.agents),operator_names:this.resolveFilterNames(e.operator_id,this.operators),location_names:this.resolveFilterNames(e.location_id,this.locations,"location"),vendor_names:this.resolveFilterNames(e.vendor_id,this.vendors,"name")}}catch(t){console.error("Errore caricamento report:",t),this.$toast.show("L'inserimento delle date è obbligatorio.",{type:"error",position:"bottom-right"})}finally{this.loading=!1}},formatDate(e){const t=new Date(e),o=t.toLocaleDateString("it-IT"),a=t.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"});return`${o} ${a}`},formatDateOnly(e){if(!e)return"";const t=new Date(e);return t.toLocaleDateString("it-IT")},capitalize(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""},percentage(e){const t=this.summary.total||1;return(e/t*100).toFixed(2)},extractNames(e,t){const o=[...new Set(e.map((e=>e[t])).filter(Boolean))];return 0===o.length?["Tutti"]:o},async exportCSV(){this.loading=!0;try{const e=["ID","Data","Agente","Operatore","Stato","Sede"],t=[e.join(","),...this.data.map((e=>[e.id,this.formatDate(e.date_start),e.agent,e.operator,e.status,e.sede].join(",")))].join("\n"),o=new Blob([t],{type:"text/csv"}),a=document.createElement("a");a.href=URL.createObjectURL(o),a.download="report_appuntamenti.csv",a.click()}catch(e){console.error("Errore CSV:",e),this.$toast.show("Errore durante l'esportazione CSV",{type:"error",position:"bottom-right"})}finally{this.loading=!1}},copyAllReportToClipboard(){const e=this.columns.map((e=>e.label)).join("\t"),t=this.data.map((e=>this.columns.map((t=>e[t.field])).join("\t"))),o=[e,...t].join("\n");navigator.clipboard.writeText(o).then((()=>{this.$toast?.show?.("Righe copiate negli appunti.",{type:"success",position:"bottom-right"})})).catch((e=>{console.error("❌ Errore durante la copia:",e),this.$toast?.show?.("Errore durante la copia",{type:"error",position:"bottom-right"})}))},generateCSVBase64(){const e=["ID","Data","Agente","Operatore","Stato","Sede"],t=[e.join(","),...this.data.map((e=>[e.id,this.formatDate(e.date_start),e.agent,e.operator,e.status,e.sede].join(",")))].join("\n");return btoa(unescape(encodeURIComponent(t)))},sort(e){this.sortField===e?this.sortOrder="asc"===this.sortOrder?"desc":"asc":(this.sortField=e,this.sortOrder="asc"),this.loading=!0,setTimeout((()=>{this.loading=!1}),200)},sortRows(e){return e.sort(((e,t)=>{let o=e[this.sortField],a=t[this.sortField];return"string"===typeof o&&(o=o.toLowerCase()),"string"===typeof a&&(a=a.toLowerCase()),o<a?"asc"===this.sortOrder?-1:1:o>a?"asc"===this.sortOrder?1:-1:0}))},changePage(e){e>=1&&e<=this.totalPages&&(this.currentPage=e)},isAllSelected(e,t){if(!Array.isArray(e))return!0;const o=t.map((e=>String(e.id))).sort(),a=e.map(String).sort();return JSON.stringify(a)===JSON.stringify(o)},resolveFilterNames(e,t,o="cognome_nome"){const a=Array.isArray(e)?e:null!=e?[e]:[];if(0===a.length||this.isAllSelected(a,t))return["Tutti"];const l=t.filter((e=>a.includes(e.id))).map((e=>"cognome_nome"===o?`${e.cognome} ${e.nome}`:e[o]));return l.length>0?l:["Tutti"]}},watch:{itemsPerPage(){this.currentPage=1}}};const cg=(0,x.A)(dg,[["render",tm]]);var ug=cg;const pg={class:"report-page"},hg={key:0,class:"loading-overlay"},mg={key:0,class:"placeholder"},gg={key:1},kg={class:"report-range"},fg={class:"summary-wrapper"},Lg={class:"summary-box"},vg={class:"summary-box"},bg={class:"status-summary"},yg={class:"percentage"},_g={class:"top-controls"},Cg={class:"left-controls"},wg={class:"table-search-wrapper"},Ag={class:"table-wrapper"},Eg={class:"table"},Pg=["onClick"],Dg={key:0},Sg={key:0},xg={class:"table-footer"},Fg={class:"footer-left"},Mg=["value"],Vg={class:"total-count"},Ug={class:"pagination"},Ig=["disabled"],Og=["onClick"],Xg={key:1,class:"ellipsis"},Tg=["disabled"];function $g(e,t,o,i,s,r){const d=(0,l.g2)("ReportFilterModal"),c=(0,l.g2)("SendReportModal");return(0,l.uX)(),(0,l.CE)("div",pg,[s.loading?((0,l.uX)(),(0,l.CE)("div",hg,t[11]||(t[11]=[(0,l.Lk)("div",{class:"spinner-box"},[(0,l.Lk)("i",{class:"fa-solid fa-spinner fa-spin fa-2x"}),(0,l.Lk)("p",null,"Caricamento...")],-1)]))):(0,l.Q3)("",!0),s.showModal?((0,l.uX)(),(0,l.Wv)(d,{key:1,loading:s.loading,filters:["agent","location","vendor","status","dateRange"],reportName:"Contratti per agente",onGenerate:r.handleGenerate,onClose:t[0]||(t[0]=e=>s.showModal=!1)},null,8,["loading","onGenerate"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:2},[s.reportReady?((0,l.uX)(),(0,l.CE)("div",gg,[t[37]||(t[37]=(0,l.Lk)("h2",null,[(0,l.Lk)("i",{class:"fa-solid fa-file-contract icon-green"}),(0,l.eW)(" Report Contratti per Agente")],-1)),(0,l.Lk)("p",kg,[t[15]||(t[15]=(0,l.Lk)("strong",null,"Periodo:",-1)),(0,l.eW)(" "+(0,n.v_)(r.formatDateOnly(s.dates.from))+" → "+(0,n.v_)(r.formatDateOnly(s.dates.to))+" | ",1),t[16]||(t[16]=(0,l.Lk)("strong",null,"Generato il:",-1)),(0,l.eW)(" "+(0,n.v_)(r.formatDate(new Date)),1)]),(0,l.Lk)("div",fg,[(0,l.Lk)("div",Lg,[t[25]||(t[25]=(0,l.Lk)("h3",null,[(0,l.Lk)("i",{class:"fa-solid fa-sliders icon-green"}),(0,l.eW)(" Filtri applicati:")],-1)),(0,l.Lk)("ul",null,[(0,l.Lk)("li",null,[t[17]||(t[17]=(0,l.Lk)("i",{class:"fa-solid fa-calendar-days"},null,-1)),t[18]||(t[18]=(0,l.eW)(" Periodo: ")),(0,l.Lk)("strong",null,(0,n.v_)(r.formatDateOnly(s.appliedFilters.from))+" - "+(0,n.v_)(r.formatDateOnly(s.appliedFilters.to)),1)]),(0,l.Lk)("li",null,[t[19]||(t[19]=(0,l.Lk)("i",{class:"fa-solid fa-building"},null,-1)),t[20]||(t[20]=(0,l.eW)(" Sede: ")),(0,l.Lk)("strong",null,(0,n.v_)(s.appliedFilters.locationLabel||"Tutti"),1)]),(0,l.Lk)("li",null,[t[21]||(t[21]=(0,l.Lk)("i",{class:"fa-solid fa-store"},null,-1)),t[22]||(t[22]=(0,l.eW)(" Vendor: ")),(0,l.Lk)("strong",null,(0,n.v_)(s.appliedFilters.vendorLabel||"Tutti"),1)]),(0,l.Lk)("li",null,[t[23]||(t[23]=(0,l.Lk)("i",{class:"fa-solid fa-circle-check"},null,-1)),t[24]||(t[24]=(0,l.eW)(" Stato: ")),(0,l.Lk)("strong",null,(0,n.v_)(s.appliedFilters.statusLabel||"Tutti"),1)])])]),(0,l.Lk)("div",vg,[(0,l.Lk)("h3",null,[t[26]||(t[26]=(0,l.Lk)("i",{class:"fa-solid fa-list-ol icon-green"},null,-1)),t[27]||(t[27]=(0,l.eW)(" Totale contratti: ")),(0,l.Lk)("strong",null,(0,n.v_)(s.summary.total),1)]),(0,l.Lk)("ul",bg,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.summary.statusBreakdown,((e,o)=>((0,l.uX)(),(0,l.CE)("li",{key:o},[t[28]||(t[28]=(0,l.Lk)("i",{class:"fa-solid fa-circle-info icon-green"},null,-1)),(0,l.eW)(" "+(0,n.v_)(r.capitalize(o))+": ",1),(0,l.Lk)("strong",null,(0,n.v_)(e),1),(0,l.Lk)("span",yg,"("+(0,n.v_)(r.percentage(e))+"%)",1)])))),128))])])]),(0,l.Lk)("div",_g,[(0,l.Lk)("div",Cg,[(0,l.Lk)("button",{class:"function-button-primary",onClick:t[2]||(t[2]=(...e)=>r.exportCSV&&r.exportCSV(...e)),title:"Scarica CSV"},t[29]||(t[29]=[(0,l.Lk)("i",{class:"fa-solid fa-download"},null,-1)])),(0,l.Lk)("button",{class:"function-button-primary",onClick:t[3]||(t[3]=e=>s.showModal=!0),title:"Modifica filtri"},t[30]||(t[30]=[(0,l.Lk)("i",{class:"fa-solid fa-filter-circle-xmark"},null,-1)])),(0,l.Lk)("button",{class:"function-button-primary",onClick:t[4]||(t[4]=e=>s.sendModalOpen=!0),title:"Invia email"},t[31]||(t[31]=[(0,l.Lk)("i",{class:"fa-solid fa-paper-plane"},null,-1)])),(0,l.Lk)("button",{class:"function-button-primary",onClick:t[5]||(t[5]=(...e)=>r.copyAllReportToClipboard&&r.copyAllReportToClipboard(...e)),title:"Copia tutto"},t[32]||(t[32]=[(0,l.Lk)("i",{class:"fa-solid fa-copy"},null,-1)]))]),(0,l.Lk)("div",wg,[(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>s.searchText=e),type:"text",placeholder:"Cerca nei risultati..."},null,512),[[a.Jo,s.searchText]])])]),s.sendModalOpen?((0,l.uX)(),(0,l.Wv)(c,{key:0,csvBase64:r.generateCSVBase64(),reportType:"contracts-by-agent",defaultSubject:`Report Contratti (${r.formatDateOnly(s.dates.from)} - ${r.formatDateOnly(s.dates.to)})`,filters:s.appliedFilters,summary:s.summary.statusBreakdown,total:s.summary.total,onClose:t[7]||(t[7]=e=>s.sendModalOpen=!1)},null,8,["csvBase64","defaultSubject","filters","summary","total"])):(0,l.Q3)("",!0),(0,l.Lk)("div",Ag,[(0,l.Lk)("table",Eg,[(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.columns,(e=>((0,l.uX)(),(0,l.CE)("th",{key:e.field,onClick:t=>r.sort(e.field)},[(0,l.eW)((0,n.v_)(e.label)+" ",1),s.sortField===e.field?((0,l.uX)(),(0,l.CE)("span",Dg,[(0,l.Lk)("i",{class:(0,n.C4)("asc"===s.sortOrder?"fa-solid fa-caret-up":"fa-solid fa-caret-down")},null,2)])):(0,l.Q3)("",!0)],8,Pg)))),128))])]),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.paginatedRows,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id},[(0,l.Lk)("td",null,(0,n.v_)(e.id),1),(0,l.Lk)("td",null,(0,n.v_)(r.formatDateOnly(e.completion_date)),1),(0,l.Lk)("td",null,(0,n.v_)(e.agent),1),(0,l.Lk)("td",null,(0,n.v_)(e.status),1),(0,l.Lk)("td",null,(0,n.v_)(e.vendor),1),(0,l.Lk)("td",null,(0,n.v_)(e.location),1)])))),128)),0===r.paginatedRows.length?((0,l.uX)(),(0,l.CE)("tr",Sg,t[33]||(t[33]=[(0,l.Lk)("td",{colspan:"6"},"Nessun contratto trovato.",-1)]))):(0,l.Q3)("",!0)])]),(0,l.Lk)("div",xg,[(0,l.Lk)("div",Fg,[(0,l.Lk)("label",null,[t[34]||(t[34]=(0,l.eW)(" Risultati: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>s.itemsPerPage=e)},[((0,l.uX)(),(0,l.CE)(l.FK,null,(0,l.pI)([5,10,20,50],(e=>(0,l.Lk)("option",{key:e,value:e},(0,n.v_)(e),9,Mg))),64))],512),[[a.u1,s.itemsPerPage,void 0,{number:!0}]])]),(0,l.Lk)("span",Vg,(0,n.v_)(r.filteredRows.length)+" risultati totali",1)]),(0,l.Lk)("div",Ug,[(0,l.Lk)("button",{disabled:1===s.currentPage,onClick:t[9]||(t[9]=e=>r.changePage(s.currentPage-1))},t[35]||(t[35]=[(0,l.Lk)("i",{class:"fa-solid fa-backward-step"},null,-1)]),8,Ig),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.visiblePages,(e=>((0,l.uX)(),(0,l.CE)("span",{key:e},["..."!==e?((0,l.uX)(),(0,l.CE)("button",{key:0,class:(0,n.C4)({active:e===s.currentPage}),onClick:t=>r.changePage(e)},(0,n.v_)(e),11,Og)):((0,l.uX)(),(0,l.CE)("span",Xg,"..."))])))),128)),(0,l.Lk)("button",{disabled:s.currentPage===r.totalPages,onClick:t[10]||(t[10]=e=>r.changePage(s.currentPage+1))},t[36]||(t[36]=[(0,l.Lk)("i",{class:"fa-solid fa-forward-step"},null,-1)]),8,Tg)])])])])):((0,l.uX)(),(0,l.CE)("div",mg,[t[13]||(t[13]=(0,l.Lk)("i",{class:"fa-solid fa-filter-circle-exclamation icon-green"},null,-1)),t[14]||(t[14]=(0,l.Lk)("p",{class:"placeholder-text"},"Seleziona i parametri per generare il report!",-1)),(0,l.Lk)("button",{class:"filter-again-btn",onClick:t[1]||(t[1]=e=>s.showModal=!0)},t[12]||(t[12]=[(0,l.Lk)("i",{class:"fa-solid fa-filter"},null,-1),(0,l.eW)(" Apri filtri ")]))]))],64))])}var zg={name:"ContractsByAgentReport",components:{ReportFilterModal:Gm,SendReportModal:rg},data(){return{showModal:!0,loading:!1,data:[],summary:{total:0,statusBreakdown:{}},dates:{from:null,to:null},appliedFilters:{},reportReady:!1,sendModalOpen:!1,searchText:"",currentPage:1,itemsPerPage:10,sortField:"completion_date",sortOrder:"desc",columns:[{label:"ID",field:"id"},{label:"Data Firma",field:"completion_date"},{label:"Agente",field:"agent"},{label:"Stato",field:"status"},{label:"Vendor",field:"vendor"},{label:"Sede",field:"location"}]}},computed:{filteredRows(){const e=this.searchText.toLowerCase();return this.sortRows(this.data.filter((t=>Object.values(t).some((t=>String(t).toLowerCase().includes(e))))))},paginatedRows(){const e=(this.currentPage-1)*this.itemsPerPage;return this.filteredRows.slice(e,e+this.itemsPerPage)},totalPages(){return Math.ceil(this.filteredRows.length/this.itemsPerPage)},visiblePages(){const e=this.totalPages,t=this.currentPage,o=[];if(e<=5)return Array.from({length:e},((e,t)=>t+1));t>2&&o.push(1),t>3&&o.push("...");for(let a=Math.max(2,t-1);a<=Math.min(e-1,t+1);a++)o.push(a);return t<e-2&&o.push("..."),t<e&&o.push(e),o}},methods:{async handleGenerate(e){this.loading=!0;try{const t=await P.A.get("https://dev.gixflow.cloud/api/reports/contracts-by-agent",{params:e});this.data=t.data.data||[],this.summary.total=t.data.total||0,this.summary.statusBreakdown=t.data.summary||{},this.dates={from:e.from,to:e.to},this.appliedFilters=e,this.reportReady=!0,this.showModal=!1,this.currentPage=1}catch(t){console.error("Errore caricamento report:",t)}finally{this.loading=!1}},formatDate(e){const t=new Date(e),o=t.toLocaleDateString("it-IT"),a=t.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"});return`${o} ${a}`},formatDateOnly(e){return e?new Date(e).toLocaleDateString("it-IT"):""},capitalize(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""},percentage(e){const t=this.summary.total||1;return(e/t*100).toFixed(2)},sort(e){this.sortField===e?this.sortOrder="asc"===this.sortOrder?"desc":"asc":(this.sortField=e,this.sortOrder="asc")},sortRows(e){return e.sort(((e,t)=>{let o=e[this.sortField],a=t[this.sortField];return"string"===typeof o&&(o=o.toLowerCase()),"string"===typeof a&&(a=a.toLowerCase()),o<a?"asc"===this.sortOrder?-1:1:o>a?"asc"===this.sortOrder?1:-1:0}))},changePage(e){e>=1&&e<=this.totalPages&&(this.currentPage=e)},exportCSV(){const e=this.columns.map((e=>e.label)).join(","),t=this.data.map((e=>[e.id,this.formatDate(e.completion_date),e.agent,e.status,e.vendor,e.location].join(","))),o=new Blob([e,...t].join("\n"),{type:"text/csv"}),a=document.createElement("a");a.href=URL.createObjectURL(o),a.download="report_contratti.csv",a.click()},generateCSVBase64(){const e=this.columns.map((e=>e.label)).join(","),t=this.data.map((e=>[e.id,this.formatDate(e.completion_date),e.agent,e.status,e.vendor,e.location].join(",")));return btoa(unescape(encodeURIComponent([e,...t].join("\n"))))},copyAllReportToClipboard(){const e=this.columns.map((e=>e.label)).join("\t"),t=this.data.map((e=>[e.id,this.formatDate(e.completion_date),e.agent,e.status,e.vendor,e.location].join("\t")));navigator.clipboard.writeText([e,...t].join("\n")).then((()=>{this.$toast?.show?.("Report copiato!",{type:"success"})}))}},watch:{itemsPerPage(){this.currentPage=1}}};const Rg=(0,x.A)(zg,[["render",$g]]);var Wg=Rg;const Ng={class:"report-page"},jg={key:0,class:"loading-overlay"},Bg={key:0,class:"placeholder"},qg={key:1},Kg={class:"report-range"},Yg={class:"grid-4-cols"},Jg={class:"grid-box col-1-4"},Qg={class:"grid-box col-1-4"},Gg={class:"status-summary"},Hg={class:"grid-box col-2-4"},Zg={class:"sedi-summary-flex"},ek={class:"top-controls"},tk={class:"left-controls"},ok={class:"table-search-wrapper"},ak={class:"table-wrapper"},lk={class:"table"},nk={key:0},ik={class:"table-footer"},sk={class:"footer-left"},rk=["value"],dk={class:"total-count"},ck={class:"pagination"},uk=["disabled"],pk=["onClick"],hk={key:1,class:"ellipsis"},mk=["disabled"];function gk(e,t,o,i,s,r){const d=(0,l.g2)("ReportFilterModal"),c=(0,l.g2)("SendReportModal");return(0,l.uX)(),(0,l.CE)("div",Ng,[s.loading?((0,l.uX)(),(0,l.CE)("div",jg,t[18]||(t[18]=[(0,l.Lk)("div",{class:"spinner-box"},[(0,l.Lk)("i",{class:"fa-solid fa-spinner fa-spin fa-2x"}),(0,l.Lk)("p",null,"Caricamento...")],-1)]))):(0,l.Q3)("",!0),s.showModal?((0,l.uX)(),(0,l.Wv)(d,{key:1,loading:s.loading,filters:["dateRange"],reportName:"Efficienza per sede",onGenerate:r.handleGenerate,onClose:t[0]||(t[0]=e=>s.showModal=!1)},null,8,["loading","onGenerate"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:2},[s.reportReady?((0,l.uX)(),(0,l.CE)("div",qg,[t[54]||(t[54]=(0,l.Lk)("h2",null,[(0,l.Lk)("i",{class:"fa-solid fa-chart-line icon-green"}),(0,l.eW)(" Report Efficienza per Sede ")],-1)),(0,l.Lk)("p",Kg,[t[22]||(t[22]=(0,l.Lk)("strong",null,"Report dal:",-1)),(0,l.eW)(" "+(0,n.v_)(r.formatDate(s.dates.from))+" al "+(0,n.v_)(r.formatDate(s.dates.to))+" | ",1),t[23]||(t[23]=(0,l.Lk)("strong",null,"Generato il:",-1)),(0,l.eW)(" "+(0,n.v_)(r.formatDate(new Date)),1)]),(0,l.Lk)("div",Yg,[(0,l.Lk)("div",Jg,[t[27]||(t[27]=(0,l.Lk)("h3",null,[(0,l.Lk)("i",{class:"fa-solid fa-sliders icon-green"}),(0,l.eW)(" Filtri applicati: ")],-1)),(0,l.Lk)("ul",null,[(0,l.Lk)("li",null,[t[24]||(t[24]=(0,l.Lk)("i",{class:"fa-solid fa-calendar-days"},null,-1)),t[25]||(t[25]=(0,l.eW)(" Periodo: ")),(0,l.Lk)("strong",null,(0,n.v_)(r.formatDateOnly(s.dates.from)),1),t[26]||(t[26]=(0,l.eW)(" - ")),(0,l.Lk)("strong",null,(0,n.v_)(r.formatDateOnly(s.dates.to)),1)])])]),(0,l.Lk)("div",Qg,[t[38]||(t[38]=(0,l.Lk)("h3",null,[(0,l.Lk)("i",{class:"fa-solid fa-list-ol icon-green"}),(0,l.eW)(" Riepilogo Totale: ")],-1)),(0,l.Lk)("ul",Gg,[(0,l.Lk)("li",null,[t[28]||(t[28]=(0,l.Lk)("i",{class:"fa-solid fa-calendar-check icon-green"},null,-1)),t[29]||(t[29]=(0,l.eW)(" Appuntamenti: ")),(0,l.Lk)("strong",null,(0,n.v_)(r.summary.totalAppointments),1)]),(0,l.Lk)("li",null,[t[30]||(t[30]=(0,l.Lk)("i",{class:"fa-solid fa-clock icon-green"},null,-1)),t[31]||(t[31]=(0,l.eW)(" Ore: ")),(0,l.Lk)("strong",null,(0,n.v_)(r.summary.totalHours),1)]),(0,l.Lk)("li",null,[t[32]||(t[32]=(0,l.Lk)("i",{class:"fa-solid fa-chart-line icon-green"},null,-1)),t[33]||(t[33]=(0,l.eW)(" Resa: ")),(0,l.Lk)("strong",null,(0,n.v_)(r.summary.resa),1)]),(0,l.Lk)("li",null,[t[34]||(t[34]=(0,l.Lk)("i",{class:"fa-solid fa-circle-check icon-green"},null,-1)),t[35]||(t[35]=(0,l.eW)(" Positivi: ")),(0,l.Lk)("strong",null,(0,n.v_)(r.summary.totalPositive),1)]),(0,l.Lk)("li",null,[t[36]||(t[36]=(0,l.Lk)("i",{class:"fa-solid fa-percentage icon-green"},null,-1)),t[37]||(t[37]=(0,l.eW)(" % POS: ")),(0,l.Lk)("strong",null,(0,n.v_)(r.summary.posRate)+"%",1)])])]),(0,l.Lk)("div",Hg,[t[45]||(t[45]=(0,l.Lk)("h3",null,[(0,l.Lk)("i",{class:"fa-solid fa-building icon-green"}),(0,l.eW)(" Dettagli per Sede: ")],-1)),(0,l.Lk)("div",Zg,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.summaryBySede,((e,o)=>((0,l.uX)(),(0,l.CE)("div",{key:o,class:"sede-card"},[(0,l.Lk)("h4",null,[t[39]||(t[39]=(0,l.Lk)("i",{class:"fa-solid fa-location-dot icon-green"},null,-1)),(0,l.eW)(" "+(0,n.v_)(o),1)]),(0,l.Lk)("ul",null,[(0,l.Lk)("li",null,[t[40]||(t[40]=(0,l.eW)("Appuntamenti: ")),(0,l.Lk)("strong",null,(0,n.v_)(e.appuntamenti_totali),1)]),(0,l.Lk)("li",null,[t[41]||(t[41]=(0,l.eW)("Ore: ")),(0,l.Lk)("strong",null,(0,n.v_)(e.ore_erogate.toFixed(2)),1)]),(0,l.Lk)("li",null,[t[42]||(t[42]=(0,l.eW)("Resa: ")),(0,l.Lk)("strong",null,(0,n.v_)((e.appuntamenti_totali/Math.max(e.ore_erogate,1)).toFixed(2)),1)]),(0,l.Lk)("li",null,[t[43]||(t[43]=(0,l.eW)("Positivi: ")),(0,l.Lk)("strong",null,(0,n.v_)(e.appuntamenti_positivi),1)]),(0,l.Lk)("li",null,[t[44]||(t[44]=(0,l.eW)("Conversion: ")),(0,l.Lk)("strong",null,(0,n.v_)((e.appuntamenti_positivi/Math.max(e.appuntamenti_totali,1)*100).toFixed(2))+" % ",1)])])])))),128))])])]),(0,l.Lk)("div",ek,[(0,l.Lk)("div",tk,[(0,l.Lk)("button",{class:"function-button-primary",onClick:t[2]||(t[2]=(...e)=>r.exportCSV&&r.exportCSV(...e)),title:"Scarica il report in formato CSV"},t[46]||(t[46]=[(0,l.Lk)("i",{class:"fa-solid fa-download"},null,-1)])),(0,l.Lk)("button",{class:"function-button-primary",onClick:t[3]||(t[3]=e=>s.showModal=!0),title:"Modifica filtri"},t[47]||(t[47]=[(0,l.Lk)("i",{class:"fa-solid fa-filter-circle-xmark"},null,-1)])),(0,l.Lk)("button",{class:"function-button-primary",onClick:t[4]||(t[4]=e=>s.sendModalOpen=!0),title:"Invia via email"},t[48]||(t[48]=[(0,l.Lk)("i",{class:"fa-solid fa-paper-plane"},null,-1)])),(0,l.Lk)("button",{class:"function-button-primary",onClick:t[5]||(t[5]=(...e)=>r.copyAllReportToClipboard&&r.copyAllReportToClipboard(...e)),title:"Copia tutti i dati"},t[49]||(t[49]=[(0,l.Lk)("i",{class:"fa-solid fa-copy"},null,-1)]))]),(0,l.Lk)("div",ok,[(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>s.searchText=e),type:"text",placeholder:"Cerca nei risultati..."},null,512),[[a.Jo,s.searchText]])])]),s.sendModalOpen?((0,l.uX)(),(0,l.Wv)(c,{key:0,csvBase64:r.generateCSVBase64(),reportType:"location-efficiency",defaultSubject:`Report Efficienza (${r.formatDateOnly(s.dates.from)} - ${r.formatDateOnly(s.dates.to)})`,filters:r.computedFilters,summary:r.summary,total:r.summary.totalAppointments,onClose:t[7]||(t[7]=e=>s.sendModalOpen=!1)},null,8,["csvBase64","defaultSubject","filters","summary","total"])):(0,l.Q3)("",!0),(0,l.Lk)("div",ak,[(0,l.Lk)("table",lk,[(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",{onClick:t[8]||(t[8]=e=>r.sort("mese"))},"Mese"),(0,l.Lk)("th",{onClick:t[9]||(t[9]=e=>r.sort("sede"))},"Sede"),(0,l.Lk)("th",{onClick:t[10]||(t[10]=e=>r.sort("ore_erogate"))},"Ore"),(0,l.Lk)("th",{onClick:t[11]||(t[11]=e=>r.sort("appuntamenti_totali"))},"App"),(0,l.Lk)("th",{onClick:t[12]||(t[12]=e=>r.sort("resa_oraria"))},"Resa"),(0,l.Lk)("th",{onClick:t[13]||(t[13]=e=>r.sort("appuntamenti_positivi"))},"Positivi"),(0,l.Lk)("th",{onClick:t[14]||(t[14]=e=>r.sort("percentuale_pos"))},"% POS")])]),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.paginatedRows,((e,t)=>((0,l.uX)(),(0,l.CE)("tr",{key:t},[(0,l.Lk)("td",null,(0,n.v_)(e.mese),1),(0,l.Lk)("td",null,(0,n.v_)(e.sede),1),(0,l.Lk)("td",null,(0,n.v_)(e.ore_erogate),1),(0,l.Lk)("td",null,(0,n.v_)(e.appuntamenti_totali),1),(0,l.Lk)("td",null,(0,n.v_)(e.resa_oraria.toFixed(2)),1),(0,l.Lk)("td",null,(0,n.v_)(e.appuntamenti_positivi),1),(0,l.Lk)("td",null,(0,n.v_)(e.percentuale_pos)+"%",1)])))),128)),0===r.paginatedRows.length?((0,l.uX)(),(0,l.CE)("tr",nk,t[50]||(t[50]=[(0,l.Lk)("td",{colspan:"7"},"Nessun risultato disponibile.",-1)]))):(0,l.Q3)("",!0)])]),(0,l.Lk)("div",ik,[(0,l.Lk)("div",sk,[(0,l.Lk)("label",null,[t[51]||(t[51]=(0,l.eW)(" Risultati: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[15]||(t[15]=e=>s.itemsPerPage=e)},[((0,l.uX)(),(0,l.CE)(l.FK,null,(0,l.pI)([5,10,20,50],(e=>(0,l.Lk)("option",{key:e,value:e},(0,n.v_)(e),9,rk))),64))],512),[[a.u1,s.itemsPerPage,void 0,{number:!0}]])]),(0,l.Lk)("span",dk,(0,n.v_)(r.filteredRows.length)+" risultati totali",1)]),(0,l.Lk)("div",ck,[(0,l.Lk)("button",{disabled:1===s.currentPage,onClick:t[16]||(t[16]=e=>r.changePage(s.currentPage-1))},t[52]||(t[52]=[(0,l.Lk)("i",{class:"fa-solid fa-backward-step"},null,-1)]),8,uk),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.visiblePages,(e=>((0,l.uX)(),(0,l.CE)("span",{key:e},["..."!==e?((0,l.uX)(),(0,l.CE)("button",{key:0,class:(0,n.C4)({active:e===s.currentPage}),onClick:t=>r.changePage(e)},(0,n.v_)(e),11,pk)):((0,l.uX)(),(0,l.CE)("span",hk,"..."))])))),128)),(0,l.Lk)("button",{disabled:s.currentPage===r.totalPages,onClick:t[17]||(t[17]=e=>r.changePage(s.currentPage+1))},t[53]||(t[53]=[(0,l.Lk)("i",{class:"fa-solid fa-forward-step"},null,-1)]),8,mk)])])])])):((0,l.uX)(),(0,l.CE)("div",Bg,[t[20]||(t[20]=(0,l.Lk)("i",{class:"fa-solid fa-filter-circle-exclamation icon-green"},null,-1)),t[21]||(t[21]=(0,l.Lk)("p",{class:"placeholder-text"}," Seleziona i parametri dal filtro per generare il report! ",-1)),(0,l.Lk)("button",{class:"filter-again-btn",onClick:t[1]||(t[1]=e=>s.showModal=!0)},t[19]||(t[19]=[(0,l.Lk)("i",{class:"fa-solid fa-filter"},null,-1),(0,l.eW)(" Apri filtri ")]))]))],64))])}var kk={name:"OperatorEfficiencyReport",components:{ReportFilterModal:Gm,SendReportModal:rg},data(){return{showModal:!0,sendModalOpen:!1,loading:!1,data:[],dates:{from:null,to:null},reportReady:!1,currentPage:1,itemsPerPage:10,sortField:"mese",sortOrder:"asc",searchText:""}},computed:{filteredRows(){const e=this.searchText.toLowerCase();return this.sortRows(this.data.filter((t=>Object.values(t).some((t=>String(t).toLowerCase().includes(e))))))},summary(){const e=this.data.reduce(((e,t)=>e+t.appuntamenti_totali),0),t=this.data.reduce(((e,t)=>e+t.appuntamenti_positivi),0),o=this.data.reduce(((e,t)=>e+t.ore_erogate),0),a=o>0?(e/o).toFixed(2):"0.00",l=e>0?(t/e*100).toFixed(2):"0.00";return{totalAppointments:e,totalPositive:t,totalHours:o.toFixed(2),resa:a,posRate:l}},summaryBySede(){return this.data.reduce(((e,t)=>{const o=t.sede||"Sconosciuta";return e[o]||(e[o]={appuntamenti_totali:0,appuntamenti_positivi:0,ore_erogate:0}),e[o].appuntamenti_totali+=t.appuntamenti_totali,e[o].appuntamenti_positivi+=t.appuntamenti_positivi,e[o].ore_erogate+=t.ore_erogate,e}),{})},paginatedRows(){const e=(this.currentPage-1)*this.itemsPerPage;return this.filteredRows.slice(e,e+this.itemsPerPage)},totalPages(){return Math.ceil(this.filteredRows.length/this.itemsPerPage)},visiblePages(){const e=this.totalPages,t=this.currentPage,o=[];if(e<=5)return Array.from({length:e},((e,t)=>t+1));t>2&&o.push(1),t>3&&o.push("...");for(let a=Math.max(2,t-1);a<=Math.min(e-1,t+1);a++)o.push(a);return t<e-2&&o.push("..."),t<e&&o.push(e),o},computedFilters(){return{from:this.dates.from,to:this.dates.to}}},methods:{async handleGenerate(e){this.loading=!0;try{this.dates={from:this.setDateStart(e.from),to:this.setDateEnd(e.to)};const t={from:this.dates.from.toISOString().split("T")[0],to:this.dates.to.toISOString().split("T")[0]},o=await P.A.get("https://dev.gixflow.cloud/api/reports/location-efficiency",{params:t,paramsSerializer:e=>new URLSearchParams(e).toString()});this.data=o.data.data||[],this.dates={from:e.from,to:e.to},this.reportReady=!0,this.showModal=!1,this.currentPage=1}catch(t){console.error("❌ Errore report efficienza:",t),this.$toast?.show?.("Errore nel caricamento del report",{type:"error",position:"bottom-right"})}finally{this.loading=!1}},formatDate(e){const t=new Date(e),o=t.toLocaleDateString("it-IT"),a=t.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"});return`${o} ${a}`},formatDateOnly(e){if(!e)return"";const t=new Date(e);return t.toLocaleDateString("it-IT")},setDateStart(e){const t=new Date(e);return t.setHours(0,0,0,0),t},setDateEnd(e){const t=new Date(e);return t.setHours(23,59,59,999),t},sort(e){this.sortField===e?this.sortOrder="asc"===this.sortOrder?"desc":"asc":(this.sortField=e,this.sortOrder="asc")},sortRows(e){return e.sort(((e,t)=>{let o=e[this.sortField],a=t[this.sortField];return"string"===typeof o&&(o=o.toLowerCase()),"string"===typeof a&&(a=a.toLowerCase()),o<a?"asc"===this.sortOrder?-1:1:o>a?"asc"===this.sortOrder?1:-1:0}))},changePage(e){e>=1&&e<=this.totalPages&&(this.currentPage=e)},exportCSV(){const e=["Mese","Sede","Ore","Appuntamenti","Resa oraria","App utili","% POS"],t=[e.join(","),...this.data.map((e=>[e.mese,e.sede,e.ore_erogate,e.appuntamenti_totali,e.resa_oraria.toFixed(2),e.appuntamenti_positivi,`${e.percentuale_pos}%`].join(",")))].join("\n"),o=new Blob([t],{type:"text/csv"}),a=document.createElement("a");a.href=URL.createObjectURL(o),a.download="report_efficienza_operatori.csv",a.click()},copyAllReportToClipboard(){const e=["Mese","Sede","Ore","Appuntamenti","Resa oraria","App utili","% POS"].join("\t"),t=this.data.map((e=>[e.mese,e.sede,e.ore_erogate,e.appuntamenti_totali,e.resa_oraria.toFixed(2),e.appuntamenti_positivi,`${e.percentuale_pos}%`].join("\t")));navigator.clipboard.writeText([e,...t].join("\n")).then((()=>{this.$toast?.show?.("Righe copiate negli appunti",{type:"success",position:"bottom-right"})}))},generateCSVBase64(){const e=["Mese","Sede","Ore","Appuntamenti","Resa oraria","App utili","% POS"],t=[e.join(","),...this.data.map((e=>[e.mese,e.sede,e.ore_erogate,e.appuntamenti_totali,e.resa_oraria.toFixed(2),e.appuntamenti_positivi,`${e.percentuale_pos}%`].join(",")))].join("\n");return btoa(unescape(encodeURIComponent(t)))}},watch:{itemsPerPage(){this.currentPage=1}}};const fk=(0,x.A)(kk,[["render",gk],["__scopeId","data-v-86248492"]]);var Lk=fk;const vk={class:"report-page"},bk={key:0,class:"loading-overlay"},yk={key:0,class:"placeholder"},_k={key:1},Ck={class:"report-range"},wk={class:"summary-wrapper"},Ak={class:"summary-box"},Ek={class:"summary-box"},Pk={class:"status-summary"},Dk={class:"top-controls"},Sk={class:"left-controls"},xk={class:"table-search-wrapper"},Fk={class:"table-wrapper"},Mk={class:"table"},Vk={key:0},Uk={key:0},Ik={key:0},Ok={key:0},Xk={key:0},Tk={key:0},$k={key:0},zk={class:"text-left"},Rk={key:0},Wk={class:"table-footer"},Nk={class:"footer-left"},jk=["value"],Bk={class:"total-count"},qk={class:"pagination"},Kk=["disabled"],Yk=["onClick"],Jk={key:1,class:"ellipsis"},Qk=["disabled"];function Gk(e,t,o,i,s,r){const d=(0,l.g2)("ReportFilterModal"),c=(0,l.g2)("SendReportModal");return(0,l.uX)(),(0,l.CE)("div",vk,[s.loading?((0,l.uX)(),(0,l.CE)("div",bk,t[18]||(t[18]=[(0,l.Lk)("div",{class:"spinner-box"},[(0,l.Lk)("i",{class:"fa-solid fa-spinner fa-spin fa-2x"}),(0,l.Lk)("p",null,"Caricamento...")],-1)]))):(0,l.Q3)("",!0),s.showModal?((0,l.uX)(),(0,l.Wv)(d,{key:1,loading:s.loading,filters:["operator","location","dateRange"],onGenerate:r.handleGenerate,onClose:t[0]||(t[0]=e=>s.showModal=!1)},null,8,["loading","onGenerate"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:2},[s.reportReady?((0,l.uX)(),(0,l.CE)("div",_k,[t[58]||(t[58]=(0,l.Lk)("h2",null,[(0,l.Lk)("i",{class:"fa-solid fa-user-check icon-green"}),(0,l.eW)(" Report Performance Operatori ")],-1)),(0,l.Lk)("p",Ck,[t[22]||(t[22]=(0,l.Lk)("strong",null,"Dal:",-1)),(0,l.eW)(" "+(0,n.v_)(r.formatDate(s.dates.from))+" al "+(0,n.v_)(r.formatDate(s.dates.to))+" | ",1),t[23]||(t[23]=(0,l.Lk)("strong",null,"Generato il:",-1)),(0,l.eW)(" "+(0,n.v_)(r.formatDate(new Date)),1)]),(0,l.Lk)("div",wk,[(0,l.Lk)("div",Ak,[t[31]||(t[31]=(0,l.Lk)("h3",null,[(0,l.Lk)("i",{class:"fa-solid fa-sliders icon-green"}),(0,l.eW)(" Filtri applicati: ")],-1)),(0,l.Lk)("ul",null,[(0,l.Lk)("li",null,[t[24]||(t[24]=(0,l.Lk)("i",{class:"fa-solid fa-calendar-days"},null,-1)),t[25]||(t[25]=(0,l.eW)(" Periodo: ")),(0,l.Lk)("strong",null,(0,n.v_)(r.formatDateOnly(s.dates.from)),1),t[26]||(t[26]=(0,l.eW)(" - ")),(0,l.Lk)("strong",null,(0,n.v_)(r.formatDateOnly(s.dates.to)),1)]),(0,l.Lk)("li",null,[t[27]||(t[27]=(0,l.Lk)("i",{class:"fa-solid fa-headset"},null,-1)),t[28]||(t[28]=(0,l.eW)(" Operatori: ")),(0,l.Lk)("strong",null,(0,n.v_)(r.resolveFilterNames(s.appliedFilters.operator_id,s.operators).join(", ")),1)]),(0,l.Lk)("li",null,[t[29]||(t[29]=(0,l.Lk)("i",{class:"fa-solid fa-building"},null,-1)),t[30]||(t[30]=(0,l.eW)(" Sedi: ")),(0,l.Lk)("strong",null,(0,n.v_)(r.resolveFilterNames(s.appliedFilters.location_id,s.locations,"location").join(", ")),1)])])]),(0,l.Lk)("div",Ek,[t[42]||(t[42]=(0,l.Lk)("h3",null,[(0,l.Lk)("i",{class:"fa-solid fa-list-ol icon-green"}),(0,l.eW)(" Riepilogo: ")],-1)),(0,l.Lk)("ul",Pk,[(0,l.Lk)("li",null,[t[32]||(t[32]=(0,l.Lk)("i",{class:"fa-solid fa-users"},null,-1)),t[33]||(t[33]=(0,l.eW)(" Operatori: ")),(0,l.Lk)("strong",null,(0,n.v_)(s.data.length),1)]),(0,l.Lk)("li",null,[t[34]||(t[34]=(0,l.Lk)("i",{class:"fa-solid fa-clock"},null,-1)),t[35]||(t[35]=(0,l.eW)(" Ore totali: ")),(0,l.Lk)("strong",null,(0,n.v_)(r.totalHours),1)]),(0,l.Lk)("li",null,[t[36]||(t[36]=(0,l.Lk)("i",{class:"fa-solid fa-calendar-check"},null,-1)),t[37]||(t[37]=(0,l.eW)(" Appuntamenti: ")),(0,l.Lk)("strong",null,(0,n.v_)(r.totalAppointments),1)]),(0,l.Lk)("li",null,[t[38]||(t[38]=(0,l.Lk)("i",{class:"fa-solid fa-chart-line"},null,-1)),t[39]||(t[39]=(0,l.eW)(" Resa/h: ")),(0,l.Lk)("strong",null,(0,n.v_)(r.averageYield),1)]),(0,l.Lk)("li",null,[t[40]||(t[40]=(0,l.Lk)("i",{class:"fa-solid fa-percent"},null,-1)),t[41]||(t[41]=(0,l.eW)(" Conversion: ")),(0,l.Lk)("strong",null,(0,n.v_)(r.positiveRate)+"%",1)])])])]),(0,l.Lk)("div",Dk,[(0,l.Lk)("div",Sk,[(0,l.Lk)("button",{class:"function-button-primary",onClick:t[2]||(t[2]=(...e)=>r.exportCSV&&r.exportCSV(...e)),title:"Scarica CSV"},t[43]||(t[43]=[(0,l.Lk)("i",{class:"fa-solid fa-download"},null,-1)])),(0,l.Lk)("button",{class:"function-button-primary",onClick:t[3]||(t[3]=e=>s.showModal=!0),title:"Modifica filtri"},t[44]||(t[44]=[(0,l.Lk)("i",{class:"fa-solid fa-filter-circle-xmark"},null,-1)])),(0,l.Lk)("button",{class:"function-button-primary",onClick:t[4]||(t[4]=(...e)=>r.copyAllReportToClipboard&&r.copyAllReportToClipboard(...e)),title:"Copia report"},t[45]||(t[45]=[(0,l.Lk)("i",{class:"fa-solid fa-copy"},null,-1)])),(0,l.Lk)("button",{class:"function-button-primary",onClick:t[5]||(t[5]=e=>s.sendModalOpen=!0),title:"Invia via email"},t[46]||(t[46]=[(0,l.Lk)("i",{class:"fa-solid fa-paper-plane"},null,-1)]))]),(0,l.Lk)("div",xk,[(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>s.searchText=e),type:"text",placeholder:"Cerca nei risultati..."},null,512),[[a.Jo,s.searchText]])])]),s.sendModalOpen?((0,l.uX)(),(0,l.Wv)(c,{key:0,csvBase64:r.generateCSVBase64(),reportType:"operator-performance",defaultSubject:`Report Performance Operatori (${r.formatDateOnly(s.dates.from)} - ${r.formatDateOnly(s.dates.to)})`,filters:r.computedFilters,summary:r.summaryData,total:r.totalAppointments,onClose:t[7]||(t[7]=e=>s.sendModalOpen=!1)},null,8,["csvBase64","defaultSubject","filters","summary","total"])):(0,l.Q3)("",!0),(0,l.Lk)("div",Fk,[(0,l.Lk)("table",Mk,[(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",{onClick:t[8]||(t[8]=e=>r.sort("operator_name")),class:"text-left"},[t[47]||(t[47]=(0,l.eW)(" Operatore ")),"operator_name"===s.sortField?((0,l.uX)(),(0,l.CE)("span",Vk,[(0,l.Lk)("i",{class:(0,n.C4)("asc"===s.sortOrder?"fa-solid fa-caret-up":"fa-solid fa-caret-down")},null,2)])):(0,l.Q3)("",!0)]),(0,l.Lk)("th",{onClick:t[9]||(t[9]=e=>r.sort("sede"))},[t[48]||(t[48]=(0,l.eW)(" Sede ")),"sede"===s.sortField?((0,l.uX)(),(0,l.CE)("span",Uk,[(0,l.Lk)("i",{class:(0,n.C4)("asc"===s.sortOrder?"fa-solid fa-caret-up":"fa-solid fa-caret-down")},null,2)])):(0,l.Q3)("",!0)]),(0,l.Lk)("th",{onClick:t[10]||(t[10]=e=>r.sort("ore_erogate"))},[t[49]||(t[49]=(0,l.eW)(" Ore ")),"ore_erogate"===s.sortField?((0,l.uX)(),(0,l.CE)("span",Ik,[(0,l.Lk)("i",{class:(0,n.C4)("asc"===s.sortOrder?"fa-solid fa-caret-up":"fa-solid fa-caret-down")},null,2)])):(0,l.Q3)("",!0)]),(0,l.Lk)("th",{onClick:t[11]||(t[11]=e=>r.sort("appuntamenti_totali"))},[t[50]||(t[50]=(0,l.eW)(" Appuntamenti ")),"appuntamenti_totali"===s.sortField?((0,l.uX)(),(0,l.CE)("span",Ok,[(0,l.Lk)("i",{class:(0,n.C4)("asc"===s.sortOrder?"fa-solid fa-caret-up":"fa-solid fa-caret-down")},null,2)])):(0,l.Q3)("",!0)]),(0,l.Lk)("th",{onClick:t[12]||(t[12]=e=>r.sort("resa_oraria"))},[t[51]||(t[51]=(0,l.eW)(" Resa oraria ")),"resa_oraria"===s.sortField?((0,l.uX)(),(0,l.CE)("span",Xk,[(0,l.Lk)("i",{class:(0,n.C4)("asc"===s.sortOrder?"fa-solid fa-caret-up":"fa-solid fa-caret-down")},null,2)])):(0,l.Q3)("",!0)]),(0,l.Lk)("th",{onClick:t[13]||(t[13]=e=>r.sort("appuntamenti_positivi"))},[t[52]||(t[52]=(0,l.eW)(" App. Positivi ")),"appuntamenti_positivi"===s.sortField?((0,l.uX)(),(0,l.CE)("span",Tk,[(0,l.Lk)("i",{class:(0,n.C4)("asc"===s.sortOrder?"fa-solid fa-caret-up":"fa-solid fa-caret-down")},null,2)])):(0,l.Q3)("",!0)]),(0,l.Lk)("th",{onClick:t[14]||(t[14]=e=>r.sort("percentuale_pos"))},[t[53]||(t[53]=(0,l.eW)(" % Positivi ")),"percentuale_pos"===s.sortField?((0,l.uX)(),(0,l.CE)("span",$k,[(0,l.Lk)("i",{class:(0,n.C4)("asc"===s.sortOrder?"fa-solid fa-caret-up":"fa-solid fa-caret-down")},null,2)])):(0,l.Q3)("",!0)])])]),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.paginatedRows,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.operator_id},[(0,l.Lk)("td",zk,(0,n.v_)(e.operator_name),1),(0,l.Lk)("td",null,(0,n.v_)(e.sede),1),(0,l.Lk)("td",null,(0,n.v_)(e.ore_erogate),1),(0,l.Lk)("td",null,(0,n.v_)(e.appuntamenti_totali),1),(0,l.Lk)("td",null,(0,n.v_)(e.resa_oraria.toFixed(2)),1),(0,l.Lk)("td",null,(0,n.v_)(e.appuntamenti_positivi),1),(0,l.Lk)("td",null,(0,n.v_)(e.percentuale_pos.toFixed(2))+"%",1)])))),128)),0===r.paginatedRows.length?((0,l.uX)(),(0,l.CE)("tr",Rk,t[54]||(t[54]=[(0,l.Lk)("td",{colspan:"7"},"Nessun dato disponibile.",-1)]))):(0,l.Q3)("",!0)])]),(0,l.Lk)("div",Wk,[(0,l.Lk)("div",Nk,[(0,l.Lk)("label",null,[t[55]||(t[55]=(0,l.eW)(" Risultati: ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[15]||(t[15]=e=>s.itemsPerPage=e)},[((0,l.uX)(),(0,l.CE)(l.FK,null,(0,l.pI)([5,10,20,50,100],(e=>(0,l.Lk)("option",{key:e,value:e},(0,n.v_)(e),9,jk))),64))],512),[[a.u1,s.itemsPerPage,void 0,{number:!0}]])]),(0,l.Lk)("span",Bk,(0,n.v_)(r.filteredRows.length)+" risultati totali",1)]),(0,l.Lk)("div",qk,[(0,l.Lk)("button",{disabled:1===s.currentPage,onClick:t[16]||(t[16]=e=>r.changePage(s.currentPage-1))},t[56]||(t[56]=[(0,l.Lk)("i",{class:"fa-solid fa-backward-step"},null,-1)]),8,Kk),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.visiblePages,(e=>((0,l.uX)(),(0,l.CE)("span",{key:e},["..."!==e?((0,l.uX)(),(0,l.CE)("button",{key:0,class:(0,n.C4)({active:e===s.currentPage}),onClick:t=>r.changePage(e)},(0,n.v_)(e),11,Yk)):((0,l.uX)(),(0,l.CE)("span",Jk,"..."))])))),128)),(0,l.Lk)("button",{disabled:s.currentPage===r.totalPages,onClick:t[17]||(t[17]=e=>r.changePage(s.currentPage+1))},t[57]||(t[57]=[(0,l.Lk)("i",{class:"fa-solid fa-forward-step"},null,-1)]),8,Qk)])])])])):((0,l.uX)(),(0,l.CE)("div",yk,[t[20]||(t[20]=(0,l.Lk)("i",{class:"fa-solid fa-filter-circle-exclamation icon-green"},null,-1)),t[21]||(t[21]=(0,l.Lk)("p",{class:"placeholder-text"}," Seleziona i parametri dal filtro per generare il report! ",-1)),(0,l.Lk)("button",{class:"filter-again-btn",onClick:t[1]||(t[1]=e=>s.showModal=!0)},t[19]||(t[19]=[(0,l.Lk)("i",{class:"fa-solid fa-filter"},null,-1),(0,l.eW)(" Apri filtri ")]))]))],64))])}var Hk={name:"OperatorPerformanceReport",components:{ReportFilterModal:Gm,SendReportModal:rg},data(){return{loading:!1,showModal:!0,sendModalOpen:!1,reportReady:!1,data:[],dates:{from:null,to:null},appliedFilters:{},searchText:"",currentPage:1,itemsPerPage:10,sortField:"operator_name",sortOrder:"asc",operators:[],locations:[]}},computed:{filteredRows(){const e=this.searchText.toLowerCase();return this.sortRows(this.data.filter((t=>Object.values(t).some((t=>String(t).toLowerCase().includes(e))))))},paginatedRows(){const e=(this.currentPage-1)*this.itemsPerPage;return this.filteredRows.slice(e,e+this.itemsPerPage)},totalPages(){return Math.ceil(this.filteredRows.length/this.itemsPerPage)},visiblePages(){const e=this.totalPages,t=this.currentPage,o=[];if(e<=5)return Array.from({length:e},((e,t)=>t+1));t>2&&o.push(1),t>3&&o.push("...");for(let a=Math.max(2,t-1);a<=Math.min(e-1,t+1);a++)o.push(a);return t<e-2&&o.push("..."),t<e&&o.push(e),o},totalAppointments(){return this.data.reduce(((e,t)=>e+t.appuntamenti_totali),0)},totalHours(){return this.data.reduce(((e,t)=>e+t.ore_erogate),0).toFixed(2)},averageYield(){const e=this.data.reduce(((e,t)=>e+t.ore_erogate),0),t=this.data.reduce(((e,t)=>e+t.appuntamenti_totali),0);return e>0?(t/e).toFixed(2):"0.00"},positiveRate(){const e=this.data.reduce(((e,t)=>e+t.appuntamenti_positivi),0);return this.totalAppointments>0?(e/this.totalAppointments*100).toFixed(2):"0.00"},summaryData(){return{Operatori:this.data.length,"Ore Totali":this.totalHours,Appuntamenti:this.totalAppointments,"Resa media":this.averageYield,"% Positivi":this.positiveRate+"%"}},computedFilters(){return{from:this.dates.from,to:this.dates.to,operatorLabel:this.resolveFilterNames(this.appliedFilters.operator_id,this.operators).join(", "),locationLabel:this.resolveFilterNames(this.appliedFilters.location_id,this.locations,"location").join(", ")}}},methods:{async handleGenerate(e){this.loading=!0;try{const t=await P.A.get("https://dev.gixflow.cloud/api/reports/operator-performance",{params:e}),[o,a]=await Promise.all([P.A.get("https://dev.gixflow.cloud/api/users"),P.A.get("https://dev.gixflow.cloud/api/locations-table")]),l=Array.isArray(o.data)?o.data.flat():[];this.operators=l.filter((e=>1===e.role_id)),this.locations=a.data||[],this.data=t.data.data||[],this.dates={from:e.from,to:e.to},this.appliedFilters={...e},this.currentPage=1,this.reportReady=!0,this.showModal=!1}catch(t){console.error("Errore generazione report:",t),this.$toast?.show?.("Errore nel caricamento del report",{type:"error",position:"bottom-right"})}finally{this.loading=!1}},formatDate(e){const t=new Date(e);return t.toLocaleDateString("it-IT")+" "+t.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})},formatDateOnly(e){return e?new Date(e).toLocaleDateString("it-IT"):""},sort(e){this.sortField===e?this.sortOrder="asc"===this.sortOrder?"desc":"asc":(this.sortField=e,this.sortOrder="asc")},sortRows(e){return e.sort(((e,t)=>{let o=e[this.sortField],a=t[this.sortField];return"string"===typeof o&&(o=o.toLowerCase()),"string"===typeof a&&(a=a.toLowerCase()),o<a?"asc"===this.sortOrder?-1:1:o>a?"asc"===this.sortOrder?1:-1:0}))},changePage(e){e>=1&&e<=this.totalPages&&(this.currentPage=e)},resolveFilterNames(e,t,o="cognome_nome"){const a=Array.isArray(e)?e:null!=e?[e]:[];return 0===a.length||this.isAllSelected(a,t)?["Tutti"]:t.filter((e=>a.includes(e.id))).map((e=>"cognome_nome"===o?`${e.cognome} ${e.nome}`:e[o]))},isAllSelected(e,t){const o=t.map((e=>String(e.id))).sort(),a=e.map(String).sort();return JSON.stringify(a)===JSON.stringify(o)},exportCSV(){const e=["Operatore","Sede","Ore","Appuntamenti","Resa oraria","App. Positivi","% Positivi"],t=[e.join(","),...this.data.map((e=>[e.operator_name,e.sede,e.ore_erogate,e.appuntamenti_totali,e.resa_oraria.toFixed(2),e.appuntamenti_positivi,e.percentuale_pos.toFixed(2)+"%"].join(",")))].join("\n"),o=new Blob([t],{type:"text/csv"}),a=document.createElement("a");a.href=URL.createObjectURL(o),a.download="report_operatori.csv",a.click()},generateCSVBase64(){const e=["Operatore","Sede","Ore","Appuntamenti","Resa oraria","App. Positivi","% Positivi"],t=[e.join(","),...this.data.map((e=>[e.operator_name,e.sede,e.ore_erogate,e.appuntamenti_totali,e.resa_oraria.toFixed(2),e.appuntamenti_positivi,e.percentuale_pos.toFixed(2)+"%"].join(",")))].join("\n");return btoa(unescape(encodeURIComponent(t)))},copyAllReportToClipboard(){const e=["Operatore","Sede","Ore","Appuntamenti","Resa oraria","App. Positivi","% Positivi"],t=[e.join("\t"),...this.data.map((e=>[e.operator_name,e.sede,e.ore_erogate,e.appuntamenti_totali,e.resa_oraria.toFixed(2),e.appuntamenti_positivi,e.percentuale_pos.toFixed(2)+"%"].join("\t")))].join("\n");navigator.clipboard.writeText(t).then((()=>{this.$toast?.show?.("Report copiato negli appunti!",{type:"success",position:"bottom-right"})}))}},watch:{itemsPerPage(){this.currentPage=1}}};const Zk=(0,x.A)(Hk,[["render",Gk],["__scopeId","data-v-5adb0a13"]]);var ef=Zk;const tf=[{path:"/login",name:"Login",component:ya,meta:{requiresSidebar:!1,requiresTopbar:!1}},{path:"/",name:"Dashboard",component:Se,meta:{requiresSidebar:!0,requiresAuth:!0}},{path:"/appointments",name:"Appointments",component:Ct,meta:{requiresSidebar:!0,requiresAuth:!0}},{path:"/agenda-schedules",name:"AgendaSchedule",component:zt,meta:{requiresSidebar:!0,requiresAuth:!0}},{path:"/calendar",name:"Calendar",component:yo,meta:{requiresSidebar:!0,requiresAuth:!0}},{path:"/sidebar",name:"SideBar",component:M,meta:{requiresSidebar:!0,requiresAuth:!0}},{path:"/topbar",name:"TopBar",component:j,meta:{requiresSidebar:!0,requiresAuth:!0}},{path:"/reports",name:"Reports",component:Ma,meta:{requiresSidebar:!0,requiresAuth:!0}},{path:"/clients",name:"Clients",component:Pl,meta:{requiresSidebar:!0,requiresAuth:!0}},{path:"/contracts",name:"ContractsPage",component:Nl,meta:{requiresSidebar:!0,requiresAuth:!0}},{path:"/contracts/:id",name:"ContractsDetails",component:ji,props:!0,meta:{requiresSidebar:!0,requiresAuth:!0}},{path:"/contracts/new",name:"ContractsNew",component:Yn,meta:{requiresSidebar:!0,requiresAuth:!0}},{path:"/settings/tables",name:"SettingsTables",component:ks,meta:{requiresSidebar:!0,requiresAuth:!0}},{path:"/settings/tables/:tableName",component:ns,meta:{requiresSidebar:!0,requiresAuth:!0}},{path:"/settings/logs",component:Xs,meta:{requiresSidebar:!0,requiresAuth:!0}},{path:"/settings/generate-api-key",component:Hs,meta:{requiresSidebar:!0,requiresAuth:!0}},{path:"/commissioning/agents",component:Ic,meta:{requiresSidebar:!0,requiresAuth:!0}},{path:"/commissioning/operators",component:Vp,meta:{requiresSidebar:!0,requiresAuth:!0}},{path:"/user/profile",name:"UserProfile",component:ph,meta:{requiresSidebar:!0,requiresAuth:!0}},{path:"/settings/email",name:"EmailConfigPage",component:Eh,meta:{requiresSidebar:!0,requiresAuth:!0}},{path:"/reports/appointments-report",name:"AppointmentsReport",component:ug,meta:{requiresSidebar:!0,requiresAuth:!0}},{path:"/reports/contracts-by-agent-report",name:"ContractsByAgentReport",component:Wg,meta:{requiresSidebar:!0,requiresAuth:!0}},{path:"/reports/location-efficiency-report",name:"LocationEfficiencyReport",component:Lk,meta:{requiresSidebar:!0,requiresAuth:!0}},{path:"/reports/operator-performance-report",name:"OperatorPerformanceReport",component:ef,meta:{requiresSidebar:!0,requiresAuth:!0}},{path:"/users",name:"UserManagement",component:ia,meta:{requiresSidebar:!0,requiresAuth:!0,requiresAdmin:!1}}],of=(0,J.aE)({history:(0,J.LA)(),routes:tf});of.beforeEach(((e,t,o)=>{const a=localStorage.getItem("token"),l=a?JSON.parse(atob(a.split(".")[1])):null;return e.meta.requiresAuth&&!a?o("/login"):!e.meta.requiresAdmin||l&&"admin"===l.role?void o():o("/")}));var af=of,lf=o(6673),nf=o(9950);o(2681);const sf=(0,a.Ef)(K),rf=localStorage.getItem("token");let df;function cf(){console.warn("[DEBUG] Utente inattivo per 30 minuti! Logout automatico."),localStorage.removeItem("token"),delete P.A.defaults.headers.common["Authorization"],window.location.href="/login"}function uf(){clearTimeout(df),df=setTimeout(cf,18e5)}function pf(){const e=localStorage.getItem("token");if(e)try{const t=(0,D.s)(e),o=Math.floor(Date.now()/1e3),a=1e3*(t.exp-o);a>0?(console.log(`[DEBUG] Logout automatico tra ${a/1e3} secondi.`),uf()):cf()}catch(t){console.error("[DEBUG] Errore nella decodifica del token:",t),cf()}}rf&&(P.A.defaults.headers.common["Authorization"]=`Bearer ${rf}`),P.A.defaults.baseURL="https://app.gixflow.cloud/api",P.A.interceptors.request.use((e=>{const t=localStorage.getItem("token");return console.log("[DEBUG] Token Prelevato da LocalStorage:",t),t&&(e.headers.Authorization=`Bearer ${t}`),e}),(e=>Promise.reject(e))),sf.use(lf.Ay,{directive:"tippy",component:"Tippy",defaultProps:{placement:"top",allowHTML:!0}}),sf.use(af),sf.use(Y.Ay),sf.use(nf.h),sf.mount("#app"),window.addEventListener("mousemove",uf),window.addEventListener("keydown",uf),window.addEventListener("scroll",uf),window.addEventListener("click",uf),P.A.interceptors.request.use((e=>(uf(),e)),(e=>Promise.reject(e))),pf()}},t={};function o(a){var l=t[a];if(void 0!==l)return l.exports;var n=t[a]={id:a,loaded:!1,exports:{}};return e[a].call(n.exports,n,n.exports,o),n.loaded=!0,n.exports}o.m=e,function(){var e=[];o.O=function(t,a,l,n){if(!a){var i=1/0;for(c=0;c<e.length;c++){a=e[c][0],l=e[c][1],n=e[c][2];for(var s=!0,r=0;r<a.length;r++)(!1&n||i>=n)&&Object.keys(o.O).every((function(e){return o.O[e](a[r])}))?a.splice(r--,1):(s=!1,n<i&&(i=n));if(s){e.splice(c--,1);var d=l();void 0!==d&&(t=d)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[a,l,n]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){o.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={524:0};o.O.j=function(t){return 0===e[t]};var t=function(t,a){var l,n,i=a[0],s=a[1],r=a[2],d=0;if(i.some((function(t){return 0!==e[t]}))){for(l in s)o.o(s,l)&&(o.m[l]=s[l]);if(r)var c=r(o)}for(t&&t(a);d<i.length;d++)n=i[d],o.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return o.O(c)},a=self["webpackChunkgixflow_f"]=self["webpackChunkgixflow_f"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=o.O(void 0,[504],(function(){return o(7933)}));a=o.O(a)})();
//# sourceMappingURL=app.d46f2fba.js.map